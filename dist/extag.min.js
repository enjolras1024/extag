!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Extag=t()}(this,function(){"use strict";var n=/\./,i=/(\]\.)|\.|\[|\]/g,r=/^[\$_A-Z][\$_A-Z0-9]*(\.[\$_A-Z0-9]+)*$/i,s=/^[\$_A-Z][\$_A-Z0-9]*((\[\d+\])|(\.[\$_A-Z0-9]+))*$/i;function a(e,t){for(var n=-1,i=e.length,r=t;++n<i;)if(null==(r=r[e[n]]))return r;return r}var d={test:function(e){return r.test(e)},parse:function(e){var t=null;return r.test(e)?t=e.split(n):s.test(e)&&(t=e.replace(i," ").trim().split(" ")),t},search:function(e,t,n){var i;if("string"==typeof e&&(e=this.parse(e)),e)return t&&(i=a(e,t)),null!=i||n||("undefined"!=typeof window?i=a(e,window):"undefined"!=typeof global&&(i=a(e,global))),i}},o={},v={JS_ENV:"",JSXEngine:null,HTMEngine:null,HTMXParser:null,get:function(e){return o[e]},set:function(e,t){o[e]=t}},l=Array.prototype.slice;function f(e,t,n){return l.call(e,t,n)}function t(e){this.target=e}t.prototype.bind=function(){for(var e,t,n=this.target,i=0;i<arguments.length;++i)"function"==typeof(t=n[e=arguments[i]])&&(n[e]=t.bind(n))};var c=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");if(!(e instanceof Object)){var t=typeof e;"number"===t?e=new Number(e):"string"===t?e=new String(e):"boolean"===t&&(e=new Boolean(e))}var n,i,r,s=arguments.length;for(r=1;r<s;++r)if((n=arguments[r])instanceof Object)for(i in n)n.hasOwnProperty(i)&&Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i));return e};function u(e,t){var n,i=e.length;if(!t)for(n=0;n<i;++n)if(Array.isArray(e[n])){t=[];break}if(t)for(n=0;n<i;++n){var r=e[n];Array.isArray(r)?u(r,t):t.push(r)}return t||e}function e(e){return"function"==typeof e&&/native code/.test(e.toString())}var y,h=function(e,t,n,i){if(e){var r=e.resolve();return function(e){"function"==typeof e&&r.then(e)}}if(n){var s=[],a=0,o=document.createTextNode("");return new n(function(){for(var e;e=s.pop();)e();a=a?0:1}).observe(o,{characterData:!0}),function(e){"function"==typeof e&&(s.unshift(e),o.data=a)}}return i?function(e){if("function"==typeof e){var t=!1,n=function(){t||(t=!0,e())};i(n),setTimeout(n)}}:t||setTimeout}("undefined"!=typeof Promise&&e(Promise)?Promise:null,void 0!==h&&e(h)?h:null,"undefined"!=typeof MutationObserver&&e(MutationObserver)?MutationObserver:null,"undefined"!=typeof requestAnimationFrame&&e(requestAnimationFrame)?requestAnimationFrame:null);try{v.JS_ENV=">=ES5",(y=Object.defineProperty)({},"x",{get:function(){}})}catch(e){v.JS_ENV="<ES5",y=function(e,t,n){e[t]=n.value}}function p(e,t){var n,i,r;for(n=0,i=t.length;n<i;++n)for(var s in r=t[n])r.hasOwnProperty(s)&&y(e,s,Object.getOwnPropertyDescriptor(r,s))}function g(e){var t,n,i,r,s;if(e.hasOwnProperty("extends")){if("function"!=typeof(n=e.extends))throw new TypeError("superClass must be a function")}else n=Object;if(e.hasOwnProperty("constructor")){if("function"!=typeof(t=e.constructor))throw new TypeError("subClass must be a function")}else t=function(){n.apply(this,arguments)};return t.prototype=Object.create(n.prototype),s=[t.prototype],i=e.mixins,Array.isArray(i)&&s.push.apply(s,i),s.push(e),p(t.prototype,s),y(t.prototype,"constructor",{value:t,enumerable:!1,writable:!0,configurable:!0}),s=[t,n],(r=e.statics)&&(i=r.mixins,Array.isArray(i)&&s.push.apply(s,i),s.push(r)),p(t,s),delete t.prototype.statics,delete t.prototype.entend,delete t.prototype.mixins,delete t.mixins,t}var m,_=/\&[\w\#]{2,6};/;try{var b=document.createElement("div");(function(e){return b.textContent=e,b.innerHTML}),m=function(e){return _.test(e)?(b.innerHTML=e,b.textContent):e}}catch(e){(function(e){return/[<>&"\u00a0]/.test(e)?e.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\u00a0/g,"&nbsp;"):e}),m=function(e){return _.test(e)?e.replace(/\&nbsp;/g,String.fromCharCode(160)).replace(/\&quot;/g,'"').replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&amp;/g,"&"):e}}function x(e,t){var n=e instanceof Error?e:new Error(e);throw t&&c(n,t),n}var w="view-engine",k={},A=[],E="{}",O={DATA:"@",TEXT:"#",EVENT:"+",MODIFIER:"::",CONVERTER:"|=",ASSIGN:"!",TWO_WAY:"@",ANY_WAY:"^",ONE_TIME:"?"},C=/\s+/,$=/\s/g,P=/^[A-Z]/,T=/^this\./,D=/^(this\.)?[\w\$\_]+$/;function N(e,t,n){(t=f(t,0))[0]=n+" "+t[0],e.apply(console,t)}var S=function(){N(console.warn,arguments,"[EXTAG WARN]")};function j(){x("Parent is a base class and can not be instantiated!")}function M(e){for(var t=e._parent;t&&0===t.$type;)t=t._parent;return t}function I(e,t){var n,i,r=e._children,s=r.length;for(t=t||[],n=0;n<s;++n)0===(i=r[n]).$type?I(i,t):t.push(i);return t}function z(){}function W(e){var t="";return e.key?t+="."+e.key[0].toLowerCase()+e.key.slice(1):e.button&&(t+=[".left",".middle",".right"][e.button]),e.altKey&&(t+=".alt"),e.ctrlKey&&(t+=".ctrl"),e.metaKey&&(t+=".meta"),e.shiftKey&&(t+=".shift"),t}g({constructor:j,statics:{clean:function(e){e._children&&(e._children.isInvalidated=!1)},invalidate:function(e){e._children&&(e._children.isInvalidated=!0,e.invalidate(2))},findParent:M,flattenChildren:I},getParent:function(e){return e?M(this):this._parent},getChildren:function(e){return e?I(this):this._children?this._children.slice(0):[]},setChildren:function(e){var t,n=this._children,i=e?e.length:0,r=n?n.length:0;if(r===i){for(t=0;t<i&&n[t]===e[t];++t);if(t===i)return this}if(r){for(t=0;t<r;++t)n[t]._parent=null;n.length=0}if(i)for(t=0;t<i;++t)this.insertChild(e[t],null);else r&&this.invalidate(2);return this},insertChild:function(e,t){null==e&&x("The new child to be inserted into this parent must not be null!");var n,i,r,s=this._children;if(s||y(this,"_children",{value:s=[],writable:!1,enumerable:!1,configurable:!0}),r=s.length,null!=t){for(n=0;n<r&&(s[n]!==t||this!==t._parent);++n);if(n===r&&x("The child before which the new child is to be inserted is not a child of this parent!"),t===e)return this}else n=r;if(e._parent)if(e._parent===this){for(i=0;i<r;++i)if(s[i]===e){if(i===n)return this;s.splice(i,1),n=i<n?n-1:n,r=s.length;break}}else e._parent.removeChild(e);return n<r?s.splice(n,0,e):s.push(e),(e._parent=this).invalidate(2),this},appendChild:function(e){this.insertChild(e,null)},removeChild:function(e){null==e&&x("The new child to be removed from this parent must not be null!");var t=0,n=0,i=this._children;if(i)for(t=0,n=i.length;t<n&&(i[t]!==e||this!==e._parent);++t);return t===n&&x("The child to be removed is not a child of this parent!"),t<n-1?i.splice(t,1):i.pop(),e._parent=null,this.invalidate(2),this},replaceChild:function(e,t){null==e&&x("The new child to be inserted into this parent must not be null!");var n=0,i=0,r=0,s=this._children;if(s)for(n=0,r=s.length;n<r&&(s[n]!==t||this!==t._parent);++n);if(n===r&&x("The child to be replaced is not a child of this parent!"),e===t)return this;if(e._parent)if(e._parent===this){for(i=0;i<r;++i)if(s[i]===e){s.splice(i,1),n=i<n?n-1:n,r=s.length;break}}else e._parent.removeChild(e);return t._parent=null,e._parent=this,s[n]=e,this.invalidate(2),this}});var V=[function(e){this.emit(e.type+W(e),e,0)},function(e){this.emit(e.type+W(e),e,1)},function(e){this.emit(e.type+W(e),e,2)},function(e){this.emit(e.type+W(e),e,3)}];function Y(e){var t=0;return e&&(e.capture&&(t|=1),e.passive&&(t|=2),e.once&&(t|=4)),t}function R(e){var t={};return 1&e&&(t.capture=!0),2&e&&(t.passive=!0),4&e&&(t.once=!0),t}function X(e,t){return(1&e)==(1&t)}function L(e,t,n,i){var r=e._actions;if("function"==typeof n){r||y(e,"_actions",{value:r={},writable:!1,enumerable:!1,configurable:!0});var s=t.split(".");2<s.length&&(t=s[0]+"."+s.slice(1).sort().join("."));var a=r[t];a||(a=r[t]={type:t,handlers:[]});var o,l,c,f,u,h,p=Y(i),d=a.handlers,g=d.length;for(l=0;l<g;++l)if((o=d[l])&&n===o.func&&X(p,o.flag))return;o={func:n,flag:p},d.push(o),"listeners"in a&&!a.listeners||(f=a,u=o,"function"==typeof(h=(c=e).constructor).addEventListener?h.addEventListener(c,f,u):f.listeners=null)}}function H(e,t,n,i){var r=e._actions;if(r){var s=t.split(".");2<s.length&&(t=s[0]+"."+s.slice(1).sort().join("."));var a=r[t];if(a){var o,l,c=a.handlers,f=c.length,u=!0;if(2!==arguments.length){var h,p,d,g,v=Y(i);for(l=0;l<f;++l)(o=c[l])&&n===o.func&&X(v,o.flag)&&(c[l]=null),c[l]&&(u=!1);if(a.listeners)a.listeners[3&o.flag]&&(p=a,d=o,"function"==typeof(g=(h=e).constructor).removeEventListener&&g.removeEventListener(h,p,d));u&&(c.length=0,delete r[t])}else for(l=0;l<f;++l)(o=c[l])&&o.func&&H(e,t,o.func,o.flag?R(o.flag):null)}}}function Q(){1<arguments.length?(this.ctor=arguments[0],this.args=arguments[1]):this.gen=arguments[0]}g({constructor:z,statics:{opts2flag:Y,flag2opts:R,getListenerByFlag:function(e){return V[3&e]}},on:function(e,t,n){if("object"!=typeof e)return L(this,e,t,n),this;var i=e;for(e in i)if(i.hasOwnProperty(e)){var r=i[e];Array.isArray(r)?L(this,e,r[0],r[1]):L(this,e,r)}return this},off:function(e,t,n){var i=this._actions;if(!i)return this;var r=arguments.length,s=typeof e;if(0===r)for(e in i)H(this,e);else if("string"===s)1===r?H(this,e):H(this,e,t,n);else if("object"===s){var a=e;for(e in a)if(a.hasOwnProperty(e)){var o=a[e];Array.isArray(o)?H(this,e,o[0],o[1]):null==o?H(this,e):H(this,e,o)}}return this},emit:function(e){var t=this._actions;if(!t)return this;var n=e.split(".");2<n.length&&(e=n[0]+"."+n.slice(1).sort().join("."));var i=t[e];if(i)for(var r,s=i.listeners?arguments[2]:0,a=i.handlers,o=0,l=a.length;o<l;++o)(r=a[o])&&X(s,r.flag)&&(4&r.flag&&this.off(e,r.func,r.flag?R(r.flag):null),r.func.apply(null,f(arguments,1)));if(1<n.length&&t[n[0]]){var c=f(arguments,1);c.unshift(n[0]),this.emit.apply(this,c)}return this}}),g({constructor:Q,statics:{anew:function(e){return new Q(e,f(arguments,1))},inst:function(e){return new Q(e)}},gen:function(){var e=this.ctor,t=this.args;if(!t)return new e;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);default:throw new Error("`anew` arguments length must not exceed 6.")}}});var U={configurable:!0,enumerable:!0},F={},G={};var q={},J=function(e,t){return t[e]};function Z(e,t){var n,i;U.get=(n=t,F.hasOwnProperty(n)||(F[n]=function(){return this.get(n)}),F[n]),U.set=(i=t,G.hasOwnProperty(i)||(G[i]=function(e){this.set(i,e)}),G[i]),y(e,t,U)}function B(){throw new Error("Accessor is a partial class for mixins and can not be instantiated")}function K(e){if(e instanceof Object){var t=e.constructor;return t.fullName||t.name}return typeof e}function ee(e,t,n,i){var r,s,a,o=B.getAttrDesc(e,t);if(o&&(o.type||o.validator))return(a=o.type)&&(r=function(e,t,n,i){var r,s,a,o,l,c,f=typeof i;if("string"===f&&typeof n!==i?(f=i,r=!0):"function"!==f||n instanceof i||(f=i.fullName||i.name,r=!0),r)return s=e.constructor,a=s.fullName||s.name,o=t,l=f,c=K(n),"`"+o+"` of type `"+(a||"<<anonymous>>")+"` should be `"+l+(c?"`, not `"+c:"")+"`";if(Array.isArray(i)){for(var u=0,h=i.length;u<h&&!("string"==(f=typeof i[u])&&typeof n===i[u]||"function"===f&&n instanceof i[u]);++u);if(u===h)return function(e,t,n,i){for(var r=[],s=0,a=n.length;s<a;++s)r.push("`"+(n[s].name||n[s])+"`");return"`"+t+"` of type `"+(e||"<<anonymous>>")+"` should be "+r.join(" or ")+(i?", not `"+i:"")+"`"}((s=e.constructor).fullName||s.name,t,i,K(n))}}(e,t,n,a)),r||((s=o.validator)&&(r="function"==typeof s?s.call(e,n,t):function(e,t,n,i){if(!i.test(n))return n+" does not match the pattern "+i.toString()+" of the property `"+t+"` in "+e.toString()}(e,t,n,s)),r||void 0)}g({constructor:B,statics:{getAttrDesc:function(e,t){return e.__extag_descriptors__?e.__extag_descriptors__[t]:null},defineGetterSetter:Z,getAttributeDefaultValue:function(e){return"object"!=typeof e.value?e.value:null!=e.value?e.value instanceof Q?e.value.gen&&e.value.gen():e.value:void 0},getAttributeDefaultValues:function(e){var t={},n=e.__extag_descriptors__;if(n)for(var i in n)if(n.hasOwnProperty(i)){var r=n[i],s=typeof r.value;if("undefined"===s)continue;"object"!==s?t[i]=r.value:null!=r.value&&(r.value instanceof Q?t[i]=r.value.gen&&r.value.gen():t[i]=r.value)}return t},applyAttributeDescriptors:function(e,t,n){if(!e.hasOwnProperty("__extag_descriptors__")){if(Array.isArray(t)){var i,r,s=t;for(t={},i=0,r=s.length;i<r;++i)t[s[i]]=q}var a,o;for(a in t=c({},e.__extag_descriptors__,t))if(t.hasOwnProperty(a)){if(a in e&&!n)continue;o=t[a],t[a]="object"!=typeof o?{value:o}:o instanceof Q?{value:o}:o?(o.get&&!o.set||o.set&&!o.get&&(o.get=J),o):q,"bindable"in(o=t[a])||(o.bindable=!0),o.bindable&&Z(e,a)}y(e,"__extag_descriptors__",{value:t})}}},get:function(e){throw new Error("Method `get` must be implemented by sub-class")},set:function(e,t){throw new Error("Method `set` must be implemented by sub-class")},assign:function(e){for(var t in e)e.hasOwnProperty(t)&&this.set(t,e[t])}});var te={validate0:function(e,t){var n,i=e.__extag_descriptors__;for(n in i)!i[n].required||t&&t.hasOwnProperty(n)||S("Attribute Validation:","required `"+n+"` for "+(e.constructor.fullName||e.constructor.name))},validate:function(e,t,n,i){return!ee(e,t,n)},troubleShoot:ee};function ne(){throw new Error("DirtyMarker is a partial class for mixins and can not be instantiated")}g({constructor:ne,statics:{check:function(e,t,n,i){var r=e._dirty;r||y(e,"_dirty",{value:r={},enumerable:!1,writable:!0,configurable:!0}),t in r?r[t]===n&&delete r[t]:r[t]=i},clean:function(e,t){t?delete e._dirty[t]:e._dirty=null}},hasDirty:function(e){var t=this._dirty;return!!t&&(null==e||t.hasOwnProperty(e))}});var ie=[],re=[],se=[],ae=0,oe=0,le=!1,ce=!1,fe=!1;function ue(){if(!ce&&le)try{var e;for(0,ce=!0,ae=0;ae<ie.length;)ie[ae].update(),++ae;for(ie.length=0,fe=!(le=ce=!1),oe=ae=0;oe<re.length;)re[oe].render(),++oe;for(re.length=0,oe=0,fe=!1,e=se.length-1;0<=e;--e)se[e]();se.length=0}catch(e){throw oe=ae=0,ie.length=0,re.length=0,se.length=0,le=ce=fe=!1,e}}var he,pe={insertUpdateQueue:function(e){var t,n=ie.length,i=e.$guid;if(ce)for(t=ae+1;t<n&&i>=ie[t].$guid;)++t;else{for(t=n-1;0<=t&&i<ie[t].$guid;)--t;++t}t===n?ie.push(e):ie.splice(t,0,e),le||(le=!0,h(ue))},insertRenderQueue:function(e){var t,n=re.length,i=e.$guid;if(fe)for(t=oe+1;t<n&&i>=re[t].$guid;)++t;else{for(t=n-1;0<=t&&i<re[t].$guid;)--t;++t}t===n?re.push(e):re.splice(t,0,e)},pushCallbackQueue:function(e){se.push(e)}},de=[],ge=function(){return null!=he},ve=function(e){(he=e).execTimes=he.execTimes?he.execTimes+1:1,he.depsCountNew=0,he.depsCountOld=0,he.deps||(he.deps={}),de.unshift(e)},ye=function(){if(null!=he){var e,t;if(he.depsCountOld<he.depsCount)for(e in he.deps)(t=he.deps[e]).cnt!==he.execTimes&&(delete he.deps[e],t.src.off("changed."+t.key,he.invalidate));he.depsCount=he.depsCountOld+he.depsCountNew,de.shift(),he=de[0]}},me=function(e,t){if(null!=he){var n=e.$guid+"."+t,i=he.deps[n];i?(i.cnt=he.execTimes,he.depsCountOld++):(e.on("changed."+t,he.invalidate),he.depsCountNew++,he.deps[n]={src:e,key:t,cnt:he.execTimes})}},_e=function(e){var t=e.deps;if(t){var n,i;for(n in t)(i=t[n]).src.off("changed."+i.key,e.invalidate);e.deps=null}};function be(e,t,n,i,r){this.sync=!0,this.scope=e,this.target=t,this.property=n,"function"==typeof i&&(this.invalidate=this.invalidate.bind(this),this.exec=this.exec.bind(this),this.collect=i,this.flag=1,this.exec(),0<this.depsCount&&be.record(t,this),"function"==typeof r&&(this.reflect=r,this.back=this.back.bind(this),t.on("changed."+n,this.back)))}g({constructor:be,statics:{record:function(e,t){var n=e._bindings;n?n.push(t):y(e,"_bindings",{value:[t],writable:!1,enumerable:!1,configurable:!0})},remove:function(e,t){var n=e._bindings;n&&n.length&&n.splice(n.lastIndexOf(t),1)},create:function(e,t,n,i,r){return new be(e,t,n,i,r)},destroy:function(e){var t=e.target,n=e.scope;"function"==typeof e.reflect&&t.off("changed."+e.property,e.back),e.sync||"function"!=typeof e.collect||n.off("updating",e.exec),_e(e),be.remove(n,e)}},exec:function(){if(0!==this.flag){ve(this);var e=this.collect.call(this.scope);ye(),this.target.set(this.property,e),this.flag=0,1<this.depsCount&&this.sync&&(this.scope.on("updating",this.exec),this.sync=!1)}},back:function(){this.reflect.call(this.scope,this.target[this.property])},invalidate:function(e){this.flag=1,this.sync?this.exec():this.scope.invalidate(1)}});var xe=-1;function we(e){we.initialize(this,e)}g({constructor:we,mixins:[B.prototype,z.prototype],statics:{create:function(e){return new we(e)},initialize:function(e,t){var n=e.constructor.prototype,i=e.constructor.attributes;B.applyAttributeDescriptors(n,i,!0);var r=B.getAttributeDefaultValues(e);y(e,"$props",{value:r,writable:!1,enumerable:!1,configurable:!0}),y(e,"$guid",{value:xe--,writable:!1,enumerable:!1,configurable:!0}),this.setup&&this.setup(),t&&(B.applyAttributeDescriptors(e,t,!1),e.assign(t))}},get:function(e){var t=B.getAttrDesc(this,e);return t&&t.bindable?(ge()&&me(this,e),t.get?t.get.call(this,this.$props,e):this.$props[e]):this[e]},set:function(e,t){var n=B.getAttrDesc(this,e);if(n)if(n.bindable){var i,r=this.$props;n.get?n.set&&(i=n.get.call(this,r,e),n.set.call(this,t,r),i!==(t=n.get.call(this,r,e))&&this.emit("changed."+e,e)):(i=r[e])!==t&&(r[e]=t,this.emit("changed."+e,e))}else this[e]=t;else this[e]=t}});var ke={invalidate:function(){}};function Ae(e){y(this,"_owner",{value:e||ke}),y(this,"_props",{value:{}})}g({constructor:Ae,mixins:[B.prototype,ne.prototype],get:function(e){return this._props[e]},set:function(e,t){var n=this._props,i=n[e];t!==i&&(n[e]=t,this._owner.invalidate(1),ne.check(this,e,t,i))},reset:function(e){var t,n=this._props;if(n)for(t in n)e&&t in e||this.set(t,null);e&&this.assign(e)}});var Ee=0,Oe=null;function Ce(){throw new Error("Shell is a base class and can not be instantiated")}function $e(e){$e.initialize(this,e)}function Pe(e,t,n,i){var r=e.indexOf(":"),s="";0<r&&(s=e.slice(0,r),e=e.slice(r+1)),Pe.initialize(this,s,e,t,n,i)}function Te(e,t,n){Te.initialize(this,e,t,n)}function De(e,t){this.func=e,this.expr=t}g({constructor:Ce,mixins:[z.prototype,B.prototype,ne.prototype],invalidate:function(e){0===this.$flag&&(this.$flag=1,pe.insertUpdateQueue(this)),this.$flag|=e},update:function(){throw new Error("The method `update` must be implemented by sub-class")},render:function(){throw new Error("The method `render` must be implemented by sub-class")},attach:function(e){if(0===this.$type)return!1;if(Ce.getViewEngine(this).attachShell(e,this),y(this,"$skin",{value:e,writable:!0,enumerable:!1,configurable:!0}),this._actions){var t,n,i=this._actions;for(t in i)if(i.hasOwnProperty(t)&&(n=i[t]))for(var r,s=n.handlers,a=0,o=s.length;a<o;++a)(r=s[a])&&Ce.addEventListener(this,n,r)}return 0==(8&this.$flag)&&(this.$flag|=8,pe.insertRenderQueue(this)),!0},detach:function(e){if(!e&&this._props&&this._props.hasOwnProperty("preventDetach"))return!1;var t=this._parent;return t&&!t._parent?(this._parent=null,void t.detach(e)):(this.constructor.destroy(this),!0)},getSkin:function(){return this.$skin},toString:function(){var e=this.constructor;return(e.fullName||e.name)+"<"+this.tag+">("+this.$guid+")"},get:function(e){return this._props[e]},set:function(e,t){var n=this._props,i=n[e];i!==t&&(n[e]=t,this.invalidate(1),ne.check(this,e,t,i))},cmd:function(e){this._commands||(this._commands=[]),this._commands.push({name:e,args:f(arguments,1)}),this.invalidate(4)},statics:{initialize:function(e,t,n,i){e.hasOwnProperty("_props")||y(e,"_props",{value:{},writable:!1,enumerable:!1,configurable:!0}),y(e,"$flag",{value:0,writable:!0,enumerable:!1,configurable:!0}),y(e,"$guid",{value:Ee++,writable:!1,enumerable:!1,configurable:!0}),y(e,"$type",{value:t,writable:!1,enumerable:!1,configurable:!0}),y(e,"tag",{value:n,writable:!1,enumerable:!1,configurable:!0}),y(e,"ns",{value:i,writable:!0,enumerable:!1,configurable:!0})},destroy:function(e){var t,n,i=e._children;if(i){for(t=i.length-1;0<=t;--t)(n=i[t])._parent=null,n.constructor.destroy(n);e._children.length=0}var r,s=e._bindings;if(s){for(t=s.length-1;0<=t;--t)(r=s[t]).constructor.destroy(r);delete e._bindings}e.off(),ne.clean(e);var a=e.$skin;a&&(Ce.getViewEngine(e).detachShell(a,e),e.$skin=null)},getViewEngine:function(e){return null==Oe&&(Oe=v.get(w)),e.ns&&!Oe.hasNameSpace(e.ns)?v.get(e.ns+":"+w):Oe},addEventListener:function(e,t,n){var i=e.getSkin(),r=Ce.getViewEngine(e);if(i&&r){var s=t.type.indexOf("."),a=s<0?t.type:t.type.slice(0,s);if(r.mayDispatchEvent(i,a)){t.listeners=t.listeners||[];var o=t.listeners[3&n.flag];if(o)return void o.count++;o=z.getListenerByFlag(n.flag).bind(e),r.addEventListener(i,a,o,z.flag2opts(3&n.flag)),(t.listeners[3&n.flag]=o).count=1}else t.listeners=null}},removeEventListener:function(e,t,n){var i=e.getSkin(),r=Ce.getViewEngine(e);if(i&&r){var s=t.listeners&&t.listeners[3&n.flag];if(s){s.count--;var a=t.type.indexOf("."),o=a<0?t.type:t.type.slice(0,a);s.count<1&&r.mayDispatchEvent(i,o)&&r.removeEventListener(i,o,s,z.flag2opts(3&n.flag))}}}}}),g({constructor:$e,extends:Ce,statics:{create:function(e){return new $e(e)},initialize:function(e,t){Ce.initialize(e,3,"",""),e.set("data",t||"")}},update:function(){return 0!==this.$flag&&(0==(8&this.$flag)&&(this.$flag|=8,pe.insertRenderQueue(this)),!0)},render:function(){if(0===this.$flag)return!1;this.$skin&&(Ce.getViewEngine(this).renderShell(this.$skin,this),ne.clean(this));return!(this.$flag=0)},toString:function(){var e=this.get("data");return'"'+((e=null==e?"":e.toString()).length<24?e:e.slice(0,21)+"...")+'"('+this.$guid+")"}}),g({constructor:Pe,extends:Ce,mixins:[j.prototype],statics:{initialize:function(e,t,n,i,r,s){Ce.initialize(e,1,n,t),Pe.defineMembers(e),r&&s||i&&e.assign(i)},create:function(e,t,n,i){return new Pe(e,t,n,i)},defineMembers:function(e){var t=e.constructor.prototype;"classes"in t||(y(t,"attrs",{get:function(){return this._attrs||y(this,"_attrs",{value:new Ae(this),configurable:!0}),this._attrs}}),y(t,"style",{get:function(){return this._style||y(this,"_style",{value:new Ae(this),configurable:!0}),this._style}}),y(t,"classes",{get:function(){return this._classes||y(this,"_classes",{value:new Ae(this),configurable:!0}),this._classes}}))}},update:function(){return 0!==this.$flag&&(v.HTMXEngine.transferProperties(this),0==(8&this.$flag)&&(this.$flag|=8,pe.insertRenderQueue(this)),!0)},render:function(){if(0===this.$flag)return!1;this.$skin&&(Ce.getViewEngine(this).renderShell(this.$skin,this),this._children&&j.clean(this),ne.clean(this),this._attrs&&ne.clean(this._attrs),this._style&&ne.clean(this._style),this._classes&&ne.clean(this._classes),this._commands&&(this._commands=null));return!(this.$flag=0)}}),g({constructor:Te,extends:Ce,mixins:[j.prototype],statics:{initialize:function(e,t,n,i){Ce.initialize(e,0,"x:frag",""),(e.scopes=n)&&i&&i.compile("contents",e,n)},create:function(e,t,n){return new Te(e,t,n)}},update:function(){if(0===this.$flag)return!1;if(this.scopes&&this.hasDirty("contents")){var e=v.JSXEngine,t=this._props.contents||[];e.reflow(this.scopes[0],this,t)}if(0==(8&this.$flag)){if(this._parent&&2&this.$flag){var n=this.getParent(!0);n.$flag|=2,0==(8&n.$flag)&&(n.$flag|=8,pe.insertRenderQueue(n))}this.$flag|=8,pe.insertRenderQueue(this)}return!0},render:function(){return 0!==this.$flag&&!(this.$flag=0)}}),g({constructor:De,execute:function(e,t){var n=e.slice(1);return 1<arguments.length&&n.push(t),this.func.apply(e[0],n)}});var Ne={ASSIGN:-1,ONE_TIME:0,ONE_WAY:1,TWO_WAY:2,ANY_WAY:3};function Se(e,t){var n=B.getAttrDesc(e,t);return n&&n.bindable}function je(e){this.mode=e.mode,this.path=e.path,this.paths=e.paths,this.evaluator=e.evaluator,this.converters=e.converters,this.identifiers=e.identifiers}g({constructor:je,statics:{MODES:Ne,compile:function(e,t,n,i){return new je(e).link(t,n,i)},destroy:function(e){var t=e.target,n=e.scopes;e.mode===Ne.TWO_WAY&&Se(e.target,e.targetProp)&&e.target.off("changed."+e.targetProp,e.back),e.sync||n[0].off("updating",e.exec),be.remove(t,e),_e(e)}},link:function(e,t,n){if(this.flag=0,this.sync=!0,this.scopes=n,this.target=t,this.targetProp=e,this.mode!==Ne.ASSIGN){if(this.exec=this.exec.bind(this),this.invalidate=this.invalidate.bind(this),this.mode===Ne.TWO_WAY){this.back=this.back.bind(this);var i=this.path,r=this.identifiers.indexOf(i[0]);this.sourceProp=i[i.length-1],this.source=0<=r?d.search(i.slice(1,i.length-1),n[r],!0):d.search(i.slice(1,i.length-1),n[0].constructor.resources,!0),Se(this.target,this.targetProp)&&this.target.on("changed."+this.targetProp,this.back)}this.mode===Ne.ANY_WAY?(this.sync=!1,this.scopes[0].on("updating",this.exec),this.target.set(this.targetProp,this.eval())):(this.sync=!0,this.flag=1,this.exec(),0<this.depsCount&&be.record(t,this))}else this.target.set(this.targetProp,this.eval())},eval:function(e){if(this.mode===Ne.TWO_WAY)return e?this.target[this.targetProp]:this.source[this.sourceProp];var t=this.converters;return t&&t.length?function(e,t,n){for(var i=0;i<e.length;++i)n=e[i].execute(t,n);return n}(t,this.scopes,this.evaluator.execute(this.scopes)):this.evaluator.execute(this.scopes)},exec:function(){if(this.mode!==Ne.ANY_WAY){if(0!==this.flag){ve(this);var e=this.eval();ye(),this.target.set(this.targetProp,e),this.flag=0,this.mode===Ne.ONE_TIME?je.destroy(this):1<this.depsCount&&this.sync&&(this.scopes[0].on("updating",this.exec),this.sync=!1)}}else this.target.set(this.targetProp,this.eval())},back:function(){this.source.set(this.sourceProp,this.eval(!0))},invalidate:function(){this.flag=1,this.sync?this.exec():this.scopes[0].invalidate(1)}});var Me=Ce.prototype,Ie=Pe.prototype,ze=Te.prototype;function We(e,t,n){We.initialize(this,e,t,n)}g({constructor:We,extends:Ce,mixins:[j.prototype],statics:{__extag_component_class__:!0,create:function(e,t,n,i){return new e(t,n,i)},initialize:function(e,t,n,i){var r=e.constructor,s=r.prototype,a=r.attributes,o=r.__extag_template__;B.applyAttributeDescriptors(s,a,!0);var l,c=B.getAttributeDefaultValues(e);if(y(e,"_props",{value:c,writable:!1,enumerable:!1,configurable:!0}),!o){if("string"==typeof r.template)o=v.HTMXParser.parse(r.template,s);else if("function"==typeof r.template){o=v.JSXParser.parse(r.template,s)}if(!o)throw new TypeError("The template must be legal HTML string or DOM element");y(r,"__extag_template__",{value:o,writable:!1,enumerable:!1,configurable:!0})}if(Ce.initialize(e,"x:frag"!==o.tag?1:0,o.tag,o.ns||""),Pe.defineMembers(e),n&&n[0].context?(l=e.setup(n[0].context),null==e.context&&(e.context=n[0].context)):l=e.setup(),null!=l){if("object"!=typeof l)throw new TypeError("setup() should return object, not "+typeof l);for(var f in l)y(e,f,Object.getOwnPropertyDescriptor(l,f))}v.HTMXEngine.driveComponent(e,o,n,i,t),e.emit("created")}},get:function(e){var t=B.getAttrDesc(this,e);return t?t.bindable?(ge()&&me(this,e),t.get?t.get.call(this,e,this._props):this._props[e]):this[e]:this._props[e]},set:function(e,t){var n=B.getAttrDesc(this,e);if(n)if(n.bindable){var i,r=this._props;n.get?n.set&&(i=n.get.call(this,e,r),n.set.call(this,t,r),i!==(t=n.get.call(this,e,r))&&(this.invalidate(1),this.emit("changed."+e,e,t,this))):(i=r[e])!==t&&(r[e]=t,this.invalidate(1),this.emit("changed."+e,e,t,this))}else this[e]=t;else Me.set.call(this,e,t)},bind:function(e,t,n,i){be.create(this,e,t,n,i)},setup:function(e){e&&(this.context=e)},attach:function(e){return!!Me.attach.call(this,e)&&(this.emit("attached",e),!0)},detach:function(e){var t=this.getSkin();return!!Ce.prototype.detach.call(this,e)&&(t&&this.emit("detached",t),this.emit("destroyed"),!0)},update:function(){if(0===this.$flag)return!1;if(this.emit("updating",this.$flag),0!==this.$type?v.HTMXEngine.transferProperties(this):this._parent&&2&this.$flag&&this._parent.invalidate(2),0==(8&this.$flag)){if(0===this.type&&this._parent&&2&this.$flag){var e=this.getParent(!0);e.$flag|=2,0==(8&e.$flag)&&(e.$flag|=8,pe.insertRenderQueue(e))}this.$flag|=8,pe.insertRenderQueue(this)}return!0},render:function(){if(0===this.$flag)return!1;0!==this.$type?Ie.render.call(this):ze.render.call(this);var e=this._actions;return e&&e.rendered&&this.$skin&&pe.pushCallbackQueue(function(){this.emit("rendered",this.$skin)}.bind(this)),!0},getContents:function(){return this._contents},setContents:function(e){this._contents!==e&&(this._contents=e,this.emit("changed.contents","contents",e,this))},addNamedPart:function(e,t){this[e]=t}});var Ve=/[\w).+\-_$\]]/,Ye={};function Re(e,t){for(var n,i=e.length;t<i;){if(!(32===(n=e.charCodeAt(t))||9<=n&&n<=13))return 44!==n&&123!==n;--t}}function Xe(e,t){for(var n,i,r,s=e.length;t<s;)if(32===(n=e.charCodeAt(t))||9<=n&&n<=13)r=!0,++t;else{if(46===n)i&&x("Unexpected token '.'.",{code:1001,expr:e}),i=!(r=!1);else{if(!(Le(n)||48<=n&&n<=57)){i&&x("Unexpected token '"+e[t]+"'.",{code:1001,expr:e});break}r&&!i&&x("Unexpected token '"+e[t]+"'.",{code:1001,expr:e}),i=r=!1}++t}return t}function Le(e){return 97<=e&&e<=122||65<=e&&e<=90||95===e||36===e}!function(){for(var e="abstract arguments boolean break byte case catch char class const continue debugger default delete do double else enum eval export extends false final finally float for function goto if implements import in instanceof int interface let long native new null package private protected public return short static super switch synchronized this throw throws transient true try typeof undefined var void volatile while with yield Array Date Infinity Math NaN Number Object String Boolean".split(/\s+/),t=0,n=e.length;t<n;++t)Ye[e[t]]=!0}();var He={parse:function(e,t,n){var i,r,s,a=n.slice(1),o=0,l=[],c=function(e){for(var t,n,i,r,s,a,o=[],l=e.length,c=0;c<l;){switch(r=s,s=e.charCodeAt(c)){case 39:t?92!==r&&(t=!1):t=!0;break;case 34:n?92!==r&&(n=!1):n=!0;break;case 47:if(i)92!==r&&(i=!1);else{for(var f;0<=a&&(32===(f=e.charCodeAt(a))||9<=f&&f<=13);--a);f&&Ve.test(f)||(i=!0)}break;default:t||n||i||46===r||!Le(s)||(a=Xe(e,c+1),58!==(s=e.charCodeAt(a))?o.push(c,a):Re(e,c-1)&&o.push(c,a),c=a)}++c}return o}(e),f=t.constructor.resources||k;for(s=0;s<c.length;s+=2)c[s+1]<0||(i=e.slice(c[s]+o,c[s+1]+o),r=d.parse(i.replace($,"")),Ye.hasOwnProperty(r[0])||0<=n.indexOf(r[0])||(r[0]in f?l.push("var "+r[0]+" = this.constructor.resources."+r[0]+";"):(e=e.slice(0,c[s]+o)+"this."+i+e.slice(c[s+1]+o),o+=5)));l.push("return "+e),a.push(l.join("\n"));try{return new De(Function.apply(null,a),e)}catch(e){x(e,{code:1001,expr:arguments[0],desc:"Illegal expression `"+arguments[0]+"`."})}}};function Qe(e,t,n){this.binding=e,this.pattern=t,this.unparsed=n}function Ue(e,t,n){Ue.initialize(this,e,t,n)}function Fe(e,t){if(t&&"string"==typeof e){var n,i,r,s={},a=e.split(";");for(r=a.length-1;0<=r;--r)0<(i=(n=a[r]).indexOf(":"))&&(s[t.toCamelCase(n.slice(0,i).trim())]=n.slice(i+1).trim());return s}}function Ge(e){if("string"==typeof e&&(e=e.trim().split(WHITE_SPACES_REGEXG)),Array.isArray(e)){var t,n={};for(t=0;t<e.length;++t)e[t]&&(n[e[t]]=!0);return n}}function qe(e,t,n){var i,r;if(t)for(i in t)"object"==typeof(r=t[i])&&r instanceof Qe?r.compile(i,e,n):e.set(i,r)}function Je(e,t,n){var i,r;if(t)for(i in t)"object"==typeof(r=t[i])&&r instanceof Qe?r.compile(i,e,n):"function"==typeof r&&e.on(i,r)}function Ze(e,t,n){var i=Ke(t,n);e.setChildren(i)}function Be(e,t,n){var i=Ke(t,n);e.setContents(i)}function Ke(e,t){var n,i,r,s=[];if(e&&e.length){for(n=0,i=e.length;n<i;++n)(r=et(e[n],t))&&s.push(r);return s}}function et(e,t){var n,i,r=e.tag;return"string"==typeof e?i=new $e(e):e instanceof Qe?i=new Te(null,t,e):e.xif||e.xfor?i=new Ue(null,t,e):"!"!==e.tag&&((n=e.type)?i=new n(null,t,e):"!"!==e.tag&&(i=new Pe(e.ns?e.ns+":"+r:r,null,t,e),e.events&&Je(i,e.events,t),e.props&&qe(i,e.props,t),e.attrs&&qe(i.attrs,e.attrs,t),e.style&&qe(i.style,e.style,t),e.classes&&qe(i.classes,e.classes,t),e.children&&Ze(i,e.children,t)),i&&e.name&&(t[0].addNamedPart(e.name,i),y(i,"$owner",{configurable:!0,enumarable:!1,writable:!1,value:t[0]}))),i}g({constructor:Qe,statics:{},connect:function(e,t){if(this.unparsed){var n=this.pattern,i=n.evaluator,r=n.converters;if(i&&(n.evaluator=new De(i)),r)for(var s=0;s<r.length;++s)n.converters[s]=new De(r[s]);this.unparsed=!1}},compile:function(e,t,n){return this.binding.compile(this.pattern,e,t,n)}}),g({constructor:Ue,extends:We,statics:{initialize:function(e,t,n,i){(We.initialize(e,t),e.mode=0,i)&&(e.scopes=n,e.template=c({},i),delete e.template.xkey,delete e.template.xfor,delete e.template.xif,e.set("condition",!0),i.xif&&(e.mode=1,i.xif.compile("condition",e,n)),i.xfor&&(e.mode=2,i.xfor[1].compile("iterable",e,n),i.xkey&&(e.keyEval=i.xkey)),e.on("updating",e.onUpdating.bind(e)))},template:"<x:frag></x:frag>"},onUpdating:function(){if(this.mode){var e=this.get("condition"),t=this.template,n=this.scopes,i=[];if(e){var r=v.HTMXEngine;if(1===this.mode)return(a=r.makeContent(t,n))&&i.push(a),void this.setChildren(i);var s,a,o,l,c,f,u,h={},p=this.get("iterable")||[],d=this._children||[],g=this.keyEval;for(f=0,c=d.length;f<c;++f)(l=d[f].__key__)&&(h[l]=f);for(f=0,c=p.length;f<c;++f)a=l=null,o=p[f],u=n.concat([o]),g&&null!=(s=h[l=g.execute(u)])&&(a=d[s]),a||((a=r.makeContent(t,u)).__key__=l),i.push(a);this.setChildren(i)}else this.setChildren(i)}}});var tt={driveProps:qe,driveEvents:Je,driveContents:Be,driveChildren:Ze,driveComponent:function(e,t,n,i,r){var s=[e];i&&n?(r&&i.props?r=c({},i.props,r):!r&&i.props&&(r=i.props),qe(e,r,n),i.events&&Je(e,i.events,n),i.attrs&&qe(e.attrs,i.attrs,n),i.style&&qe(e.style,i.style,n),i.classes&&qe(e.classes,i.classes,n),i.children&&Be(e,i.children,n)):r&&qe(e,r,n),t.events&&Je(e,t.events,s),t.props&&(y(e,"__props",{value:new Ae(e),configurable:!0}),qe(e.__props,t.props,s)),t.attrs&&(y(e,"__attrs",{value:new Ae(e),configurable:!0}),qe(e.__attrs,t.attrs,s)),t.style&&(y(e,"__style",{value:new Ae(e),configurable:!0}),qe(e.__style,t.style,s)),t.classes&&(y(e,"__classes",{value:new Ae(e),configurable:!0}),qe(e.__classes,t.classes,s)),t.children&&Ze(e,t.children,s)},transferProperties:function(e){if(e.tag){var t,n,i,r=e._props;if(e.hasDirty("style")&&(ne.clean(e,"style"),"object"==typeof(t=r.style)?e.style.reset(t):"string"==typeof t&&((i=Ce.getViewEngine(e))&&(t=Fe(t,i)),e.style.reset(t))),e.hasDirty("classes")&&(ne.clean(e,"classes"),"object"!=typeof(n=r.classes)&&(n=Ge(n)),e.classes.reset(n)),e.__props&&e.constructor.__extag_component_class__){var s=e.__props;if(s&&s.hasDirty("style")){var a=e.__style;a||(a=new Ae(e),y(target,"__style",{value:a,configurable:!0})),ne.clean(s,"style"),"object"==typeof(t=s.style)?a.reset(t):"string"==typeof t&&((i=Ce.getViewEngine(e))&&(t=Fe(t,i)),a.reset(t))}if(s&&s.hasDirty("classes")){var o=e.__classes;o||(o=new Ae(e),y(target,"__classes",{value:o,configurable:!0})),ne.clean(s,"classes"),"object"!=typeof(n=s.classes)&&(n=Ge(n)),o.reset(n)}}}},buildContent:et,makeContent:et,makeContents:Ke};function nt(e,t,n){nt.initialize(this,e,t,n)}function it(e){this.pattern=e}function rt(e){return{once:0<=e.indexOf("once"),capture:0<=e.indexOf("capture"),passive:0<=e.indexOf("passive")}}function st(e,t){"object"==typeof t&&t&&e&&e.length&&(0<=e.indexOf("stop")&&t.stopPropagation&&t.stopPropagation(),0<=e.indexOf("prev")&&t.preventDefault&&t.preventDefault())}function at(e){this.pattern=e}function ot(e,t){return e.xkey===t.xkey&&(t.type?e.constructor===t.type:e.tag===t.tag&&e.ns===t.ns)}function lt(e,t,n){var i,r;if(null==e)return i=new $e("");if(e.type)i=new e.type(e.props,[n]);else{if(!e.tag)return i=new $e(e);i=new Pe((r=e.ns||t.ns)?r+":"+e.tag:e.tag,e.props,[n])}return e.name&&(n.addNamedPart(e.name,i),y(i,"$owner",{configurable:!0,enumarable:!1,writable:!1,value:n})),e.xkey&&(i.__key__=e.xkey),i}function ct(e,t,n){var i,r;if(t instanceof We&&t!==n)i=t._contents||A,r=e.contents||A;else{if(t instanceof nt)return;i=t._children||A,r=e.children||A}for(var s,a,o,l=new Array(r.length),c=0,f=i.length-1,u=0,h=r.length-1,p=i[c],d=i[f],g=r[u],v=r[h];c<=f&&u<=h;)if(null==p)p=i[++c];else if(null==d)d=i[--f];else if(ot(p,g))ft(g,l[u]=p,n),p=i[++c],g=r[++u];else if(ot(d,v))ft(v,l[h]=d,n),d=i[--f],v=r[--h];else if(ot(p,v))ft(v,l[h]=p,n),p=i[++c],v=r[--h];else if(ot(d,g))ft(g,l[u]=d,n),d=i[--f],g=r[++u];else{if(!s)for(s={},o=c;o<=f;++o)(a=i[c].__key__)&&(s[a]=o);null!=(o=(a=g.xkey)&&s[a])&&ot(i[o]||k,g)?l[u]=i[o]:l[u]=lt(g,t,n),ft(g,l[u],n),g=r[++u]}if(f<c)for(;u<=h;)l[u]=lt(g,t,n),ft(g,l[u],n),g=r[++u];t instanceof We&&t!==n?t.setContents(l):t.setChildren(l)}function ft(e,t,n){"object"==typeof e&&e.__extag_node__?(!function(e,t,n){var i,r,s=e.props,a=e.events,o=t._props,l=t._events;if(o)if(t instanceof We)for(i in o)s&&i in s||((r=B.getAttrDesc(i))?t.set(i,B.getAttributeDefaultValue(r)):t.set(i,null));else for(i in o)s&&i in s||t.set(i,null);if(s&&t.assign(s),l)for(i in l)l[i]&&t.off(i,l[i]);a&&t.on(a)}(e,t),ct(e,t,n)):t.set("data",e)}v.HTMXEngine=tt,g({constructor:nt,extends:We,statics:{initialize:function(e,t,n,i){var r=i&&i.props&&i.props.name;We.initialize(e,t,n,{props:{name:r||""}}),e.template=c({},i),e.template.props=c({},i.props),r&&delete e.template.props.name,e.scopes=n,e.invalidate(1),e.on("updating",e.onUpdating.bind(e)),n[0].on("changed.contents",function(){e.invalidate(1)})},template:"<x:frag></x:frag>"},onUpdating:function(){var e,t,n,i,r=[],s=this.scopes[0].getContents(),a=this.template,o=this.scopes;if(s&&0<s.length){var l=this.get("name")||"";for(i=0,n=s.length;i<n;++i)l===((t=s[i])._attrs&&t.attrs.get("x:slot")||"")&&r.push(t);this.useDefault=!1}if(0===r.length&&a.children){if(this.useDefault)return;for(i=0,n=(e=a.children).length;i<n;++i)(t=tt.makeContent(e[i],o))&&r.push(t);this.useDefault=!0}this.setChildren(r)}}),g({constructor:it,statics:{compile:function(e,t,n,i){new it(e).link(t,n,i)}},link:function(e,t,n){var i,r=this.pattern,s=r.handler,a=r.evaluator,o=r.modifiers;if(s){var l=n[0][s];if(!l)return;o&&o.length?"bind"===o[0]&&1===o.length?t.on(e,l.bind(n[0])):(i=function(e){st(o,e),0<=o.indexOf("bind")?l.apply(n[0],arguments):l.apply(null,arguments)},t.on(e,i,rt(o))):t.on(e,l)}else o&&o.length?(i=function(e){st(o,e),a.execute(n)},t.on(e,i,rt(o))):t.on(e,function(e){a.execute(n)})}}),g({constructor:at,statics:{compile:function(e,t,n,i){new at(e).link(t,n,i)},destroy:function(e){e.scopes[0].off("updating",e.exec);var t=e.cache._bindings;if(t)for(var n=t.length-1;0<=n;--n)je.destroy(t[n]);be.remove(e.target,e)}},link:function(e,t,n){var i,r,s,a=this.pattern;this.scopes=n,this.target=t,this.property=e;var o=this.cache=new Ae(n[0]);for(i=0,r=a.length;i<r;++i)(s=a[i])instanceof Qe?s.compile(i,o,n):o.set(i,s);o.set("length",r),be.record(t,this),this.exec(),this.exec=this.exec.bind(this),n[0].on("updating",this.exec)},exec:function(){var e=this.cache;if(e.hasDirty()){var t=f(e._props,0);this.pattern.asStr&&(t=t.join("")),this.target.set(this.property,t),ne.clean(e)}}});var ut={reflow:function(e,t,n){2===arguments.length&&(n=t,t=e),ct(t instanceof We&&t!==e?{contents:u(n)}:{children:u(n)},t,e)}};function ht(e,t,n){ht.initialize(this,e,t,n)}function pt(e,t){var n,i,r,s=e.props;if(e.xif&&e.xif.connect(t,e.identifiers),e.xfor&&(e.xfor[1].connect(t,e.identifiers),e.identifiers=e.identifiers.concat([e.xfor[0]])),e.xkey&&e.xkey.connect(t,e.identifiers),s)for(i in s)"object"==typeof(n=s[i])&&n instanceof Qe&&n.connect(t,e.identifiers);e.type&&"string"==typeof e.type&&("function"==typeof(r=d.search(e.type,t.constructor.resources))&&r.__extag_component_class__||x("Can not find such component type `"+vt+"`"),e.type=r);null==e.type&&P.test(e.tag)&&("function"==typeof(r=d.search(e.tag,t.constructor.resources))&&r.__extag_component_class__&&(e.type=r));if(null==e.type)switch(e.tag){case"x:slot":e.type=nt;break;case"x:view":e.type=ht;break;case"x:frag":e.type=Te}e.events&&function(e,t){var n,i,r=e.events;for(i in r)"object"==typeof(n=r[i])&&n instanceof Qe?n.connect(t,e.identifiers):"object"==typeof(n=vt("+",n))&&n instanceof Qe?r[i]=n:delete r[i]}(e,t)}v.JSXEngine=ut,g({constructor:ht,extends:We,statics:{initialize:function(e,t,n,i){var r=i&&i.attrs&&i.attrs["x:type"];We.initialize(e,t,n,{props:{xtype:r}}),e.template=c({},i),e.template.attrs=c({},i.attrs),delete e.template.attrs["x:type"],e.scopes=n,e.invalidate(1),e.on("updating",e.onUpdating.bind(e))},template:"<x:frag></x:frag>"},onUpdating:function(){var e,t,n=this.get("xtype"),i=this.templat,r=this.scopes;if("function"==typeof n)t=n;else if("string"==typeof n){if(/^url\(.*\)$/.test(n))return void require([n],function(e){this.set("xtype",e)}.bind(this));var s=scope.constructor.resources;t=s&&s[n]}else"object"==typeof n&&"function"==typeof Promise&&n instanceof Promise&&n.then(function(e){this.set("xtype",e)}.bind(this));"function"==typeof t&&t.__extag_component_class__&&(i.tag="?",i.type=t,e=tt.makeContent(i,r),this.setChildren([e]))}});var dt={ns:null,on:null,xif:null,xfor:null,xkey:null,xname:null,xtype:null,props:null,children:null,contents:null};function gt(e,t,n){var i={__extag_node__:!0},r=typeof e;if("string"===r){var s=e.indexOf(":");i.tag=s<0?(i.ns="",e):(i.ns=e.slice(0,s),e.slice(s+1))}else"function"===r?i.type=e:x("First argument must be class, string or constructor.");if(null!=t){t.xif&&(i.xif=t.xif),t.xfor&&(i.xfor=t.xfor),t.xkey&&(i.xkey=t.xkey),t.xname&&(i.name=t.xname),t.xtype&&!i.type&&(i.type=t.xtype),t.on&&(i.events=t.on);var a=i.props={};for(var o in t)t.hasOwnProperty(o)&&!dt.hasOwnProperty(o)&&(a[o]=t[o])}return n&&(3<arguments.length&&(n=f(arguments,2)),n=Array.isArray(n)?u(n):[n],i.type?i.contents=n:i.children=n),i}function vt(e,t){var n,i=2<arguments.length?f(arguments,2):null;if("@"!==e[0])return"+"===e?"string"==typeof t&&D.test(t.trim())?new Qe(it,{handler:t.trim().replace(T,""),modifiers:i}):new Qe(it,{evaluator:t,modifiers:i},!0):"#"===e?(i?i.unshift(t):i=[t],new Qe(at,i)):void 0;switch(e){case"@":n=1;break;case"@@":n=2;break;case"@!":n=-1;break;case"@?":n=0;break;default:return}return new Qe(je,{mode:n,path:2===n?t.trim().replace(T,""):null,evaluator:t,converters:i},!0)}var yt={node:gt,expr:vt,parse:function(e,t){var n=e(gt,vt);return n.identifiers=["this"],pt(n,t),function e(t,n){var i,r,s,a=t.children,o=-1;for(i=a.length-1;0<=i;--i){if("object"==typeof(r=a[i])){if(r.__extag_node__){s&&a.splice(i+1,o+1,new Qe(at,a.slice(i+1,o+1))),s=!1,o=-1,r.identifiers=t.identifiers,pt(r,n),e(r,n);continue}r instanceof Qe&&(r.connect(n,t.identifiers),s=!0)}o<0&&(o=i)}s&&-1<o&&a.splice(0,o+1,new Qe(at,a.slice(0,o+1)))}(n,t),n.type?"x:frag"===n.tag?n.type=null:"x:slot"===n.tag||"x:view"===n.tag?x(n.tag+" can not be used as root tag of component template."):x("component can not be used as root tag of another component template."):(n.xif||n.xfor||n.xkey)&&x("`xif`, `xfor`, `xkey` can not be used on component template root tag."),n}};v.JSXParser=yt;var mt={tryParse:function(e){return"false"!==e&&("true"===e||(isNaN(e)?void 0:Number(e)))}},_t=je.MODES;function bt(e,t){for(var n="$"+t.length;0<=e.indexOf(n);)n="$"+n;return n}var xt={parse:function(e,t,n){var i,r,s,a,o,l,c,f=-1,u=e.length;if(e[0]===O.TWO_WAY?(f=_t.TWO_WAY,e=e.slice(1,u)):e[u-1]===O.ANY_WAY?(f=_t.ANY_WAY,e=e.slice(0,u-1)):e[u-1]===O.ASSIGN?(f=_t.ASSIGN,e=e.slice(0,u-1)):e[u-1]===O.ONE_TIME?(f=_t.ONE_TIME,e=e.slice(0,u-1)):f=_t.ONE_WAY,f===_t.TWO_WAY)d.test(e.trim())||x("",{code:1001,expr:arguments[0],desc:"`"+arguments[0]+"` is not a valid two-way binding expression. Must be a property name or path."}),(c=d.parse(e.trim()))[0]in t&&n.indexOf(c[0])<0&&c.unshift("this"),a=He.parse(e,t,n);else if(e.indexOf(O.CONVERTER)<0)a=He.parse(e,t,n);else if(o=e.split(O.CONVERTER),a=He.parse(o[0],t,n),1<o.length)for(i=1;i<o.length;++i){(l=o[i].trim())||x("Converter must not be empty!",{code:1001,expr:arguments[0],desc:"Empty converter in the expression `"+arguments[0]+"` is not allowed."});var h=bt(e,n),p=l.indexOf("(");l=0<p?l.slice(0,p+1)+h+","+l.slice(p+1):l+"("+h+")",s=He.parse(l,t,n.concat([h])),(r=r||[]).push(s)}return{mode:f,path:c,paths:[],evaluator:a,converters:r,identifiers:n}}},wt=/\s*\n\s*/g,kt=new RegExp(O.DATA+"\\"+E[0]+"(\\s|.)*?\\"+E[1]),At={like:function(e){return kt.test(e)},parse:function(e,t,n){var i,r,s,a,o,l,c,f,u,h,p=[],d=0,g=0;for(i=0,r=e.length;i<r;++i)f=c,c=e.charCodeAt(i),l?125!==c||a||o?39===c?a?92!==f&&(a=!1):a=!0:34===c?o?92!==f&&(o=!1):o=!0:123!==c||a||o||++g:0===--g&&(d<s&&(h=(h=e.slice(d,s)).replace(wt,""))&&(h=m(h),p.push(h)),u=xt.parse(e.slice(s+2,i),t,n),p.push(new Qe(je,u)),d=s=i+1,l=!1):64===f&&123===c&&(l=!0,s=i-1,g=1);return 0<d&&d<r&&(h=(h=e.slice(d,r)).replace(wt,""))&&(h=m(h),p.push(h)),p.length?p:null}},Et=/;/g,Ot=/^[a-z0-9\-\_]+$/i,Ct=new RegExp("^"+O.DATA+"\\"+E[0]+"[^"+O.DATA+"]*\\"+E[1]+"$"),$t={parse:function(e,t,n,i,r){var s,a,o,l,c,f,u,h,p={},d=e.split(Et);for(f=0,c=d.length;f<c;++f)if((h=(a=d[f].trim()).indexOf(":"))<0){if(a=a.trim())for(l=a.split(C),u=0;u<l.length;++u)p[l[u]]=!0}else{o=a.slice(0,h).trim(),e=a.slice(h+1).trim(),o&&Ot.test(o)||x("Illegal "+(r?"x:style":"x:class")+" expression.",{code:1001,expr:o||arguments[0]}),r&&(o=i.toCamelCase(o));try{if(!At.like(e)){p[o]=r?e:mt.tryParse(e);continue}if(Ct.test(e)){s=xt.parse(e.slice(2,e.length-1),t,n),p[o]=new Qe(je,s);continue}s=At.parse(e,t,n)}catch(e){throw e}s?1===s.length&&s[0]instanceof Qe?p[o]=s[0]:r?(s.asStr=!0,p[o]=new Qe(at,s)):x("Illegal x:class expression.",{code:1001,expr:e}):p[o]=r?e:mt.tryParse(e)}return p}},Pt={parse:function(e,t,n){var i=e.indexOf(O.MODIFIER)<0?[e]:e.split(O.MODIFIER);i[0]=i[0].trim();var r={};if(D.test(i[0])?r.handler=i[0].replace(T,""):r.evaluator=He.parse(i[0],t,n),1<i.length){for(var s=[],a=1;a<i.length;++a)s.push(i[a].trim());r.modifiers=s}return r}},Tt=/^([\_\$\w]+)\s+of\s+(.+)$/,Dt=/[a-zA-Z]/,Nt=/[\s\/>]/,St=null,jt={"!":!0,br:!0,hr:!0,area:!0,base:!0,img:!0,input:!0,link:!0,meta:!0,basefont:!0,param:!0,col:!0,frame:!0,embed:!0,keygen:!0,source:!0,command:!0,track:!0,wbr:!0},Mt={"x:ns":!0,"x:if":!0,"x:for":!0,"x:key":!0,"x:name":!0,"x:type":!0,"x:class":!0,"x:style":!0};function It(e,t){var n=e[t];return null==n&&(e[t]=n={}),n}function zt(e,t,n,i,r){var s;if("x:class"===e)n.classes=$t.parse(t,i,r,St,!1);else if("x:style"===e)n.style=$t.parse(t,i,r,St,!0);else if("x:type"===e){var a=d.search(t,i.constructor.resources);"function"==typeof a&&a.__extag_component_class__||x('Illegal x:type="'+t+'"',{code:1001,expr:t,desc:"Can not find such component type `"+t+"`. Make sure it extends Component and please register `"+t+"` in static resources."}),n.type=a}else if("x:name"===e)n.name=t;else if("x:key"===e)n.xkey=He.parse(t,i,r);else if("x:for"===e){var o=t.trim().match(Tt);o&&o[2].trim()||x('Illegal x:for="'+t+'".',{code:1001,expr:t}),(s=xt.parse(o[2],i,r))?n.xfor=[o[1],new Qe(je,s)]:x('Illegal x:for="'+t+'".',{code:1001,expr:t}),n.identifiers=r.concat([o[1]])}else"x:if"===e?(s=xt.parse(t,i,r))?n.xif=new Qe(je,s):x('Illegal x:if="'+t+'".',{code:1001,expr:t}):"x:ns"===e&&(n.ns=t)}function Wt(e,t,n,i,r){var s,a,o,l,c=e[e.length-1];if(c===O.EVENT)a=It(n,"events"),o=St.toCamelCase(e.slice(0,-1)),s=Pt.parse(t,i,r),a[o]=new Qe(it,s);else switch(a=It(n,(l=e.indexOf(":")<0)?"props":"attrs"),c){case O.DATA:o=l?St.toCamelCase(e.slice(0,-1)):e.slice(1,-1),s=mt.tryParse(t),a[o]=null!=s?s:new Qe(je,s=xt.parse(t,i,r));break;case O.TEXT:o=l?St.toCamelCase(e.slice(0,-1)):e.slice(1,-1);try{s=At.parse(t,i,r)}catch(e){throw e}a[o]=s?(s.asStr=!0,new Qe(at,s)):t;break;default:a[o=l?St.toCamelCase(e):e]=St.isBoolProp(o)||t}}function Vt(e,t,n){for(var i=t.length,r=n;r<i;){if(e.test(t[r]))return r;r+=1}return-1}function Yt(e,t,n,i,r){for(var s,a,o,l,c=t,f=t,u=t,h=e.length;c<h;){if(s=e[c],a){if(!$.test(s)){if(u=0<(u='"'===s||"'"===s?(f=c+1,e.indexOf(s,f)):Vt(Nt,e,f=c))?u:h,n)try{120===(l=a).charCodeAt(0)&&l in Mt?zt(a,e.slice(f,u),n,i,n.identifiers):Wt(a,e.slice(f,u),n,i,n.identifiers)}catch(e){throw e}if(">"===e[u])return u;a=null,f=u=c=u+1;continue}}else{if(">"===s){if(f<(u=c))for(o=e.slice(f,u).trim().split(C);0<o.length;)(a=o.shift())&&n&&(It(n,"props")[St.toCamelCase(a)]=!0);return u}if("="===s){if(f<(u=c)){for(o=e.slice(f,u).trim().split(C);1<o.length;)(a=o.shift())&&n&&(It(n,"props")[St.toCamelCase(a)]=!0);a=o.shift()}f=u=c=u+1;continue}}c+=1}}function Rt(e,t,n,i,r,s){var a,o=i.children||[],l=e.slice(t,n);if(At.like(l)){try{a=At.parse(l,r,s)}catch(e){throw e}a?o.push(new Qe(at,a)):o.push(m(l))}else o.push(m(l));i.children=o}var Xt={parse:function(e,t){St=St||v.get(w);var n=t.constructor,i=function(e,t){var n,i,r,s,a,o=0,l=0,c=[],f=0,u=(e=e.trim()).length;for(s={tag:"[]",children:[],identifiers:["this"]},c.push(s);f<u;){if("<"===e[f]){if(n=e[f+1],Dt.test(n)){if(o<f&&Rt(e,o,f,s,t,s.identifiers),l=Vt(Nt,e,o=f+1),r=e.slice(o,l),(i={}).tag=r,i.__extag_node__=!0,i.identifiers=s.identifiers,">"!==e[l]&&(l=Yt(e,o=l+=1,i,t,i.identifiers)),i.ns||(i.props&&i.props.xmlns?i.ns=St.toNameSpace(i.props.xmlns):s.ns&&(i.ns=s.ns)),null==i.type&&P.test(r)){var h=d.search(r,t.constructor.resources);"function"==typeof h&&h.__extag_component_class__&&(i.type=h)}if(null==i.type)switch(r){case"x:slot":i.type=nt;break;case"x:view":i.type=ht;break;case"x:frag":i.type=Te}s&&(s.children=s.children||[],s.children.push(i)),"/"===e[l-1]||(a=r,jt.hasOwnProperty(a))||(c.push(i),s=i),o=l=f=l+1;continue}if("/"===n&&Dt.test(e[f+2])){if(o<f&&Rt(e,o,f,s,t,s.identifiers),l=Vt(Nt,e,o=f+2),(r=e.slice(o,l))!==s.tag&&x("Unclosed tag "+s.tag),">"!==e[l]&&(l=Yt(e,o=l+=1)),!(1<c.length)){if(l<u)throw new Error("");return c[0]}c.pop(),0<c.length&&(s=c[c.length-1]),o=l=f=l+1;continue}if("!"===n&&"\x3c!--"===e.slice(f,f+4)){o<f&&Rt(e,o,f,s,t,s.identifiers),o=f+4,l=0<(l=e.indexOf("--\x3e",o))?l:e.length,i={tag:"!",comment:e.slice(o,l)},s.children=s.children||[],s.children.push(i),o=l=f=l+3;continue}}f+=1}return o<u&&Rt(e,o,u,s,t,s.identifiers),c}(e,t)[0].children,r=i[0];return 1!==i.length&&x("The template of Component "+(n.fullName||n.name)+" must have only one root tag."),"!"!==r.tag&&"#"!==r.tag||x("Component template root tag must be a DOM element, instead of: "+e.slice(0,e.indexOf(">"))),r.type?"x:frag"===r.tag&&r.type===Te?r.type=null:"x:slot"===r.tag||"x:view"===r.tag?x(r.tag+" can not be used as root tag of component template: "+e.slice(0,e.indexOf(">"))):x("component can not be used as root tag of another component template: "+e.slice(0,e.indexOf(">"))):(r.xif||r.xfor||r.xkey)&&x("`x:if`, `x:for`, `x:key` can not be used on root tag of component template: "+e.slice(0,e.indexOf(">"))),r}};return v.HTMXParser=Xt,"undefined"!=typeof window&&window.ExtagDom&&v.set("view-engine",ExtagDom),{anew:Q.anew,inst:Q.inst,conf:function(e,t){if(1===arguments.length)return v.get(e);v.set(e,t)},help:function(e){return new t(e)},defineClass:g,Validator:te,Watcher:z,Store:we,Cache:Ae,Text:$e,Element:Pe,Component:We,node:yt.node,expr:yt.expr,version:"0.2.0"}});
