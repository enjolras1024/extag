!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Extag=t()}(this,function(){"use strict";var n=/\./,i=/(\]\.)|\.|\[|\]/g,r=/^[$_A-Z][$_A-Z0-9]*(\.[$_A-Z0-9]+)*$/i,s=/^[$_A-Z][$_A-Z0-9]*((\[\d+\])|(\.[$_A-Z0-9]+))*$/i;function a(e,t){for(var n=-1,i=e.length,r=t;++n<i;)if(null==(r=r[e[n]]))return r;return r}var d={test:function(e){return r.test(e)},parse:function(e){var t=null;return r.test(e)?t=e.split(n):s.test(e)&&(t=e.replace(i," ").trim().split(" ")),t},search:function(e,t,n){var i;if("string"==typeof e&&(e=d.parse(e)),e)return t&&(i=a(e,t)),null!=i||n||("undefined"!=typeof window?i=a(e,window):"undefined"!=typeof global&&(i=a(e,global))),i}},o={},v={JS_ENV:"",JSXEngine:null,HTMEngine:null,HTMXParser:null,get:function(e){return o[e]},set:function(e,t){o[e]=t}},l=Array.prototype.slice;function f(e,t,n){return l.call(e,t,n)}var p=Object.prototype.hasOwnProperty;function t(e){this.target=e}t.prototype.bind=function(){for(var e,t,n=this.target,i=0;i<arguments.length;++i)"function"==typeof(t=n[e=arguments[i]])&&(n[e]=t.bind(n))};var c=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");if(!(e instanceof Object)){var t=typeof e;"number"===t?e=new Number(e):"string"===t?e=new String(e):"boolean"===t&&(e=new Boolean(e))}var n,i,r,s=arguments.length;for(r=1;r<s;++r)if((n=arguments[r])instanceof Object)for(i in n)p.call(n,i)&&Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i));return e};function u(e,t){var n,i=e.length;if(!t)for(n=0;n<i;++n)if(Array.isArray(e[n])){t=[];break}if(t)for(n=0;n<i;++n){var r=e[n];Array.isArray(r)?u(r,t):t.push(r)}return t||e}function e(e){return"function"==typeof e&&/native code/.test(e.toString())}var y,h=function(e,t,n,i){if(e){var r=e.resolve();return function(e){"function"==typeof e&&r.then(e)}}if(n){var s=[],a=0,o=document.createTextNode("");return new n(function(){for(var e;e=s.pop();)e();a=a?0:1}).observe(o,{characterData:!0}),function(e){"function"==typeof e&&(s.unshift(e),o.data=a)}}return i?function(e){if("function"==typeof e){var t=!1,n=function(){t||(t=!0,e())};i(n),setTimeout(n)}}:t||setTimeout}("undefined"!=typeof Promise&&e(Promise)?Promise:null,void 0!==h&&e(h)?h:null,"undefined"!=typeof MutationObserver&&e(MutationObserver)?MutationObserver:null,"undefined"!=typeof requestAnimationFrame&&e(requestAnimationFrame)?requestAnimationFrame:null);try{v.JS_ENV=">=ES5",(y=Object.defineProperty)({},"x",{get:function(){}})}catch(e){v.JS_ENV="<ES5",y=function(e,t,n){e[t]=n.value}}function g(e,t){var n,i,r;for(n=0,i=t.length;n<i;++n)for(var s in r=t[n])p.call(r,s)&&y(e,s,Object.getOwnPropertyDescriptor(r,s))}function m(e){var t,n,i,r,s;if(p.call(e,"extends")){if("function"!=typeof(n=e.extends))throw new TypeError("superClass must be a function")}else n=Object;if(p.call(e,"constructor")){if("function"!=typeof(t=e.constructor))throw new TypeError("subClass must be a function")}else t=function(){n.apply(this,arguments)};return t.prototype=Object.create(n.prototype),s=[t.prototype],i=e.mixins,Array.isArray(i)&&s.push.apply(s,i),s.push(e),g(t.prototype,s),y(t.prototype,"constructor",{value:t,enumerable:!1,writable:!0,configurable:!0}),s=[t,n],(r=e.statics)&&(i=r.mixins,Array.isArray(i)&&s.push.apply(s,i),s.push(r)),g(t,s),delete t.prototype.statics,delete t.prototype.entend,delete t.prototype.mixins,delete t.mixins,t}var _,b=/&[\w#]{2,6};/;try{var x=document.createElement("div");(function(e){return x.textContent=e,x.innerHTML}),_=function(e){return b.test(e)?(x.innerHTML=e,x.textContent):e}}catch(e){(function(e){return/[<>&"\u00a0]/.test(e)?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\u00a0/g,"&nbsp;"):e}),_=function(e){return b.test(e)?e.replace(/&nbsp;/g,String.fromCharCode(160)).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}}function w(e,t){var n=e instanceof Error?e:new Error(e);throw t&&c(n,t),n}var k="view-engine",A={},E=[],C="{}",$={DATA:"@",TEXT:"#",EVENT:"+",MODIFIER:"::",CONVERTER:"|=",ASSIGN:"!",TWO_WAY:"@",ANY_WAY:"^",ONE_TIME:"?"},O=/\s+/,T=/\s/g,N=/^[A-Z]/,D=/^this\./,S=/^(this\.)?[\w$_]+$/;function P(){w("Parent is a base class and can not be instantiated!")}function j(e){for(var t=e._parent;t&&0===t.$type;)t=t._parent;return t}function M(e,t){var n,i,r=e._children,s=r.length;for(t=t||[],n=0;n<s;++n)0===(i=r[n]).$type?M(i,t):t.push(i);return t}function I(){}function z(e){var t="";return e.key?t+="."+e.key[0].toLowerCase()+e.key.slice(1):e.button&&(t+=[".left",".middle",".right"][e.button]),e.altKey&&(t+=".alt"),e.ctrlKey&&(t+=".ctrl"),e.metaKey&&(t+=".meta"),e.shiftKey&&(t+=".shift"),t}m({constructor:P,statics:{clean:function(e){e._children&&(e._children.isInvalidated=!1)},invalidate:function(e){e._children&&(e._children.isInvalidated=!0,e.invalidate(2))},findParent:j,flattenChildren:M},getParent:function(e){return e?j(this):this._parent},getChildren:function(e){return e?M(this):this._children?this._children.slice(0):[]},setChildren:function(e){var t,n=this._children,i=e?e.length:0,r=n?n.length:0;if(r===i){for(t=0;t<i&&n[t]===e[t];++t);if(t===i)return this}if(r){for(t=0;t<r;++t)n[t]._parent=null;n.length=0}if(i)for(t=0;t<i;++t)this.insertChild(e[t],null);else r&&this.invalidate(2);return this},insertChild:function(e,t){null==e&&w("The new child to be inserted into this parent must not be null!");var n,i,r,s=this._children;if(s||y(this,"_children",{value:s=[],writable:!1,enumerable:!1,configurable:!0}),r=s.length,null!=t){for(n=0;n<r&&(s[n]!==t||this!==t._parent);++n);if(n===r&&w("The child before which the new child is to be inserted is not a child of this parent!"),t===e)return this}else n=r;if(e._parent)if(e._parent===this){for(i=0;i<r;++i)if(s[i]===e){if(i===n)return this;s.splice(i,1),n=i<n?n-1:n,r=s.length;break}}else e._parent.removeChild(e);return n<r?s.splice(n,0,e):s.push(e),(e._parent=this).invalidate(2),this},appendChild:function(e){this.insertChild(e,null)},removeChild:function(e){null==e&&w("The new child to be removed from this parent must not be null!");var t=0,n=0,i=this._children;if(i)for(t=0,n=i.length;t<n&&(i[t]!==e||this!==e._parent);++t);return t===n&&w("The child to be removed is not a child of this parent!"),t<n-1?i.splice(t,1):i.pop(),e._parent=null,this.invalidate(2),this},replaceChild:function(e,t){null==e&&w("The new child to be inserted into this parent must not be null!");var n=0,i=0,r=0,s=this._children;if(s)for(n=0,r=s.length;n<r&&(s[n]!==t||this!==t._parent);++n);if(n===r&&w("The child to be replaced is not a child of this parent!"),e===t)return this;if(e._parent)if(e._parent===this){for(i=0;i<r;++i)if(s[i]===e){s.splice(i,1),n=i<n?n-1:n,r=s.length;break}}else e._parent.removeChild(e);return t._parent=null,e._parent=this,s[n]=e,this.invalidate(2),this}});var W=[function(e){this.emit(e.type+z(e),e,0)},function(e){this.emit(e.type+z(e),e,1)},function(e){this.emit(e.type+z(e),e,2)},function(e){this.emit(e.type+z(e),e,3)}];function V(e){var t=0;return e&&(e.capture&&(t|=1),e.passive&&(t|=2),e.once&&(t|=4)),t}function Y(e){var t={};return 1&e&&(t.capture=!0),2&e&&(t.passive=!0),4&e&&(t.once=!0),t}function R(e,t){return(1&e)==(1&t)}function X(e,t,n,i){var r=e._actions;if("function"==typeof n){r||y(e,"_actions",{value:r={},writable:!1,enumerable:!1,configurable:!0});var s=t.split(".");2<s.length&&(t=s[0]+"."+s.slice(1).sort().join("."));var a=r[t];a||(a=r[t]={type:t,handlers:[]});var o,l,c,f,u,h,p=V(i),d=a.handlers,g=d.length;for(l=0;l<g;++l)if((o=d[l])&&n===o.func&&R(p,o.flag))return;o={func:n,flag:p},d.push(o),"listeners"in a&&!a.listeners||(f=a,u=o,"function"==typeof(h=(c=e).constructor).addEventListener?h.addEventListener(c,f,u):f.listeners=null)}}function L(e,t,n,i){var r=e._actions;if(r){var s=t.split(".");2<s.length&&(t=s[0]+"."+s.slice(1).sort().join("."));var a=r[t];if(a){var o,l,c=a.handlers,f=c.length,u=!0;if(2!==arguments.length){var h,p,d,g,v=V(i);for(l=0;l<f;++l)(o=c[l])&&n===o.func&&R(v,o.flag)&&(c[l]=null),c[l]&&(u=!1);if(a.listeners)a.listeners[3&o.flag]&&(p=a,d=o,"function"==typeof(g=(h=e).constructor).removeEventListener&&g.removeEventListener(h,p,d));u&&(c.length=0,delete r[t])}else for(l=0;l<f;++l)(o=c[l])&&o.func&&L(e,t,o.func,o.flag?Y(o.flag):null)}}}function F(e,t,n){(t=f(t,0))[0]=n+" "+t[0],e.apply(console,t)}m({constructor:I,statics:{opts2flag:V,flag2opts:Y,getListenerByFlag:function(e){return W[3&e]}},on:function(e,t,n){if("object"!=typeof e)return X(this,e,t,n),this;var i=e;for(e in i)if(p.call(i,e)){var r=i[e];Array.isArray(r)?X(this,e,r[0],r[1]):X(this,e,r)}return this},off:function(e,t,n){var i=this._actions;if(!i)return this;var r=arguments.length,s=typeof e;if(0===r)for(e in i)L(this,e);else if("string"===s)1===r?L(this,e):L(this,e,t,n);else if("object"===s){var a=e;for(e in a)if(p.call(a,e)){var o=a[e];Array.isArray(o)?L(this,e,o[0],o[1]):null==o?L(this,e):L(this,e,o)}}return this},emit:function(e){var t=this._actions;if(!t)return this;var n=e.split(".");2<n.length&&(e=n[0]+"."+n.slice(1).sort().join("."));var i=t[e];if(i)for(var r,s=i.listeners?arguments[2]:0,a=i.handlers,o=0,l=a.length;o<l;++o)if((r=a[o])&&R(s,r.flag)){4&r.flag&&this.off(e,r.func,r.flag?Y(r.flag):null);try{r.func.apply(null,f(arguments,1))}catch(e){console.error(e)}}if(1<n.length&&t[n[0]]){var c=f(arguments,1);c.unshift(n[0]),this.emit.apply(this,c)}return this}});var H=function(){F(console.warn,arguments,"[EXTAG WARN]")};function Q(){1<arguments.length?(this.ctor=arguments[0],this.args=arguments[1]):this.gen=arguments[0]}m({constructor:Q,statics:{anew:function(e){return new Q(e,f(arguments,1))},inst:function(e){return new Q(e)}},gen:function(){var e=this.ctor,t=this.args;if(!t)return new e;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);default:throw new Error("`anew` arguments length must not exceed 6.")}}});var U={configurable:!0,enumerable:!0},J={},Z={};var q={},G=function(e,t){return t[e]};function B(e,t){var n,i;U.get=(n=t,p.call(J,n)||(J[n]=function(){return this.get(n)}),J[n]),U.set=(i=t,p.call(Z,i)||(Z[i]=function(e){this.set(i,e)}),Z[i]),y(e,t,U)}function K(){throw new Error("Accessor is a partial class for mixins and can not be instantiated")}function ee(e){if(e instanceof Object){var t=e.constructor;return t.fullName||t.name}return typeof e}function te(e,t,n,i){var r,s,a,o=K.getAttrDesc(e,t);if(o&&(o.type||o.validator))return(a=o.type)&&(r=function(e,t,n,i){var r,s,a,o,l,c,f=typeof i;if("string"===f&&typeof n!==i?(f=i,r=!0):"function"!==f||n instanceof i||(f=i.fullName||i.name,r=!0),r)return s=e.constructor,a=s.fullName||s.name,o=t,l=f,c=ee(n),"`"+o+"` of type `"+(a||"<<anonymous>>")+"` should be `"+l+(c?"`, not `"+c:"")+"`";if(Array.isArray(i)){for(var u=0,h=i.length;u<h&&!("string"==(f=typeof i[u])&&typeof n===i[u]||"function"===f&&n instanceof i[u]);++u);if(u===h)return function(e,t,n,i){for(var r=[],s=0,a=n.length;s<a;++s)r.push("`"+(n[s].name||n[s])+"`");return"`"+t+"` of type `"+(e||"<<anonymous>>")+"` should be "+r.join(" or ")+(i?", not `"+i:"")+"`"}((s=e.constructor).fullName||s.name,t,i,ee(n))}}(e,t,n,a)),r||((s=o.validator)&&(r="function"==typeof s?s.call(e,n,t):function(e,t,n,i){if(!i.test(n))return n+" does not match the pattern "+i.toString()+" of the property `"+t+"` in "+e.toString()}(e,t,n,s)),r||void 0)}m({constructor:K,statics:{getAttrDesc:function(e,t){return e.__extag_descriptors__?e.__extag_descriptors__[t]:null},defineGetterSetter:B,getAttributeDefaultValue:function(e){return"object"!=typeof e.value?e.value:null!=e.value?e.value instanceof Q?e.value.gen&&e.value.gen():e.value:void 0},getAttributeDefaultValues:function(e){var t={},n=e.__extag_descriptors__;if(n)for(var i in n)if(p.call(n,i)){var r=n[i],s=typeof r.value;if("undefined"===s)continue;"object"!==s?t[i]=r.value:null!=r.value&&(r.value instanceof Q?t[i]=r.value.gen&&r.value.gen():t[i]=r.value)}return t},applyAttributeDescriptors:function(e,t,n){if(!p.call(e,"__extag_descriptors__")){if(Array.isArray(t)){var i,r,s=t;for(t={},i=0,r=s.length;i<r;++i)t[s[i]]=q}var a,o;for(a in t=c({},e.__extag_descriptors__,t))if(p.call(t,a)){if(a in e&&!n)continue;o=t[a],t[a]="object"!=typeof o?{value:o}:o instanceof Q?{value:o}:o?(o.get&&!o.set||o.set&&!o.get&&(o.get=G),o):q,"bindable"in(o=t[a])||(o.bindable=!0),o.bindable&&B(e,a)}y(e,"__extag_descriptors__",{value:t})}}},get:function(e){throw new Error("Method `get` must be implemented by sub-class")},set:function(e,t){throw new Error("Method `set` must be implemented by sub-class")},assign:function(e){for(var t in e)p.call(e,t)&&this.set(t,e[t])}});var ne={validate0:function(e,t){var n,i=e.__extag_descriptors__;for(n in i)!i[n].required||t&&p.call(t,n)||H("Attribute Validation:","required `"+n+"` for "+(e.constructor.fullName||e.constructor.name))},validate:function(e,t,n,i){return!te(e,t,n)},troubleShoot:te};function ie(){throw new Error("DirtyMarker is a partial class for mixins and can not be instantiated")}m({constructor:ie,statics:{check:function(e,t,n,i){var r=e._dirty;r||y(e,"_dirty",{value:r={},enumerable:!1,writable:!0,configurable:!0}),t in r?r[t]===n&&delete r[t]:r[t]=i},clean:function(e,t){t?delete e._dirty[t]:e._dirty=null}},hasDirty:function(e){var t=this._dirty;return!!t&&(null==e||p.call(t,e))}});var re=[],se=[],ae=[],oe=0,le=0,ce=!1,fe=!1,ue=!1;function he(){if(!fe&&ce)try{var e;for(0,fe=!0,oe=0;oe<re.length;)re[oe].update(),++oe;for(re.length=0,ue=!(ce=fe=!1),le=oe=0;le<se.length;)se[le].render(),++le;for(se.length=0,le=0,ue=!1,e=ae.length-1;0<=e;--e)ae[e]();ae.length=0}catch(e){throw le=oe=0,re.length=0,se.length=0,ae.length=0,ce=fe=ue=!1,e}}var pe,de={insertUpdateQueue:function(e){var t,n=re.length,i=e.$guid;for(t=n-1;oe<t&&i<re[t].$guid;)--t;++t===n?re.push(e):re.splice(t,0,e),ce||(ce=!0,h(he))},insertRenderQueue:function(e){var t,n=se.length,i=e.$guid;if(ue)for(t=le+1;t<n&&i>=se[t].$guid;)++t;else{for(t=n-1;0<=t&&i<se[t].$guid;)--t;++t}t===n?se.push(e):se.splice(t,0,e)},pushCallbackQueue:function(e){ae.push(e)}},ge=[],ve=function(){return null!=pe},ye=function(e){(pe=e).execTimes=pe.execTimes?pe.execTimes+1:1,pe.depsCountNew=0,pe.depsCountOld=0,pe.deps||(pe.deps=[]),ge.unshift(e)},me=function(){if(null!=pe){if(pe.depsCountOld<pe.depsCount){var e,t,n=pe.deps;for(e=n.length-1;0<=e;--e)(t=n[e]).cnt!==pe.execTimes&&(n.splice(e,1),t.src.off("changed."+t.key,pe.invalidate))}pe.depsCount=pe.depsCountOld+pe.depsCountNew,ge.shift(),pe=ge[0]}},_e=function(e,t){if(null!=pe){var n,i,r,s=pe.deps;if(s.length)for(n=0;n<s.length;++n)if((i=s[n]).key===t&&i.src===e){r=i;break}r?(pe.depsCountOld++,r.cnt=pe.execTimes):(pe.depsCountNew++,e.on("changed."+t,pe.invalidate),s.push({src:e,ley:t,cnt:pe.execTimes}))}},be=function(e){var t=e.deps;if(t){var n,i;for(n=0;n<t.length;++n)(i=t[n]).src.off("changed."+i.key,e.invalidate);e.deps.length=0}},xe=-1;function we(e){we.initialize(this,e)}m({constructor:we,mixins:[K.prototype,I.prototype],statics:{create:function(e){return new we(e)},initialize:function(e,t){var n=e.constructor.prototype,i=e.constructor.attributes;K.applyAttributeDescriptors(n,i,!0);var r=K.getAttributeDefaultValues(e);y(e,"$props",{value:r,writable:!1,enumerable:!1,configurable:!0}),y(e,"$guid",{value:xe--,writable:!1,enumerable:!1,configurable:!0}),this.setup&&this.setup(),t&&(K.applyAttributeDescriptors(e,t,!1),e.assign(t))}},get:function(e){var t=K.getAttrDesc(this,e);return t&&t.bindable?(ve()&&_e(this,e),t.get?t.get.call(this,this.$props,e):this.$props[e]):this[e]},set:function(e,t){var n=K.getAttrDesc(this,e);if(n)if(n.bindable){var i,r=this.$props;n.get?n.set&&(i=n.get.call(this,r,e),n.set.call(this,t,r),i!==(t=n.get.call(this,r,e))&&this.emit("changed."+e,e)):(i=r[e])!==t&&(r[e]=t,this.emit("changed."+e,e))}else this[e]=t;else this[e]=t}});var ke={invalidate:function(){}};function Ae(e){y(this,"_owner",{value:e||ke}),y(this,"_props",{value:{}})}m({constructor:Ae,mixins:[K.prototype,ie.prototype],get:function(e){return this._props[e]},set:function(e,t){var n=this._props,i=n[e];t!==i&&(n[e]=t,this._owner.invalidate(1),ie.check(this,e,t,i))},reset:function(e){var t,n=this._props;if(n)for(t in n)e&&t in e||this.set(t,null);e&&this.assign(e)}});var Ee=0,Ce=null;function $e(){throw new Error("Shell is a base class and can not be instantiated")}function Oe(e){Oe.initialize(this,e)}function Te(e,t,n,i){var r=e.indexOf(":"),s="";0<r&&(s=e.slice(0,r),e=e.slice(r+1)),Te.initialize(this,s,e,t,n,i)}function Ne(e,t,n){Ne.initialize(this,e,t,n)}function De(e,t,n,i,r){this.sync=!0,this.scope=e,this.target=t,this.property=n,"function"==typeof i&&(this.invalidate=this.invalidate.bind(this),this.exec=this.exec.bind(this),this.collect=i,this.flag=1,this.exec(),0<this.depsCount&&De.record(t,this),"function"==typeof r&&(this.reflect=r,this.back=this.back.bind(this),t.on("changed."+n,this.back)))}m({constructor:$e,mixins:[I.prototype,K.prototype,ie.prototype],invalidate:function(e){0===this.$flag&&(this.$flag=1,de.insertUpdateQueue(this)),0==(this.$flag&e)&&(this.$flag|=e)},update:function(){throw new Error("The method `update` must be implemented by sub-class")},render:function(){throw new Error("The method `render` must be implemented by sub-class")},attach:function(e){if(0===this.$type)return!1;if($e.getViewEngine(this).attachShell(e,this),y(this,"$skin",{value:e,writable:!0,enumerable:!1,configurable:!0}),this._actions){var t,n,i=this._actions;for(t in i)if(p.call(i,t)&&(n=i[t]))for(var r,s=n.handlers,a=0,o=s.length;a<o;++a)(r=s[a])&&$e.addEventListener(this,n,r)}return 0==(8&this.$flag)&&(this.$flag|=8,de.insertRenderQueue(this)),!0},detach:function(e){var t=this._parent;return t&&!t._parent?(this._parent=null,void t.detach(e)):(this.constructor.destroy(this),!0)},getSkin:function(){return this.$skin},toString:function(){var e=this.constructor;return(e.fullName||e.name)+"<"+this.tag+">("+this.$guid+")"},get:function(e){return this._props[e]},set:function(e,t){var n=this._props,i=n[e];i!==t&&(n[e]=t,this.invalidate(1),ie.check(this,e,t,i))},cmd:function(e){this._commands||(this._commands=[]),this._commands.push({name:e,args:f(arguments,1)}),this.invalidate(4)},statics:{initialize:function(e,t,n,i){p.call(e,"_props")||y(e,"_props",{value:{},writable:!1,enumerable:!1,configurable:!0}),y(e,"$flag",{value:0,writable:!0,enumerable:!1,configurable:!0}),y(e,"$guid",{value:Ee++,writable:!1,enumerable:!1,configurable:!0}),y(e,"$type",{value:t,writable:!1,enumerable:!1,configurable:!0}),y(e,"tag",{value:n,writable:!1,enumerable:!1,configurable:!0}),y(e,"ns",{value:i,writable:!0,enumerable:!1,configurable:!0})},destroy:function(e){var t,n,i=e._children;if(i){for(t=i.length-1;0<=t;--t)(n=i[t])._parent=null,n.constructor.destroy(n);e._children.length=0}var r,s=e._bindings;if(s){for(t=s.length-1;0<=t;--t)(r=s[t]).constructor.destroy(r);delete e._bindings}e.off(),ie.clean(e);var a=e.$skin;a&&($e.getViewEngine(e).detachShell(a,e),e.$skin=null)},getViewEngine:function(e){return null==Ce&&(Ce=v.get(k)),e.ns&&!Ce.hasNameSpace(e.ns)?v.get(e.ns+":"+k):Ce},addEventListener:function(e,t,n){var i=e.getSkin(),r=$e.getViewEngine(e);if(i&&r){var s=t.type.indexOf("."),a=s<0?t.type:t.type.slice(0,s);if(r.mayDispatchEvent(i,a)){t.listeners=t.listeners||[];var o=t.listeners[3&n.flag];if(o)return void o.count++;o=I.getListenerByFlag(n.flag).bind(e),r.addEventListener(i,a,o,I.flag2opts(3&n.flag)),(t.listeners[3&n.flag]=o).count=1}else t.listeners=null}},removeEventListener:function(e,t,n){var i=e.getSkin(),r=$e.getViewEngine(e);if(i&&r){var s=t.listeners&&t.listeners[3&n.flag];if(s){s.count--;var a=t.type.indexOf("."),o=a<0?t.type:t.type.slice(0,a);s.count<1&&r.mayDispatchEvent(i,o)&&r.removeEventListener(i,o,s,I.flag2opts(3&n.flag))}}}}}),m({constructor:Oe,extends:$e,statics:{create:function(e){return new Oe(e)},initialize:function(e,t){$e.initialize(e,3,"",""),e.set("data",t||"")}},update:function(){return 0!==this.$flag&&(0==(8&this.$flag)&&(this.$flag|=8,de.insertRenderQueue(this)),!0)},render:function(){if(0===this.$flag)return!1;this.$skin&&($e.getViewEngine(this).renderShell(this.$skin,this),ie.clean(this));return!(this.$flag=0)},toString:function(){var e=this.get("data");return'"'+((e=null==e?"":e.toString()).length<24?e:e.slice(0,21)+"...")+'"('+this.$guid+")"}}),m({constructor:Te,extends:$e,mixins:[P.prototype],statics:{initialize:function(e,t,n,i,r,s){$e.initialize(e,1,n,t),Te.defineMembers(e),r&&s||i&&e.assign(i)},create:function(e,t,n,i){return new Te(e,t,n,i)},defineMembers:function(e){var t=e.constructor.prototype;"classes"in t||(y(t,"attrs",{get:function(){return this._attrs||y(this,"_attrs",{value:new Ae(this),configurable:!0}),this._attrs}}),y(t,"style",{get:function(){return this._style||y(this,"_style",{value:new Ae(this),configurable:!0}),this._style}}),y(t,"classes",{get:function(){return this._classes||y(this,"_classes",{value:new Ae(this),configurable:!0}),this._classes}}))}},update:function(){return 0!==this.$flag&&(v.HTMXEngine.transferProperties(this),0==(8&this.$flag)&&(this.$flag|=8,de.insertRenderQueue(this)),!0)},render:function(){if(0===this.$flag)return!1;this.$skin&&($e.getViewEngine(this).renderShell(this.$skin,this),this._children&&P.clean(this),ie.clean(this),this._attrs&&ie.clean(this._attrs),this._style&&ie.clean(this._style),this._classes&&ie.clean(this._classes),this._commands&&(this._commands=null));return!(this.$flag=0)}}),m({constructor:Ne,extends:$e,mixins:[P.prototype],statics:{initialize:function(e,t,n,i){$e.initialize(e,0,"x:frag",""),(e.scopes=n)&&i&&i.compile("contents",e,n)},create:function(e,t,n){return new Ne(e,t,n)}},update:function(){if(0===this.$flag)return!1;if(this.scopes&&this.hasDirty("contents")){var e=v.JSXEngine,t=this._props.contents||[];e.reflow(this.scopes[0],this,t)}if(0==(8&this.$flag)){if(this._parent&&2&this.$flag){var n=this.getParent(!0);n.$flag|=2,0==(8&n.$flag)&&(n.$flag|=8,de.insertRenderQueue(n))}this.$flag|=8,de.insertRenderQueue(this)}return!0},render:function(){return 0!==this.$flag&&!(this.$flag=0)}}),m({constructor:De,statics:{record:function(e,t){var n=e._bindings;n?n.push(t):y(e,"_bindings",{value:[t],writable:!1,enumerable:!1,configurable:!0})},remove:function(e,t){var n=e._bindings;n&&n.length&&n.splice(n.lastIndexOf(t),1)},create:function(e,t,n,i,r){return new De(e,t,n,i,r)},destroy:function(e){var t=e.target,n=e.scope;"function"==typeof e.reflect&&t.off("changed."+e.property,e.back),e.sync||"function"!=typeof e.collect||n.off("updating",e.exec),be(e),De.remove(n,e)}},exec:function(){if(0!==this.flag){ye(this);var e=this.collect.call(this.scope);me(),this.target.set(this.property,e),this.flag=0,1<this.depsCount&&this.sync&&(this.scope.on("updating",this.exec),this.sync=!1)}},back:function(){this.reflect.call(this.scope,this.target[this.property])},invalidate:function(){this.flag=1,this.sync?this.exec():this.scope.invalidate(1)}});var Se=$e.prototype,Pe=Te.prototype,je=Ne.prototype;function Me(e,t,n){Me.initialize(this,e,t,n)}function Ie(e,t,n){Ie.initialize(this,e,t,n)}function ze(e,t){this.func=e,this.expr=t}function We(e,t,n){this.binding=e,this.pattern=t,this.unparsed=n}function Ve(e,t){if(t&&"string"==typeof e){var n,i,r,s={},a=e.split(";");for(r=a.length-1;0<=r;--r)0<(i=(n=a[r]).indexOf(":"))&&(s[t.toCamelCase(n.slice(0,i).trim())]=n.slice(i+1).trim());return s}}function Ye(e){if("string"==typeof e&&(e=e.trim().split(O)),Array.isArray(e)){var t,n={};for(t=0;t<e.length;++t)e[t]&&(n[e[t]]=!0);return n}}function Re(e,t,n){var i,r;if(t)for(i in t)"object"==typeof(r=t[i])&&r instanceof We?r.compile(i,e,n):e.set(i,r)}function Xe(e,t,n){var i,r;if(t)for(i in t)"object"==typeof(r=t[i])&&r instanceof We?r.compile(i,e,n):"function"==typeof r&&e.on(i,r)}function Le(e,t,n){var i=He(t,n);e.setChildren(i)}function Fe(e,t,n){var i=He(t,n);e.setContents(i)}function He(e,t){var n,i,r,s=[];if(e&&e.length){for(n=0,i=e.length;n<i;++n)(r=Qe(e[n],t))&&s.push(r);return s}}function Qe(e,t){var n,i,r=e.tag;return"string"==typeof e?i=new Oe(e):e instanceof We?i=new Ne(null,t,e):e.xif||e.xfor?i=new Ie(null,t,e):"!"!==e.tag&&((n=e.type)?i=new n(null,t,e):"!"!==e.tag&&(i=new Te(e.ns?e.ns+":"+r:r,null,t,e),e.events&&Xe(i,e.events,t),e.props&&Re(i,e.props,t),e.attrs&&Re(i.attrs,e.attrs,t),e.style&&Re(i.style,e.style,t),e.classes&&Re(i.classes,e.classes,t),e.children&&Le(i,e.children,t)),i&&e.name&&(t[0].addNamedPart(e.name,i),y(i,"$owner",{configurable:!0,enumarable:!1,writable:!1,value:t[0]}))),i}m({constructor:Me,extends:$e,mixins:[P.prototype],statics:{__extag_component_class__:!0,create:function(e,t,n,i){return new e(t,n,i)},initialize:function(e,t,n,i){var r=e.constructor,s=r.prototype,a=r.attributes,o=r.__extag_template__;K.applyAttributeDescriptors(s,a,!0);var l,c=K.getAttributeDefaultValues(e);if(y(e,"_props",{value:c,writable:!1,enumerable:!1,configurable:!0}),!o){if("string"==typeof r.template)o=v.HTMXParser.parse(r.template,s);else if("function"==typeof r.template){o=v.JSXParser.parse(r.template,s)}if(!o)throw new TypeError("The template must be legal HTML string or DOM element");y(r,"__extag_template__",{value:o,writable:!1,enumerable:!1,configurable:!0})}if($e.initialize(e,"x:frag"!==o.tag?1:0,o.tag,o.ns||""),Te.defineMembers(e),n&&n[0].context?(l=e.setup(n[0].context),null==e.context&&(e.context=n[0].context)):l=e.setup(),null!=l){if("object"!=typeof l)throw new TypeError("setup() should return object, not "+typeof l);for(var f in l)y(e,f,Object.getOwnPropertyDescriptor(l,f))}v.HTMXEngine.driveComponent(e,o,n,i,t),e.emit("created")}},get:function(e){var t=K.getAttrDesc(this,e);return t?t.bindable?(ve()&&_e(this,e),t.get?t.get.call(this,e,this._props):this._props[e]):this[e]:this._props[e]},set:function(e,t){var n=K.getAttrDesc(this,e);if(n)if(n.bindable){var i,r=this._props;n.get?n.set&&(i=n.get.call(this,e,r),n.set.call(this,t,r),i!==(t=n.get.call(this,e,r))&&(this.invalidate(1),this.emit("changed."+e,e,t,this))):(i=r[e])!==t&&(r[e]=t,this.invalidate(1),this.emit("changed."+e,e,t,this))}else this[e]=t;else Se.set.call(this,e,t)},bind:function(e,t,n,i){De.create(this,e,t,n,i)},setup:function(e){e&&(this.context=e)},attach:function(e){return!!Se.attach.call(this,e)&&(this.emit("attached",e),!0)},detach:function(e){var t=this.getSkin();return!!$e.prototype.detach.call(this,e)&&(t&&this.emit("detached",t),this.emit("destroyed"),!0)},update:function(){if(0===this.$flag)return!1;if(this.emit("updating",this.$flag),0!==this.$type?v.HTMXEngine.transferProperties(this):this._parent&&2&this.$flag&&this._parent.invalidate(2),0==(8&this.$flag)){if(0===this.$type&&this._parent&&2&this.$flag){var e=this.getParent(!0);e.$flag|=2,0==(8&e.$flag)&&(e.$flag|=8,de.insertRenderQueue(e))}this.$flag|=8,de.insertRenderQueue(this)}return!0},render:function(){if(0===this.$flag)return!1;0!==this.$type?Pe.render.call(this):je.render.call(this);var e=this._actions;return e&&e.rendered&&this.$skin&&de.pushCallbackQueue(function(){this.emit("rendered",this.$skin)}.bind(this)),!0},getContents:function(){return this._contents},setContents:function(e){this._contents!==e&&(this._contents=e,this.emit("changed.contents","contents",e,this))},addNamedPart:function(e,t){this[e]=t}}),m({constructor:Ie,extends:Me,statics:{initialize:function(e,t,n,i){(Me.initialize(e,t),e.mode=0,i)&&(e.scopes=n,e.template=c({},i),delete e.template.xkey,delete e.template.xfor,delete e.template.xif,e.set("condition",!0),i.xif&&(e.mode=1,i.xif.compile("condition",e,n)),i.xfor&&(e.mode=2,i.xfor[1].compile("iterable",e,n),i.xkey&&(e.keyEval=i.xkey)),e.on("updating",e.onUpdating.bind(e)))},template:"<x:frag></x:frag>"},onUpdating:function(){if(this.mode){var e=this.get("condition"),t=this.template,n=this.scopes,i=[];if(e){var r=v.HTMXEngine;if(1===this.mode)return(a=r.makeContent(t,n))&&i.push(a),void this.setChildren(i);var s,a,o,l,c,f,u,h={},p=this.get("iterable")||[],d=this._children||[],g=this.keyEval;for(f=0,c=d.length;f<c;++f)(l=d[f].__key__)&&(h[l]=f);for(f=0,c=p.length;f<c;++f)a=l=null,o=p[f],u=n.concat([o]),g&&null!=(s=h[l=g.execute(u)])&&(a=d[s]),a||((a=r.makeContent(t,u)).__key__=l),i.push(a);this.setChildren(i)}else this.setChildren(i)}}}),m({constructor:ze,execute:function(e,t){var n=e.slice(1);return 1<arguments.length&&n.push(t),this.func.apply(e[0],n)}}),m({constructor:We,statics:{},connect:function(e,t){if(this.unparsed){var n=this.pattern,i=n.evaluator,r=n.converters;if("function"==typeof i&&(n.evaluator=new ze(i)),r)for(var s=0;s<r.length;++s)"function"==typeof r[s]&&(n.converters[s]=new ze(r[s]));this.unparsed=!1}},compile:function(e,t,n){return this.binding.compile(this.pattern,e,t,n)}});var Ue={driveProps:Re,driveEvents:Xe,driveContents:Fe,driveChildren:Le,driveComponent:function(e,t,n,i,r){var s=[e];i&&n?(r&&i.props?r=c({},i.props,r):!r&&i.props&&(r=i.props),Re(e,r,n),i.events&&Xe(e,i.events,n),i.attrs&&Re(e.attrs,i.attrs,n),i.style&&Re(e.style,i.style,n),i.classes&&Re(e.classes,i.classes,n),i.children&&Fe(e,i.children,n)):r&&Re(e,r,n),t.events&&Xe(e,t.events,s),t.props&&(y(e,"__props",{value:new Ae(e),configurable:!0}),Re(e.__props,t.props,s)),t.attrs&&(y(e,"__attrs",{value:new Ae(e),configurable:!0}),Re(e.__attrs,t.attrs,s)),t.style&&(y(e,"__style",{value:new Ae(e),configurable:!0}),Re(e.__style,t.style,s)),t.classes&&(y(e,"__classes",{value:new Ae(e),configurable:!0}),Re(e.__classes,t.classes,s)),t.children&&Le(e,t.children,s)},transferProperties:function(e){if(e.tag){var t,n,i,r=e._props;if(e.hasDirty("style")&&(ie.clean(e,"style"),"object"==typeof(t=r.style)?e.style.reset(t):"string"==typeof t&&((i=$e.getViewEngine(e))&&(t=Ve(t,i)),e.style.reset(t))),e.hasDirty("classes")&&(ie.clean(e,"classes"),"object"!=typeof(n=r.classes)&&(n=Ye(n)),e.classes.reset(n)),e.__props&&e.constructor.__extag_component_class__){var s=e.__props;if(s&&s.hasDirty("style")){var a=e.__style;a||(a=new Ae(e),y(e,"__style",{value:a,configurable:!0})),ie.clean(s,"style"),"object"==typeof(t=s.get("style"))?a.reset(t):"string"==typeof t&&((i=$e.getViewEngine(e))&&(t=Ve(t,i)),a.reset(t))}if(s&&s.hasDirty("classes")){var o=e.__classes;o||(o=new Ae(e),y(e,"__classes",{value:o,configurable:!0})),ie.clean(s,"classes"),"object"!=typeof(n=s.get("classes"))&&(n=Ye(n)),o.reset(n)}}}},buildContent:Qe,makeContent:Qe,makeContents:He};function Je(e,t,n){Je.initialize(this,e,t,n)}v.HTMXEngine=Ue,m({constructor:Je,extends:Me,statics:{initialize:function(e,t,n,i){var r=i&&i.props&&i.props.name;Me.initialize(e,t,n,{props:{name:r||""}}),e.template=c({},i),e.template.props=c({},i.props),r&&delete e.template.props.name,e.scopes=n,e.invalidate(1),e.on("updating",e.onUpdating.bind(e)),n[0].on("changed.contents",function(){e.invalidate(1)})},template:"<x:frag></x:frag>"},onUpdating:function(){var e,t,n,i,r=[],s=this.scopes[0].getContents(),a=this.template,o=this.scopes;if(s&&0<s.length){var l=this.get("name")||"";for(i=0,n=s.length;i<n;++i)l===((t=s[i])._attrs&&t.attrs.get("x:slot")||"")&&r.push(t);this.useDefault=!1}if(0===r.length&&a.children){if(this.useDefault)return;for(i=0,n=(e=a.children).length;i<n;++i)(t=Ue.makeContent(e[i],o))&&r.push(t);this.useDefault=!0}this.setChildren(r)}});var Ze={ASSIGN:-1,ONE_TIME:0,ONE_WAY:1,TWO_WAY:2,ANY_WAY:3};function qe(e,t){var n=K.getAttrDesc(e,t);return n&&n.bindable}function Ge(e){this.mode=e.mode,this.path=e.path,this.paths=e.paths,this.evaluator=e.evaluator,this.converters=e.converters,this.identifiers=e.identifiers}function Be(e){this.pattern=e}function Ke(e){return{once:0<=e.indexOf("once"),capture:0<=e.indexOf("capture"),passive:0<=e.indexOf("passive")}}function et(e,t){"object"==typeof t&&t&&e&&e.length&&(0<=e.indexOf("stop")&&t.stopPropagation&&t.stopPropagation(),0<=e.indexOf("prev")&&t.preventDefault&&t.preventDefault())}function tt(e){this.pattern=e}function nt(e,t){return!e.tag&&!t.__extag_node__||e.xkey===t.xkey&&(t.type?e.constructor===t.type:e.tag===t.tag&&e.ns===t.ns)}function it(e,t,n){var i,r;if(null==e)return i=new Oe("");if(e.type)i=new e.type(e.props,[n]);else{if(!e.tag)return i=new Oe(e);i=new Te((r=e.ns||t.ns)?r+":"+e.tag:e.tag,e.props,[n])}return e.name&&(n.addNamedPart(e.name,i),y(i,"$owner",{configurable:!0,enumarable:!1,writable:!1,value:n})),e.xkey&&(i.__key__=e.xkey),i}function rt(e,t,n){var i,r;if(t instanceof Me&&t!==n)i=t._contents||E,r=e.children||E;else{if(t instanceof Je)return;i=t._children||E,r=e.children||E}for(var s,a,o,l=new Array(r.length),c=0,f=i.length-1,u=0,h=r.length-1,p=i[c],d=i[f],g=r[u],v=r[h];c<=f&&u<=h;)if(null==p)p=i[++c];else if(null==d)d=i[--f];else if(nt(p,g))st(g,l[u]=p,n),p=i[++c],g=r[++u];else if(nt(d,v))st(v,l[h]=d,n),d=i[--f],v=r[--h];else if(nt(p,v))st(v,l[h]=p,n),p=i[++c],v=r[--h];else if(nt(d,g))st(g,l[u]=d,n),d=i[--f],g=r[++u];else{if(!s)for(s={},o=c;o<=f;++o)(a=i[c].__key__)&&(s[a]=o);null!=(o=(a=g.xkey)&&s[a])&&nt(i[o]||A,g)?l[u]=i[o]:l[u]=it(g,t,n),st(g,l[u],n),g=r[++u]}if(f<c)for(;u<=h;)l[u]=it(g,t,n),st(g,l[u],n),g=r[++u];t instanceof Me&&t!==n?t.setContents(l):t.setChildren(l)}function st(e,t,n){"object"==typeof e&&e.__extag_node__?(!function(e,t,n){var i,r,s=e.props,a=e.events,o=t._props,l=t._events;if(o)if(t instanceof Me)for(i in o)s&&i in s||((r=K.getAttrDesc(i))?t.set(i,K.getAttributeDefaultValue(r)):t.set(i,null));else for(i in o)s&&i in s||t.set(i,null);if(s&&t.assign(s),l)for(i in l)l[i]&&t.off(i,l[i]);a&&t.on(a)}(e,t),rt(e,t,n)):t.set("data",e)}m({constructor:Ge,statics:{MODES:Ze,compile:function(e,t,n,i){return new Ge(e).link(t,n,i)},destroy:function(e){var t=e.target,n=e.scopes;e.mode===Ze.TWO_WAY&&qe(e.target,e.targetProp)&&e.target.off("changed."+e.targetProp,e.back),e.sync||n[0].off("updating",e.exec),De.remove(t,e),be(e)}},link:function(e,t,n){if(this.flag=0,this.sync=!0,this.scopes=n,this.target=t,this.targetProp=e,this.mode!==Ze.ASSIGN){if(this.exec=this.exec.bind(this),this.invalidate=this.invalidate.bind(this),this.mode===Ze.TWO_WAY){this.back=this.back.bind(this);var i=this.path,r=this.identifiers.indexOf(i[0]);this.sourceProp=i[i.length-1],this.source=0<=r?d.search(i.slice(1,i.length-1),n[r],!0):d.search(i.slice(1,i.length-1),n[0].constructor.resources,!0),qe(this.target,this.targetProp)&&this.target.on("changed."+this.targetProp,this.back)}this.mode===Ze.ANY_WAY?(this.sync=!1,this.scopes[0].on("updating",this.exec),this.target.set(this.targetProp,this.eval())):(this.sync=!0,this.flag=1,this.exec(),0<this.depsCount&&De.record(t,this))}else this.target.set(this.targetProp,this.eval())},eval:function(e){if(this.mode===Ze.TWO_WAY)return e?this.target[this.targetProp]:this.source[this.sourceProp];var t=this.converters;return t&&t.length?function(e,t,n){for(var i=0;i<e.length;++i)n=e[i].execute(t,n);return n}(t,this.scopes,this.evaluator.execute(this.scopes)):this.evaluator.execute(this.scopes)},exec:function(){if(this.mode!==Ze.ANY_WAY){if(0!==this.flag){ye(this);var e=this.eval();me(),this.target.set(this.targetProp,e),this.flag=0,this.mode===Ze.ONE_TIME?Ge.destroy(this):1<this.depsCount&&this.sync&&(this.scopes[0].on("updating",this.exec),this.sync=!1)}}else this.target.set(this.targetProp,this.eval())},back:function(){this.source.set(this.sourceProp,this.eval(!0))},invalidate:function(){this.flag=1,this.sync?this.exec():this.scopes[0].invalidate(1)}}),m({constructor:Be,statics:{compile:function(e,t,n,i){new Be(e).link(t,n,i)}},link:function(e,t,n){var i,r=this.pattern,s=r.handler,a=r.evaluator,o=r.modifiers;if(s){var l=n[0][s];if(!l)return;o&&o.length?"bind"===o[0]&&1===o.length?t.on(e,l.bind(n[0])):(i=function(e){et(o,e),0<=o.indexOf("bind")?l.apply(n[0],arguments):l.apply(null,arguments)},t.on(e,i,Ke(o))):t.on(e,l)}else o&&o.length?(i=function(e){et(o,e),a.execute(n)},t.on(e,i,Ke(o))):t.on(e,function(){a.execute(n)})}}),m({constructor:tt,statics:{compile:function(e,t,n,i){new tt(e).link(t,n,i)},destroy:function(e){e.scopes[0].off("updating",e.exec);var t=e.cache._bindings;if(t)for(var n=t.length-1;0<=n;--n)Ge.destroy(t[n]);De.remove(e.target,e)}},link:function(e,t,n){var i,r,s,a=this.pattern;this.scopes=n,this.target=t,this.property=e;var o=this.cache=new Ae(n[0]);for(i=0,r=a.length;i<r;++i)(s=a[i])instanceof We?s.compile(i,o,n):o.set(i,s);o.set("length",r),De.record(t,this),this.exec(),this.exec=this.exec.bind(this),n[0].on("updating",this.exec)},exec:function(){var e=this.cache;if(e.hasDirty()){var t=f(e._props,0);this.pattern.asStr&&(t=t.join("")),this.target.set(this.property,t),ie.clean(e)}}});var at={reflow:function(e,t,n){2===arguments.length&&(n=t,t=e),rt(t instanceof Me&&t!==e?{contents:u(n)}:{children:u(n)},t,e)}};function ot(e,t,n){ot.initialize(this,e,t,n)}function lt(e,t){var n,i,r,s=e.props;if(e.xif&&e.xif.connect(t,e.identifiers),e.xfor&&(e.xfor[1].connect(t,e.identifiers),e.identifiers=e.identifiers.concat([e.xfor[0]])),e.xkey&&e.xkey.connect(t,e.identifiers),s)for(i in s)"object"==typeof(n=s[i])&&n instanceof We&&n.connect(t,e.identifiers),"object"==typeof n&&(n instanceof We?n.connect(t,e.identifiers):"classes"!==i&&"style"!==i&&"attrs"!==i||(e[i]=n,delete s[i]));if(e.type&&"string"==typeof e.type&&("function"==typeof(r=d.search(e.type,t.constructor.resources))&&r.__extag_component_class__||w("Can not find such component type `"+ut+"`"),e.type=r),null==e.type&&N.test(e.tag)&&"function"==typeof(r=d.search(e.tag,t.constructor.resources))&&r.__extag_component_class__&&(e.type=r),null==e.type)switch(e.tag){case"x:slot":e.type=Je;break;case"x:view":e.type=ot;break;case"x:frag":e.type=Ne}e.events&&function(e,t){var n,i,r=e.events;for(i in r)"object"==typeof(n=r[i])&&n instanceof We?n.connect(t,e.identifiers):"object"==typeof(n=ut("+",n))&&n instanceof We?r[i]=n:delete r[i]}(e,t)}v.JSXEngine=at,m({constructor:ot,extends:Me,statics:{initialize:function(e,t,n,i){var r=i&&i.attrs&&i.attrs["x:type"];Me.initialize(e,t,n,{props:{xtype:r}}),e.template=c({},i),e.template.attrs=c({},i.attrs),delete e.template.attrs["x:type"],e.scopes=n,e.invalidate(1),e.on("updating",e.onUpdating.bind(e))},template:"<x:frag></x:frag>"},onUpdating:function(){var e,t,n=this.get("xtype"),i=this.templat,r=this.scopes;if("function"==typeof n)t=n;else if("object"==typeof n&&"function"==typeof Promise&&n instanceof Promise)return void n.then(function(e){this.set("xtype",e)}.bind(this)).catch(function(){this.set("xtype",null)}.bind(this));"function"==typeof t&&t.__extag_component_class__?(i.tag="?",i.type=t,e=Ue.makeContent(i,r),this.setChildren([e])):this.setChildren([])}});var ct={xns:null,xif:null,xfor:null,xkey:null,xname:null,xtype:null,props:null,events:null,children:null,contents:null};function ft(e,t,n){var i={__extag_node__:!0},r=typeof e;if("string"===r){var s=e.indexOf(":");i.tag=s<0?(i.ns="",e):(i.ns=e.slice(0,s),e.slice(s+1))}else"function"===r?i.type=e:w("First argument must be class, string or constructor.");if(null!=t){t.xns&&(i.ns=t.xns),t.xif&&(i.xif=t.xif),t.xfor&&(i.xfor=t.xfor),t.xkey&&(i.xkey=t.xkey),t.xname&&(i.name=t.xname),t.xtype&&!i.type&&(i.type=t.xtype),t.events&&(i.events=t.events);var a=i.props={};for(var o in t)!p.call(t,o)||o in ct||(a[o]=t[o])}return n&&(3<arguments.length&&(n=f(arguments,2)),n=Array.isArray(n)?u(n):[n],i.children=n),i}function ut(e,t){var n,i=2<arguments.length?f(arguments,2):null;if("@"!==e[0])return"+"===e?"string"==typeof t&&S.test(t.trim())?new We(Be,{handler:t.trim().replace(D,""),modifiers:i}):new We(Be,{evaluator:t,modifiers:i},!0):"#"===e?(i?i.unshift(t):i=[t],new We(tt,i)):void 0;switch(e){case"@":n=1;break;case"@@":n=2;break;case"@!":n=-1;break;case"@?":n=0;break;default:return}return new We(Ge,{mode:n,path:2===n?t.trim().replace(D,""):null,evaluator:t,converters:i},!0)}var ht={node:ft,expr:ut,parse:function(e,t){var n=e(ft,ut);return n.identifiers=["this"],lt(n,t),function e(t,n){var i=t.children;if(i&&i.length){var r,s,a,o=-1;for(r=i.length-1;0<=r;--r){if("object"==typeof(s=i[r])){if(s.__extag_node__){a&&i.splice(r+1,o+1,new We(tt,i.slice(r+1,o+1))),a=!1,o=-1,s.identifiers=t.identifiers,lt(s,n),e(s,n);continue}s instanceof We&&(s.connect(n,t.identifiers),a=!0)}o<0&&(o=r)}a&&-1<o&&i.splice(0,o+1,new We(tt,i.slice(0,o+1)))}}(n,t),n.type?"x:frag"===n.tag?n.type=null:"x:slot"===n.tag||"x:view"===n.tag?w(n.tag+" can not be used as root tag of component template."):w("component can not be used as root tag of another component template."):(n.xif||n.xfor||n.xkey)&&w("`xif`, `xfor`, `xkey` can not be used on component template root tag."),n}};v.JSXParser=ht;var pt=/[\w).+\-_$\]]/,dt="abstract arguments boolean break byte case catch char class const continue debugger default delete do double else enum eval export extends false final finally float for function goto if implements import in instanceof int interface let long native new null package private protected public return short static super switch synchronized this throw throws transient true try typeof undefined var void volatile while with yield isNaN isFinite parseFloat parseInt Array Date Infinity Math NaN Number Object String Boolean RegExp JSON",gt={};function vt(e,t){for(var n,i=e.length;t<i;){if(!(32===(n=e.charCodeAt(t))||9<=n&&n<=13))return 44!==n&&123!==n;--t}}function yt(e,t){for(var n,i,r,s=e.length;t<s;)if(32===(n=e.charCodeAt(t))||9<=n&&n<=13)r=!0,++t;else{if(46===n)i&&w("Unexpected token '.'.",{code:1001,expr:e}),i=!(r=!1);else{if(!(mt(n)||48<=n&&n<=57)){i&&w("Unexpected token '"+e[t]+"'.",{code:1001,expr:e});break}if(r&&!i){--t;break}i=r=!1}++t}return t}function mt(e){return 97<=e&&e<=122||65<=e&&e<=90||95===e||36===e}!function(){for(var e=dt.split(/\s+/),t=0,n=e.length;t<n;++t)gt[e[t]]=!0}();var _t={parse:function(e,t,n){var i,r,s,a=n.slice(1),o=0,l=[],c=function(e){for(var t,n,i,r,s,a,o=[],l=e.length,c=0;c<l;){switch(r=s,s=e.charCodeAt(c)){case 39:t?92!==r&&(t=!1):t=!0;break;case 34:n?92!==r&&(n=!1):n=!0;break;case 47:if(i)92!==r&&(i=!1);else{for(var f;0<=a&&(32===(f=e.charCodeAt(a))||9<=f&&f<=13);--a);f&&pt.test(f)||(i=!0)}break;default:t||n||i||46===r||!mt(s)||(a=yt(e,c+1),58!==(s=e.charCodeAt(a))?o.push(c,a):vt(e,c-1)&&o.push(c,a),c=a)}++c}return o}(e),f=t.constructor.resources||A;for(s=0;s<c.length;s+=2)c[s+1]<0||(i=e.slice(c[s]+o,c[s+1]+o),r=d.parse(i.replace(T,"")),p.call(gt,r[0])||n.indexOf(r[0])<0&&(r[0]in f?l.push("var "+r[0]+" = this.constructor.resources."+r[0]+";"):(e=e.slice(0,c[s]+o)+"this."+i+e.slice(c[s+1]+o),o+=5)));l.push("return "+e),a.push(l.join("\n"));try{return new ze(Function.apply(null,a),e)}catch(e){w(e,{code:1001,expr:arguments[0],desc:"Illegal expression `"+arguments[0]+"`."})}}},bt={tryParse:function(e){return"false"!==e&&("true"===e||(isNaN(e)?void 0:Number(e)))}},xt=Ge.MODES;function wt(e,t){for(var n="$"+t.length;0<=e.indexOf(n);)n="$"+n;return n}var kt={parse:function(e,t,n){var i,r,s,a,o,l,c,f=-1,u=e.length;if(e[0]===$.TWO_WAY?(f=xt.TWO_WAY,e=e.slice(1,u)):e[u-1]===$.ANY_WAY?(f=xt.ANY_WAY,e=e.slice(0,u-1)):e[u-1]===$.ASSIGN?(f=xt.ASSIGN,e=e.slice(0,u-1)):e[u-1]===$.ONE_TIME?(f=xt.ONE_TIME,e=e.slice(0,u-1)):f=xt.ONE_WAY,f===xt.TWO_WAY)d.test(e.trim())||w("",{code:1001,expr:arguments[0],desc:"`"+arguments[0]+"` is not a valid two-way binding expression. Must be a property name or path."}),(c=d.parse(e.trim()))[0]in t&&n.indexOf(c[0])<0&&c.unshift("this"),a=_t.parse(e,t,n);else if(e.indexOf($.CONVERTER)<0)a=_t.parse(e,t,n);else if(o=e.split($.CONVERTER),a=_t.parse(o[0],t,n),1<o.length)for(i=1;i<o.length;++i){(l=o[i].trim())||w("Converter must not be empty!",{code:1001,expr:arguments[0],desc:"Empty converter in the expression `"+arguments[0]+"` is not allowed."});var h=wt(e,n),p=l.indexOf("(");l=0<p?l.slice(0,p+1)+h+","+l.slice(p+1):l+"("+h+")",s=_t.parse(l,t,n.concat([h])),(r=r||[]).push(s)}return{mode:f,path:c,paths:[],evaluator:a,converters:r,identifiers:n}}},At=/\s*\n\s*/g,Et=new RegExp($.DATA+"\\"+C[0]+"(\\s|.)*?\\"+C[1]),Ct={like:function(e){return Et.test(e)},parse:function(e,t,n){var i,r,s,a,o,l,c,f,u,h,p=[],d=0,g=0;for(i=0,r=e.length;i<r;++i)f=c,c=e.charCodeAt(i),l?125!==c||a||o?39===c?a?92!==f&&(a=!1):a=!0:34===c?o?92!==f&&(o=!1):o=!0:123!==c||a||o||++g:0===--g&&(d<s&&(h=(h=e.slice(d,s)).replace(At,""))&&(h=_(h),p.push(h)),u=kt.parse(e.slice(s+2,i),t,n),p.push(new We(Ge,u)),d=s=i+1,l=!1):64===f&&123===c&&(l=!0,s=i-1,g=1);return 0<d&&d<r&&(h=(h=e.slice(d,r)).replace(At,""))&&(h=_(h),p.push(h)),p.length?p:null}},$t=/;/g,Ot=/^[a-z0-9\-_]+$/i,Tt=new RegExp("^"+$.DATA+"\\"+C[0]+"[^"+$.DATA+"]*\\"+C[1]+"$"),Nt={parse:function(e,t,n,i,r){var s,a,o,l,c,f,u,h,p={},d=e.split($t);for(f=0,c=d.length;f<c;++f)if((h=(a=d[f].trim()).indexOf(":"))<0){if(a=a.trim())for(l=a.split(O),u=0;u<l.length;++u)p[l[u]]=!0}else{o=a.slice(0,h).trim(),e=a.slice(h+1).trim(),o&&Ot.test(o)||w("Illegal "+(r?"x:style":"x:class")+" expression.",{code:1001,expr:o||arguments[0]}),r&&(o=i.toCamelCase(o));try{if(!Ct.like(e)){p[o]=r?e:bt.tryParse(e);continue}if(Tt.test(e)){s=kt.parse(e.slice(2,e.length-1),t,n),p[o]=new We(Ge,s);continue}s=Ct.parse(e,t,n)}catch(e){throw e}s?1===s.length&&s[0]instanceof We?p[o]=s[0]:r?(s.asStr=!0,p[o]=new We(tt,s)):w("Illegal x:class expression.",{code:1001,expr:e}):p[o]=r?e:bt.tryParse(e)}return p}},Dt={parse:function(e,t,n){var i=e.indexOf($.MODIFIER)<0?[e]:e.split($.MODIFIER);i[0]=i[0].trim();var r={};if(S.test(i[0])?r.handler=i[0].replace(D,""):r.evaluator=_t.parse(i[0],t,n),1<i.length){for(var s=[],a=1;a<i.length;++a)s.push(i[a].trim());r.modifiers=s}return r}},St=/^([_$\w]+)\s+of\s+(.+)$/,Pt=/[a-zA-Z]/,jt=/[\s/>]/,Mt=/[\s\/]+/,It=null,zt={"!":!0,br:!0,hr:!0,area:!0,base:!0,img:!0,input:!0,link:!0,meta:!0,basefont:!0,param:!0,col:!0,frame:!0,embed:!0,keygen:!0,source:!0,command:!0,track:!0,wbr:!0},Wt={"x:ns":!0,"x:if":!0,"x:for":!0,"x:key":!0,"x:name":!0,"x:type":!0,"x:class":!0,"x:style":!0};function Vt(e,t){var n=e[t];return null==n&&(e[t]=n={}),n}function Yt(e){return"class"!==e?It.toCamelCase(e):"classes"}function Rt(e,t,n,i,r){var s;if("x:class"===e)n.classes=Nt.parse(t,i,r,It,!1);else if("x:style"===e)n.style=Nt.parse(t,i,r,It,!0);else if("x:type"===e){var a=d.search(t,i.constructor.resources);"function"==typeof a&&a.__extag_component_class__||w('Illegal x:type="'+t+'"',{code:1001,expr:t,desc:"Can not find such component type `"+t+"`. Make sure it extends Component and please register `"+t+"` in static resources."}),n.type=a}else if("x:name"===e)n.name=t;else if("x:key"===e)n.xkey=_t.parse(t,i,r);else if("x:for"===e){var o=t.trim().match(St);o&&o[2].trim()||w('Illegal x:for="'+t+'".',{code:1001,expr:t}),(s=kt.parse(o[2],i,r))?n.xfor=[o[1],new We(Ge,s)]:w('Illegal x:for="'+t+'".',{code:1001,expr:t}),n.identifiers=r.concat([o[1]])}else"x:if"===e?(s=kt.parse(t,i,r))?n.xif=new We(Ge,s):w('Illegal x:if="'+t+'".',{code:1001,expr:t}):"x:ns"===e&&(n.ns=t)}function Xt(e,t,n,i,r){var s,a,o,l,c=e[e.length-1];if(c===$.EVENT)a=Vt(n,"events"),o=It.toCamelCase(e.slice(0,-1)),s=Dt.parse(t,i,r),a[o]=new We(Be,s);else switch((l=e.indexOf(":"))<0?a=Vt(n,"props"):(a=Vt(n,"attrs"),0===l&&(e=e.slice(1))),c){case $.DATA:e=e.slice(0,-1),o=l<0?Yt(e):e,s=bt.tryParse(t),a[o]=null!=s?s:new We(Ge,s=kt.parse(t,i,r));break;case $.TEXT:e=e.slice(0,-1),o=l<0?Yt(e):e;try{s=Ct.parse(t,i,r)}catch(e){throw e}a[o]=s?(s.asStr=!0,new We(tt,s)):t;break;default:a[o=l<0?Yt(e):e]=It.isBoolProp(o)||t}}function Lt(e,t,n){for(var i=t.length,r=n;r<i;){if(e.test(t[r]))return r;r+=1}return-1}function Ft(e,t,n,i){for(var r,s,a,o,l=t,c=t,f=t,u=e.length;l<u;){if(r=e[l],s){if(!T.test(r)){if(f=0<(f='"'===r||"'"===r?(c=l+1,e.indexOf(r,c)):Lt(jt,e,c=l))?f:u,n)try{120===(o=s).charCodeAt(0)&&o in Wt?Rt(s,e.slice(c,f),n,i,n.identifiers):Xt(s,e.slice(c,f),n,i,n.identifiers)}catch(e){throw e}if(">"===e[f])return f;s=null,c=f=l=f+1;continue}}else{if(">"===r){if(c<(f=l))for(a=e.slice(c,f).trim().split(Mt);0<a.length;)(s=a.shift())&&n&&(Vt(n,"props")[It.toCamelCase(s)]="");return f}if("="===r){if(c<(f=l)){for(a=e.slice(c,f).trim().split(Mt);1<a.length;)(s=a.shift())&&n&&(Vt(n,"props")[It.toCamelCase(s)]="");s=a.shift()}c=f=l=f+1;continue}}l+=1}}function Ht(e,t,n,i,r,s){var a,o=i.children||[],l=e.slice(t,n);if(Ct.like(l)){try{a=Ct.parse(l,r,s)}catch(e){throw e}a?o.push(new We(tt,a)):o.push(_(l))}else o.push(_(l));i.children=o}var Qt={parse:function(e,t){It=It||v.get(k);var n=t.constructor,i=function(e,t){var n,i,r,s,a,o=0,l=0,c=[],f=0,u=(e=e.trim()).length;for(s={tag:"[]",children:[],identifiers:["this"]},c.push(s);f<u;){if("<"===e[f]){if(n=e[f+1],Pt.test(n)){if(o<f&&Ht(e,o,f,s,t,s.identifiers),l=Lt(jt,e,o=f+1),r=e.slice(o,l),(i={}).tag=r,i.__extag_node__=!0,i.identifiers=s.identifiers,">"!==e[l]&&(l=Ft(e,o=l+=1,i,t,i.identifiers)),i.ns||(i.props&&i.props.xmlns?i.ns=It.toNameSpace(i.props.xmlns):s.ns&&(i.ns=s.ns)),null==i.type&&N.test(r)){var h=d.search(r,t.constructor.resources);"function"==typeof h&&h.__extag_component_class__&&(i.type=h)}if(null==i.type)switch(r){case"x:slot":i.type=Je;break;case"x:view":i.type=ot;break;case"x:frag":i.type=Ne}s&&(s.children=s.children||[],s.children.push(i)),"/"===e[l-1]||(a=r,p.call(zt,a))||(c.push(i),s=i),o=l=f=l+1;continue}if("/"===n&&Pt.test(e[f+2])){if(o<f&&Ht(e,o,f,s,t,s.identifiers),l=Lt(jt,e,o=f+2),(r=e.slice(o,l))!==s.tag&&w("Unclosed tag "+s.tag),">"!==e[l]&&(l=Ft(e,o=l+=1)),!(1<c.length)){if(l<u)throw new Error("");return c[0]}c.pop(),0<c.length&&(s=c[c.length-1]),o=l=f=l+1;continue}if("!"===n&&"\x3c!--"===e.slice(f,f+4)){o<f&&Ht(e,o,f,s,t,s.identifiers),o=f+4,l=0<(l=e.indexOf("--\x3e",o))?l:e.length,i={tag:"!",comment:e.slice(o,l)},s.children=s.children||[],s.children.push(i),o=l=f=l+3;continue}}f+=1}return o<u&&Ht(e,o,u,s,t,s.identifiers),c}(e,t)[0].children,r=i[0];return 1!==i.length&&w("The template of Component "+(n.fullName||n.name)+" must have only one root tag."),"!"!==r.tag&&"#"!==r.tag||w("Component template root tag must be a DOM element, instead of: "+e.slice(0,e.indexOf(">"))),r.type?"x:frag"===r.tag&&r.type===Ne?r.type=null:"x:slot"===r.tag||"x:view"===r.tag?w(r.tag+" can not be used as root tag of component template: "+e.slice(0,e.indexOf(">"))):w("component can not be used as root tag of another component template: "+e.slice(0,e.indexOf(">"))):(r.xif||r.xfor||r.xkey)&&w("`x:if`, `x:for`, `x:key` can not be used on root tag of component template: "+e.slice(0,e.indexOf(">"))),r}};return v.HTMXParser=Qt,"undefined"!=typeof window&&window.ExtagDom&&v.set("view-engine",window.ExtagDom),{anew:Q.anew,inst:Q.inst,conf:function(e,t){if(1===arguments.length)return v.get(e);v.set(e,t)},help:function(e){return new t(e)},defineClass:m,Validator:ne,Watcher:I,Store:we,Cache:Ae,Slot:Je,Text:Oe,Element:Te,Fragment:Ne,Component:Me,node:ht.node,expr:ht.expr,version:"0.2.3"}});
