!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Extag=e()}(this,function(){"use strict";var e=/^\s*[$_A-Z][$_A-Z0-9]*(\s*\.\s*[$_A-Z0-9]+)*\s*$/i,n=/\s*\.\s*/;function r(t,e){for(var n=-1,i=t.length,r=e;++n<i;)if(null==(r=r[t[n]]))return r;return r}var v={test:function(t){return e.test(t)},parse:function(t){if(v.test(t))return t.trim().split(n)},search:function(t,e,n){var i;if("string"==typeof t&&(t=v.parse(t)),t)return e&&(i=r(t,e)),null!=i||n||("undefined"!=typeof window?i=r(t,window):"undefined"!=typeof global&&(i=r(t,global))),i}},h=0,o=3,i=0,a=4,l=2,f=1,c=16,s=32,g=Object.freeze({}),u="view-engine",y={},x=[],_={DATA:"@",TEXT:"#",EVENT:"+",FRAGMENT:"<>",MODIFIER:"::",CONVERTER:"|=",ASSIGN:"!",TWO_WAY:"@",ANY_WAY:"^",ONE_TIME:"?"},d=/\s+/,p=/\s/g,m=/^[A-Z]/,b=/^this\./,w=/^(this\.)?[\w$_]+$/,A=Array.prototype.slice,E=Object.defineProperty,k=Object.prototype.hasOwnProperty,$=Object.getOwnPropertyDescriptor;function C(t){this.target=t}C.prototype.bind=function(){for(var t,e,n=this.target,i=0;i<arguments.length;++i)"function"==typeof(e=n[t=arguments[i]])&&(n[t]=e.bind(n))};var O=function(t){var e,n,i,r=arguments.length;for(i=1;i<r;++i)if((e=arguments[i])instanceof Object)for(n in e)k.call(e,n)&&(t[n]=e[n]);return t};function t(t){return"function"==typeof t&&/native code/.test(t.toString())}function T(t,e){var n,i,r;for(n=0,i=e.length;n<i;++n)for(var s in r=e[n])k.call(r,s)&&E(t,s,$(r,s))}function D(t){var e,n,i,r,s;if(k.call(t,"extends")){if("function"!=typeof(n=t.extends))throw new TypeError("superClass must be a function")}else n=Object;if(k.call(t,"constructor")){if("function"!=typeof(e=t.constructor))throw new TypeError("subClass must be a function")}else e=function(){n.apply(this,arguments)};return e.prototype=Object.create(n.prototype),s=[e.prototype],i=t.mixins,Array.isArray(i)&&s.push.apply(s,i),s.push(t),T(e.prototype,s),E(e.prototype,"constructor",{value:e,enumerable:!1,writable:!0,configurable:!0}),s=[e,n],(r=t.statics)&&(i=r.mixins,Array.isArray(i)&&s.push.apply(s,i),s.push(r)),T(e,s),delete e.prototype.statics,delete e.prototype.entend,delete e.prototype.mixins,delete e.mixins,e}var N=/&[\w#]{2,6};/;function S(t){return N.test(t)?t.replace(/&nbsp;/g,String.fromCharCode(160)).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t}function P(t,e){var n=t instanceof Error?t:new Error(t);throw e&&O(n,e),n}function M(){}var j=[function(t){this.emit(t.type,t,i)},function(t){this.emit(t.type,t,f)},function(t){this.emit(t.type,t,l)},function(t){this.emit(t.type,t,f|l)}];function I(t,e,n){var i=t.constructor;"function"==typeof i.removeEventListener&&(2===arguments.length?i.removeEventListener(t,e):i.removeEventListener(t,e,n))}function W(t){var e=i;return t&&(t.capture&&(e|=f),t.passive&&(e|=l),t.once&&(e|=a)),e}function z(t){var e={};return t&f&&(e.capture=!0),t&l&&(e.passive=!0),t&a&&(e.once=!0),e}function Y(t,e){return(t&f)==(e&f)}function V(t,e,n,i){var r=t._actions;if("function"==typeof n){r||E(t,"_actions",{value:r={},writable:!1,enumerable:!1,configurable:!0});var s=r[e];s||(s=r[e]={type:e,head:null,tail:null});var o=W(i);if(n.__extag_handler__)for(var a=s.head;a;){if(a.func===n&&Y(o,a.flag))return;a=a.next}var c,l,f,u,h={func:n,flag:o};n.__extag_handler__=!0,s.head?s.tail.next=h:s.head=h,s.tail=h,"listeners"in s&&!s.listeners||(l=s,f=h,"function"==typeof(u=(c=t).constructor).addEventListener?u.addEventListener(c,l,f):l.listeners=null)}}function U(t,e,n,i){var r=t._actions;if(r){var s=r[e];if(s){if(2===arguments.length)return s.listeners&&I(t,s),void(r[e]=null);for(var o=W(i),a=s.head,c=null;a;){if(n===a.func&&Y(o,a.flag)){if(s.listeners)s.listeners[a.flag&(f|l)]&&I(t,s,a);a.next||(s.tail=c),c?c.next=a.next:s.head=a.next;break}a=(c=a).next}}}}function R(t,e,n){(e=A.call(e,0))[0]=n+" "+e[0],t.apply(console,e)}D({constructor:M,statics:{opts2flag:W,flag2opts:z,getEventListener:function(t,e){return j[e].bind(t)}},on:function(t,e,n){if("object"==typeof t){for(t in n=t)if(k.call(n,t)){var i=n[t];Array.isArray(i)?V(this,t,i[0],i[1]):V(this,t,i)}}else V(this,t,e,n)},off:function(t,e,n){var i=this._actions;if(i){var r=arguments.length,s=typeof t;if(0===r)for(t in i)U(this,t);else if("string"===s)1===r?U(this,t):U(this,t,e,n);else if("object"===s)for(t in n=t)if(k.call(n,t)){var o=n[t];Array.isArray(o)?U(this,t,o[0],o[1]):null==o?U(this,t):U(this,t,o)}}},emit:function(t){var e=this._actions;if(e){var n=e[t];if(n&&n.head){var i,r,s=n.listeners?arguments[2]:0;for(i=n.head;i;)Y(s,i.flag)&&(i.func.apply(null,A.call(arguments,1)),i.flag&a&&(r=r||[]).push(i)),i=i.next;if(r)for(var o=0;o<r.length;++o)i=r[o],this.off(t,i.func,i.flag?z(i.flag):null)}}}});var G={info:function(){R(console.log,arguments,"[EXTAG INFO]")},warn:function(){R(console.warn,arguments,"[EXTAG WARN]")},error:function(){R(console.error,arguments,"[EXTAG ERROR]")},debug:function(){R(console.log,arguments,"[EXTAG DEBUG]")}};function F(){1<arguments.length?(this.ctor=arguments[0],this.args=arguments[1]):this.gen=arguments[0]}D({constructor:F,statics:{anew:function(t){return new F(t,A.call(arguments,1))},inst:function(t){return new F(t)}},gen:function(){var t=this.ctor,e=this.args;if(!e)return new t;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);default:throw new Error("`anew` arguments length must not exceed 6.")}}});var L={},Q={configurable:!0,enumerable:!0},X={},q={};function Z(e){return function(t){return t[e]}}function H(t,e){var n,i;Q.get=(n=e,k.call(X,n)||(X[n]=function(){return this.get(n)}),X[n]),Q.set=(i=e,k.call(q,i)||(q[i]=function(t){this.set(i,t)}),q[i]),E(t,e,Q)}function J(){throw new Error("Accessor is a partial class for mixins and can not be instantiated")}function B(t){if(t instanceof Object){var e=t.constructor;return e.fullname||e.name}return typeof t}function K(t,e,n,i){var r,s,o,a=J.getAttrDesc(t,e);if(a&&(a.type||a.test))return(o=a.type)&&(r=function(t,e,n,i){var r,s,o,a,c,l,f=typeof i;if("string"===f&&typeof n!==i?(f=i,r=!0):"function"!==f||n instanceof i||(f=i.fullname||i.name,r=!0),r)return s=t.constructor,o=s.fullname||s.name,a=e,c=f,l=B(n),"`"+a+"` of type `"+(o||"<<anonymous>>")+"` should be `"+c+(l?"`, not `"+l:"")+"`";if(Array.isArray(i)){for(var u=0,h=i.length;u<h&&!("string"==(f=typeof i[u])&&typeof n===i[u]||"function"===f&&n instanceof i[u]);++u);if(u===h)return function(t,e,n,i){for(var r=[],s=0,o=n.length;s<o;++s)r.push("`"+(n[s].name||n[s])+"`");return"`"+e+"` of type `"+(t||"<<anonymous>>")+"` should be "+r.join(" or ")+(i?", not `"+i:"")+"`"}((s=t.constructor).fullname||s.name,e,i,B(n))}}(t,e,n,o)),r||((s=a.test)&&(r="function"==typeof s?s.call(t,n,e):function(t,e,n,i){if(!i.test(n))return n+" does not match the pattern "+i.toString()+" of the property `"+e+"` in "+t.toString()}(t,e,n,s)),r||void 0)}D({constructor:J,statics:{getAttrDesc:function(t,e){return t.__extag_descriptors__?t.__extag_descriptors__[e]:null},defineGetterSetter:H,getAttributeDefaultValue:function(t){return"object"!=typeof t.value?t.value:null!=t.value?t.value instanceof F?t.value.gen&&t.value.gen():t.value:void 0},getAttributeDefaultValues:function(t){var e={},n=t.__extag_descriptors__;if(n)for(var i in n)if(k.call(n,i)){var r=n[i],s=typeof r.value;if("undefined"===s)continue;"object"!==s?e[i]=r.value:null!=r.value&&(r.value instanceof F?e[i]=r.value.gen&&r.value.gen():e[i]=r.value)}return e},applyAttributeDescriptors:function(t,e){if(!k.call(t,"__extag_descriptors__")){if(Array.isArray(e)){var n,i,r=e;for(e={},n=0,i=r.length;n<i;++n)e[r[n]]=L}var s,o,a=O({},t.__extag_descriptors__);for(s in e)if(k.call(e,s)){if(s in t)continue;o=e[s],a[s]="object"!=typeof o?{value:o}:o instanceof F?{value:o}:o?(o.get&&!o.set||o.set&&!o.get&&(o.get=Z(s)),o):L,H(t,s)}E(t,"__extag_descriptors__",{value:a,configurable:!0,enumerable:!1,writable:!1})}}},get:function(t){throw new Error("Method `get` must be implemented by sub-class")},set:function(t,e){throw new Error("Method `set` must be implemented by sub-class")},assign:function(t){for(var e in t)k.call(t,e)&&this.set(e,t[e])}});var tt={validate0:function(t,e){var n,i=t.__extag_descriptors__;for(n in i)!i[n].required||e&&k.call(e,n)||G.warn("Attribute Validation:","required `"+n+"` for component "+(t.constructor.fullname||t.constructor.name))},validate:function(t,e,n,i){return!K(t,e,n)},troubleShoot:K};function et(){throw new Error("DirtyMarker is a partial class for mixins and can not be instantiated")}D({constructor:et,statics:{check:function(t,e,n,i){var r=t._dirty;r||(r={},t._dirty=r),e in r?r[e]===n&&delete r[e]:r[e]=i},clean:function(t,e){t._dirty&&(e?delete t._dirty[e]:t._dirty=null)}},hasDirty:function(t){var e=this._dirty;return!!e&&(null==t||k.call(e,t))}});var nt=function(t,e,i){if(t){var n=t.resolve();return function(t){"function"==typeof t&&n.then(t)}}if(e){var r=[],s=0,o=document.createTextNode("");return new e(function(){for(var t;t=r.pop();)t();s=s?0:1}).observe(o,{characterData:!0}),function(t){"function"==typeof t&&(r.unshift(t),o.data=s)}}return i?function(t){if("function"==typeof t){var e=!1,n=function(){e||(e=!0,t())};i(n),setTimeout(n)}}:setTimeout}("undefined"!=typeof Promise&&t(Promise)?Promise:null,"undefined"!=typeof MutationObserver&&t(MutationObserver)?MutationObserver:null,"undefined"!=typeof requestAnimationFrame&&t(requestAnimationFrame)?requestAnimationFrame:null),it=[],rt=[],st=[],ot=0,at=0,ct=!1;function lt(){try{var t;for(0,ot=0;ot<it.length;)it[ot].update(),++ot;for(it.length=0,ot=-1,at=0;at<rt.length;)rt[at].digest(),++at;for(rt.length=0,at=-1,t=st.length-1;0<=t;--t)st[t]();st.length=0,ct=!1}catch(t){throw at=ot=-1,it.length=0,rt.length=0,st.length=0,ct=!1,t}}function ft(t,e,n,i){for(var r,s;e<=n;)if((s=i[r=e+n>>1].$meta.guid)<t)e=r+1;else{if(!(t<s))return e;n=r-1}return-e-1}var ut,ht={setImmediate:nt,insertUpdateQueue:function(t){var e,n=it.length,i=t.$meta.guid;if(0<n&&i>it[n-1].$meta.guid)e=n;else{var r=ft(i,ot+1,it.length-1,it);if(!(r<0))return;e=-r-1}e===n?it.push(t):it.splice(e,0,t),ct||(ct=!0,nt(lt))},insertDigestQueue:function(t){var e,n=rt.length,i=t.$meta.guid;if(0<n&&i>rt[n-1].$meta.guid)e=n;else{var r=ft(i,at+1,rt.length-1,rt);if(!(r<0))return;e=-r-1}e===n?rt.push(t):rt.splice(e,0,t),ct||(ct=!0,nt(lt))},pushCallbackQueue:function(t){st.push(t)}},pt=[],gt=function(t){(ut=t).depsCountNew=0,ut.depsCountOld=0,ut.executeTimes=ut.executeTimes?ut.executeTimes+1:1,pt.push(t)},dt=function(){if(null!=ut){if(ut.depsCountOld<ut.depsCount){var t,e,n=ut.deps;for(t=n.length-1;0<=t;--t)(e=n[t]).times!==ut.executeTimes&&(e.src.off("changed",ut.invalidate),n.splice(t,1))}ut.depsCount=ut.depsCountOld+ut.depsCountNew,pt.pop(),pt.length&&(ut=pt[pt.length-1])}},vt=function(t,e){if(null!=ut){var n=ut.keys;n?n.indexOf(e)<0&&n.push(e):ut.keys=[e];var i,r,s=ut.deps;if(s){for(i=0;i<s.length;++i)if((r=s[i]).src===t)return void(r.times<ut.executeTimes&&(r.times=ut.executeTimes,ut.depsCountOld++))}else s=ut.deps=[];ut.depsCountNew++,t.on("changed",ut.invalidate),s.push({src:t,times:ut.executeTimes})}},_t=function(t){var e=t.deps;if(e){for(var n=0;n<e.length;++n)e[n].src.off("changed",t.invalidate);t.deps=null,t.keys=null}};function yt(t){yt.initialize(this,t)}D({constructor:yt,mixins:[J.prototype,M.prototype],statics:{create:function(t){return new yt(t)},initialize:function(t,e){var n,i=t.constructor;i!==yt&&i.attributes?(J.applyAttributeDescriptors(i.prototype,i.attributes),n=J.getAttributeDefaultValues(t),E(t,"_props",{value:n,writable:!1,enumerable:!1,configurable:!0})):E(t,"_props",{value:{},writable:!1,enumerable:!1,configurable:!0}),e&&function(t,e){var n,i;for(n in e)k.call(e,n)&&(J.getAttrDesc(t,n)?t.set(n,e[n]):(i=$(e,n)).get||i.set?E(t,n,i):(J.defineGetterSetter(t,n),t.set(n,i.value)))}(t,e)}},get:function(t){vt(this,t);var e=J.getAttrDesc(this,t);return e&&e.get?e.get.call(this,this._props):this._props[t]},set:function(t,e){var n,i=J.getAttrDesc(this,t),r=this._props;i&&i.get?i.set&&(n=i.get.call(this,r),i.set.call(this,e,r),n!==(e=i.get.call(this,r))&&this.emit("changed",t,e)):(n=r[t])!==e&&(r[t]=e,this.emit("changed",t,e))}});var xt={invalidate:function(){}};function mt(t){this._owner=t||xt,this._props={}}D({constructor:mt,mixins:[J.prototype,et.prototype],get:function(t){return this._props[t]},set:function(t,e){var n=this._props,i=n[t];e!==i&&(n[t]=e,this._owner.invalidate(1),et.check(this,t,e,i))},reset:function(t){var e,n=this._props;if(n)for(e in n)t&&e in t||this.set(e,null);t&&this.assign(t)}});var bt={},wt=function(t){return bt[t]},At=function(t,e){bt[t]=e},Et=0,kt=null;function $t(){throw new Error("Shell is a base class and can not be instantiated")}function Ct(){P("Parent is a base class and can not be instantiated!")}function Ot(t){for(var e=t._parent;e&&e.$meta.type===h;)e=e._parent;return e}function Tt(t,e){var n,i,r=t._children,s=r.length;for(e=e||[],n=0;n<s;++n)(i=r[n]).$meta.type===h?Tt(i,e):e.push(i);return e}D({constructor:$t,mixins:[M.prototype,J.prototype,et.prototype],invalidate:function(t){0==(8&this.$flag)&&(this.$flag|=8,ht.insertUpdateQueue(this)),t&&0==(this.$flag&t)&&(this.$flag|=t)},update:function(){throw new Error("The method `update` must be implemented by sub-class")},digest:function(){throw new Error("The method `digest` must be implemented by sub-class")},attach:function(t){if(0===this.$meta.type)throw new Error("Fragment and component using <x:frag> as root tag, can not attach a skin.");var e=$t.getViewEngine(this);if(e.attachShell(t,this),this.$skin=t,this._actions){var n,i,r=this._actions;for(n in r)if(k.call(r,n)&&e.mayDispatchEvent(t,n)&&(i=r[n]))for(var s=i.head;s;)$t.addEventListener(this,i,s),s=s.next}0==(this.$flag&c)&&(this.$flag|=c,ht.insertDigestQueue(this))},detach:function(){this.$owner&&(this.$owner=null),this.constructor.destroy(this);var t=this.$skin;t&&($t.getViewEngine(this).detachShell(t,this),this.$skin=null)},toString:function(){var t=this.$meta,e=this.constructor;return(e.fullname||e.name)+"<"+t.tag+">("+t.guid+")"},get:function(t){return this._props[t]},set:function(t,e){var n=this._props,i=n[t];i!==e&&(n[t]=e,this.invalidate(1),et.check(this,t,e,i))},cmd:function(t){this._commands||(this._commands=[]),this._commands.push({name:t,args:A.call(arguments,1)}),this.invalidate(4)},statics:{initialize:function(t,e,n,i){e===o||k.call(t,"_props")||(t._props={}),t.$flag=0,t.$meta={guid:Et++,type:e,tag:n,ns:i}},destroy:function(t){if(!(64&t.$flag)){var e;t.off(),et.clean(t);var n=t._bindings;if(n){for(e=n.length-1;0<=e;--e)n[e].destroy();n.length=0}var i,r=t._children;if(r){for(e=r.length-1;0<=e;--e)(i=r[e]).constructor.destroy(i),i._parent=null;t._children.length=0}t.$flag|=64}},getViewEngine:function(t){var e=t.$meta.ns;return null==kt&&(kt=wt(u)),e&&!kt.hasNameSpace(e)?wt(e+":"+u):kt},addEventListener:function(t,e,n){var i=t.$skin,r=$t.getViewEngine(t);if(i&&r)if(r.mayDispatchEvent(i,e.type)){var s=n.flag&(f|l);e.listeners=e.listeners||[];var o=e.listeners[s];if(o)return void o.count++;o=M.getEventListener(t,n.flag),r.addEventListener(i,e.type,o,s&&M.flag2opts(s)),(e.listeners[s]=o).count=1}else e.listeners=null},removeEventListener:function(t,e,n){var i,r,s,o=t.$skin,a=e.listeners,c=$t.getViewEngine(t);if(o&&a&&c&&c.mayDispatchEvent(o,e.type))if(2===arguments.length)for(i=0;i<a.length;++i)(s=a[i])&&(s.count=0,a[i]=null,c.removeEventListener(o,e.type,s,M.flag2opts(i)));else{if(!(s=a[r=n.flag&(f|l)]))return;s.count--,s.count<1&&(c.removeEventListener(o,e.type,s,M.flag2opts(r)),a[r]=null)}}}});var Dt=[],Nt=!1;function St(t){Dt.push(t),Nt||(Nt=!0,ht.pushCallbackQueue(Pt))}function Pt(){for(var t=0;t<Dt.length;++t){var e=Dt[t];e._parent||e.detach()}Dt.length=0,Nt=!1}function Mt(t){Mt.initialize(this,t)}D({constructor:Ct,statics:{findParent:Ot,flattenChildren:Tt},getParent:function(t){return t?Ot(this):this._parent},getChildren:function(t){return t?Tt(this):this._children?this._children.slice(0):[]},setChildren:function(t){var e,n=this._children,i=t?t.length:0,r=n?n.length:0;if(r===i){for(e=0;e<i&&n[e]===t[e];++e);if(e===i)return}if(r){for(e=0;e<r;++e)n[e]._parent=null,St(n[e]);n.length=0}if(i)for(e=0;e<i;++e)this.insertChild(t[e],null);else r&&this.invalidate(2)},insertChild:function(t,e){null==t&&P("The new child to be inserted into this parent must not be null!");var n,i,r,s=this._children;if(s||(s=[],this._children=s),r=s.length,null!=e){for(n=0;n<r&&(s[n]!==e||this!==e._parent);++n);if(n===r&&P("The child before which the new child is to be inserted is not a child of this parent!"),e===t)return}else n=r;if(t._parent)if(t._parent===this){for(i=0;i<r;++i)if(s[i]===t){if(i===n)return;s.splice(i,1),n=i<n?n-1:n,r=s.length;break}}else t._parent.removeChild(t);n<r?s.splice(n,0,t):s.push(t),(t._parent=this).invalidate(2)},appendChild:function(t){this.insertChild(t,null)},removeChild:function(t){null==t&&P("The new child to be removed from this parent must not be null!");var e=0,n=0,i=this._children;if(i)for(e=0,n=i.length;e<n&&(i[e]!==t||this!==t._parent);++e);e===n&&P("The child to be removed is not a child of this parent!"),e<n-1?i.splice(e,1):i.pop(),t._parent=null,St(t),this.invalidate(2)},replaceChild:function(t,e){null==t&&P("The new child to be inserted into this parent must not be null!");var n=0,i=0,r=0,s=this._children;if(s)for(n=0,r=s.length;n<r&&(s[n]!==e||this!==e._parent);++n);if(n===r&&P("The child to be replaced is not a child of this parent!"),t!==e){if(t._parent)if(t._parent===this){for(i=0;i<r;++i)if(s[i]===t){s.splice(i,1),n=i<n?n-1:n,r=s.length;break}}else t._parent.removeChild(t);St(e),e._parent=null,t._parent=this,s[n]=t,this.invalidate(2)}}}),D({constructor:Mt,extends:$t,statics:{initialize:function(t,e){$t.initialize(t,o,"",""),t.set("content",e||"")}},get:function(t){if("content"===t)return this._content},set:function(t,e){"content"===t&&e!==this._content&&(this._dirty=!0,this._content=e,this.invalidate(1))},update:function(){if(0==(8&this.$flag))return!1;0==(this.$flag&c)&&(this.$flag|=c,ht.insertDigestQueue(this))},digest:function(){if(0==(this.$flag&c))return!1;this.$skin&&7&this.$flag&&($t.getViewEngine(this).renderShell(this.$skin,this),this.$flag&=-8,this._dirty=!1);this.$skin&&!1&this.$flag&&(this.$flag|=s),this.$flag&=-25},getParent:Ct.prototype.getParent,toString:function(){var t=this._content;return'"'+((t=null==t?"":t.toString()).length<24?t:t.slice(0,21)+"...")+'"('+this.$meta.guid+")"}});var jt={driveComponent:null,transferProps:null,createContent:null,makeContent:null,parseHTMX:null,parseJSX:null};function It(t,e){var n=t.indexOf(":"),i="";0<n&&(i=t.slice(0,n),t=t.slice(n+1)),It.initialize(this,i,t,e)}function Wt(t,e,n,i,r){this.scope=t,this.target=e,this.property=n,"function"==typeof i&&(this.invalidate=this.invalidate.bind(this),this.execute=this.execute.bind(this),this.collect=i,this.flag=1,this.execute(),this.keys&&this.keys.length&&(Wt.record(e,this),this.scope.on("updating",this.execute)),"function"==typeof r&&(this.reflect=r,this.backward=this.backward.bind(this),e.on("changed",this.backward)))}function zt(t){for(var e=t.getParent();e;){if(e.constructor.__extag_component_class__)return e;e=e.getParent()}}function Yt(t,e,n){var i;function r(){i=!0}for(var s=null,o=e,a=[o];e;){i||(e.emit("throwed",{targets:a.slice(0),target:o,phase:n,error:t,stop:r}),i&&(s=e));var c=zt(e);if(!c){if(e.emit("error",{targets:a.slice(0),target:o,solver:s,phase:n,error:t}),!s)throw G.error("Unsolved error in phase `"+n+"` from ",o),t;break}e=c,a.push(c)}}D({constructor:It,extends:$t,mixins:[Ct.prototype],statics:{__extag_element_class__:!0,initialize:function(t,e,n,i){$t.initialize(t,1,n,e),It.defineMembers(t),i&&t.assign(i)},defineMembers:function(t){var e=t.constructor.prototype;"classes"in e||(E(e,"style",{get:function(){return this._style||(this._style=new mt(this)),this._style}}),E(e,"classes",{get:function(){return this._classes||(this._classes=new mt(this)),this._classes}}))}},update:function(){if(0==(8&this.$flag))return!1;jt.transferProps(this),0==(this.$flag&c)&&(this.$flag|=c,ht.insertDigestQueue(this))},digest:function(){if(0==(this.$flag&c))return!1;this.$skin&&7&this.$flag&&($t.getViewEngine(this).renderShell(this.$skin,this),et.clean(this),this._style&&et.clean(this._style),this._classes&&et.clean(this._classes),this._commands&&(this._commands=null),this.$flag&=-8);this.$skin&&!1&this.$flag&&(this.$flag|=s),this.$flag&=-25}}),D({constructor:Wt,statics:{record:function(t,e){var n=t._bindings;n?n.push(e):E(t,"_bindings",{value:[e],writable:!1,enumerable:!1,configurable:!0})},remove:function(t,e){var n=t._bindings;n&&n.length&&n.splice(n.lastIndexOf(e),1)},create:function(t,e,n,i,r){return new Wt(t,e,n,i,r)},destroy:function(t){var e=t.target,n=t.scope;"function"==typeof t.reflect&&e.off("changed",t.backward),"function"==typeof t.collect&&t.keys&&n.off("updating",t.execute),_t(t)}},destroy:function(){var t=this.target,e=this.scope;"function"==typeof this.reflect&&t.off("changed",this.backward),"function"==typeof this.collect&&this.keys&&e.off("updating",this.execute),_t(this)},execute:function(){if(0!==this.flag){gt(this);var t=this.collect.call(this.scope);dt(),this.target.set(this.property,t),this.flag=0}},backward:function(t){t===this.property&&this.reflect.call(this.scope,this.target[this.property])},invalidate:function(t){0<=this.keys.indexOf(t)&&(this.scope.invalidate(),this.flag=1)}});var Vt=$t.prototype;function Ut(t,e,n){Ut.initialize(this,t,e,n)}function Rt(t,e,n){Rt.initialize(this,t,e,n)}function Gt(t,e,n){Gt.initialize(this,t,e,n)}function Ft(t,e,n){Ft.initialize(this,t,e,n)}D({constructor:Ut,extends:$t,mixins:[Ct.prototype],statics:{__extag_component_class__:!0,destroy:function(t){64&t.$flag||(t.emit("destroying"),$t.destroy(t))},initialize:function(e,t,n,i){var r=e.constructor,s=r.prototype,o=r.attributes,a=r.__extag_template__;J.applyAttributeDescriptors(s,o);var c,l=J.getAttributeDefaultValues(e);if(e._props=l,!a)try{if(r.template||(r.template="<x:frag></x:frag>"),"string"==typeof r.template)a=jt.parseHTMX(r.template,s);else{if("function"!=typeof r.template)throw new TypeError("The static template must be string or function");a=jt.parseJSX(r.template,s)}a&&(r.__extag_template__=a)}catch(t){Yt(t,e,"parsing")}if($t.initialize(e,"x:frag"!==a.tag?1:h,a.tag,a.ns||""),It.defineMembers(e),n&&n[0].context?(c=e.setup(n[0].context),null==e.context&&(e.context=n[0].context)):c=e.setup(),null!=c){if("object"!=typeof c)throw new TypeError("setup() should return object, not "+typeof c);for(var f in c){var u=$(c,f);u.get||u.set?E(e,f,u):e[f]=u.value}}try{jt.driveComponent(e,n,i,t,a)}catch(t){Yt(t,e,"building")}try{e.emit("created")}catch(t){Yt(t,e,"created")}e.invalidate()}},get:function(t){var e=J.getAttrDesc(this,t);return e?(vt(this,t),e.get?e.get.call(this,this._props):this._props[t]):this._props[t]},set:function(t,e){var n=J.getAttrDesc(this,t);if(!n)return Vt.set.call(this,t,e);var i,r=this._props;n.get?n.set&&(i=n.get.call(this,r),n.set.call(this,e,r),i!==(e=n.get.call(this,r))&&(this.invalidate(),this.emit("changed",t,e))):(i=r[t])!==e&&(r[t]=e,this.invalidate(),this.emit("changed",t,e))},bind:function(t,e,n,i){var r=Wt.create(this,t,e,n,i);Wt.record(t,r)},setup:function(t){t&&(this.context=t)},update:function(){if(0!=(8&this.$flag)){try{this.emit("updating")}catch(t){Yt(t,this,"updating")}var t=this.$meta.type;if(0!==t&&1&this.$flag&&jt.transferProps(this),this.render&&"function"==typeof this.render){var e=this.render(this._props)||[];Array.isArray(e)||(e=[e]),jt.driveChildren(this,[this],e,!1,!1)}if(et.clean(this,"contents"),0==(this.$flag&c)){if(0===t&&this._parent&&2&this.$flag){var n=this.getParent(!0);n.$flag|=2,0==(n.$flag&c)&&(n.$flag|=c,ht.insertDigestQueue(n))}this.$flag|=c,ht.insertDigestQueue(this)}}},digest:function(){if(0!=(this.$flag&c)){if(this.$skin&&0!==this.$meta.type&&7&this.$flag)$t.getViewEngine(this).renderShell(this.$skin,this),et.clean(this),this._style&&et.clean(this._style),this._classes&&et.clean(this._classes),this.__style&&et.clean(this.__style),this.__classes&&et.clean(this.__classes),this._commands&&(this._commands=null),this.$flag&=-8;var t=this._actions;if(0==(this.$flag&s)){if(0===this.$meta.type){var e=Ct.findParent(!0);e&&e.$skin&&(this.$flag|=s)}else this.$skin&&(this.$flag|=s);t&&t.mounted&&this.$flag&s&&ht.pushCallbackQueue(function(){try{this.emit("mounted")}catch(t){Yt(t,this,"mounted")}}.bind(this))}t&&t.updated&&ht.pushCallbackQueue(function(){try{this.emit("updated")}catch(t){Yt(t,this,"updated")}}.bind(this)),this.$flag&=-25}},addNamedPart:function(t,e){this[t]=e}}),D({constructor:Rt,extends:Ut,statics:{initialize:function(t,e,n,i){var r=i&&i.props&&i.props.name;if(Ut.initialize(t,e,n,{props:{name:r||""}}),n[0].on("updating",t.onScopeUpdating.bind(t)),i.children){var s=i.children.slice(0);s.scopes=n,t.set("contents",s)}t.scopes=n},template:"<x:frag></x:frag>"},update:function(){if(this.hasDirty("collection")||this.hasDirty("contents")){var t=this.scopes,e=this.get("contents"),n=this.get("collection");n&&n.length?(t=n.scopes,jt.driveChildren(this,t,n,!!t)):e&&e.length?(t=e.scopes,n=e.slice(0),jt.driveChildren(this,t,n,!!t)):this.setChildern([]),Ut.prototype.update.call(this)}},onScopeUpdating:function(){var t,e,n,i,r,s,o=this.scopes;if(o[0].hasDirty("contents")){if(s=[],(r=o[0].get("contents"))&&0<r.length)for(e=this.get("name")||"",i=0,n=r.length;i<n;++i)null!=(t=r[i])&&e===(t.slot||"")&&s.push(t);this.set("collection",s)}}}),D({constructor:Gt,extends:Ut,statics:{template:"<x:frag></x:frag>",initialize:function(t,e,n,i){var r=i&&i.props&&i.props.xtype;Ut.initialize(t,e,n,{props:{xtype:r}}),t.cache=new mt(t),t.template=O({},i),t.template.props=O({},i.props),delete t.template.props.xtype,t.scopes=n,t.invalidate(),t.on("updating",t.onUpdating.bind(t))}},onUpdating:function(){var t,e,n,i=this.cache,r=this.scopes,s=this.template;if(this.hasDirty("xtype"))if("function"==typeof(n=this.get("xtype")))if(n.__extag_component_class__)i.set("xctor",e);else{var o=this,a=n();"object"==typeof a&&a instanceof Promise?a.then(function(t){i.set("xctor",t)}).catch(function(t){i.set("xctor",null),o.emitError(t)}):(i.set("xctor",null),o.emitError())}else i.set("xctor",null),o.emitError();if(i.hasDirty("xctor")){if("function"!=typeof(e=i.get("xctor"))||!e.__extag_component_class__)return void this.setChildren([]);try{s.tag="?",s.type=e,t=jt.createContent(s,r),this.setChildren([t])}catch(t){this.setChildren([]),this.emitError(t)}}et.clean(i)},emitError:function(t){t||(t=new TypeError("`"+this.get("xtype")+"` is not a component class, constructor or a function that returns promise!")),t instanceof Error&&this.emit("error",t)}}),D({constructor:Ft,extends:$t,mixins:[Ct.prototype],statics:{__extag_fragment_class__:!0,initialize:function(t,e,n,i){$t.initialize(t,0,"x:frag",""),(t.scopes=n)&&i&&i.connect("_vnodes",t,n)}},update:function(){if(0!=(8&this.$flag)){if(this.scopes&&this.hasDirty("_vnodes")){var t=this.get("_vnodes")||[];et.clean(this,"_vnodes"),Array.isArray(t)||(t=[t]),jt.driveChildren(this,this.scopes,t,!1)}if(0==(this.$flag&c)){if(this._parent&&2&this.$flag){var e=this.getParent(!0);e.$flag|=2,0==(e.$flag&c)&&(e.$flag|=c,ht.insertDigestQueue(e))}this.$flag|=c,ht.insertDigestQueue(this)}}},digest:function(){if(0==(this.$flag&c))return!1;this.$flag&=-25,et.clean(this)}});var Lt={ASSIGN:-1,ONE_TIME:0,ONE_WAY:1,TWO_WAY:2,ANY_WAY:3};function Qt(t){this.mode=t.mode,this.evaluator=t.evaluator,this.converters=t.converters}function Xt(t){this.pattern=t}function qt(t){return{once:0<=t.indexOf("once"),capture:0<=t.indexOf("capture"),passive:0<=t.indexOf("passive")}}function Zt(t,e){"object"==typeof e&&e&&t&&t.length&&(0<=t.indexOf("stop")&&e.stopPropagation&&e.stopPropagation(),0<=t.indexOf("prev")&&e.preventDefault&&e.preventDefault())}function Ht(t,e){this.binding=t,this.pattern=e}function Jt(t){for(var e=this.pieces=[],n=0;n<t.length;++n)"object"!=typeof t[n]||t[n]instanceof Ht?e.push(t[n]):e.push(new Ht(Qt,t[n]))}function Bt(t,e){this.func=t,this.expr=e}function Kt(t,e){this.path=t,this.expr=e}function te(t,e){var n=t._bindings,i=e.length;if(n)for(var r=0;r<n.length;++r){var s=n[r],o=s.scopes;o&&o.length===i&&o[i-1]!==e[i-1]&&s.replace(e)}}function ee(t,e,n){ee.initialize(this,t,e,n)}function ne(t,e,n,i){var r,s,o=t._events;if(o)for(r in o)"function"==typeof(s=o[r])?t.off(r,s):Array.isArray(s)&&t.off(r,s[0],s[1]);if(n)for(r in n)s=n[r],i&&s instanceof Ht?s.connect(r,t,e):"function"==typeof s?t.on(r,s):Array.isArray(s)&&t.on(r,s[0],s[1]);t._events=n}function ie(t,e,n,i){var r,s,o,a=t._props;if(a)if(t instanceof Ut)for(r in a)n&&r in n||((s=J.getAttrDesc(t,r))?t.set(r,J.getAttributeDefaultValue(s)):t.set(r,null));else for(r in a)n&&r in n||t.set(r,null);if(n)for(r in n)o=n[r],i&&o instanceof Ht?o.connect(r,t,e):t.set(r,o)}function re(t,e){var n=t.$meta;return n.type===o&&e.__extag_node__!==g||t.__extag_key__===e.xkey&&(e.type?t.constructor===e.type:n.tag===e.tag&&n.ns===e.ns)}function se(t,e,n){ce(e)?(ie(t,n,e.props),ne(t,n,e.events),le(t,n,e.children,t instanceof Ut)):t.set("content",e)}function oe(t,e){if(!ce(t))return new Mt(t);var n,i,r,s=t.useExpr;return t.xif||t.xfor||t.xtype?r=new ee(null,e,t):s&&t.type===Ht?(i=t.expr).binding===Qt&&"frag"===i.pattern.target?r=new Ft(null,e,i):(r=new Mt(""),i.connect("content",r,e)):"!"!==t.tag&&((n=t.type)?r=new n(null,e,t):(r=new It(t.ns?t.ns+":"+t.tag:t.tag),t.events&&ne(r,e,t.events,s),t.props&&ie(r,e,t.props,s),t.style&&ie(r.style,e,t.style,s),t.classes&&ie(r.classes,e,t.classes,s),t.children&&le(r,e,t.children,s)),r&&t.name&&(r.$owner=e[0],e[0].addNamedPart(t.name,r))),r}function ae(t,e,n){var i,r;i=n._children||x,(r=t||x).length&&(r=function t(e,n,i){var r,s,o=e.length;if(!n)for(r=0;r<o;++r)if(Array.isArray(e[r])){n=[];break}if(n)for(r=0;r<o;++r)s=e[r],Array.isArray(s)?t(s,n,i):(n.push(s),i&&ce(s)&&!s.ns&&(s.ns=i));else for(r=0;r<o;++r)s=e[r],i&&ce(s)&&!s.ns&&(s.ns=i);return n||e}(r,null,n.$meta.ns));for(var s,o,a,c,l=new Array(r.length),f=0,u=i.length-1,h=0,p=r.length-1,g=i[f],d=i[u],v=r[h],_=r[p];f<=u&&h<=p;)if(null==g)g=i[++f];else if(null==d)d=i[--u];else if(re(g,v))se(l[h]=g,v,e),g=i[++f],v=r[++h];else if(re(d,_))se(l[p]=d,_,e),d=i[--u],_=r[--p];else if(re(g,_))se(l[p]=g,_,e),g=i[++f],_=r[--p];else if(re(d,v))se(l[h]=d,v,e),d=i[--u],v=r[++h];else{if(!o)for(o={},c=f;c<=u;++c)(a=i[f].__key__)&&(o[a]=c);if(null!=(c=(a=v.xkey)&&o[a])&&re(i[c]||y,v))l[h]=i[c];else{if(!(s=oe(v,e)))throw new Error("Can not create content from ",v);l[h]=s}v=r[++h]}if(u<f)for(;h<=p;){if(!(s=oe(v,e)))throw new Error("Can not create content from ",v);l[h]=s,v=r[++h]}return l}function ce(t){return"object"==typeof t&&t.__extag_node__===g}function le(t,e,n,i,r){var s;r?((s=n.slice(0)).scopes=e,t.set("contents",s)):(s=i?function(t,e){var n,i,r,s=[];if(t&&t.length)for(n=0,i=t.length;n<i;++n)(r=oe(t[n],e))&&s.push(r);return s}(n,e):ae(n,e,t),t.setChildren(s))}function fe(t){var e=typeof t;if("object"===e)return t;if("string"===e){var n,i,r,s,o,a={},c=t.split(";");for(r=c.length-1;0<=r;--r)0<(i=(n=c[r]).indexOf(":"))&&(s=n.slice(0,i).trim(),o=n.slice(i+1).trim(),a[s]=o);return a}}function ue(t){var e=typeof t;if("object"===e)return t;if("string"===e&&(t=t.trim().split(d)),Array.isArray(t)){var n,i={};for(n=0;n<t.length;++n)t[n]&&(i[t[n]]=!0);return i}}function he(t,e){var n=t[e];return n||(n=new mt(t),t[e]=n),n}function pe(t){var e,n;if(t.$meta.type!==o&&(t.hasDirty("style")&&(et.clean(t,"style"),e=fe(t.get("style")),t.style.reset(e)),t.hasDirty("class")&&(et.clean(t,"class"),n=ue(t.get("class")),t.classes.reset(n)),t.__props&&t.constructor.__extag_component_class__)){var i=t.__props;if(i.hasDirty("style")){var r=he(t,"__style");et.clean(i,"style"),e=fe(e=i.get("style")),r.reset(e)}if(i.hasDirty("class")){var s=he(t,"__classes");et.clean(i,"class"),n=ue(n=i.get("class")),s.reset(n)}}}D({constructor:Qt,statics:{MODES:Lt,create:function(t){return new Qt(t)}},connect:function(t,e,n){this.flag=0,this.scopes=n,this.target=e,this.targetProp=t,this.mode!==Lt.ASSIGN?(this.execute=this.execute.bind(this),this.invalidate=this.invalidate.bind(this),this.mode===Lt.TWO_WAY&&(this.backward=this.backward.bind(this),J.getAttrDesc(this.target,this.targetProp)&&this.target.on("changed",this.backward)),this.mode===Lt.ANY_WAY?(this.scopes[0].on("updating",this.execute),this.target.set(this.targetProp,this.evaluate())):(this.flag=1,this.execute(),this.keys&&this.keys.length&&n[0].on("updating",this.execute)),Wt.record(e,this)):this.target.set(this.targetProp,this.evaluate())},replace:function(t){1<t.length&&t.length===this.scopes.length&&(this.scopes=t,this.flag=1,this.execute())},destroy:function(){var t=this.scopes;this.mode===Lt.TWO_WAY&&J.getAttrDesc(this.target,this.targetProp)&&this.target.off("changed",this.backward),this.keys&&this.keys.length&&t[0].off("updating",this.execute),_t(this)},evaluate:function(){return this.converters&&this.converters.length?function(t,e,n){for(var i=0;i<t.length;++i)n=t[i].execute(e,n);return n}(this.converters,this.scopes,this.evaluator.execute(this.scopes)):this.evaluator.execute(this.scopes)},execute:function(){if(this.mode!==Lt.ANY_WAY){if(0!==this.flag){gt(this);var t=this.evaluate();dt(),this.target.set(this.targetProp,t),this.flag=0,this.mode===Lt.ONE_TIME&&this.destroy()}}else this.target.set(this.targetProp,this.evaluate())},backward:function(t){if(t===this.targetProp){var e=this.target[this.targetProp],n=this.evaluator.path,i=n.from,r=n.length,s=this.scopes;2===r?(0<=i?s[i]:s[0].constructor.resources).set(n[1],e):2<r&&(0<=i?v.search(n.slice(1,r-1),s[i],!0):v.search(n.slice(1,r-1),s[0].constructor.resources,!0)).set(n[r-1],e)}},invalidate:function(t){0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}}),D({constructor:Xt,statics:{create:function(t){return new Xt(t)}},connect:function(t,e,n){this.type=t,this.target=e;var i=this.pattern,r=i.handler,s=i.evaluator,o=i.modifiers;if(r){var a=n[0][r];if(!a)return;o&&o.length?"bind"===o[0]&&1===o.length?this.handler=a.bind(n[0]):(this.handler=function(t){Zt(o,t),0<=o.indexOf("bind")?a.apply(n[0],arguments):a.apply(null,arguments)},this.options=qt(o)):this.handler=a}else n.length<=1?o&&o.length?(this.handler=function(t){Zt(o,t),s.execute(n)},this.options=qt(o)):this.handler=function(){s.execute(n)}:(this.scopes=n,o&&o.length?(this.handler=function(t){Zt(o,t),s.execute(this.scopes)}.bind(this),this.options=qt(o)):this.handler=function(){s.execute(this.scopes)}.bind(this));this.handler&&(this.options?e.on(t,this.handler,this.options):e.on(t,this.handler),Wt.record(e,this))},replace:function(t){this.scopes&&1<t.length&&this.scopes.length===t.length&&(this.scopes=t)},destroy:function(){var t=this.handler;t&&(this.options?this.target.off(this.type,t,this.options):this.target.off(this.type,t))}}),D({constructor:Ht,connect:function(t,e,n){this.binding.create(this.pattern).connect(t,e,n)}}),D({constructor:Jt,statics:{create:function(t){return new Jt(t)}},connect:function(t,e,n){var i,r,s,o=this.pieces;this.scopes=n,this.target=e,this.property=t;var a=this.cache=new mt(n[0]);for(i=0,r=o.length;i<r;++i)(s=o[i])instanceof Ht?s.connect(i,a,n):a.set(i,s);a.set("length",r),this.execute(),this.execute=this.execute.bind(this),n[0].on("updating",this.execute),Wt.record(e,this)},replace:function(t){var e=this.cache._bindings;if(e)for(var n=0;n<e.length;++n)e[n].replace(t)},destroy:function(){this.scopes[0].off("updating",this.execute);var t=this.cache._bindings;if(t){for(var e=t.length-1;0<=e;--e)t[e].destroy();t.length=0}},execute:function(){var t=this.cache;if(t.hasDirty()){var e=A.call(t._props,0);this.target.set(this.property,e.join("")),et.clean(t)}}}),D({constructor:Bt,execute:function(t,e){var n=t;return 1<arguments.length&&(n=t.slice(0)).push(e),this.func.apply(t[0],n)}}),Kt.prototype.execute=function(t){var e,n=this.path,i=n.length,r=n.from;if(e=0<=r?t[r]:(e=t[0].constructor.resources)[n[0]],2===i)return e[n[1]];for(r=0;++r<i;)e=e[n[r]];return e},D({constructor:ee,extends:Ut,statics:{initialize:function(t,e,n,i){(Ut.initialize(t,e),t.mode=0,i)&&(t.scopes=n,t.template=O({},i),delete t.template.xtype,delete t.template.xkey,delete t.template.xfor,delete t.template.xif,t.set("condition",!0),i.xif&&(t.mode=1,i.xif.connect("condition",t,n)),i.xfor&&(t.mode=2,i.xfor[1].connect("iterable",t,n),i.xkey&&(t.keyEval=i.xkey)),i.xtype&&(t.xtype=!0,i.xtype.connect("component",t,n)),t.on("updating",t.onUpdating.bind(t)))},template:"<x:frag></x:frag>"},onUpdating:function(){if(this.mode){var t=this.get("condition"),e=this.get("component"),n=this.template,i=this.scopes,r=[];if(t){if(this.xtype){if(!e||!e.__extag_component_class__)return void this.setChildren(r);n=O({},n,{type:e})}if(1===this.mode)return(o=jt.createContent(n,i,!0))&&r.push(o),void this.setChildren(r);var s,o,a,c,l,f,u,h={},p=this.get("iterable")||[],g=this._children||[],d=this.keyEval;for(f=0,l=g.length;f<l;++f)(c=g[f].__key__)&&(h[c]=f);for(f=0,l=p.length;f<l;++f)o=c=null,a=p[f],u=i.concat([a]),d&&null!=(s=h[c=d.execute(u)])&&(o=g[s]),o?te(o,u):(o=jt.makeContent(n,u)).__key__=c,r.push(o);this.setChildren(r)}else this.setChildren(r)}}}),jt.makeContent=oe,jt.createContent=oe,jt.driveChildren=le,jt.driveEvents=ne,jt.driveProps=ie,jt.driveComponent=function(t,e,n,i,r){var s;if(n&&e?(s=n.useExpr,i&&n.props?i=O({},n.props,i):!i&&n.props&&(i=n.props),ie(t,e,i,s),n.events&&ne(t,e,n.events,s),s&&(n.style&&ie(t.style,e,n.style,s),n.classes&&ie(t.classes,e,n.classes,s)),n.children&&le(t,e,n.children,s,!0)):i&&ie(t,e,i),r){var o=[t];s=r.useExpr,r.events&&ne(t,o,r.events,s),r.props&&(t.__props=new mt(t),ie(t.__props,o,r.props,s)),s&&(r.style&&(t.__style=new mt(t),ie(t.__style,o,r.style,s)),r.classes&&(t.__classes=new mt(t),ie(t.__classes,o,r.classes,s))),r.children&&le(t,o,r.children,s)}},jt.transferProps=pe,jt.transferProperties=pe;var ge=/[\w).+\-_$\]]/,de="abstract arguments boolean break byte case catch char class const continue debugger default delete do double else enum eval export extends false final finally float for function goto if implements import in instanceof int interface let long native new null package private protected public return short static super switch synchronized this throw throws transient true try typeof undefined var void volatile while with yield isNaN isFinite parseFloat parseInt Array Date Infinity Math NaN Number Object String Boolean RegExp JSON",ve={};function _e(t,e){for(var n,i=t.length;e<i;){if(!(32===(n=t.charCodeAt(e))||9<=n&&n<=13))return 44!==n&&123!==n;--e}}function ye(t,e){for(var n,i,r,s=t.length;e<s;)if(32===(n=t.charCodeAt(e))||9<=n&&n<=13)r=!0,++e;else{if(46===n)i&&P("Unexpected token '.'.",{code:1001,expr:t}),i=!(r=!1);else{if(!(xe(n)||48<=n&&n<=57)){i&&P("Unexpected token '"+t[e]+"'.",{code:1001,expr:t});break}if(r&&!i){--e;break}i=r=!1}++e}return e}function xe(t){return 97<=t&&t<=122||65<=t&&t<=90||95===t||36===t}function me(t,e,n){for(var i=e.length;n<i;){if(e.charCodeAt(n)===t&&92!==e.charCodeAt(n-1))return n;++n}return i}function be(t,e){for(var n;0<=--e&&(32===(n=t.charCodeAt(e))||9<=n&&n<=13););return!n||!ge.test(String.fromCharCode(n))}!function(){for(var t=de.split(/\s+/),e=0,n=t.length;e<n;++e)ve[t[e]]=!0}();var we={regexStarts:be,gotoEnding:me,parse:function(t,e,n){var i=e.constructor.resources,r=v.parse(t);if(r&&r.length)return r.from=n.indexOf(r[0]),!(r.from<0)||i&&k.call(i,r[0])||(r.unshift("this"),r.from=0),new Kt(r,t);var s,o,a=n.slice(1),c=n.slice(1),l=0,f=[],u=function(t){for(var e,n,i,r=[],s=t.length,o=0;o<s;)if(n=e,32===(e=t.charCodeAt(o))||9<=e&&e<=13)++o;else{switch(e){case 39:case 34:(o=me(e,t,o+1))===s&&P("Unclosed "+String.fromCharCode(e)+" .",{code:1001,expr:t});break;case 47:be(t,o)&&(o=me(e,t,o+1))===s&&P("Unclosed "+String.fromCharCode(e)+" .",{code:1001,expr:t});break;default:if(46===n){o=ye(t,o+1);continue}if(xe(e)){i=ye(t,o+1),58!==t.charCodeAt(i)?r.push(o,i):_e(t,o-1)&&r.push(o,i),o=i;continue}}++o}return r}(t);for(o=0;o<u.length;o+=2)u[o+1]<0||(s=t.slice(u[o]+l,u[o+1]+l),r=v.parse(s.replace(p,"")),k.call(ve,r[0])||n.indexOf(r[0])<0&&(i&&k.call(i,r[0])?(f.push("var "+r[0]+" = this.constructor.resources."+r[0]+";"),c.push(r[0])):(t=t.slice(0,u[o]+l)+"this."+s+t.slice(u[o+1]+l),l+=5)));f.push("return "+t),a.push(f.join("\n"));for(var h="$";0<=c.indexOf(h);)h+="$";a.unshift(h);try{return new Bt(Function.apply(null,a),arguments[0])}catch(t){P(t,{code:1001,expr:arguments[0],desc:"Illegal expression `"+arguments[0]+"`."})}}},Ae=Qt.MODES;function Ee(t,e){for(var n="$"+e.length;0<=t.indexOf(n);)n="$"+n;return n}var ke={parse:function(t,e,n){var i,r,s,o,a,c,l,f=-1,u=t.length;if(t[0]===_.TWO_WAY?(f=Ae.TWO_WAY,t=t.slice(1,u)):t[u-1]===_.ANY_WAY?(f=Ae.ANY_WAY,t=t.slice(0,u-1)):t[u-1]===_.ASSIGN?(f=Ae.ASSIGN,t=t.slice(0,u-1)):t[u-1]===_.ONE_TIME?(f=Ae.ONE_TIME,t=t.slice(0,u-1)):f=Ae.ONE_WAY,f===Ae.TWO_WAY)v.test(t.trim())||P("Invalid two-way binding expression!",{code:1001,expr:arguments[0],desc:"`"+arguments[0]+"` is not a valid two-way binding expression. Must be a property name or path."}),a=we.parse(t,e,n);else if(t.indexOf(_.CONVERTER)<0)a=we.parse(t,e,n);else if(c=t.split(_.CONVERTER),a=we.parse(c[0],e,n),1<c.length)for(i=1;i<c.length;++i){(l=c[i].trim())||P("Converter must not be empty!",{code:1001,expr:arguments[0],desc:"Empty converter in the expression `"+arguments[0]+"` is not allowed."});var h=Ee(t,n),p=l.indexOf("(");if(0<p)l=l.slice(0,p+1)+h+","+l.slice(p+1);else{if(l.indexOf(".")<0&&n.indexOf(l)<0&&(r=e.constructor.resources)){var g=v.search(l,r);if("function"==typeof g){(s=s||[]).push(new Bt(g,l));continue}}l=l+"("+h+")"}o=we.parse(l,e,n.concat([h])),(s=s||[]).push(o)}var d={mode:f,evaluator:a};return s&&s.length&&(d.converters=s),d}},$e=/\s*\n\s*/g,Ce=new RegExp(_.DATA+"\\"+"{}"[0]+"(\\s|.)*?\\"+"{}"[1]),Oe={like:function(t){return Ce.test(t)},parse:function(t,e,n){for(var i,r,s,o,a,c,l=[],f=0,u=t.length,h=0,p=0;h<u;){switch(s=r,r=t.charCodeAt(h)){case 125:o&&0===--p&&(f<i&&(c=(c=t.slice(f,i)).replace($e," "))&&(c=S(c),l.push(c)),123===t.charCodeAt(i+2)&&125===t.charCodeAt(h-1)?(a=ke.parse(t.slice(i+3,h-1),e,n)).target="frag":(a=ke.parse(t.slice(i+2,h),e,n)).target="text",l.push(a),f=i=h+1,o=!1);break;case 123:o?(64===s&&P("Unclosed @{ .",{code:1001,expr:t}),++p):64===s&&(i=h-1,o=!0,p=1);break;case 39:case 34:(h=we.gotoEnding(r,t,h+1))===u&&P("Unclosed "+String.fromCharCode(r)+" .",{code:1001,expr:t});break;case 47:we.regexStarts(t,h)&&(h=we.gotoEnding(r,t,h+1))===u&&P("Unclosed "+String.fromCharCode(r)+" .",{code:1001,expr:t})}++h}return o&&P("Unclosed @{ .",{code:1001,expr:t}),0<f&&f<u&&(c=(c=t.slice(f,u)).replace($e," "))&&(c=S(c),l.push(c)),l.length?l:null}},Te={parse:function(t,e,n){var i=t.indexOf(_.MODIFIER)<0?[t]:t.split(_.MODIFIER);i[0]=i[0].trim();var r={};if(w.test(i[0])?r.handler=i[0].replace(b,""):r.evaluator=we.parse(i[0],e,n),1<i.length){for(var s=[],o=1;o<i.length;++o)s.push(i[o].trim());r.modifiers=s}return r}},De={tryParse:function(t){return"false"!==t&&("true"===t||(isNaN(t)?void 0:Number(t)))}},Ne=Qt.MODES;function Se(t){t!==_.DATA&&t!==_.TEXT&&P(t+" is not allowed in expr() for data binding")}function Pe(t,e){var n,i,r,s,o=t.props;if(t.xif&&(Se((s=t.xif.args)[0]),t.xif=Ie(s,t,e)),t.xfor&&(Se((s=t.xfor[1].args)[0]),t.xfor[1]=Ie(s,t,e),t.identifiers=t.identifiers.concat([t.xfor[0]])),t.xkey&&(Se((s=t.xkey.args)[0]),t.xkey=Ie(s,t,e)),o)for(i in o)(n=o[i])&&"object"==typeof n&&(n.__extag_expr__===Ht?(Se((s=n.args)[0]),o[i]=Ie(s,t,e)):"class"!==i&&"style"!==i||(t[i]=je(n,t,e),delete o[i]));if(t.type&&"string"==typeof t.type&&("function"==typeof(r=v.search(t.type,e.constructor.resources))&&r.__extag_component_class__||P("Can not find such component type `"+Ye+"`"),t.type=r),null==t.type&&m.test(t.tag)&&"function"==typeof(r=v.search(t.tag,e.constructor.resources))&&r.__extag_component_class__&&(t.type=r),null==t.type)switch(t.tag){case"x:slot":t.type=Rt;break;case"x:frag":t.type=Ft;break;case"x:output":t.type=Gt}t.events&&function(t,e){var n,i,r,s,o=t.events;for(n in o)(s=o[n])&&"object"==typeof s&&s.__extag_expr__===Ht&&((r=s.args)[0]!==_.EVENT&&P(r[0]+" is not allowed in expr() for event binding"),(i=Ie(r,t,e))&&(o[n]=i))}(t,e)}function Me(t,e,n){var i=typeof t;return"string"===i?we.parse(t,e,n):"function"===i?new Bt(t):void P("evaluator must be string or function")}function je(t,e,n){var i,r;for(i in t)(r=t[i])&&"object"==typeof r&&r.__extag_expr__===Ht&&(t[i]=Ie(r.args,e,n));return t}function Ie(t,e,n){t.length<2&&P("Unexpected arguments for expr()");var i,r,s,o=t[0],a=t[1],c=typeof a;if(o===_.DATA||o===_.FRAGMENT){if(o===_.FRAGMENT&&(i="frag"),2===t.length&&"string"===c)return i||a[0]!==_.TWO_WAY?null!=(s=De.tryParse(a.trim()))?s:((r=ke.parse(a,n,e.identifiers)).target=i,new Ht(Qt,r)):(v.test(a.slice(1))||P("Invalid two-way binding expression!",{code:1001,expr:arguments[0],desc:"`"+arguments[0]+"` is not a valid two-way binding expression. Must be a property name or path."}),new Ht(Qt,r={mode:Ne.TWO_WAY,evaluator:Me(a.slice(1),n,e.identifiers)}));switch(t[t.length-1]){case _.ASSIGN:o=Ne.ASSIGN,t=t.slice(0,-1);break;case _.ANY_WAY:o=Ne.ANY_WAY,t=t.slice(0,-1);break;case _.ONE_TIME:o=Ne.ONE_TIME,t=t.slice(0,-1);break;default:o=Ne.ONE_WAY}return new Ht(Qt,r={mode:o,target:i,evaluator:Me(a,n,e.identifiers),converters:t.length<=2?null:function(t,e,n){for(var i,r=[],s=0;s<t.length;++s)i=Me(t[s],e,n),r.push(i);return r}(t.slice(2),n,e.identifiers)})}if(o===_.EVENT)return"string"===c&&2===t.length?r=Te.parse(a,n,e.identifiers):"function"===c?r={evaluator:Me(a,n,e.identifiers),modifiers:2<t.length?t.slice(2):null}:P("Unexpected arguments for expr()"),new Ht(Xt,r);if(o===_.TEXT){r=[];for(var l=1;l<t.length;++l)(a=t[l])&&"object"==typeof a&&a.__extag_expr__&&(a=Ie(a.args,e,n)),r.push(a);return new Ht(Jt,r)}P('The first argument of expr() should be one of "@", "+", "#", "{}"')}var We={xns:!0,xif:!0,xfor:!0,xkey:!0,xname:!0,xslot:!0,xtype:!0,events:!0};function ze(t,e,n){var i,r,s={__extag_node__:g},o=typeof t;if("string"===o){var a=t.indexOf(":");if(a<0)s.ns="",s.tag=t;else{if("x"===t.slice(0,a))switch(t){case"x:slot":s.tag=t,s.type=Rt;break;case"x:frag":s.tag=t,s.type=Ft;break;case"x:output":s.tag=t,s.type=Gt}s.type||(s.ns=t.slice(0,a),s.tag=t.slice(a+1))}}else"function"===o&&t.__extag_component_class__?s.type=t:P("The first argument must be string, component class or constructor.");if(null!=e)for(r in e.xns&&(s.ns=e.xns),e.xif&&(s.xif=e.xif),e.xfor&&(s.xfor=e.xfor),e.xkey&&(s.xkey=e.xkey),e.xname&&(s.name=e.xname),e.xslot&&(s.slot=e.xslot),e.xtype&&(s.type?s.type===Gt&&(s.props={xtype:e.xtype}):s.type=e.xtype),e.events&&(s.events=e.events),i=s.props?s.props:s.props={},e)!We[r]&&k.call(e,r)&&(i[r]=e[r]);return n&&(n=3<arguments.length||Array.isArray(n)?function t(e,n){var i,r=e.length;if(!n)for(i=0;i<r;++i)if(Array.isArray(e[i])){n=[];break}if(n)for(i=0;i<r;++i){var s=e[i];Array.isArray(s)?t(s,n):n.push(s)}return n||e}(n=A.call(arguments,2)):[n],s.children=n),s}function Ye(){return{args:A.call(arguments,0),__extag_expr__:Ht}}var Ve={node:ze,expr:Ye,parse:function(t,e){var n=t(ze,Ye);return n.__extag_node__!==g&&P("template root must be a tag node"),n.useExpr=!0,n.identifiers=["this"],Pe(n,e),function t(e,n){var i,r,s=e.children;if(s&&s.length)for(i=s.length-1;0<=i;--i)if("object"==typeof(r=s[i])){if(r.__extag_node__===g){r.useExpr=!0,r.identifiers=e.identifiers,Pe(r,n),t(r,n);continue}if(r.__extag_expr__===Ht){var o=r.args[0];o!==_.DATA&&o!==_.FRAGMENT&&P(o+" is not allowed in expr() for text or fragment binding"),s[i]={__extag_node__:g,useExpr:!0,type:Ht,expr:Ie(r.args,e,n)}}}}(n,e),n.type?"x:frag"===n.tag?n.type=null:"x:slot"===n.tag||"x:view"===n.tag?P(n.tag+" can not be used as root tag of component template."):P("component can not be used as root tag of another component template."):(n.xif||n.xfor||n.xkey)&&P("`xif`, `xfor`, `xkey` can not be used on root tag of component template."),n}};jt.parseJSX=Ve.parse;var Ue=/;/g,Re=/^[a-z0-9\-_]+$/i,Ge={parse:function(t,e,n,i){var r,s,o,a,c,l,f,u,h={},p=t.split(Ue);for(l=0,c=p.length;l<c;++l)if((u=(s=p[l].trim()).indexOf(":"))<0){if(s=s.trim())for(a=s.split(d),f=0;f<a.length;++f)h[a[f]]=!0}else{o=s.slice(0,u).trim(),t=s.slice(u+1).trim(),o&&Re.test(o)||P("Illegal "+(i?"x:style":"x:class")+" expression.",{code:1001,expr:o||arguments[0]});try{if(!Oe.like(t)){h[o]=i?t:De.tryParse(t);continue}r=Oe.parse(t,e,n)}catch(t){throw t}r?1===r.length?h[o]=new Ht(Qt,r[0]):i?h[o]=new Ht(Jt,r):P("Illegal x:class expression.",{code:1001,expr:t}):h[o]=i?t:De.tryParse(t)}return h}},Fe=/^([_$\w]+)\s+of\s+(.+)$/,Le=/[a-zA-Z]/,Qe=/[\s/>]/,Xe=/[\s\/]+/,qe=/^x:/,Ze={html:"http://www.w3.org/1999/xhtml",math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};var He={"!":!0,br:!0,hr:!0,area:!0,base:!0,img:!0,input:!0,link:!0,meta:!0,basefont:!0,param:!0,col:!0,frame:!0,embed:!0,keygen:!0,source:!0,command:!0,track:!0,wbr:!0},Je={"inner-html":"innerHTML"},Be={"x:ns":!0,"x:if":!0,"x:for":!0,"x:key":!0,"x:name":!0,"x:slot":!0,"x:type":!0,"x:class":!0,"x:style":!0};function Ke(t,e){var n=t[e];return null==n&&(t[e]=n={}),n}function tn(t){return t in Je?Je[t]:t}function en(t,e,n,i,r){var s;if("x:class"===t)n.classes=Ge.parse(e,i,r,!1);else if("x:style"===t)n.style=Ge.parse(e,i,r,!0);else if("x:type"===t){var o=v.search(e,i.constructor.resources);"function"==typeof o&&o.__extag_component_class__?n.type=o:(s=ke.parse(e,i,r),n.xtype=new Ht(Qt,s))}else if("x:name"===t)n.name=e;else if("x:slot"===t)n.slot=e;else if("x:key"===t)n.xkey=we.parse(e,i,r);else if("x:for"===t){var a=e.trim().match(Fe);a&&a[2].trim()||P('Illegal x:for="'+e+'".',{code:1001,expr:e}),(s=ke.parse(a[2],i,r))?n.xfor=[a[1],new Ht(Qt,s)]:P('Illegal x:for="'+e+'".',{code:1001,expr:e}),n.identifiers=r.concat([a[1]])}else"x:if"===t?(s=ke.parse(e,i,r))?n.xif=new Ht(Qt,s):P('Illegal x:if="'+e+'".',{code:1001,expr:e}):"x:ns"===t&&(n.ns=e)}function nn(t,e,n,i,r){var s,o,a,c=t[t.length-1];if(null==e)return a=tn(t),void((o=Ke(n,"props"))[a]=!0);if(c===_.EVENT)o=Ke(n,"events"),a=t.slice(0,-1),s=Te.parse(e,i,r),o[a]=new Ht(Xt,s);else switch(o=Ke(n,"props"),c){case _.DATA:a=tn(t.slice(0,-1)),s=De.tryParse(e.trim()),o[a]=null!=s?s:new Ht(Qt,s=ke.parse(e,i,r));break;case _.TEXT:a=tn(t.slice(0,-1));try{s=Oe.parse(e,i,r)}catch(t){throw t}s?1===s.length?o[a]=new Ht(Qt,s[0]):o[a]=new Ht(Jt,s):o[a]=e;break;default:o[a=tn(t)]=e}}function rn(t,e,n){for(var i=e.length,r=n;r<i;){if(t.test(e[r]))return r;r+=1}return-1}function sn(t,e,n,i){for(var r,s,o,a,c=e,l=e,f=e,u=t.length;c<u;){if(r=t[c],s){if(!p.test(r)){if(f=0<(f='"'===r||"'"===r?(l=c+1,t.indexOf(r,l)):rn(Qe,t,l=c))?f:u,n)try{120===(a=s).charCodeAt(0)&&a in Be?en(s,t.slice(l,f),n,i,n.identifiers):nn(s,t.slice(l,f),n,i,n.identifiers)}catch(t){throw t}if(">"===t[f])return f;s=null,l=f=c=f+1;continue}}else{if(">"===r){if(l<(f=c))for(o=t.slice(l,f).trim().split(Xe);0<o.length;)(s=o.shift())&&n&&nn(s,null,n,i,n.identifiers);return f}if("="===r){if(l<(f=c)){for(o=t.slice(l,f).trim().split(Xe);1<o.length;)(s=o.shift())&&n&&nn(s,null,n,i,n.identifiers);s=o.shift()}l=f=c=f+1;continue}}c+=1}}var on=/^\s*\n\s*/,an=/\s*\n\s*$/;function cn(t,e){return{__extag_node__:g,useExpr:!0,type:Ht,expr:new Ht(t,e)}}function ln(t,e,n,i,r,s){var o,a=i.children||[],c=t.slice(e,n);if(c=c.replace(on,"").replace(an,"")){if(Oe.like(c)){try{o=Oe.parse(c,r,s)}catch(t){throw t}if(o)if(1===o.length&&"object"==typeof o[0])a.push(cn(Qt,o[0]));else{for(var l=-1,f=0,u=o.length;f<u;++f){var h=o[f];"object"==typeof h&&"frag"===h.target?(l<f&&(1<f-l?a.push(cn(Jt,o.slice(l,f))):"object"==typeof o[l]?a.push(cn(Qt,o[l])):a.push(o[l])),a.push(cn(Qt,h)),l=-1):l<0&&(l=f)}0<=l&&l<f&&(1<f-l?a.push(cn(Jt,o.slice(l,f))):"object"==typeof o[l]?a.push(cn(Qt,o[l])):a.push(o[l]))}else a.push(S(c))}else a.push(S(c));i.children=a}}var fn=function(t,e){var n=e.constructor,i=function(t,e){var n,i,r,s,o,a,c=0,l=0,f=[],u=0,h=(t=t.trim()).length;for(s={tag:"[]",children:[],identifiers:["this"]},f.push(s);u<h;){if("<"===t[u]){if(n=t[u+1],Le.test(n)){if(c<u&&ln(t,c,u,s,e,s.identifiers),l=rn(Qe,t,c=u+1),r=t.slice(c,l),(i={}).tag=r,i.useExpr=!0,i.__extag_node__=g,i.identifiers=s.identifiers,">"!==t[l]&&(l=sn(t,c=l+=1,i,e,i.identifiers)),i.ns||(i.props&&i.props.xmlns?i.ns=(a=i.props.xmlns)&&a!==Ze.html?a===Ze.svg?"svg":a===Ze.math?"math":a===Ze.xlink?"xlink":null:"":s.ns&&(i.ns=s.ns)),null==i.type&&qe.test(r))switch(r){case"x:slot":i.type=Rt;break;case"x:frag":i.type=Ft}if(null==i.type&&null==i.xtype&&m.test(r)){var p=v.search(r,e.constructor.resources);"function"==typeof p&&p.__extag_component_class__&&(i.type=p)}s&&(s.children=s.children||[],s.children.push(i)),"/"===t[l-1]||(o=r,k.call(He,o))||(f.push(i),s=i),c=l=u=l+1;continue}if("/"===n&&Le.test(t[u+2])){if(c<u&&ln(t,c,u,s,e,s.identifiers),l=rn(Qe,t,c=u+2),(r=t.slice(c,l))!==s.tag&&P("Unclosed tag "+s.tag),">"!==t[l]&&(l=sn(t,c=l+=1)),!(1<f.length))return f[0];f.pop(),0<f.length&&(s=f[f.length-1]),c=l=u=l+1;continue}if("!"===n&&"\x3c!--"===t.slice(u,u+4)){c<u&&ln(t,c,u,s,e,s.identifiers),c=u+4,l=0<(l=t.indexOf("--\x3e",c))?l:t.length,i={tag:"!",comment:t.slice(c,l),__extag_node__:g},s.children=s.children||[],s.children.push(i),c=l=u=l+3;continue}}u+=1}return c<h&&ln(t,c,h,s,e,s.identifiers),f}(t,e)[0].children,r=i[0];return 1!==i.length&&P("The template of component "+(n.fullname||n.name)+" must have only one root tag."),"!"!==r.tag&&"#"!==r.tag||P("Component template root tag must be a DOM element, instead of: "+t.slice(0,t.indexOf(">"))),r.type?"x:frag"===r.tag&&r.type===Ft?r.type=null:"x:slot"===r.tag||"x:view"===r.tag?P(r.tag+" can not be used as root tag of component template: "+t.slice(0,t.indexOf(">"))):P("component can not be used as root tag of another component template: "+t.slice(0,t.indexOf(">"))):(r.xif||r.xfor||r.xkey)&&P("`x:if`, `x:for`, `x:key` can not be used on root tag of component template: "+t.slice(0,t.indexOf(">"))),r};return jt.parseHTMX=fn,"undefined"!=typeof ExtagDOM&&At("view-engine",ExtagDOM),{anew:F.anew,inst:F.inst,node:Ve.node,expr:Ve.expr,conf:function(t,e){if(1===arguments.length)return wt(t);At(t,e)},help:function(t){return new C(t)},defineClass:D,setImmediate:ht.setImmediate,Validator:tt,Watcher:M,Model:yt,Text:Mt,Slot:Rt,Output:Gt,Element:It,Fragment:Ft,Component:Ut,version:"0.4.1"}});
