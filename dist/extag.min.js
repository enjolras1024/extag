!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Extag=e()}(this,function(){"use strict";var e=/^\s*[$_A-Z][$_A-Z0-9]*(\s*\.\s*[$_A-Z0-9]+)*\s*$/i,n=/\s*\.\s*/;function s(t,e){for(var n=-1,i=t.length,s=e;++n<i;)if(null==(s=s[t[n]]))return s;return s}var d={test:function(t){return e.test(t)},parse:function(t){if(d.test(t))return t.trim().split(n)},search:function(t,e,n){var i;if("string"==typeof t&&(t=d.parse(t)),t)return e&&(i=s(t,e)),null!=i||n||("undefined"!=typeof window?i=s(t,window):"undefined"!=typeof global&&(i=s(t,global))),i}},u=0,a=3,i=0,l=4,c=2,f=1,r=16,o=32,h=11,p=256,v=Object.freeze({}),g="view-engine",m=Object.freeze({}),y=Object.freeze([]),_={DATA:"@",TEXT:"#",EVENT:"+",FRAGMENT:"<>",MODIFIER:"::",CONVERTER:"|=",ASSIGN:"!",TWO_WAY:"@",ANY_WAY:"^",ONE_TIME:"?"},x=/\s+/,b=/\s/g,w=/^[A-Z]/,A=/^this\./,$=/^(this\.)?[\w$_]+$/,E=Array.prototype.slice,k=Object.defineProperty,C=Object.prototype.hasOwnProperty,O=Object.getOwnPropertyDescriptor,T=function(t){var e,n,i,s=arguments.length;for(i=1;i<s;++i)if((e=arguments[i])instanceof Object)for(n in e)C.call(e,n)&&(t[n]=e[n]);return t};function N(t,e){return null!=e&&(t=t.slice(0)).push(e),t}function t(t){return"function"==typeof t&&/native code/.test(t.toString())}function D(t,e){var n,i,s;for(n=0,i=e.length;n<i;++n)for(var r in s=e[n])C.call(s,r)&&k(t,r,O(s,r))}function S(t){var e,n,i,s,r;if(C.call(t,"extends")){if("function"!=typeof(n=t.extends))throw new TypeError("superClass must be a function")}else n=Object;if(C.call(t,"constructor")){if("function"!=typeof(e=t.constructor))throw new TypeError("subClass must be a function")}else e=function(){n.apply(this,arguments)};return e.prototype=Object.create(n.prototype),r=[e.prototype],i=t.mixins,Array.isArray(i)&&r.push.apply(r,i),r.push(t),D(e.prototype,r),k(e.prototype,"constructor",{value:e,enumerable:!1,writable:!0,configurable:!0}),r=[e,n],(s=t.statics)&&(i=s.mixins,Array.isArray(i)&&r.push.apply(r,i),r.push(s)),D(e,r),delete e.prototype.statics,delete e.prototype.entend,delete e.prototype.mixins,delete e.mixins,e}var I=/&[\w#]{2,6};/;function M(t){return I.test(t)?t.replace(/&nbsp;/g,String.fromCharCode(160)).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t}function P(t,e){var n=t instanceof Error?t:new Error(t);throw e&&T(n,e),n}function W(){}var j=[function(t){this.emit(t.type,t,i)},function(t){this.emit(t.type,t,f)},function(t){this.emit(t.type,t,c)},function(t){this.emit(t.type,t,f|c)}];function Y(t,e,n){var i=t.constructor;"function"==typeof i.removeEventListener&&(2===arguments.length?i.removeEventListener(t,e):i.removeEventListener(t,e,n))}function z(t){var e=i;return t&&(t.capture&&(e|=f),t.passive&&(e|=c),t.once&&(e|=l)),e}function V(t){var e={};return t&f&&(e.capture=!0),t&c&&(e.passive=!0),t&l&&(e.once=!0),e}function G(t,e){return(t&f)==(e&f)}function R(t,e,n,i){var s=t._actions;if("function"==typeof n){s||k(t,"_actions",{value:s={},writable:!1,enumerable:!1,configurable:!0});var r=s[e];r||(r=s[e]={type:e,head:null,tail:null});var o=z(i);if(n.__extag_handler__)for(var a=r.head;a;){if(a.func===n&&G(o,a.flag))return;a=a.next}var l,c,f,h,u={func:n,flag:o};n.__extag_handler__=!0,r.head?r.tail.next=u:r.head=u,r.tail=u,"listeners"in r&&!r.listeners||(c=r,f=u,"function"==typeof(h=(l=t).constructor).addEventListener?h.addEventListener(l,c,f):c.listeners=null)}}function U(t,e,n,i){var s=t._actions;if(s){var r=s[e];if(r){if(2===arguments.length)return r.listeners&&Y(t,r),void(s[e]=null);for(var o=z(i),a=r.head,l=null;a;){if(n===a.func&&G(o,a.flag)){if(r.listeners)r.listeners[a.flag&(f|c)]&&Y(t,r,a);a.next||(r.tail=l),l?l.next=a.next:r.head=a.next;break}a=(l=a).next}}}}function F(t,e,n){(e=E.call(e,0))[0]=n+" "+e[0],t.apply(console,e)}S({constructor:W,statics:{opts2flag:z,flag2opts:V,getEventListener:function(t,e){return j[e].bind(t)}},on:function(t,e,n){if("object"==typeof t){for(t in n=t)if(C.call(n,t)){var i=n[t];Array.isArray(i)?R(this,t,i[0],i[1]):R(this,t,i)}}else R(this,t,e,n)},off:function(t,e,n){var i=this._actions;if(i){var s=arguments.length,r=typeof t;if(0===s)for(t in i)U(this,t);else if("string"===r)1===s?U(this,t):U(this,t,e,n);else if("object"===r)for(t in n=t)if(C.call(n,t)){var o=n[t];Array.isArray(o)?U(this,t,o[0],o[1]):null==o?U(this,t):U(this,t,o)}}},emit:function(t){var e=this._actions;if(e){var n=e[t];if(n&&n.head){var i,s,r=n.listeners?arguments[2]:0;for(i=n.head;i;)G(r,i.flag)&&(i.func.apply(null,E.call(arguments,1)),i.flag&l&&(s=s||[]).push(i)),i=i.next;if(s)for(var o=0;o<s.length;++o)i=s[o],this.off(t,i.func,i.flag?V(i.flag):null)}}}});var L={info:function(){F(console.log,arguments,"[EXTAG INFO]")},warn:function(){F(console.warn,arguments,"[EXTAG WARN]")},error:function(){F(console.error,arguments,"[EXTAG ERROR]")},debug:function(){F(console.log,arguments,"[EXTAG DEBUG]")}};function Q(){1<arguments.length?(this.ctor=arguments[0],this.args=arguments[1]):this.gen=arguments[0]}S({constructor:Q,statics:{anew:function(t){return new Q(t,E.call(arguments,1))},inst:function(t){return new Q(t)}},gen:function(){var t=this.ctor,e=this.args;if(!e)return new t;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);default:throw new Error("`anew` arguments length must not exceed 6.")}}});var X={},q={configurable:!0,enumerable:!0},Z={},B={};function J(e){return function(t){return t[e]}}function H(t,e){var n,i;q.get=(n=e,C.call(Z,n)||(Z[n]=function(){return this.get(n)}),Z[n]),q.set=(i=e,C.call(B,i)||(B[i]=function(t){this.set(i,t)}),B[i]),k(t,e,q)}function K(){throw new Error("Accessor is a partial class for mixins and can not be instantiated")}function tt(t){if(t instanceof Object){var e=t.constructor;return e.fullname||e.name}return typeof t}function et(t,e,n,i){var s,r,o,a=K.getAttrDesc(t,e);if(a&&(a.type||a.test))return(o=a.type)&&(s=function(t,e,n,i){var s,r,o,a,l,c,f=typeof i;if("string"===f&&typeof n!==i?(f=i,s=!0):"function"!==f||n instanceof i||(f=i.fullname||i.name,s=!0),s)return r=t.constructor,o=r.fullname||r.name,a=e,l=f,c=tt(n),"`"+a+"` of type `"+(o||"<<anonymous>>")+"` should be `"+l+(c?"`, not `"+c:"")+"`";if(Array.isArray(i)){for(var h=0,u=i.length;h<u&&!("string"==(f=typeof i[h])&&typeof n===i[h]||"function"===f&&n instanceof i[h]);++h);if(h===u)return function(t,e,n,i){for(var s=[],r=0,o=n.length;r<o;++r)s.push("`"+(n[r].name||n[r])+"`");return"`"+e+"` of type `"+(t||"<<anonymous>>")+"` should be "+s.join(" or ")+(i?", not `"+i:"")+"`"}((r=t.constructor).fullname||r.name,e,i,tt(n))}}(t,e,n,o)),s||((r=a.test)&&(s="function"==typeof r?r.call(t,n,e):function(t,e,n,i){if(!i.test(n))return n+" does not match the pattern "+i.toString()+" of the property `"+e+"` in "+t.toString()}(t,e,n,r)),s||void 0)}S({constructor:K,statics:{getAttrDesc:function(t,e){return t.__extag_descriptors__?t.__extag_descriptors__[e]:null},defineGetterSetter:H,getAttributeDefaultValue:function(t){return"object"!=typeof t.value?t.value:null!=t.value?t.value instanceof Q?t.value.gen&&t.value.gen():t.value:void 0},getAttributeDefaultValues:function(t){var e={},n=t.__extag_descriptors__;if(n)for(var i in n)if(C.call(n,i)){var s=n[i],r=typeof s.value;if("undefined"===r)continue;"object"!==r?e[i]=s.value:null!=s.value&&(s.value instanceof Q?e[i]=s.value.gen&&s.value.gen():e[i]=s.value)}return e},applyAttributeDescriptors:function(t,e){if(!C.call(t,"__extag_descriptors__")){if(Array.isArray(e)){var n,i,s=e;for(e={},n=0,i=s.length;n<i;++n)e[s[n]]=X}var r,o,a=T({},t.__extag_descriptors__);for(r in e)if(C.call(e,r)){if(r in t)continue;o=e[r],a[r]="object"!=typeof o?{value:o}:o instanceof Q?{value:o}:o?(o.get&&!o.set||o.set&&!o.get&&(o.get=J(r)),o):X,H(t,r)}k(t,"__extag_descriptors__",{value:a,configurable:!0,enumerable:!1,writable:!1})}}},get:function(t){throw new Error("Method `get` must be implemented by sub-class")},set:function(t,e){throw new Error("Method `set` must be implemented by sub-class")},assign:function(t){for(var e in t)C.call(t,e)&&this.set(e,t[e])}});var nt={validate0:function(t,e){var n,i=t.__extag_descriptors__;for(n in i)!i[n].required||e&&C.call(e,n)||L.warn("Attribute Validation:","required `"+n+"` for component "+(t.constructor.fullname||t.constructor.name))},validate:function(t,e,n,i){return!et(t,e,n)},troubleShoot:et};function it(){throw new Error("DirtyMarker is a partial class for mixins and can not be instantiated")}S({constructor:it,statics:{check:function(t,e,n,i){var s=t._dirty;s||(s={},t._dirty=s),e in s?s[e]===n&&delete s[e]:s[e]=i},clean:function(t,e){t._dirty&&(e?delete t._dirty[e]:t._dirty=null)}},hasDirty:function(t){var e=this._dirty;return!!e&&(null==t||C.call(e,t))}});var st=function(t,e,i){if(t){var n=t.resolve();return function(t){"function"==typeof t&&n.then(t)}}if(e){var s=[],r=0,o=document.createTextNode("");return new e(function(){for(var t;t=s.pop();)t();r=r?0:1}).observe(o,{characterData:!0}),function(t){"function"==typeof t&&(s.unshift(t),o.data=r)}}return i?function(t){if("function"==typeof t){var e=!1,n=function(){e||(e=!0,t())};i(n),setTimeout(n)}}:setTimeout}("undefined"!=typeof Promise&&t(Promise)?Promise:null,"undefined"!=typeof MutationObserver&&t(MutationObserver)?MutationObserver:null,"undefined"!=typeof requestAnimationFrame&&t(requestAnimationFrame)?requestAnimationFrame:null),rt=[],ot=[],at=[],lt=0,ct=0,ft=!1;function ht(){try{var t;for(0,lt=0;lt<rt.length;)rt[lt].update(),++lt;for(rt.length=0,lt=-1,ct=0;ct<ot.length;)ot[ct].digest(),++ct;for(ot.length=0,ct=-1,t=at.length-1;0<=t;--t)at[t]();at.length=0,ft=!1}catch(t){throw ct=lt=-1,rt.length=0,ot.length=0,at.length=0,ft=!1,t}}function ut(t,e,n,i){for(var s,r;e<=n;)if((r=i[s=e+n>>1].$meta.guid)<t)e=s+1;else{if(!(t<r))return e;n=s-1}return-e-1}var pt,gt={setImmediate:st,insertUpdateQueue:function(t){var e,n=rt.length,i=t.$meta.guid;if(0<n&&i>rt[n-1].$meta.guid)e=n;else{var s=ut(i,lt+1,rt.length-1,rt);if(!(s<0))return;e=-s-1}e===n?rt.push(t):rt.splice(e,0,t),ft||(ft=!0,st(ht))},insertDigestQueue:function(t){var e,n=ot.length,i=t.$meta.guid;if(0<n&&i>ot[n-1].$meta.guid)e=n;else{var s=ut(i,ct+1,ot.length-1,ot);if(!(s<0))return;e=-s-1}e===n?ot.push(t):ot.splice(e,0,t),ft||(ft=!0,st(ht))},pushCallbackQueue:function(t){at.push(t)}},dt=[],vt=function(t){(pt=t).depsCountNew=0,pt.depsCountOld=0,pt.executeTimes=pt.executeTimes?pt.executeTimes+1:1,dt.push(t)},_t=function(){if(null!=pt){if(pt.depsCountOld<pt.depsCount){var t,e,n=pt.deps;for(t=n.length-1;0<=t;--t)(e=n[t]).times!==pt.executeTimes&&(e.src.off("changed",pt.invalidate),n.splice(t,1))}pt.depsCount=pt.depsCountOld+pt.depsCountNew,dt.pop(),dt.length&&(pt=dt[dt.length-1])}},mt=function(t,e){if(null!=pt){var n=pt.keys;n?n.indexOf(e)<0&&n.push(e):pt.keys=[e];var i,s,r=pt.deps;if(r){for(i=0;i<r.length;++i)if((s=r[i]).src===t)return void(s.times<pt.executeTimes&&(s.times=pt.executeTimes,pt.depsCountOld++))}else r=pt.deps=[];pt.depsCountNew++,t.on("changed",pt.invalidate),r.push({src:t,times:pt.executeTimes})}},yt=function(t){var e=t.deps;if(e){for(var n=0;n<e.length;++n)e[n].src.off("changed",t.invalidate);t.deps=null,t.keys=null}};function xt(t){xt.initialize(this,t)}S({constructor:xt,mixins:[K.prototype,W.prototype],statics:{create:function(t){return new xt(t)},initialize:function(t,e){var n,i=t.constructor;i!==xt&&i.attributes?(K.applyAttributeDescriptors(i.prototype,i.attributes),n=K.getAttributeDefaultValues(t),k(t,"_props",{value:n,writable:!1,enumerable:!1,configurable:!0})):k(t,"_props",{value:{},writable:!1,enumerable:!1,configurable:!0}),e&&function(t,e){var n,i;for(n in e)C.call(e,n)&&(K.getAttrDesc(t,n)?t.set(n,e[n]):(i=O(e,n)).get||i.set?k(t,n,i):(K.defineGetterSetter(t,n),t.set(n,i.value)))}(t,e)}},get:function(t){mt(this,t);var e=K.getAttrDesc(this,t);return e&&e.get?e.get.call(this,this._props):this._props[t]},set:function(t,e){var n,i=K.getAttrDesc(this,t),s=this._props;i&&i.get?i.set&&(n=i.get.call(this,s),i.set.call(this,e,s),n!==(e=i.get.call(this,s))&&this.emit("changed",t,e)):(n=s[t])!==e&&(s[t]=e,this.emit("changed",t,e))}});var bt={invalidate:function(){}};function wt(t){this._owner=t||bt,this._props={}}S({constructor:wt,mixins:[K.prototype,it.prototype],get:function(t){return this._props[t]},set:function(t,e){var n=this._props,i=n[t];e!==i&&(n[t]=e,this._owner.invalidate(1),it.check(this,t,e,i))},reset:function(t){var e,n,i=this._props;if(i)for(n in i)C.call(i,n)&&(t&&C.call(t,n)||it.check(this,n,null,i[n]));if(t){for(n in t)C.call(t,n)&&(e=t[n])!==i[n]&&it.check(this,n,e,i[n]);this._props=t}else this._props={}}});var At={},$t={get:function(t){return At[t]},set:function(t,e){At[t]=e}},Et=0,kt=null;function Ct(){P("Shell is a base class and can not be instantiated")}function Ot(){P("Parent is a base class and can not be instantiated!")}function Tt(t){for(var e=t._parent;e&&e.$meta.type===u;)e=e._parent;return e}function Nt(t,e){var n,i,s=t._children,r=s.length;for(e=e||[],n=0;n<r;++n)(i=s[n]).$meta.type===u?Nt(i,e):e.push(i);return e}S({constructor:Ct,mixins:[W.prototype,K.prototype,it.prototype],invalidate:function(t){0==(this.$flag&r)&&(this.$flag|=r,gt.insertUpdateQueue(this)),t&&0==(this.$flag&t)&&(this.$flag|=t)},update:function(){P("The method `update` must be implemented by sub-class")},digest:function(){P("The method `digest` must be implemented by sub-class")},attach:function(t){0===this.$meta.type&&P("Fragment and component using <x:frag> as root tag, can not attach a skin.");var e=Ct.getViewEngine(this);if(e.attachShell(t,this),this.$skin=t,this._actions){var n,i,s=this._actions;for(n in s)if(C.call(s,n)&&e.mayDispatchEvent(t,n)&&(i=s[n]))for(var r=i.head;r;)Ct.addEventListener(this,i,r),r=r.next}0==(this.$flag&o)&&(this.$flag|=o,gt.insertDigestQueue(this))},detach:function(){this.$owner&&(this.$owner=null),this.constructor.destroy(this);var t=this.$skin;t&&(Ct.getViewEngine(this).detachShell(t,this),this.$skin=null)},toString:function(){var t=this.$meta,e=this.constructor;return(e.fullname||e.name)+"<"+t.tag+">("+t.guid+")"},get:function(t){return this._props[t]},set:function(t,e){var n=this._props,i=n[t];i!==e&&(n[t]=e,this.invalidate(1),it.check(this,t,e,i))},cmd:function(t){this._commands||(this._commands=[]),this._commands.push({name:t,args:E.call(arguments,1)}),this.invalidate(8)},statics:{initialize:function(t,e,n,i){e===a||C.call(t,"_props")||(t._props={}),t.$flag=0,t.$meta={guid:Et++,type:e,tag:n,ns:i}},destroy:function(t){if(!(512&t.$flag)){var e;t.off(),it.clean(t);var n=t._bindings;if(n){for(e=n.length-1;0<=e;--e)n[e].destroy();n.length=0}var i,s=t._children;if(s){for(e=s.length-1;0<=e;--e)(i=s[e]).constructor.destroy(i),i._parent=null;t._children.length=0}t.$flag|=512}},getViewEngine:function(t){var e=t.$meta.ns;return null==kt&&(kt=$t.get(g)),e&&!kt.hasNameSpace(e)?$t.get(e+":"+g):kt},addEventListener:function(t,e,n){var i=t.$skin,s=Ct.getViewEngine(t);if(i&&s)if(s.mayDispatchEvent(i,e.type)){var r=n.flag&(f|c);e.listeners=e.listeners||[];var o=e.listeners[r];if(o)return void o.count++;o=W.getEventListener(t,n.flag),s.addEventListener(i,e.type,o,r&&W.flag2opts(r)),(e.listeners[r]=o).count=1}else e.listeners=null},removeEventListener:function(t,e,n){var i,s,r,o=t.$skin,a=e.listeners,l=Ct.getViewEngine(t);if(o&&a&&l&&l.mayDispatchEvent(o,e.type))if(2===arguments.length)for(i=0;i<a.length;++i)(r=a[i])&&(r.count=0,a[i]=null,l.removeEventListener(o,e.type,r,W.flag2opts(i)));else{if(!(r=a[s=n.flag&(f|c)]))return;r.count--,r.count<1&&(l.removeEventListener(o,e.type,r,W.flag2opts(s)),a[s]=null)}}}}),k(Ct.prototype,"style",{get:function(){return this._style||(this._style=new wt(this)),this._style}});var Dt=[],St=!1;function It(t){Dt.push(t),St||(St=!0,gt.pushCallbackQueue(Mt))}function Mt(){for(var t=0;t<Dt.length;++t){var e=Dt[t];e._parent||e.detach()}Dt.length=0,St=!1}function Pt(t){Pt.initialize(this,t)}function Wt(t,e,n){this.scope=t,this.produce=e,this.consume=n,this.execute=this.execute.bind(this),this.invalidate=this.invalidate.bind(this),this.flag=1,this.execute(),this.scope.on("updating",this.execute)}S({constructor:Ot,statics:{findParent:Tt,flattenChildren:Nt},getParent:function(t){return t?Tt(this):this._parent},getChildren:function(t){return t?Nt(this):this._children?this._children.slice(0):[]},setChildren:function(t){var e,n=this._children,i=t?t.length:0,s=n?n.length:0;if(s===i){for(e=0;e<i&&n[e]===t[e];++e);if(e===i)return}if(s){for(e=0;e<s;++e)n[e]._parent=null,It(n[e]);n.length=0}if(i)for(e=0;e<i;++e)this.insertChild(t[e],null);else s&&this.invalidate(2)},insertChild:function(t,e){null==t&&P("The new child to be inserted into this parent must not be null!");var n,i,s,r=this._children;if(r||(r=[],this._children=r),s=r.length,null!=e){for(n=0;n<s&&(r[n]!==e||this!==e._parent);++n);if(n===s&&P("The child before which the new child is to be inserted is not a child of this parent!"),e===t)return}else n=s;if(t._parent)if(t._parent===this){for(i=0;i<s;++i)if(r[i]===t){if(i===n)return;r.splice(i,1),n=i<n?n-1:n,s=r.length;break}}else t._parent.removeChild(t);n<s?r.splice(n,0,t):r.push(t),(t._parent=this).invalidate(2)},appendChild:function(t){this.insertChild(t,null)},removeChild:function(t){null==t&&P("The new child to be removed from this parent must not be null!");var e=0,n=0,i=this._children;if(i)for(e=0,n=i.length;e<n&&(i[e]!==t||this!==t._parent);++e);e===n&&P("The child to be removed is not a child of this parent!"),e<n-1?i.splice(e,1):i.pop(),t._parent=null,It(t),this.invalidate(2)},replaceChild:function(t,e){null==t&&P("The new child to be inserted into this parent must not be null!");var n=0,i=0,s=0,r=this._children;if(r)for(n=0,s=r.length;n<s&&(r[n]!==e||this!==e._parent);++n);if(n===s&&P("The child to be replaced is not a child of this parent!"),t!==e){if(t._parent)if(t._parent===this){for(i=0;i<s;++i)if(r[i]===t){r.splice(i,1),n=i<n?n-1:n,s=r.length;break}}else t._parent.removeChild(t);It(e),e._parent=null,t._parent=this,r[n]=t,this.invalidate(2)}}}),S({constructor:Pt,extends:Ct,statics:{initialize:function(t,e){Ct.initialize(t,a,"",""),t.set("content",e||"")}},get:function(t){if("content"===t)return this._content},set:function(t,e){"content"===t&&e!==this._content&&(this._dirty=!0,this._content=e,this.invalidate(1))},update:function(){if(0==(this.$flag&r))return!1;0==(this.$flag&o)&&(this.$flag|=o,gt.insertDigestQueue(this))},digest:function(){if(0==(this.$flag&o))return!1;this.$skin&&this.$flag&h&&(Ct.getViewEngine(this).renderShell(this.$skin,this),this.$flag&=~h,this._dirty=!1);this.$skin&&!1&this.$flag&&(this.$flag|=p),this.$flag&=-49},getParent:Ot.prototype.getParent,toString:function(){var t=this._content;return'"'+((t=null==t?"":t.toString()).length<24?t:t.slice(0,21)+"...")+'"('+this.$meta.guid+")"}}),S({constructor:Wt,statics:{record:function(t,e){var n=t._bindings;n?n.push(e):t._bindings=[e]},remove:function(t,e){var n=t._bindings;n&&n.length&&n.splice(n.lastIndexOf(e),1)},create:function(t,e,n){return new Wt(t,e,n)}},destroy:function(){this.scope.off("updating",this.execute),yt(this)},execute:function(){if(0!==this.flag){vt(this);var t=this.produce.call(this.scope);_t(),this.consume.call(this.scope,t),this.flag=0}},invalidate:function(t){0<=this.keys.indexOf(t)&&(this.scope.invalidate(),this.flag=1)}});var jt={driveComponent:null,transferProps:null,createContent:null,makeContent:null,parseHTMX:null,parseJSX:null};function Yt(t,e,n){var i,s;function r(){i=!0}for(var o=null,a=e,l=[e];e;){if(i||(e.emit("throwed",{targets:l.slice(0),target:a,phase:n,error:t,stop:r}),i&&(o=e)),!(s=e.__extag_scopes__)||!s[0]){if(e.emit("error",{targets:l.slice(0),target:a,solver:o,phase:n,error:t,stop:r}),!i)throw L.error("Unsolved error in phase `"+n+"` from ",a),t;break}e=s[0],l.push(e)}}function zt(t,e,n){zt.initialize(this,t,e,n)}function Vt(t,e,n){Vt.initialize(this,t,e,n)}function Gt(t,e,n){Gt.initialize(this,t,e,n)}function Rt(){zt.apply(this,arguments)}S({constructor:zt,extends:Ct,mixins:[Ot.prototype],statics:{__extag_component_class__:!0,destroy:function(t){512&t.$flag||(t.emit("destroying"),Ct.destroy(t))},initialize:function(e,t,n,i){var s=e.constructor,r=s.prototype,o=s.attributes,a=s.__extag_template__;e.__extag_scopes__=n,K.applyAttributeDescriptors(r,o);var l,c=K.getAttributeDefaultValues(e);if(e._props=c,!a)try{if(s.template||("function"==typeof r.render?s.template="<x:frag>@{{this.render(this._props) ^}}</x:frag>":s.template="<x:frag></x:frag>"),"string"==typeof s.template)a=jt.parseHTMX(s.template,r);else{if("function"!=typeof s.template)throw new TypeError("The static template must be string or function");a=jt.parseJSX(s.template,r)}a&&(s.__extag_template__=a)}catch(t){Yt(t,e,"parsing")}if(Ct.initialize(e,"x:frag"!==a.tag?1:u,a.tag,a.ns||""),n&&n[0]&&n[0].context?(l=e.setup(n[0].context),null==e.context&&(e.context=n[0].context)):l=e.setup(),null!=l){if("object"!=typeof l)throw new TypeError("setup() should return object, not "+typeof l);for(var f in l){var h=O(l,f);h.get||h.set?k(e,f,h):e[f]=h.value}}try{jt.driveComponent(e,n,i,t,null)}catch(t){Yt(t,e,"injecting")}e.invalidate()}},get:function(t){var e=K.getAttrDesc(this,t);return e?(mt(this,t),e.get?e.get.call(this,this._props):this._props[t]):this._props[t]},set:function(t,e){var n,i=K.getAttrDesc(this,t),s=this._props;i?i.get?i.set&&(n=i.get.call(this,s),i.set.call(this,e,s),n!==(e=i.get.call(this,s))&&(this.invalidate(),this.emit("changed",t,e))):(n=s[t])!==e&&(s[t]=e,this.invalidate(),this.emit("changed",t,e)):(n=s[t])!==e&&(s[t]=e,this.invalidate(1),it.check(this,t,e,n))},bind:function(t,e){return Wt.create(this,t,e)},setup:function(t){t&&(this.context=t)},update:function(){if(0!=(this.$flag&r)){try{this.emit("updating")}catch(t){Yt(t,this,"updating")}if(0==(128&this.$flag)){try{var t=this.constructor.__extag_template__;jt.driveComponent(this,null,null,null,t)}catch(t){Yt(t,this,"starting")}try{this.emit("started")}catch(t){Yt(t,this,"started")}this.$flag|=128}var e=this.$meta.type;if(0!==e&&1&this.$flag&&jt.transferProps(this),this._contents&&(this._contents.length?this._contents.length=0:this._contents=null),0==(this.$flag&o)){if(0===e&&this._parent&&2&this.$flag){var n=this.getParent(!0);n.$flag|=2,0==(n.$flag&o)&&(n.$flag|=o,gt.insertDigestQueue(n))}this.$flag|=o,gt.insertDigestQueue(this)}}},digest:function(){if(0!=(this.$flag&o)){if(this.$skin&&0!==this.$meta.type&&this.$flag&h)Ct.getViewEngine(this).renderShell(this.$skin,this),it.clean(this),this._style&&it.clean(this._style),this.$style&&it.clean(this.$style),this.$props&&it.clean(this.$props),this._commands&&(this._commands=null),this.$flag&=~h;var t=this._actions;if(0==(this.$flag&p)){if(0===this.$meta.type){var e=Ot.findParent(!0);e&&e.$skin&&(this.$flag|=p)}else this.$skin&&(this.$flag|=p);t&&t.mounted&&this.$flag&p&&gt.pushCallbackQueue(function(){try{this.emit("mounted")}catch(t){Yt(t,this,"mounted")}}.bind(this))}t&&t.updated&&gt.pushCallbackQueue(function(){try{this.emit("updated")}catch(t){Yt(t,this,"updated")}}.bind(this)),this.$flag&=-49}},accept:function(t,e){null==this._contents&&0===t.length||(this._contents=t.slice(0),this._contents.scopes=e||[this],this.emit("contents",this._contents),this.invalidate(4))},addNamedPart:function(t,e){this[t]=e}}),S({constructor:Vt,extends:zt,statics:{initialize:function(t,e,n,i){zt.initialize(t,e,n,i),n[0].on("contents",t.onScopeContents.bind(t)),t.on("updating",t.onUpdating.bind(t)),t.scopes=n,t.collect()},template:"<x:frag></x:frag>"},collect:function(){var t,e,n,i,s,r,o=this.scopes;if(o[0]._contents){if(r=[],s=o[0]._contents,r.scopes=s.scopes,s&&0<s.length)for(e=this.get("name")||"",i=0,n=s.length;i<n;++i)null!=(t=s[i])&&e===(t.slot||"")&&r.push(t);this._collection=r,this.invalidate()}},onUpdating:function(){if(this._collection||this._contents){var t=this.scopes,e=this._contents,n=this._collection;n&&n.length?(t=n.scopes,jt.driveChildren(this,t,n,!!t)):e&&e.length?(t=e.scopes,n=e.slice(0),jt.driveChildren(this,t,n,!!t)):this.setChildren([]),this._collection=null,this._contents&&(this._contents.length?this._contents.length=0:this._contents=null)}else this.setChildren([])},onScopeContents:function(){this.collect()}}),S({constructor:Gt,extends:Ct,mixins:[Ot.prototype],statics:{__extag_fragment_class__:!0,initialize:function(t,e,n,i){Ct.initialize(t,0,"x:frag",""),(t.scopes=n)&&i&&jt.driveComponent(t,n,i,e)}},accept:function(t,e){null==t||Array.isArray(t)||(t=[t]),jt.driveChildren(this,e||y,t,!1)},update:function(){if(0!=(this.$flag&r)&&0==(this.$flag&o)){if(this._parent&&2&this.$flag){var t=this.getParent(!0);t.$flag|=2,0==(t.$flag&o)&&(t.$flag|=o,gt.insertDigestQueue(t))}this.$flag|=o,gt.insertDigestQueue(this)}},digest:function(){if(0==(this.$flag&o))return!1;this.$flag&=-49,it.clean(this)}});var Ut={};function Ft(t,e){var n=t.indexOf(":"),i="";0<n&&(i=t.slice(0,n),t=t.slice(n+1)),Ft.initialize(this,i,t,e)}S({constructor:Rt,extends:zt,setup:function(){var e=this;e.on("contents",function(t){e.fragment||(e.fragment=new Gt),e.fragment.accept(t,t.scopes)}),e.on("started",function(){var t=e.getPool();t.target?t.target.append(e):t.portals.push(e)}),e.on("destroying",function(){var t=e.getPool();t.target&&t.target.remove(e),e.fragment&&e.fragment.setChildren([])})},getPool:function(){var t=this.get("target"),e=Ut[t];return e||(e=Ut[t]={portals:[]}),e}}),Rt.Target=S({extends:zt,statics:{fullname:"Portal.Target"},setup:function(){var i=this;i.on("started",function(){var t=i.get("name"),e=Ut[t];if(e)if(!e.target&&e.portals.length){for(var n=0;n<e.portals.length;++n)e.portals[n].fragment&&i.append(e.portals[n]);e.portals.length=0}else P('A portal target with the same name="'+t+'" already exists');else Ut[t]={target:i,portals:[]}}),i.on("destroying",function(){var t=i.get("name");delete Ut[t]})},append:function(t){t.fragment||(t.fragment=new Gt),this.appendChild(t.fragment)},remove:function(t){t.fragment&&this.removeChild(t.fragment)}}),S({constructor:Ft,extends:Ct,mixins:[Ot.prototype],statics:{__extag_element_class__:!0,initialize:function(t,e,n,i){Ct.initialize(t,1,n,e),i&&t.assign(i)}},accept:function(t,e){null==t||Array.isArray(t)||(t=[t]),jt.driveChildren(this,e||y,t,!1)},update:function(){if(0==(this.$flag&r))return!1;jt.transferProps(this),0==(this.$flag&o)&&(this.$flag|=o,gt.insertDigestQueue(this))},digest:function(){if(0==(this.$flag&o))return!1;this.$skin&&this.$flag&h&&(Ct.getViewEngine(this).renderShell(this.$skin,this),it.clean(this),this._style&&it.clean(this._style),this._commands&&(this._commands=null),this.$flag&=~h);this.$skin&&!1&this.$flag&&(this.$flag|=p),this.$flag&=-49}});var Lt,Qt={ASSIGN:-1,ONE_TIME:0,ONE_WAY:1,TWO_WAY:2,ANY_WAY:3};function Xt(t,e){return t.converters&&t.converters.length?function(t,e,n){for(var i=0;i<t.length;++i)n=Lt(t[i],N(e,n));return n}(t.converters,e,Lt(t.evaluator,e)):Lt(t.evaluator,e)}function qt(t){this.pattern=t}function Zt(t){this.pattern=t}function Bt(t){return{once:0<=t.indexOf("once"),capture:0<=t.indexOf("capture"),passive:0<=t.indexOf("passive")}}function Jt(t,e){"object"==typeof e&&e&&t&&t.length&&(0<=t.indexOf("stop")&&e.stopPropagation&&e.stopPropagation(),0<=t.indexOf("prev")&&e.preventDefault&&e.preventDefault())}function Ht(t,e){this.binding=t,this.pattern=e}Lt=function(t,e){return t.apply(e[0],e)},S({constructor:qt,statics:{MODES:Qt,create:function(t){return new qt(t)}},connect:function(t,e,n){this.flag=0,this.scopes=n,this.target=e,this.targetProp=t;var i=this.pattern;i.mode!==Qt.ASSIGN?(this.execute=this.execute.bind(this),this.invalidate=this.invalidate.bind(this),i.mode===Qt.TWO_WAY&&(this.backward=this.backward.bind(this),K.getAttrDesc(this.target,this.targetProp)&&this.target.on("changed",this.backward)),this.flag=1,this.execute(),n[0].on("updating",this.execute),Wt.record(e,this)):this.target.set(this.targetProp,Xt(i,n))},replace:function(t){if(1<t.length&&t.length===this.scopes.length){for(var e,n=t.length-1;0<=n;--n)if(t[n]!==this.scopes[n]){e=!0;break}e&&(this.scopes=t,this.flag=1,this.execute())}},destroy:function(){var t=this.scopes;this.pattern.mode===Qt.TWO_WAY&&K.getAttrDesc(this.target,this.targetProp)&&this.target.off("changed",this.backward),t[0].off("updating",this.execute),yt(this)},execute:function(){var t=this.pattern;if(0!==this.flag||t.mode===Qt.ANY_WAY){vt(this);var e=Xt(t,this.scopes);_t(),this.target.set(this.targetProp,e),this.flag=0,t.mode===Qt.ONE_TIME&&this.destroy()}},backward:function(t){if(t===this.targetProp){var e=this.target[this.targetProp],n=this.pattern.evaluator.path,i=n.from,s=n.length,r=this.scopes;2===s?(0<=i?r[i]:r[0].constructor.resources).set(n[1],e):2<s&&(0<=i?d.search(n.slice(1,s-1),r[i],!0):d.search(n.slice(1,s-1),r[0].constructor.resources,!0)).set(n[s-1],e)}},invalidate:function(t){this.keys&&0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}}),S({constructor:Zt,statics:{create:function(t){return new Zt(t)}},connect:function(t,e,n){this.type=t,this.target=e;var i=this.pattern,s=i.handler,r=i.evaluator,o=i.modifiers;if(s){var a=n[0][s];if(!a)return;o&&o.length?"bind"===o[0]&&1===o.length?this.handler=a.bind(n[0]):(this.handler=function(t){Jt(o,t),0<=o.indexOf("bind")?a.apply(n[0],arguments):a.apply(null,arguments)},this.options=Bt(o)):this.handler=a}else n.length<=1?o&&o.length?(this.handler=function(t){Jt(o,t),r.apply(n[0],N(n,t))},this.options=Bt(o)):this.handler=function(t){r.apply(n[0],N(n,t))}:(this.scopes=n,o&&o.length?(this.handler=function(t){Jt(o,t),r.apply(n[0],N(n,t))}.bind(this),this.options=Bt(o)):this.handler=function(t){r.apply(n[0],N(n,t))}.bind(this));this.handler&&(this.options?e.on(t,this.handler,this.options):e.on(t,this.handler),Wt.record(e,this))},replace:function(t){if(this.scopes&&1<t.length&&this.scopes.length===t.length)for(var e=1;e<t.length;++e)this.scopes[e]=t[e]},destroy:function(){var t=this.handler;t&&(this.options?this.target.off(this.type,t,this.options):this.target.off(this.type,t))}}),S({constructor:Ht,connect:function(t,e,n){this.binding.create(this.pattern).connect(t,e,n)}});var Kt=qt.MODES;function te(t){this.pattern=t}function ee(t,e,n){ee.initialize(this,t,e,n)}S({constructor:te,statics:{create:function(t){return new te(t)}},connect:function(t,e,n){this.scopes=n,this.target=e,this.property=t,this.flag=1;var i,s,r,o=this.pattern;for(i=0,s=o.length;i<s;++i)(r=o[i])instanceof Ht&&(null!=this.mode&&this.mode!==r.pattern.mode&&P("all embedded expressions must have same data-binding mode for TextBinding"),this.mode=r.pattern.mode);null!=this.mode&&this.mode!==Kt.ASSIGN?(this.invalidate=this.invalidate.bind(this),this.execute=this.execute.bind(this),this.execute(),n[0].on("updating",this.execute),Wt.record(e,this)):this.execute()},replace:function(t){1<t.length&&t.length===this.scopes.length&&(this.scopes=t,this.flag=1,this.execute())},destroy:function(){this.scopes[0].off("updating",this.execute),yt(this)},execute:function(){if(0!==this.flag||this.mode===Kt.ANY_WAY){vt(this);var t,e,n,i=[],s=this.pattern;for(t=0,e=s.length;t<e;++t)(n=s[t])instanceof Ht&&(n=Xt(n.pattern,this.scopes)),i.push(n);_t(),this.target.set(this.property,i.join("")),this.flag=0,this.mode===Kt.ONE_TIME&&this.destroy()}},invalidate:function(t){this.keys&&0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}}),S({constructor:ee,extends:zt,statics:{initialize:function(t,e,n,i){(zt.initialize(t,e),t.mode=0,i)&&(t.scopes=n,t.template=T({},i),delete t.template.xtype,delete t.template.xkey,delete t.template.xfor,delete t.template.xif,t.set("condition",!0),i.xif&&(t.mode=1,i.xif.connect("condition",t,n)),i.xfor&&(t.mode=2,t.varaibles=i.xfor[0],i.xfor[1].connect("iterable",t,n),i.xkey&&(t.keyExpr=i.xkey)),i.xtype&&(t.mode=t.mode||1,t.xtype=!0,i.xtype.connect("component",t,n)),t.refresh(),n[0].on("updating",function(){t.refresh()}))},template:"<x:frag></x:frag>"},refresh:function(){if(this.mode&&(this.hasDirty("condintion")||this.hasDirty("component")||this.hasDirty("iterable")||this.hasDirty("xtype"))){var t=this.get("condition"),e=this.get("component"),n=this.template,i=this.scopes,s=[];if(t){if(this.xtype){if(!e||!e.__extag_component_class__)return void this.setChildren(s);n=T({},n,{type:e})}if(1===this.mode)return(o=jt.createContent(n,i,!0))&&s.push(o),void this.setChildren(s);var r,o,a,l,c,f,h,u={},p=this.get("iterable")||[],g=this._children||[],d=this.varaibles,v=this.keyExpr;for(f=0,c=g.length;f<c;++f)"__extag_key__"in g[f]&&(u[l=g[f].__extag_key__]=f);for(f=0,c=p.length;f<c;++f){o=l=null,a=p[f];var _,m={};m[d[0]]=a,d[1]&&(m[d[1]]=f),h=i.concat([m]),v&&null!=(r=u[l=Xt(v.pattern,h)])&&(o=g[r]),o?(_=(h=o.__extag_scopes__)[h.length-1]).assign(m):(_=new xt(m),h[h.length-1]=_,(o=jt.makeContent(n,h)).__extag_key__=l,o.__extag_scopes__=h),s.push(o)}this.setChildren(s)}else this.setChildren(s)}}});var ne=qt.MODES;function ie(t){this.pattern=t}function se(t,e,n,i){var s,r,o=t._events;if(o)for(s in o)"function"==typeof(r=o[s])?t.off(s,r):Array.isArray(r)&&t.off(s,r[0],r[1]);if(n)for(s in n)r=n[s],i&&r instanceof Ht?r.connect(s,t,e):"function"==typeof r?t.on(s,r):Array.isArray(r)&&t.on(s,r[0],r[1]);t._events=n}function re(t,e,n,i){var s,r,o,a=t._props;if(a)if(t instanceof zt)for(s in a)n&&s in n||((r=K.getAttrDesc(t,s))?t.set(s,K.getAttributeDefaultValue(r)):t.set(s,null));else for(s in a)n&&s in n||t.set(s,null);if(n)for(s in n)o=n[s],i&&o instanceof Ht?o.connect(s,t,e):t.set(s,o)}function oe(t,e){var n=t.$meta;return n.type===a&&e.__extag_node__!==v||t.__extag_key__===e.xkey&&(e.type?t.constructor===e.type:n.tag===e.tag&&n.ns===e.ns)}function ae(t,e,n){fe(e)?(re(t,n,e.props),se(t,n,e.events),he(t,n,e.children,e.useExpr,t instanceof zt)):t.set("content",e)}function le(t,e){if(!fe(t))return new Pt(t);var n,i,s,r=t.useExpr;return t.xif||t.xfor||t.xtype?s=new ee(null,e,t):r&&t.type===Ht?"frag"===(i=t.expr).pattern.target?(s=new Gt(null,e),i.connect("accept",s,e)):(s=new Pt(""),i.connect("content",s,e)):"!"!==t.tag&&((n=t.type)?s=new n(null,e,t):(s=new Ft(t.ns?t.ns+":"+t.tag:t.tag),t.events&&se(s,e,t.events,r),t.props&&re(s,e,t.props,r),t.style&&re(s.style,e,t.style,r),t.classes&&ie.create(t.classes).connect("class",s,e),t.children&&he(s,e,t.children,r)),s&&t.name&&(s.$owner=e[0],e[0].addNamedPart(t.name,s))),s}function ce(t,e,n){var i,s;i=n._children||y,(s=t||y).length&&(s=function t(e,n,i){var s,r,o=e.length;if(!n)for(s=0;s<o;++s)if(Array.isArray(e[s])){n=[];break}if(n)for(s=0;s<o;++s)r=e[s],Array.isArray(r)?t(r,n,i):(n.push(r),i&&fe(r)&&!r.ns&&(r.ns=i));else for(s=0;s<o;++s)r=e[s],i&&fe(r)&&!r.ns&&(r.ns=i);return n||e}(s,null,n.$meta.ns));for(var r,o,a,l,c=new Array(s.length),f=0,h=i.length-1,u=0,p=s.length-1,g=i[f],d=i[h],v=s[u],_=s[p];f<=h&&u<=p;)if(null==g)g=i[++f];else if(null==d)d=i[--h];else if(oe(g,v))ae(c[u]=g,v,e),g=i[++f],v=s[++u];else if(oe(d,_))ae(c[p]=d,_,e),d=i[--h],_=s[--p];else if(oe(g,_))ae(c[p]=g,_,e),g=i[++f],_=s[--p];else if(oe(d,v))ae(c[u]=d,v,e),d=i[--h],v=s[++u];else{if(!o)for(o={},l=f;l<=h;++l)(a=i[l].__extag_key__)&&(o[a]=l);if(null!=(l=(a=v.xkey)&&o[a])&&oe(i[l]||m,v))c[u]=i[l];else{if(!(r=le(v,e)))throw new Error("Can not create content from ",v);r.__extag_key__=a,c[u]=r}v=s[++u]}if(h<f)for(;u<=p;){if(!(r=le(v,e)))throw new Error("Can not create content from ",v);(c[u]=r).__extag_key__=v.xkey,v=s[++u]}return c}function fe(t){return"object"==typeof t&&t.__extag_node__===v}function he(t,e,n,i,s){var r;if(s)t.accept(n,e);else{if(i){if(n&&1===n.length){var o=n[0];if(o instanceof Ht&&"frag"===o.pattern.target)return void(t instanceof zt?o.connect(function(t,e){he(this,e,t,!1)},t,e):o.connect("accept",t,e))}r=function(t,e){var n,i,s,r=[];if(t&&t.length)for(n=0,i=t.length;n<i;++n)(s=le(t[n],e))&&r.push(s);return r}(n,e)}else r=ce(n,e,t);t.setChildren(r)}}function ue(t){var e=typeof t;if("object"===e)return t;if("string"===e){var n,i,s,r,o,a={},l=t.split(";");for(s=0;s<l.length;++s)0<(i=(n=l[s]).indexOf(":"))&&(r=n.slice(0,i).trim(),o=n.slice(i+1).trim(),r&&(a[r]=o));return a}}function pe(t){var e;if(t.$meta.type!==a&&(t.hasDirty("style")&&(it.clean(t,"style"),e=ue(t.get("style")),t.style.reset(e)),t.$props&&t.constructor.__extag_component_class__)){var n,i,s,r=t.$props;if(r.hasDirty("style")){var o=((s=(n=t)[i="$style"])||(s=new wt(n),n[i]=s),s);it.clean(r,"style"),e=ue(e=r.get("style")),o.reset(e)}}}S({constructor:ie,statics:{create:function(t){return new ie(t)}},connect:function(t,e,n){this.scopes=n,this.target=e,this.property=t,this.flag=1;var i,s,r=this.pattern;for(i in r)(s=r[i])instanceof Ht&&(null!=this.mode&&this.mode!==s.pattern.mode&&P("all embedded expressions must have same data-binding mode for ClassBinding"),this.mode=s.pattern.mode);null!=this.mode&&this.mode!==ne.ASSIGN?(this.invalidate=this.invalidate.bind(this),this.execute=this.execute.bind(this),this.execute(),n[0].on("updating",this.execute),Wt.record(e,this)):this.execute()},replace:function(t){1<t.length&&t.length===this.scopes.length&&(this.scopes=t,this.flag=1,this.execute())},destroy:function(){this.scopes[0].off("updating",this.execute),yt(this)},execute:function(){if(0!==this.flag||this.mode===ne.ANY_WAY){vt(this);var t,e,n={},i=this.pattern;for(t in i)(e=i[t])instanceof Ht&&(e=Xt(e.pattern,this.scopes)),n[t]=e;_t(),this.target.set(this.property,n),this.flag=0,this.mode===ne.ONE_TIME&&this.destroy()}},invalidate:function(t){this.keys&&0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}}),jt.makeContent=le,jt.createContent=le,jt.driveChildren=he,jt.driveEvents=se,jt.driveProps=re,jt.driveComponent=function(t,e,n,i,s){var r;if(n&&e?(r=n.useExpr,i&&n.props?i=T({},n.props,i):!i&&n.props&&(i=n.props),re(t,e,i,r),n.events&&se(t,e,n.events,r),r&&(n.style&&re(t.style,e,n.style,r),n.classes&&ie.create(n.classes).connect("class",t,e)),n.children&&he(t,e,n.children,r,!0)):i&&re(t,e,i),s){var o=[t];r=s.useExpr,s.events&&se(t,o,s.events,r),s.props&&(t.$props=new wt(t),re(t.$props,o,s.props,r)),r&&s.style&&(t.$style=new wt(t),re(t.$style,o,s.style,r)),s.children&&he(t,o,s.children,r)}},jt.transferProps=pe,jt.transferProperties=pe;var ge=/[\w).+\-_$\]]/,de="abstract arguments boolean break byte case catch char class const continue debugger default delete do double else enum eval export extends false final finally float for function goto if implements import in instanceof int interface let long native new null package private protected public return short static super switch synchronized this throw throws transient true try typeof undefined var void volatile while with yield isNaN isFinite parseFloat parseInt Array Date Infinity Math NaN Number Object String Boolean RegExp JSON",ve={};function _e(t,e){for(var n,i=t.length;e<i;){if(!(32===(n=t.charCodeAt(e))||9<=n&&n<=13))return 44!==n&&123!==n;--e}}function me(t,e){for(var n="$"+e;0<=t.indexOf(n);)n="$"+n;return n}function ye(t,e){for(var n=e.length-1;0<=n;--n)if("string"==typeof e[n]){if(t===e[n])return n}else if(0<=e[n].indexOf(t))return n;return-1}function xe(t,e){for(var n,i,s,r=t.length;e<r;)if(32===(n=t.charCodeAt(e))||9<=n&&n<=13)s=!0,++e;else{if(46===n)i&&P("Unexpected token '.'.",{code:1001,expr:t}),i=!(s=!1);else{if(!(be(n)||48<=n&&n<=57)){i&&P("Unexpected token '"+t[e]+"'.",{code:1001,expr:t});break}if(s&&!i){--e;break}i=s=!1}++e}return e}function be(t){return 97<=t&&t<=122||65<=t&&t<=90||95===t||36===t}function we(t,e,n){for(var i=e.length;n<i;){if(e.charCodeAt(n)===t&&92!==e.charCodeAt(n-1))return n;++n}return i}function Ae(t,e){for(var n;0<=--e&&(32===(n=t.charCodeAt(e))||9<=n&&n<=13););return!n||!ge.test(String.fromCharCode(n))}function $e(t,e,n,i){try{t.push(e.join("\n"));var s=Function.apply(null,t);return n&&(s.path=n),s}catch(t){P(t,{code:1001,expr:i,desc:"Illegal expression `"+i+"`."})}}!function(){for(var t=de.split(/\s+/),e=0,n=t.length;e<n;++e)ve[t[e]]=!0}();var Ee={regexStarts:Ae,gotoEnding:we,parse:function(t,e,n,i){var s,r,o=[],a=[];for(s=0;s<n.length;++s)"$"===n[s][0]?a.push(n[s]):a.push(me(t,s));var l=a.slice(0),c=e.constructor.resources,f=d.parse(t);if(f&&f.length&&(!C.call(ve,f[0])||"this"===f[0]))return f.from=ye(f[0],n),f.from<0?c&&C.call(c,f[0])?o.push("var "+f[0]+" = this.constructor.resources."+f[0]+";"):(f.unshift("this"),f.from=0):"string"!=typeof n[f.from]&&f.unshift(a[f.from]),o.push("return "+f.join(".")),$e(a,o,f,i);var h,u=0,p=function(t){for(var e,n,i,s=[],r=t.length,o=0;o<r;)if(n=e,32===(e=t.charCodeAt(o))||9<=e&&e<=13)++o;else{switch(e){case 39:case 34:(o=we(e,t,o+1))===r&&P("Unclosed "+String.fromCharCode(e)+" .",{code:1001,expr:t});break;case 47:Ae(t,o)&&(o=we(e,t,o+1))===r&&P("Unclosed "+String.fromCharCode(e)+" .",{code:1001,expr:t});break;default:if(46===n){o=xe(t,o+1);continue}if(be(e)){i=xe(t,o+1),58!==t.charCodeAt(i)?s.push(o,i):_e(t,o-1)&&s.push(o,i),o=i;continue}}++o}return s}(t);for(r=0;r<p.length;r+=2)p[r+1]<0||(h=t.slice(p[r]+u,p[r+1]+u),f=d.parse(h.replace(x,"")),C.call(ve,f[0])||((s=ye(f[0],n))<0?c&&C.call(c,f[0])?(o.push("var "+f[0]+" = this.constructor.resources."+f[0]+";"),l.push(f[0])):(t=t.slice(0,p[r]+u)+"this."+h+t.slice(p[r+1]+u),u+=5):"string"!=typeof n[s]&&(t=t.slice(0,p[r]+u)+a[s]+"."+h+t.slice(p[r+1]+u),u+=a[s].length+1)));return o.push("return "+t),$e(a,o,null,i)}},ke=qt.MODES,Ce={parse:function(t,e,n){var i,s,r,o,a,l,c=-1,f=t.length;if(t[0]===_.TWO_WAY?(c=ke.TWO_WAY,t=t.slice(1,f)):t[f-1]===_.ANY_WAY?(c=ke.ANY_WAY,t=t.slice(0,f-1)):t[f-1]===_.ASSIGN?(c=ke.ASSIGN,t=t.slice(0,f-1)):t[f-1]===_.ONE_TIME?(c=ke.ONE_TIME,t=t.slice(0,f-1)):c=ke.ONE_WAY,c===ke.TWO_WAY)d.test(t.trim())||P("Invalid two-way binding expression!",{code:1001,expr:arguments[0],desc:"`"+arguments[0]+"` is not a valid two-way binding expression. Must be a property name or path."}),o=Ee.parse(t,e,n,arguments[0]);else if(t.indexOf(_.CONVERTER)<0)o=Ee.parse(t,e,n,arguments[0]);else if(a=t.split(_.CONVERTER),o=Ee.parse(a[0],e,n,arguments[0]),1<a.length)for(i=1;i<a.length;++i){(l=a[i].trim())||P("Converter must not be empty!",{code:1001,expr:arguments[0],desc:"Empty converter in the expression `"+arguments[0]+"` is not allowed."});for(var h="$value";0<=t.indexOf(h);)h="$"+h;var u=l.indexOf("(");l=0<u?l.slice(0,u+1)+h+","+l.slice(u+1):l+"("+h+")",r=Ee.parse(l,e,n.concat([h]),arguments[0]),(s=s||[]).push(r)}var p={mode:c,evaluator:o};return s&&s.length&&(p.converters=s),p}},Oe={parse:function(t,e,n){var i=t.indexOf(_.MODIFIER)<0?[t]:t.split(_.MODIFIER);i[0]=i[0].trim();var s={};if($.test(i[0])?s.handler=i[0].replace(A,""):((n=n.slice(0)).push("$event"),s.evaluator=Ee.parse(i[0],e,n)),1<i.length){for(var r=[],o=1;o<i.length;++o)r.push(i[o].trim());s.modifiers=r}return s}},Te={tryParse:function(t){return"false"!==t&&("true"===t||(isNaN(t)?void 0:Number(t)))}},Ne=qt.MODES;function De(t){this.pattern=t}S({constructor:De,statics:{create:function(t){return new De(t)}},connect:function(t,e,n){this.flag=0,this.scopes=n,this.target=e,this.method="function"==typeof t?t:e[t];var i=this.pattern;i.mode!==Ne.ASSIGN?(this.execute=this.execute.bind(this),this.invalidate=this.invalidate.bind(this),this.flag=1,this.execute(),n[0].on("updating",this.execute),Wt.record(e,this)):this.target.set(this.targetProp,Xt(i,n))},destroy:function(){this.scopes[0].off("updating",this.execute),yt(this)},execute:function(){var t=this.pattern;if(0!==this.flag||t.mode===Ne.ANY_WAY){vt(this);var e=Xt(t,this.scopes);_t(),this.method.call(this.target,e,this.scopes),this.flag=0,t.mode===Ne.ONE_TIME&&this.destroy()}},invalidate:function(t){this.keys&&0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}});var Se=qt.MODES;function Ie(t){t!==_.DATA&&t!==_.TEXT&&P(t+" is not allowed in expr() for data binding")}function Me(t,e){var n,i,s,r=t.props;if(t.xif&&(Ie((s=t.xif.args)[0]),t.xif=je(s,t,e)),t.xfor&&(Array.isArray(t.xfor[0])||(t.xfor[0]=t.xfor[0].replace(x,"").split(",")),Ie((s=t.xfor[1].args)[0]),t.xfor[1]=je(s,t,e),t.identifiers=t.identifiers.concat([t.xfor[0]])),t.xkey&&(Ie((s=t.xkey.args)[0]),t.xkey=je(s,t,e)),r)for(i in r)(n=r[i])&&"object"==typeof n&&(n.__extag_expr__===Ht?(Ie((s=n.args)[0]),r[i]=je(s,t,e)):"style"===i&&(t[i]=We(n,t,e),delete r[i]));if(null==t.type&&w.test(t.tag),null==t.type)switch(t.tag){case"x:slot":t.type=Vt;break;case"x:frag":t.type=Gt}t.events&&function(t,e){var n,i,s,r,o=t.events;for(n in o)(r=o[n])&&"object"==typeof r&&r.__extag_expr__===Ht&&((s=r.args)[0]!==_.EVENT&&P(s[0]+" is not allowed in expr() for event binding"),(i=je(s,t,e))&&(o[n]=i))}(t,e)}function Pe(t,e,n){var i=typeof t;return"string"===i?Ee.parse(t,e,n):"function"===i?t:void P("evaluator must be string or function")}function We(t,e,n){var i,s;for(i in t)(s=t[i])&&"object"==typeof s&&s.__extag_expr__===Ht&&(t[i]=je(s.args,e,n));return t}function je(t,e,n){t.length<2&&P("Unexpected arguments for expr()");var i,s,r,o=t[0],a=t[1],l=typeof a;if(o===_.DATA||o===_.FRAGMENT){if(o===_.FRAGMENT&&(i="frag"),2===t.length&&"string"===l)return i||a[0]!==_.TWO_WAY?null!=(r=Te.tryParse(a.trim()))?r:new Ht("frag"===((s=Ce.parse(a,n,e.identifiers)).target=i)?De:qt,s):(d.test(a.slice(1))||P("Invalid two-way binding expression!",{code:1001,expr:arguments[0],desc:"`"+arguments[0]+"` is not a valid two-way binding expression. Must be a property name or path."}),new Ht(qt,s={mode:Se.TWO_WAY,evaluator:Pe(a.slice(1),n,e.identifiers)}));switch(t[t.length-1]){case _.ASSIGN:o=Se.ASSIGN,t=t.slice(0,-1);break;case _.ANY_WAY:o=Se.ANY_WAY,t=t.slice(0,-1);break;case _.ONE_TIME:o=Se.ONE_TIME,t=t.slice(0,-1);break;default:o=Se.ONE_WAY}return new Ht("frag"===i?De:qt,s={mode:o,target:i,evaluator:Pe(a,n,e.identifiers),converters:t.length<=2?null:function(t,e,n){for(var i,s=[],r=0;r<t.length;++r)i=Pe(t[r],e,n),s.push(i);return s}(t.slice(2),n,e.identifiers)})}if(o===_.EVENT)return"string"===l&&2===t.length?s=Oe.parse(a,n,e.identifiers):"function"===l?s={evaluator:Pe(a,n,e.identifiers),modifiers:2<t.length?t.slice(2):null}:P("Unexpected arguments for expr()"),new Ht(Zt,s);if(o===_.TEXT){s=[];for(var c=1;c<t.length;++c)(a=t[c])&&"object"==typeof a&&a.__extag_expr__&&(a=je(a.args,e,n)),s.push(a);return new Ht(te,s)}P('The first argument of expr() should be one of "@", "+", "#", "{}"')}var Ye={xns:!0,xif:!0,xfor:!0,xkey:!0,xname:!0,xslot:!0,xtype:!0,events:!0};function ze(t,e,n){var i,s,r={__extag_node__:v},o=typeof t;if("string"===o){var a=t.indexOf(":");if(a<0)r.ns="",r.tag=t;else{if("x"===t.slice(0,a))switch(t){case"x:slot":r.tag=t,r.type=Vt;break;case"x:frag":r.tag=t,r.type=Gt}r.type||(r.ns=t.slice(0,a),r.tag=t.slice(a+1))}}else if("function"===o)if(t.__extag_component_class__||t===Gt)r.type=t;else{var l=$t.get("hook-engine");l&&(r.type=l.getComponentClass(t)),r.type&&r.type.__extag_component_class__||P("component class is not found.")}else P("The first argument must be string, function, component class or constructor.");if(null!=e)for(s in e.xns&&(r.ns=e.xns),e.xif&&(r.xif=e.xif),e.xfor&&(r.xfor=e.xfor),e.xkey&&(r.xkey=e.xkey),e.xname&&(r.name=e.xname),e.xslot&&(r.slot=e.xslot),e.xtype&&(e.xtype instanceof Ht?r.xtype=e.xtype:r.type=e.xtype),e.events&&(r.events=e.events),i=r.props?r.props:r.props={},e)!Ye[s]&&C.call(e,s)&&(i[s]=e[s]);return n&&(n=3<arguments.length||Array.isArray(n)?function t(e,n){var i,s=e.length;if(!n)for(i=0;i<s;++i)if(Array.isArray(e[i])){n=[];break}if(n)for(i=0;i<s;++i){var r=e[i];Array.isArray(r)?t(r,n):n.push(r)}return n||e}(n=E.call(arguments,2)):[n],r.children=n),r}function Ve(){return{args:E.call(arguments,0),__extag_expr__:Ht}}var Ge={node:ze,expr:Ve,parse:function(t,e){var n=t(ze,Ve);return n.__extag_node__!==v&&P("template root must be a tag node"),n.useExpr=!0,n.identifiers=["this"],Me(n,e),function t(e,n){var i,s,r=e.children;if(r&&r.length)for(i=r.length-1;0<=i;--i)if("object"==typeof(s=r[i])){if(s.__extag_node__===v){s.useExpr=!0,s.identifiers=e.identifiers,Me(s,n),t(s,n);continue}if(s.__extag_expr__===Ht){var o=s.args[0];o!==_.DATA&&o!==_.FRAGMENT&&P(o+" is not allowed in expr() for text or fragment binding"),r[i]={__extag_node__:v,useExpr:!0,type:Ht,expr:je(s.args,e,n)}}}}(n,e),n.type&&(n.type===Gt?n.type=null:P("component can not be used as root tag of another component template.")),(n.xif||n.xfor||n.xkey)&&P("`xif`, `xfor`, `xkey` can not be used on root tag of component template."),n}};jt.parseJSX=Ge.parse;var Re=/\s*\n\s*/g,Ue=new RegExp(_.DATA+"\\"+"{}"[0]+"(\\s|.)*?\\"+"{}"[1]),Fe={like:function(t){return Ue.test(t)},parse:function(t,e,n){for(var i,s,r,o,a,l,c=[],f=0,h=t.length,u=0,p=0;u<h;){switch(r=s,s=t.charCodeAt(u)){case 125:o&&0===--p&&(f<i&&(l=(l=t.slice(f,i)).replace(Re," "))&&(l=M(l),c.push(l)),123===t.charCodeAt(i+2)&&125===t.charCodeAt(u-1)?(a=Ce.parse(t.slice(i+3,u-1),e,n)).target="frag":(a=Ce.parse(t.slice(i+2,u),e,n)).target="text",c.push(new Ht("frag"===a.target?De:qt,a)),f=i=u+1,o=!1);break;case 123:o?(64===r&&P("Unclosed @{ .",{code:1001,expr:t}),++p):64===r&&(i=u-1,o=!0,p=1);break;case 39:case 34:o&&(u=Ee.gotoEnding(s,t,u+1))===h&&P("Unclosed "+String.fromCharCode(s)+" .",{code:1001,expr:t});break;case 47:o&&Ee.regexStarts(t,u)&&(u=Ee.gotoEnding(s,t,u+1))===h&&P("Unclosed "+String.fromCharCode(s)+" .",{code:1001,expr:t})}++u}return o&&P("Unclosed @{ .",{code:1001,expr:t}),0<f&&f<h&&(l=(l=t.slice(f,h)).replace(Re," "))&&(l=M(l),c.push(l)),c.length?c:null}},Le=/;/g,Qe=/^[a-z0-9\-_]+$/i,Xe={parse:function(t,e,n,i){var s,r,o,a,l,c,f,h,u={},p=t.split(Le);for(c=0,l=p.length;c<l;++c)if((h=(r=p[c].trim()).indexOf(":"))<0){if(r=r.trim())for(a=r.split(x),f=0;f<a.length;++f)u[a[f]]=!0}else{o=r.slice(0,h).trim(),t=r.slice(h+1).trim(),o&&Qe.test(o)||P("Illegal "+(i?"x:style":"x:class")+" expression.",{code:1001,expr:o||arguments[0]});try{if(!Fe.like(t)){u[o]=i?t:Te.tryParse(t);continue}s=Fe.parse(t,e,n)}catch(t){throw 1001===t.code&&(t.expr="@{0}".replace("0",t.expr)),t}s?1===s.length?u[o]=s[0]:i?u[o]=new Ht(te,s):P("Illegal x:class expression.",{code:1001,expr:t}):u[o]=i?t:Te.tryParse(t)}return u}},qe=/^\(.+\)$/,Ze=/\s+of\s+/,Be=/,/,Je=/^[\w\$\_]+$/,He=/[a-zA-Z]/,Ke=/[\s/>]/,tn=/[\s\/]+/,en=/^x:/,nn={html:"http://www.w3.org/1999/xhtml",math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};var sn={"!":!0,br:!0,hr:!0,area:!0,base:!0,img:!0,input:!0,link:!0,meta:!0,basefont:!0,param:!0,col:!0,frame:!0,embed:!0,keygen:!0,source:!0,command:!0,track:!0,wbr:!0},rn={"x:ns":!0,"x:if":!0,"x:for":!0,"x:key":!0,"x:name":!0,"x:slot":!0,"x:type":!0,"x:class":!0,"x:style":!0};function on(t,e){var n=t[e];return null==n&&(t[e]=n={}),n}function an(t,e,n,i,s){var r;if("x:class"===t)n.classes=Xe.parse(e,i,s,!1);else if("x:style"===t)n.style=Xe.parse(e,i,s,!0);else if("x:type"===t){var o=d.search(e,i.constructor.resources);if("function"==typeof o)if(o.__extag_component_class__||o===Gt)n.type=o;else{var a=$t.get("hook-engine");a&&(n.type=a.getComponentClass(o))}else r=Ce.parse(e,i,s),n.xtype=new Ht(qt,r)}else if("x:name"===t)n.name=e;else if("x:slot"===t)n.slot=e;else if("x:key"===t)r=Ce.parse(e,i,s),n.xkey=new Ht(qt,r);else if("x:for"===t){var l=e.trim().split(Ze);2!==l.length&&P('Illegal x:for="'+e+'".',{code:1001,expr:e}),r=l[1].trim(),l[0]=l[0].trim(),l=qe.test(l[0])?l[0].slice(1,-1).split(Be):[l[0]];for(var c=0;c<l.length;++c)l[c]=l[c].trim(),Je.test(l[c])||P('Illegal x:for="'+e+'".',{code:1001,expr:e});(r=r&&Ce.parse(r,i,s))?n.xfor=[l,new Ht(qt,r)]:P('Illegal x:for="'+e+'".',{code:1001,expr:e}),n.identifiers=s.slice(0),n.identifiers.push(l)}else"x:if"===t?(r=Ce.parse(e,i,s))?n.xif=new Ht(qt,r):P('Illegal x:if="'+e+'".',{code:1001,expr:e}):"x:ns"===t&&(n.ns=e)}function ln(t,e,n,i,s){var r,o,a,l=t[t.length-1];if(null!=e)if(l===_.EVENT)o=on(n,"events"),a=t.slice(0,-1),r=Oe.parse(e,i,s),o[a]=new Ht(Zt,r);else switch(o=on(n,"props"),l){case _.DATA:a=t.slice(0,-1),r=Te.tryParse(e.trim()),o[a]=null!=r?r:new Ht(qt,r=Ce.parse(e,i,s));break;case _.TEXT:a=t.slice(0,-1);try{r=Fe.parse(e,i,s)}catch(t){throw t}r?1===r.length?o[a]=r[0]:o[a]=new Ht(te,r):o[a]=e;break;default:o[t]=e}else(o=on(n,"props"))[t]=!0}function cn(t,e,n){for(var i=e.length,s=n;s<i;){if(t.test(e[s]))return s;s+=1}return-1}function fn(t,e,n,i){for(var s,r,o,a,l=e,c=e,f=e,h=t.length;l<h;){if(s=t[l],r){if(!b.test(s)){if(f=0<(f='"'===s||"'"===s?(c=l+1,t.indexOf(s,c)):cn(Ke,t,c=l))?f:h,n)try{120===(a=r).charCodeAt(0)&&a in rn?an(r,t.slice(c,f),n,i,n.identifiers):ln(r,t.slice(c,f),n,i,n.identifiers)}catch(t){throw t}if(">"===t[f])return f;r=null,c=f=l=f+1;continue}}else{if(">"===s){if(c<(f=l))for(o=t.slice(c,f).trim().split(tn);0<o.length;)(r=o.shift())&&n&&ln(r,null,n,i,n.identifiers);return f}if("="===s){if(c<(f=l)){for(o=t.slice(c,f).trim().split(tn);1<o.length;)(r=o.shift())&&n&&ln(r,null,n,i,n.identifiers);r=o.shift()}c=f=l=f+1;continue}}l+=1}}var hn=/^\s*\n\s*/,un=/\s*\n\s*$/;function pn(t,e){return{__extag_node__:v,useExpr:!0,type:Ht,expr:e instanceof Ht?e:new Ht(t,e)}}function gn(t,e,n,i,s,r){var o,a=i.children||[],l=t.slice(e,n);if(l=l.replace(hn,"").replace(un,"")){if(Fe.like(l)){try{o=Fe.parse(l,s,r)}catch(t){throw t}if(o)if(1===o.length&&o[0]instanceof Ht)u=o[0],a.push(pn(o[0].binding,o[0]));else{for(var c=-1,f=0,h=o.length;f<h;++f){var u=o[f];u instanceof Ht&&"frag"===u.pattern.target?(c<f&&(1<f-c?a.push(pn(te,o.slice(c,f))):o[c]instanceof Ht?a.push(pn(o[c].binding,o[c])):a.push(o[c])),a.push(pn(u.binding,u)),c=-1):c<0&&(c=f)}0<=c&&c<f&&(1<f-c?a.push(pn(te,o.slice(c,f))):o[c]instanceof Ht?a.push(pn(o[c].binding,o[c])):a.push(o[c]))}else a.push(M(l))}else a.push(M(l));i.children=a}}var dn=function(t,e){var n=e.constructor,i=function(t,e){var n,i,s,r,o,a,l=0,c=0,f=[],h=0,u=(t=t.trim()).length;for(r={tag:"<>",children:[],identifiers:["this"]},f.push(r);h<u;){if("<"===t[h]){if(n=t[h+1],He.test(n)){if(l<h&&gn(t,l,h,r,e,r.identifiers),c=cn(Ke,t,l=h+1),s=t.slice(l,c),(i={}).tag=s,i.useExpr=!0,i.__extag_node__=v,i.identifiers=r.identifiers,">"!==t[c]&&(c=fn(t,l=c+=1,i,e,i.identifiers)),i.ns||(i.props&&i.props.xmlns?i.ns=(a=i.props.xmlns)&&a!==nn.html?a===nn.svg?"svg":a===nn.math?"math":a===nn.xlink?"xlink":null:"":r.ns&&(i.ns=r.ns)),null==i.type&&en.test(s))switch(s){case"x:slot":i.type=Vt;break;case"x:frag":i.type=Gt}if(null==i.type&&null==i.xtype&&w.test(s)){var p=d.search(s,e.constructor.resources);if("function"==typeof p)if(p.__extag_component_class__||p===Gt)i.type=p;else{var g=$t.get("hook-engine");g&&(i.type=g.getComponentClass(p))}}r&&(r.children=r.children||[],r.children.push(i)),"/"===t[c-1]||(o=s,C.call(sn,o))||(f.push(i),r=i),l=c=h=c+1;continue}if("/"===n&&He.test(t[h+2])){if(l<h&&gn(t,l,h,r,e,r.identifiers),c=cn(Ke,t,l=h+2),(s=t.slice(l,c))!==r.tag&&P("Unclosed tag "+r.tag),">"!==t[c]&&(c=fn(t,l=c+=1)),!(1<f.length))return f[0];f.pop(),0<f.length&&(r=f[f.length-1]),l=c=h=c+1;continue}if("!"===n&&"\x3c!--"===t.slice(h,h+4)){l<h&&gn(t,l,h,r,e,r.identifiers),l=h+4,c=0<(c=t.indexOf("--\x3e",l))?c:t.length,i={tag:"!",comment:t.slice(l,c),__extag_node__:v},r.children=r.children||[],r.children.push(i),l=c=h=c+3;continue}}h+=1}return l<u&&gn(t,l,u,r,e,r.identifiers),f}(t,e)[0].children,s=i[0];return 1!==i.length&&P("The template of component "+(n.fullname||n.name)+" must have only one root tag."),"!"!==s.tag&&"#"!==s.tag||P("Component template root tag must be a DOM element, instead of: "+t.slice(0,t.indexOf(">"))),s.type?"x:frag"===s.tag&&s.type===Gt?s.type=null:"x:slot"===s.tag||"x:view"===s.tag?P(s.tag+" can not be used as root tag of component template: "+t.slice(0,t.indexOf(">"))):P("component can not be used as root tag of another component template: "+t.slice(0,t.indexOf(">"))):(s.xif||s.xfor||s.xkey)&&P("`x:if`, `x:for`, `x:key` can not be used on root tag of component template: "+t.slice(0,t.indexOf(">"))),s};return jt.parseHTMX=dn,"undefined"!=typeof ExtagDOM&&$t.set("view-engine",ExtagDOM),{anew:Q.anew,inst:Q.inst,node:Ge.node,expr:Ge.expr,conf:function(t,e){if(1===arguments.length)return $t.get(t);$t.set(t,e)},defineClass:S,setImmediate:gt.setImmediate,Validator:nt,Watcher:W,Model:xt,Cache:wt,Text:Pt,Slot:Vt,Portal:Rt,Element:Ft,Fragment:Gt,Component:zt,version:"0.5.1"}});
