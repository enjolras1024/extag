!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Extag=e()}(this,function(){"use strict";var n=/\./,i=/(\]\.)|\.|\[|\]/g,s=/^[$_A-Z][$_A-Z0-9]*(\.[$_A-Z0-9]+)*$/i,r=/^[$_A-Z][$_A-Z0-9]*((\[\d+\])|(\.[$_A-Z0-9]+))*$/i;function o(t,e){for(var n=-1,i=t.length,s=e;++n<i;)if(null==(s=s[t[n]]))return s;return s}var y={test:function(t){return s.test(t)},parse:function(t){var e=null;return s.test(t)?e=t.split(n):r.test(t)&&(e=t.replace(i," ").trim().split(" ")),e},search:function(t,e,n){var i;if("string"==typeof t&&(t=y.parse(t)),t)return e&&(i=o(t,e)),null!=i||n||("undefined"!=typeof window?i=o(t,window):"undefined"!=typeof global&&(i=o(t,global))),i}},u=0,a=3,c=0,l=4,f=2,h=1,p=16,g=32,d=Object.freeze({}),v="view-engine",_={},m=[],x={DATA:"@",TEXT:"#",EVENT:"+",MODIFIER:"::",CONVERTER:"|=",ASSIGN:"!",TWO_WAY:"@",ANY_WAY:"^",ONE_TIME:"?"},b=/\s+/,w=/\s/g,A=/^[A-Z]/,k=/^this\./,$=/^(this\.)?[\w$_]+$/,E=Array.prototype.slice,O=Object.defineProperty,C=Object.prototype.hasOwnProperty,T=Object.getOwnPropertyDescriptor;function e(t){this.target=t}e.prototype.bind=function(){for(var t,e,n=this.target,i=0;i<arguments.length;++i)"function"==typeof(e=n[t=arguments[i]])&&(n[t]=e.bind(n))};var D=function(t){var e,n,i,s=arguments.length;for(i=1;i<s;++i)if((e=arguments[i])instanceof Object)for(n in e)C.call(e,n)&&(t[n]=e[n]);return t};function t(t){return"function"==typeof t&&/native code/.test(t.toString())}function P(t,e){var n,i,s;for(n=0,i=e.length;n<i;++n)for(var r in s=e[n])C.call(s,r)&&O(t,r,T(s,r))}function N(t){var e,n,i,s,r;if(C.call(t,"extends")){if("function"!=typeof(n=t.extends))throw new TypeError("superClass must be a function")}else n=Object;if(C.call(t,"constructor")){if("function"!=typeof(e=t.constructor))throw new TypeError("subClass must be a function")}else e=function(){n.apply(this,arguments)};return e.prototype=Object.create(n.prototype),r=[e.prototype],i=t.mixins,Array.isArray(i)&&r.push.apply(r,i),r.push(t),P(e.prototype,r),O(e.prototype,"constructor",{value:e,enumerable:!1,writable:!0,configurable:!0}),r=[e,n],(s=t.statics)&&(i=s.mixins,Array.isArray(i)&&r.push.apply(r,i),r.push(s)),P(e,r),delete e.prototype.statics,delete e.prototype.entend,delete e.prototype.mixins,delete e.mixins,e}var S=/&[\w#]{2,6};/;function j(t){return S.test(t)?t.replace(/&nbsp;/g,String.fromCharCode(160)).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t}function M(t,e){var n=t instanceof Error?t:new Error(t);throw e&&D(n,e),n}function I(){}var z=[function(t){this.emit(t.type,t,c)},function(t){this.emit(t.type,t,h)},function(t){this.emit(t.type,t,f)},function(t){this.emit(t.type,t,h|f)}];function W(t,e,n){var i=t.constructor;"function"==typeof i.removeEventListener&&(2===arguments.length?i.removeEventListener(t,e):i.removeEventListener(t,e,n))}function Y(t){var e=c;return t&&(t.capture&&(e|=h),t.passive&&(e|=f),t.once&&(e|=l)),e}function V(t){var e={};return t&h&&(e.capture=!0),t&f&&(e.passive=!0),t&l&&(e.once=!0),e}function L(t,e){return(t&h)==(e&h)}function R(t,e,n,i){var s=t._actions;if("function"==typeof n){s||O(t,"_actions",{value:s={},writable:!1,enumerable:!1,configurable:!0});var r=s[e];r||(r=s[e]={type:e,head:null,tail:null});var o=Y(i);if(n.__extag_handler__)for(var a=r.head;a;){if(a.func===n&&L(o,a.flag))return;a=a.next}var c,l,f,h,u={func:n,flag:o};n.__extag_handler__=!0,r.head?r.tail.next=u:r.head=u,r.tail=u,"listeners"in r&&!r.listeners||(l=r,f=u,"function"==typeof(h=(c=t).constructor).addEventListener?h.addEventListener(c,l,f):l.listeners=null)}}function U(t,e,n,i){var s=t._actions;if(s){var r=s[e];if(r){if(2===arguments.length)return r.listeners&&W(t,r),void(s[e]=null);for(var o=Y(i),a=r.head,c=null;a;){if(n===a.func&&L(o,a.flag)){if(r.listeners)r.listeners[a.flag&(h|f)]&&W(t,r,a);a.next||(r.tail=c),c?c.next=a.next:r.head=a.next;break}a=(c=a).next}}}}function Q(t,e,n){(e=E.call(e,0))[0]=n+" "+e[0],t.apply(console,e)}N({constructor:I,statics:{opts2flag:Y,flag2opts:V,getEventListener:function(t,e){return z[e].bind(t)}},on:function(t,e,n){if("object"==typeof t){for(t in n=t)if(C.call(n,t)){var i=n[t];Array.isArray(i)?R(this,t,i[0],i[1]):R(this,t,i)}}else R(this,t,e,n)},off:function(t,e,n){var i=this._actions;if(i){var s=arguments.length,r=typeof t;if(0===s)for(t in i)U(this,t);else if("string"===r)1===s?U(this,t):U(this,t,e,n);else if("object"===r)for(t in n=t)if(C.call(n,t)){var o=n[t];Array.isArray(o)?U(this,t,o[0],o[1]):null==o?U(this,t):U(this,t,o)}}},emit:function(t){var e=this._actions;if(e){var n=e[t];if(n&&n.head){var i,s,r=n.listeners?arguments[2]:0;for(i=n.head;i;)L(r,i.flag)&&(i.func.apply(null,E.call(arguments,1)),i.flag&l&&(s=s||[]).push(i)),i=i.next;if(s)for(var o=0;o<s.length;++o)i=s[o],this.off(t,i.func,i.flag?V(i.flag):null)}}}});var F={info:function(){Q(console.log,arguments,"[EXTAG INFO]")},warn:function(){Q(console.warn,arguments,"[EXTAG WARN]")},error:function(){Q(console.error,arguments,"[EXTAG ERROR]")},debug:function(){Q(console.log,arguments,"[EXTAG DEBUG]")}};function G(){1<arguments.length?(this.ctor=arguments[0],this.args=arguments[1]):this.gen=arguments[0]}N({constructor:G,statics:{anew:function(t){return new G(t,E.call(arguments,1))},inst:function(t){return new G(t)}},gen:function(){var t=this.ctor,e=this.args;if(!e)return new t;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);default:throw new Error("`anew` arguments length must not exceed 6.")}}});var X={},Z={configurable:!0,enumerable:!0},q={},H={};function J(e){return function(t){return t[e]}}function B(t,e){var n,i;Z.get=(n=e,C.call(q,n)||(q[n]=function(){return this.get(n)}),q[n]),Z.set=(i=e,C.call(H,i)||(H[i]=function(t){this.set(i,t)}),H[i]),O(t,e,Z)}function K(){throw new Error("Accessor is a partial class for mixins and can not be instantiated")}function tt(t){if(t instanceof Object){var e=t.constructor;return e.fullname||e.name}return typeof t}function et(t,e,n,i){var s,r,o,a=K.getAttrDesc(t,e);if(a&&(a.type||a.test))return(o=a.type)&&(s=function(t,e,n,i){var s,r,o,a,c,l,f=typeof i;if("string"===f&&typeof n!==i?(f=i,s=!0):"function"!==f||n instanceof i||(f=i.fullname||i.name,s=!0),s)return r=t.constructor,o=r.fullname||r.name,a=e,c=f,l=tt(n),"`"+a+"` of type `"+(o||"<<anonymous>>")+"` should be `"+c+(l?"`, not `"+l:"")+"`";if(Array.isArray(i)){for(var h=0,u=i.length;h<u&&!("string"==(f=typeof i[h])&&typeof n===i[h]||"function"===f&&n instanceof i[h]);++h);if(h===u)return function(t,e,n,i){for(var s=[],r=0,o=n.length;r<o;++r)s.push("`"+(n[r].name||n[r])+"`");return"`"+e+"` of type `"+(t||"<<anonymous>>")+"` should be "+s.join(" or ")+(i?", not `"+i:"")+"`"}((r=t.constructor).fullname||r.name,e,i,tt(n))}}(t,e,n,o)),s||((r=a.test)&&(s="function"==typeof r?r.call(t,n,e):function(t,e,n,i){if(!i.test(n))return n+" does not match the pattern "+i.toString()+" of the property `"+e+"` in "+t.toString()}(t,e,n,r)),s||void 0)}N({constructor:K,statics:{getAttrDesc:function(t,e){return t.__extag_descriptors__?t.__extag_descriptors__[e]:null},defineGetterSetter:B,getAttributeDefaultValue:function(t){return"object"!=typeof t.value?t.value:null!=t.value?t.value instanceof G?t.value.gen&&t.value.gen():t.value:void 0},getAttributeDefaultValues:function(t){var e={},n=t.__extag_descriptors__;if(n)for(var i in n)if(C.call(n,i)){var s=n[i],r=typeof s.value;if("undefined"===r)continue;"object"!==r?e[i]=s.value:null!=s.value&&(s.value instanceof G?e[i]=s.value.gen&&s.value.gen():e[i]=s.value)}return e},applyAttributeDescriptors:function(t,e){if(!C.call(t,"__extag_descriptors__")){if(Array.isArray(e)){var n,i,s=e;for(e={},n=0,i=s.length;n<i;++n)e[s[n]]=X}var r,o,a=D({},t.__extag_descriptors__);for(r in e)if(C.call(e,r)){if(r in t)continue;o=e[r],a[r]="object"!=typeof o?{value:o}:o instanceof G?{value:o}:o?(o.get&&!o.set||o.set&&!o.get&&(o.get=J(r)),o):X,B(t,r)}O(t,"__extag_descriptors__",{value:a,configurable:!0,enumerable:!1,writable:!1})}}},get:function(t){throw new Error("Method `get` must be implemented by sub-class")},set:function(t,e){throw new Error("Method `set` must be implemented by sub-class")},assign:function(t){for(var e in t)C.call(t,e)&&this.set(e,t[e])}});var nt={validate0:function(t,e){var n,i=t.__extag_descriptors__;for(n in i)!i[n].required||e&&C.call(e,n)||F.warn("Attribute Validation:","required `"+n+"` for component "+(t.constructor.fullname||t.constructor.name))},validate:function(t,e,n,i){return!et(t,e,n)},troubleShoot:et};function it(){throw new Error("DirtyMarker is a partial class for mixins and can not be instantiated")}N({constructor:it,statics:{check:function(t,e,n,i){var s=t._dirty;s||(s={},t._dirty=s),e in s?s[e]===n&&delete s[e]:s[e]=i},clean:function(t,e){t._dirty&&(e?delete t._dirty[e]:t._dirty=null)}},hasDirty:function(t){var e=this._dirty;return!!e&&(null==t||C.call(e,t))}});var st=function(t,e,i){if(t){var n=t.resolve();return function(t){"function"==typeof t&&n.then(t)}}if(e){var s=[],r=0,o=document.createTextNode("");return new e(function(){for(var t;t=s.pop();)t();r=r?0:1}).observe(o,{characterData:!0}),function(t){"function"==typeof t&&(s.unshift(t),o.data=r)}}return i?function(t){if("function"==typeof t){var e=!1,n=function(){e||(e=!0,t())};i(n),setTimeout(n)}}:setTimeout}("undefined"!=typeof Promise&&t(Promise)?Promise:null,"undefined"!=typeof MutationObserver&&t(MutationObserver)?MutationObserver:null,"undefined"!=typeof requestAnimationFrame&&t(requestAnimationFrame)?requestAnimationFrame:null),rt=[],ot=[],at=[],ct=0,lt=0,ft=!1;function ht(){try{var t;for(0,ct=0;ct<rt.length;)rt[ct].update(),++ct;for(rt.length=0,ct=-1,lt=0;lt<ot.length;)ot[lt].digest(),++lt;for(ot.length=0,lt=-1,t=at.length-1;0<=t;--t)at[t]();at.length=0,ft=!1}catch(t){throw lt=ct=-1,rt.length=0,ot.length=0,at.length=0,ft=!1,t}}function ut(t,e,n,i){for(var s,r;e<=n;)if((r=i[s=e+n>>1].$meta.guid)<t)e=s+1;else{if(!(t<r))return e;n=s-1}return-e-1}var pt,gt={setImmediate:st,insertUpdateQueue:function(t){var e,n=rt.length,i=t.$meta.guid;if(0<n&&i>rt[n-1].$meta.guid)e=n;else{var s=ut(i,ct+1,rt.length-1,rt);if(!(s<0))return;e=-s-1}e===n?rt.push(t):rt.splice(e,0,t),ft||(ft=!0,st(ht))},insertDigestQueue:function(t){var e,n=ot.length,i=t.$meta.guid;if(0<n&&i>ot[n-1].$meta.guid)e=n;else{var s=ut(i,lt+1,ot.length-1,ot);if(!(s<0))return;e=-s-1}e===n?ot.push(t):ot.splice(e,0,t),ft||(ft=!0,st(ht))},pushCallbackQueue:function(t){at.push(t)}},dt=[],vt=function(t){(pt=t).depsCountNew=0,pt.depsCountOld=0,pt.executeTimes=pt.executeTimes?pt.executeTimes+1:1,dt.push(t)},yt=function(){if(null!=pt){if(pt.depsCountOld<pt.depsCount){var t,e,n=pt.deps;for(t=n.length-1;0<=t;--t)(e=n[t]).times!==pt.executeTimes&&(e.src.off("changed",pt.invalidate),n.splice(t,1))}pt.depsCount=pt.depsCountOld+pt.depsCountNew,dt.pop(),dt.length&&(pt=dt[dt.length-1])}},_t=function(t,e){if(null!=pt){var n=pt.keys;n?n.indexOf(e)<0&&n.push(e):pt.keys=[e];var i,s,r=pt.deps;if(r){for(i=0;i<r.length;++i)if((s=r[i]).src===t)return void(s.times<pt.executeTimes&&(s.times=pt.executeTimes,pt.depsCountOld++))}else r=pt.deps=[];pt.depsCountNew++,t.on("changed",pt.invalidate),r.push({src:t,times:pt.executeTimes})}},mt=function(t){var e=t.deps;if(e){for(var n=0;n<e.length;++n)e[n].src.off("changed",t.invalidate);t.deps=null,t.keys=null}};function xt(t){xt.initialize(this,t)}N({constructor:xt,mixins:[K.prototype,I.prototype],statics:{create:function(t){return new xt(t)},initialize:function(t,e){var n,i=t.constructor;i!==xt&&i.attributes?(K.applyAttributeDescriptors(i.prototype,i.attributes),n=K.getAttributeDefaultValues(t),O(t,"_props",{value:n,writable:!1,enumerable:!1,configurable:!0})):O(t,"_props",{value:{},writable:!1,enumerable:!1,configurable:!0}),e&&function(t,e){var n,i;for(n in e)C.call(e,n)&&(K.getAttrDesc(t,n)?t.set(n,e[n]):(i=T(e,n)).get||i.set?O(t,n,i):(K.defineGetterSetter(t,n),t.set(n,i.value)))}(t,e)}},get:function(t){_t(this,t);var e=K.getAttrDesc(this,t);return e&&e.get?e.get.call(this,this._props):this._props[t]},set:function(t,e){var n,i=K.getAttrDesc(this,t),s=this._props;i&&i.get?i.set&&(n=i.get.call(this,s),i.set.call(this,e,s),n!==(e=i.get.call(this,s))&&this.emit("changed",t,e)):(n=s[t])!==e&&(s[t]=e,this.emit("changed",t,e))}});var bt={invalidate:function(){}};function wt(t){this._owner=t||bt,this._props={}}N({constructor:wt,mixins:[K.prototype,it.prototype],get:function(t){return this._props[t]},set:function(t,e){var n=this._props,i=n[t];e!==i&&(n[t]=e,this._owner.invalidate(1),it.check(this,t,e,i))},reset:function(t){var e,n=this._props;if(n)for(e in n)t&&e in t||this.set(e,null);t&&this.assign(t)}});var At={},kt=function(t){return At[t]},$t=function(t,e){At[t]=e},Et=0,Ot=null;function Ct(){throw new Error("Shell is a base class and can not be instantiated")}function Tt(){M("Parent is a base class and can not be instantiated!")}function Dt(t){for(var e=t._parent;e&&e.$meta.type===u;)e=e._parent;return e}function Pt(t,e){var n,i,s=t._children,r=s.length;for(e=e||[],n=0;n<r;++n)(i=s[n]).$meta.type===u?Pt(i,e):e.push(i);return e}N({constructor:Ct,mixins:[I.prototype,K.prototype,it.prototype],invalidate:function(t){0==(8&this.$flag)&&(this.$flag|=8,gt.insertUpdateQueue(this)),t&&0==(this.$flag&t)&&(this.$flag|=t)},update:function(){throw new Error("The method `update` must be implemented by sub-class")},digest:function(){throw new Error("The method `digest` must be implemented by sub-class")},attach:function(t){if(0===this.$meta.type)throw new Error("Fragment and component using <x:frag> as root tag, can not attach a skin.");var e=Ct.getViewEngine(this);if(e.attachShell(t,this),this.$skin=t,this._actions){var n,i,s=this._actions;for(n in s)if(C.call(s,n)&&e.mayDispatchEvent(t,n)&&(i=s[n]))for(var r=i.head;r;)Ct.addEventListener(this,i,r),r=r.next}0==(this.$flag&p)&&(this.$flag|=p,gt.insertDigestQueue(this))},detach:function(){this.$owner&&(this.$owner=null),this.constructor.destroy(this);var t=this.$skin;t&&(Ct.getViewEngine(this).detachShell(t,this),this.$skin=null)},toString:function(){var t=this.$meta,e=this.constructor;return(e.fullname||e.name)+"<"+t.tag+">("+t.guid+")"},get:function(t){return this._props[t]},set:function(t,e){var n=this._props,i=n[t];i!==e&&(n[t]=e,this.invalidate(1),it.check(this,t,e,i))},cmd:function(t){this._commands||(this._commands=[]),this._commands.push({name:t,args:E.call(arguments,1)}),this.invalidate(4)},statics:{initialize:function(t,e,n,i){e===a||C.call(t,"_props")||(t._props={}),t.$flag=0,t.$meta={guid:Et++,type:e,tag:n,ns:i}},destroy:function(t){if(!(64&t.$flag)){var e;t.off(),it.clean(t);var n=t._bindings;if(n){for(e=n.length-1;0<=e;--e)n[e].destroy();n.length=0}var i,s=t._children;if(s){for(e=s.length-1;0<=e;--e)(i=s[e]).constructor.destroy(i),i._parent=null;t._children.length=0}t.$flag|=64}},getViewEngine:function(t){var e=t.$meta.ns;return null==Ot&&(Ot=kt(v)),e&&!Ot.hasNameSpace(e)?kt(e+":"+v):Ot},addEventListener:function(t,e,n){var i=t.$skin,s=Ct.getViewEngine(t);if(i&&s)if(s.mayDispatchEvent(i,e.type)){var r=n.flag&(h|f);e.listeners=e.listeners||[];var o=e.listeners[r];if(o)return void o.count++;o=I.getEventListener(t,n.flag),s.addEventListener(i,e.type,o,r&&I.flag2opts(r)),(e.listeners[r]=o).count=1}else e.listeners=null},removeEventListener:function(t,e,n){var i,s,r,o=t.$skin,a=e.listeners,c=Ct.getViewEngine(t);if(o&&a&&c&&c.mayDispatchEvent(o,e.type))if(2===arguments.length)for(i=0;i<a.length;++i)(r=a[i])&&(r.count=0,a[i]=null,c.removeEventListener(o,e.type,r,I.flag2opts(i)));else{if(!(r=a[s=n.flag&(h|f)]))return;r.count--,r.count<1&&(c.removeEventListener(o,e.type,r,I.flag2opts(s)),a[s]=null)}}}});var Nt=[],St=!1;function jt(t){Nt.push(t),St||(St=!0,gt.pushCallbackQueue(Mt))}function Mt(){for(var t=0;t<Nt.length;++t){var e=Nt[t];e._parent||e.detach()}Nt.length=0,St=!1}function It(t){It.initialize(this,t)}N({constructor:Tt,statics:{findParent:Dt,flattenChildren:Pt},getParent:function(t){return t?Dt(this):this._parent},getChildren:function(t){return t?Pt(this):this._children?this._children.slice(0):[]},setChildren:function(t){var e,n=this._children,i=t?t.length:0,s=n?n.length:0;if(s===i){for(e=0;e<i&&n[e]===t[e];++e);if(e===i)return}if(s){for(e=0;e<s;++e)n[e]._parent=null,jt(n[e]);n.length=0}if(i)for(e=0;e<i;++e)this.insertChild(t[e],null);else s&&this.invalidate(2)},insertChild:function(t,e){null==t&&M("The new child to be inserted into this parent must not be null!");var n,i,s,r=this._children;if(r||(r=[],this._children=r),s=r.length,null!=e){for(n=0;n<s&&(r[n]!==e||this!==e._parent);++n);if(n===s&&M("The child before which the new child is to be inserted is not a child of this parent!"),e===t)return}else n=s;if(t._parent)if(t._parent===this){for(i=0;i<s;++i)if(r[i]===t){if(i===n)return;r.splice(i,1),n=i<n?n-1:n,s=r.length;break}}else t._parent.removeChild(t);n<s?r.splice(n,0,t):r.push(t),(t._parent=this).invalidate(2)},appendChild:function(t){this.insertChild(t,null)},removeChild:function(t){null==t&&M("The new child to be removed from this parent must not be null!");var e=0,n=0,i=this._children;if(i)for(e=0,n=i.length;e<n&&(i[e]!==t||this!==t._parent);++e);e===n&&M("The child to be removed is not a child of this parent!"),e<n-1?i.splice(e,1):i.pop(),t._parent=null,jt(t),this.invalidate(2)},replaceChild:function(t,e){null==t&&M("The new child to be inserted into this parent must not be null!");var n=0,i=0,s=0,r=this._children;if(r)for(n=0,s=r.length;n<s&&(r[n]!==e||this!==e._parent);++n);if(n===s&&M("The child to be replaced is not a child of this parent!"),t!==e){if(t._parent)if(t._parent===this){for(i=0;i<s;++i)if(r[i]===t){r.splice(i,1),n=i<n?n-1:n,s=r.length;break}}else t._parent.removeChild(t);jt(e),e._parent=null,t._parent=this,r[n]=t,this.invalidate(2)}}}),N({constructor:It,extends:Ct,statics:{initialize:function(t,e){Ct.initialize(t,a,"",""),t.set("content",e||"")}},get:function(t){if("content"===t)return this._content},set:function(t,e){"content"===t&&e!==this._content&&(this._dirty=!0,this._content=e,this.invalidate(1))},update:function(){if(0==(8&this.$flag))return!1;0==(this.$flag&p)&&(this.$flag|=p,gt.insertDigestQueue(this))},digest:function(){if(0==(this.$flag&p))return!1;this.$skin&&7&this.$flag&&(Ct.getViewEngine(this).renderShell(this.$skin,this),this.$flag&=-8,this._dirty=!1);this.$skin&&!1&this.$flag&&(this.$flag|=g),this.$flag&=-25},getParent:Tt.prototype.getParent,toString:function(){var t=this._content;return'"'+((t=null==t?"":t.toString()).length<24?t:t.slice(0,21)+"...")+'"('+this.$meta.guid+")"}});var zt={driveComponent:null,transferProps:null,createContent:null,makeContent:null,parseHTMX:null,parseJSX:null};function Wt(t,e){var n=t.indexOf(":"),i="";0<n&&(i=t.slice(0,n),t=t.slice(n+1)),Wt.initialize(this,i,t,e)}function Yt(t,e,n,i,s){this.scope=t,this.target=e,this.property=n,"function"==typeof i&&(this.invalidate=this.invalidate.bind(this),this.execute=this.execute.bind(this),this.collect=i,this.flag=1,this.execute(),this.keys&&this.keys.length&&(Yt.record(e,this),this.scope.on("updating",this.execute)),"function"==typeof s&&(this.reflect=s,this.backward=this.backward.bind(this),e.on("changed",this.backward)))}function Vt(t){for(var e=t.getParent();e;){if(e.constructor.__extag_component_class__)return e;e=e.getParent()}}function Lt(t,e,n){var i;function s(){i=!0}for(var r=null,o=e,a=[o];e;){i||(e.emit("throwed",{targets:a.slice(0),target:o,phase:n,error:t,stop:s}),i&&(r=e));var c=Vt(e);if(!c){if(e.emit("error",{targets:a.slice(0),target:o,solver:r,phase:n,error:t}),!r)throw F.error("Unsolved error in phase `"+n+"` from ",o),t;break}e=c,a.push(c)}}N({constructor:Wt,extends:Ct,mixins:[Tt.prototype],statics:{__extag_element_class__:!0,initialize:function(t,e,n,i){Ct.initialize(t,1,n,e),Wt.defineMembers(t),i&&t.assign(i)},defineMembers:function(t){var e=t.constructor.prototype;"classes"in e||(O(e,"style",{get:function(){return this._style||(this._style=new wt(this)),this._style}}),O(e,"classes",{get:function(){return this._classes||(this._classes=new wt(this)),this._classes}}))}},update:function(){if(0==(8&this.$flag))return!1;zt.transferProps(this),0==(this.$flag&p)&&(this.$flag|=p,gt.insertDigestQueue(this))},digest:function(){if(0==(this.$flag&p))return!1;this.$skin&&7&this.$flag&&(Ct.getViewEngine(this).renderShell(this.$skin,this),it.clean(this),this._style&&it.clean(this._style),this._classes&&it.clean(this._classes),this._commands&&(this._commands=null),this.$flag&=-8);this.$skin&&!1&this.$flag&&(this.$flag|=g),this.$flag&=-25}}),N({constructor:Yt,statics:{record:function(t,e){var n=t._bindings;n?n.push(e):O(t,"_bindings",{value:[e],writable:!1,enumerable:!1,configurable:!0})},remove:function(t,e){var n=t._bindings;n&&n.length&&n.splice(n.lastIndexOf(e),1)},create:function(t,e,n,i,s){return new Yt(t,e,n,i,s)},destroy:function(t){var e=t.target,n=t.scope;"function"==typeof t.reflect&&e.off("changed",t.backward),"function"==typeof t.collect&&t.keys&&n.off("updating",t.execute),mt(t)}},destroy:function(){var t=this.target,e=this.scope;"function"==typeof this.reflect&&t.off("changed",this.backward),"function"==typeof this.collect&&this.keys&&e.off("updating",this.execute),mt(this)},execute:function(){if(0!==this.flag){vt(this);var t=this.collect.call(this.scope);yt(),this.target.set(this.property,t),this.flag=0}},backward:function(t){t===this.property&&this.reflect.call(this.scope,this.target[this.property])},invalidate:function(t){0<=this.keys.indexOf(t)&&(this.scope.invalidate(),this.flag=1)}});var Rt=Ct.prototype;function Ut(t,e,n){Ut.initialize(this,t,e,n)}function Qt(t,e,n){Qt.initialize(this,t,e,n)}function Ft(t,e,n){Ft.initialize(this,t,e,n)}function Gt(t,e,n){Gt.initialize(this,t,e,n)}N({constructor:Ut,extends:Ct,mixins:[Tt.prototype],statics:{__extag_component_class__:!0,destroy:function(t){64&t.$flag||(t.emit("destroying"),Ct.destroy(t))},initialize:function(e,t,n,i){var s=e.constructor,r=s.prototype,o=s.attributes,a=s.__extag_template__;K.applyAttributeDescriptors(r,o);var c,l=K.getAttributeDefaultValues(e);if(e._props=l,!a)try{if(s.template||(s.template="<x:frag></x:frag>"),"string"==typeof s.template)a=zt.parseHTMX(s.template,r);else{if("function"!=typeof s.template)throw new TypeError("The static template must be string or function");a=zt.parseJSX(s.template,r)}a&&(s.__extag_template__=a)}catch(t){Lt(t,e,"parsing")}if(Ct.initialize(e,"x:frag"!==a.tag?1:u,a.tag,a.ns||""),Wt.defineMembers(e),n&&n[0].context?(c=e.setup(n[0].context),null==e.context&&(e.context=n[0].context)):c=e.setup(),null!=c){if("object"!=typeof c)throw new TypeError("setup() should return object, not "+typeof c);for(var f in c){var h=T(c,f);h.get||h.set?O(e,f,h):e[f]=h.value}}try{zt.driveComponent(e,n,i,t,a)}catch(t){Lt(t,e,"building")}try{e.emit("created")}catch(t){Lt(t,e,"created")}}},get:function(t){var e=K.getAttrDesc(this,t);return e?(_t(this,t),e.get?e.get.call(this,this._props):this._props[t]):this._props[t]},set:function(t,e){var n=K.getAttrDesc(this,t);if(!n)return Rt.set.call(this,t,e);var i,s=this._props;n.get?n.set&&(i=n.get.call(this,s),n.set.call(this,e,s),i!==(e=n.get.call(this,s))&&(this.invalidate(),this.emit("changed",t,e))):(i=s[t])!==e&&(s[t]=e,this.invalidate(),this.emit("changed",t,e))},bind:function(t,e,n,i){Yt.create(this,t,e,n,i)},setup:function(t){t&&(this.context=t)},update:function(){if(0!=(8&this.$flag)){try{this.emit("updating")}catch(t){Lt(t,this,"updating")}var t=this.$meta.type;if(0!==t&&1&this.$flag&&zt.transferProps(this),this.render&&"function"==typeof this.render){var e=this.render(this._props)||[];Array.isArray(e)||(e=[e]),zt.driveChildren(this,[this],e,!1,!0)}if(it.clean(this,"contents"),0==(this.$flag&p)){if(0===t&&this._parent&&2&this.$flag){var n=this.getParent(!0);n.$flag|=2,0==(n.$flag&p)&&(n.$flag|=p,gt.insertDigestQueue(n))}this.$flag|=p,gt.insertDigestQueue(this)}}},digest:function(){if(0!=(this.$flag&p)){if(this.$skin&&0!==this.$meta.type&&7&this.$flag)Ct.getViewEngine(this).renderShell(this.$skin,this),it.clean(this),this._style&&it.clean(this._style),this._classes&&it.clean(this._classes),this.__style&&it.clean(this.__style),this.__classes&&it.clean(this.__classes),this._commands&&(this._commands=null),this.$flag&=-8;var t=this._actions;if(!1&this.$flag){if(0===this.$meta.type){var e=Tt.findParent(!0);e&&e.$skin&&(this.$flag|=g)}else this.$skin&&(this.$flag|=g);t&&t.mounted&&this.$flag&g&&gt.pushCallbackQueue(function(){try{this.emit("mounted")}catch(t){Lt(t,this,"mounted")}}.bind(this))}t&&t.updated&&gt.pushCallbackQueue(function(){try{this.emit("updated")}catch(t){Lt(t,this,"updated")}}.bind(this)),this.$flag&=-25}},getContents:function(){return this._contents},setContents:function(t){this._contents!==t&&(this._contents=t,this.emit("changed","contents",t))},addNamedPart:function(t,e){this[t]=e}}),N({constructor:Qt,extends:Ut,statics:{initialize:function(t,e,n,i){var s=i&&i.props&&i.props.name;if(Ut.initialize(t,e,n,{props:{name:s||""}}),n[0].on("updating",t.onScopeUpdating.bind(t)),i.children){var r=i.children.slice(0);r.scopes=n,t.set("contents",r)}t.scopes=n},template:"<x:frag></x:frag>"},update:function(){if(this.hasDirty("collection")||this.hasDirty("contents")){var t=this.scopes,e=this.get("contents"),n=this.get("collection");n&&n.length?(t=n.scopes,zt.driveChildren(this,t,n,!!t)):e&&e.length?(t=e.scopes,n=e.slice(0),zt.driveChildren(this,t,n,!!t)):this.setChildern([]),Ut.prototype.update.call(this)}},onScopeUpdating:function(){var t,e,n,i,s,r,o=this.scopes;if(o[0].hasDirty("contents")){if(r=[],(s=o[0].get("contents"))&&0<s.length)for(e=this.get("name")||"",i=0,n=s.length;i<n;++i)null!=(t=s[i])&&e===(t.slot||"")&&r.push(t);this.set("collection",r)}}}),N({constructor:Ft,extends:Ut,statics:{template:"<x:frag></x:frag>",initialize:function(t,e,n,i){var s=i&&i.props&&i.props.xtype;Ut.initialize(t,e,n,{props:{xtype:s}}),t.cache=new wt(t),t.template=D({},i),t.template.props=D({},i.props),delete t.template.props.xtype,t.scopes=n,t.invalidate(),t.on("updating",t.onUpdating.bind(t))}},onUpdating:function(){var t,e,n,i=this.cache,s=this.scopes,r=this.template;if(this.hasDirty("xtype"))if("function"==typeof(n=this.get("xtype")))if(n.__extag_component_class__)i.set("xctor",e);else{var o=this,a=n();"object"==typeof a&&a instanceof Promise?a.then(function(t){i.set("xctor",t)}).catch(function(t){i.set("xctor",null),o.emitError(t)}):(i.set("xctor",null),o.emitError())}else i.set("xctor",null),o.emitError();if(i.hasDirty("xctor")){if("function"!=typeof(e=i.get("xctor"))||!e.__extag_component_class__)return void this.setChildren([]);try{r.tag="?",r.type=e,t=zt.createContent(r,s),this.setChildren([t])}catch(t){this.setChildren([]),this.emitError(t)}}it.clean(i)},emitError:function(t){t||(t=new TypeError("`"+this.get("xtype")+"` is not a component class, constructor or a function that returns promise!")),t instanceof Error&&this.emit("error",t)}}),N({constructor:Gt,extends:Ct,mixins:[Tt.prototype],statics:{__extag_fragment_class__:!0,initialize:function(t,e,n,i){Ct.initialize(t,0,"x:frag",""),(t.scopes=n)&&i&&i.connect("children",t,n)}},update:function(){if(0!=(8&this.$flag)){if(this.scopes&&this.hasDirty("children")){it.clean(this,"children");var t=this.get("children")||[];Array.isArray(t)||(t=[t]),zt.driveChildren(this,this.scopes,t,!1)}if(0==(this.$flag&p)){if(this._parent&&2&this.$flag){var e=this.getParent(!0);e.$flag|=2,0==(e.$flag&p)&&(e.$flag|=p,gt.insertDigestQueue(e))}this.$flag|=p,gt.insertDigestQueue(this)}}},digest:function(){if(0==(this.$flag&p))return!1;this.$flag&=-25,it.clean(this)}});var Xt={ASSIGN:-1,ONE_TIME:0,ONE_WAY:1,TWO_WAY:2,ANY_WAY:3};function Zt(t,e,n){var i=t.path,s=n.indexOf(i[0]);t.sourceProp=i[i.length-1],t.source=0<=s?y.search(i.slice(1,i.length-1),e[s],!0):y.search(i.slice(1,i.length-1),e[0].constructor.resources,!0)}function qt(t){this.mode=t.mode,this.path=t.path,this.paths=t.paths,this.evaluator=t.evaluator,this.converters=t.converters,this.identifiers=t.identifiers}function Ht(t){this.pattern=t}function Jt(t){return{once:0<=t.indexOf("once"),capture:0<=t.indexOf("capture"),passive:0<=t.indexOf("passive")}}function Bt(t,e){"object"==typeof e&&e&&t&&t.length&&(0<=t.indexOf("stop")&&e.stopPropagation&&e.stopPropagation(),0<=t.indexOf("prev")&&e.preventDefault&&e.preventDefault())}function Kt(t,e){this.binding=t,this.pattern=e}function te(t){for(var e=this.pieces=[],n=0;n<t.length;++n)"object"==typeof t[n]?e.push(new Kt(qt,t[n])):e.push(t[n])}function ee(t,e){this.func=t,this.expr=e}function ne(t,e){var n=t._bindings,i=e.length;if(n)for(var s=0;s<n.length;++s){var r=n[s],o=r.scopes;o&&o.length===i&&o[i-1]!==e[i-1]&&r.replace(e)}}function ie(t,e,n){ie.initialize(this,t,e,n)}function se(t,e,n,i){var s,r,o=t._events;if(o)for(s in o)"function"==typeof(r=o[s])?t.off(name,r):Array.isArray(r)&&t.off(s,r[0],r[1]);if(n)for(s in n)r=n[s],i&&r instanceof Kt?r.connect(s,t,e):"function"==typeof r?t.on(s,r):Array.isArray(r)&&t.on(s,r[0],r[1]);t._events=n}function re(t,e,n,i){var s,r,o,a=t._props;if(a)if(t instanceof Ut)for(s in a)n&&s in n||((r=K.getAttrDesc(t,s))?t.set(s,K.getAttributeDefaultValue(r)):t.set(s,null));else for(s in a)n&&s in n||t.set(s,null);if(n)for(s in n)o=n[s],i&&o instanceof Kt?o.connect(s,t,e):t.set(s,o)}function oe(t,e){var n=t.$meta;return n.type===a&&e.__extag_node__!==d||t.__extag_key__===e.xkey&&(e.type?t.constructor===e.type:n.tag===e.tag&&n.ns===e.ns)}function ae(t,e,n){fe(e)?(re(t,n,e.props),se(t,n,e.events),he(t,n,e.children,t instanceof Ut)):t.set("content",e)}function ce(t,e){if(!fe(t))return new It(t);var n,i,s,r=t.useExpr;return t.xif||t.xfor||t.xtype?s=new ie(null,e,t):r&&t.type===Kt?(i=t.expr).binding===qt&&"frag"===i.pattern.target?s=new Gt(null,e,i):(s=new It(""),i.connect("content",s,e)):"!"!==t.tag&&((n=t.type)?s=new n(null,e,t):(s=new Wt(t.ns?t.ns+":"+t.tag:t.tag),t.events&&se(s,e,t.events,r),t.props&&re(s,e,t.props,r),t.style&&re(s.style,e,t.style,r),t.classes&&re(s.classes,e,t.classes,r),t.children&&he(s,e,t.children,r)),s&&t.name&&(s.$owner=e[0],e[0].addNamedPart(t.name,s))),s}function le(t,e,n){var i,s;i=n._children||m,(s=t||m).length&&(s=function t(e,n,i){var s,r,o=e.length;if(!n)for(s=0;s<o;++s)if(Array.isArray(e[s])){n=[];break}if(n)for(s=0;s<o;++s)r=e[s],Array.isArray(r)?t(r,n,i):(n.push(r),i&&fe(r)&&!r.ns&&(r.ns=i));else for(s=0;s<o;++s)r=e[s],i&&fe(r)&&!r.ns&&(r.ns=i);return n||e}(s,null,n.$meta.ns));for(var r,o,a,c,l=new Array(s.length),f=0,h=i.length-1,u=0,p=s.length-1,g=i[f],d=i[h],v=s[u],y=s[p];f<=h&&u<=p;)if(null==g)g=i[++f];else if(null==d)d=i[--h];else if(oe(g,v))ae(l[u]=g,v,e),g=i[++f],v=s[++u];else if(oe(d,y))ae(l[p]=d,y,e),d=i[--h],y=s[--p];else if(oe(g,y))ae(l[p]=g,y,e),g=i[++f],y=s[--p];else if(oe(d,v))ae(l[u]=d,v,e),d=i[--h],v=s[++u];else{if(!o)for(o={},c=f;c<=h;++c)(a=i[f].__key__)&&(o[a]=c);if(null!=(c=(a=v.xkey)&&o[a])&&oe(i[c]||_,v))l[u]=i[c];else{if(!(r=ce(v,e)))throw new Error("Can not create content from ",v);l[u]=r}v=s[++u]}if(h<f)for(;u<=p;){if(!(r=ce(v,e)))throw new Error("Can not create content from ",v);l[u]=r,v=s[++u]}return l}function fe(t){return"object"==typeof t&&t.__extag_node__===d}function he(t,e,n,i,s){var r;s?((r=n.slice(0)).scopes=e,t.set("contents",r)):(r=i?function(t,e){var n,i,s,r=[];if(t&&t.length)for(n=0,i=t.length;n<i;++n)(s=ce(t[n],e))&&r.push(s);return r}(n,e):le(n,e,t),t.setChildren(r))}function ue(t){var e=typeof t;if("object"===e)return t;if("string"===e){var n,i,s,r,o,a={},c=t.split(";");for(s=c.length-1;0<=s;--s)0<(i=(n=c[s]).indexOf(":"))&&(r=n.slice(0,i).trim(),o=n.slice(i+1).trim(),a[r]=o);return a}}function pe(t){var e=typeof t;if("object"===e)return t;if("string"===e&&(t=t.trim().split(b)),Array.isArray(t)){var n,i={};for(n=0;n<t.length;++n)t[n]&&(i[t[n]]=!0);return i}}function ge(t,e){var n=t[e];return n||(n=new wt(t),t[e]=n),n}function de(t){var e,n;if(t.$meta.type!==a&&(t.hasDirty("style")&&(it.clean(t,"style"),e=ue(t.get("style")),t.style.reset(e)),t.hasDirty("class")&&(it.clean(t,"class"),n=pe(t.get("class")),t.classes.reset(n)),t.__props&&t.constructor.__extag_component_class__)){var i=t.__props;if(i.hasDirty("style")){var s=ge(t,"__style");it.clean(i,"style"),e=ue(e=i.get("style")),s.reset(e)}if(i.hasDirty("class")){var r=ge(t,"__classes");it.clean(i,"class"),n=pe(n=i.get("class")),r.reset(n)}}}N({constructor:qt,statics:{MODES:Xt,create:function(t){return new qt(t)}},connect:function(t,e,n){this.flag=0,this.scopes=n,this.target=e,this.targetProp=t,this.mode!==Xt.ASSIGN?(this.execute=this.execute.bind(this),this.invalidate=this.invalidate.bind(this),this.mode===Xt.TWO_WAY&&(this.backward=this.backward.bind(this),Zt(this,n,this.identifiers),K.getAttrDesc(this.target,this.targetProp)&&this.target.on("changed",this.backward)),this.mode===Xt.ANY_WAY?(this.scopes[0].on("updating",this.execute),this.target.set(this.targetProp,this.evaluate())):(this.flag=1,this.execute(),this.keys&&this.keys.length&&n[0].on("updating",this.execute)),Yt.record(e,this)):this.target.set(this.targetProp,this.evaluate())},replace:function(t){1<t.length&&t.length===this.scopes.length&&(this.mode===Xt.TWO_WAY&&Zt(this,t,this.identifiers),this.scopes=t,this.flag=1,this.execute())},destroy:function(){var t=this.scopes;this.mode===Xt.TWO_WAY&&K.getAttrDesc(this.target,this.targetProp)&&this.target.off("changed",this.backward),this.keys&&this.keys.length&&t[0].off("updating",this.execute),mt(this)},evaluate:function(){var t=this.converters;return t&&t.length?function(t,e,n){for(var i=0;i<t.length;++i)n=t[i].execute(e,n);return n}(t,this.scopes,this.evaluator.execute(this.scopes)):this.evaluator.execute(this.scopes)},execute:function(){if(this.mode!==Xt.ANY_WAY){if(0!==this.flag){vt(this);var t=this.evaluate();yt(),this.target.set(this.targetProp,t),this.flag=0,this.mode===Xt.ONE_TIME&&this.destroy()}}else this.target.set(this.targetProp,this.evaluate())},backward:function(t){if(t===this.targetProp){var e=this.target[this.targetProp];this.source.set(this.sourceProp,e)}},invalidate:function(t){0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}}),N({constructor:Ht,statics:{create:function(t){return new Ht(t)}},connect:function(t,e,n){this.type=t,this.target=e;var i=this.pattern,s=i.handler,r=i.evaluator,o=i.modifiers;if(s){var a=n[0][s];if(!a)return;o&&o.length?"bind"===o[0]&&1===o.length?this.handler=a.bind(n[0]):(this.handler=function(t){Bt(o,t),0<=o.indexOf("bind")?a.apply(n[0],arguments):a.apply(null,arguments)},this.options=Jt(o)):this.handler=a}else n.length<=1?o&&o.length?(this.handler=function(t){Bt(o,t),r.execute(n)},this.options=Jt(o)):this.handler=function(){r.execute(n)}:(this.scopes=n,o&&o.length?(this.handler=function(t){Bt(o,t),r.execute(this.scopes)}.bind(this),this.options=Jt(o)):this.handler=function(){r.execute(this.scopes)}.bind(this));this.handler&&(this.options?e.on(t,this.handler,this.options):e.on(t,this.handler),Yt.record(e,this))},replace:function(t){this.scopes&&1<t.length&&this.scopes.length===t.length&&(this.scopes=t)},destroy:function(){var t=this.handler;t&&(this.options?this.target.off(this.type,t,this.options):this.target.off(this.type,t))}}),N({constructor:Kt,connect:function(t,e,n){this.binding.create(this.pattern).connect(t,e,n)}}),N({constructor:te,statics:{create:function(t){return new te(t)}},connect:function(t,e,n){var i,s,r,o=this.pieces;this.scopes=n,this.target=e,this.property=t;var a=this.cache=new wt(n[0]);for(i=0,s=o.length;i<s;++i)(r=o[i])instanceof Kt?r.connect(i,a,n):a.set(i,r);a.set("length",s),this.execute(),this.execute=this.execute.bind(this),n[0].on("updating",this.execute),Yt.record(e,this)},replace:function(t){var e=this.cache._bindings;if(e)for(var n=0;n<e.length;++n)e[n].replace(t)},destroy:function(){this.scopes[0].off("updating",this.execute);var t=this.cache._bindings;if(t){for(var e=t.length-1;0<=e;--e)t[e].destroy();t.length=0}},execute:function(){var t=this.cache;if(t.hasDirty()){var e=E.call(t._props,0);this.target.set(this.property,e.join("")),it.clean(t)}}}),N({constructor:ee,execute:function(t,e){var n=t.slice(1);return 1<arguments.length&&n.push(e),this.func.apply(t[0],n)}}),N({constructor:ie,extends:Ut,statics:{initialize:function(t,e,n,i){(Ut.initialize(t,e),t.mode=0,i)&&(t.scopes=n,t.template=D({},i),delete t.template.xtype,delete t.template.xkey,delete t.template.xfor,delete t.template.xif,t.set("condition",!0),i.xif&&(t.mode=1,i.xif.connect("condition",t,n)),i.xfor&&(t.mode=2,i.xfor[1].connect("iterable",t,n),i.xkey&&(t.keyEval=i.xkey)),i.xtype&&(t.xtype=!0,i.xtype.connect("component",t,n)),t.on("updating",t.onUpdating.bind(t)))},template:"<x:frag></x:frag>"},onUpdating:function(){if(this.mode){var t=this.get("condition"),e=this.get("component"),n=this.template,i=this.scopes,s=[];if(t){if(this.xtype){if(!e||!e.__extag_component_class__)return void this.setChildren(s);n=D({},n,{type:e})}if(1===this.mode)return(o=zt.createContent(n,i,!0))&&s.push(o),void this.setChildren(s);var r,o,a,c,l,f,h,u={},p=this.get("iterable")||[],g=this._children||[],d=this.keyEval;for(f=0,l=g.length;f<l;++f)(c=g[f].__key__)&&(u[c]=f);for(f=0,l=p.length;f<l;++f)o=c=null,a=p[f],h=i.concat([a]),d&&null!=(r=u[c=d.execute(h)])&&(o=g[r]),o?ne(o,h):(o=zt.makeContent(n,h)).__key__=c,s.push(o);this.setChildren(s)}else this.setChildren(s)}}}),zt.makeContent=ce,zt.createContent=ce,zt.driveChildren=he,zt.driveEvents=se,zt.driveProps=re,zt.driveComponent=function(t,e,n,i,s){var r;if(n&&e?(r=n.useExpr,i&&n.props?i=D({},n.props,i):!i&&n.props&&(i=n.props),re(t,e,i,r),n.events&&se(t,e,n.events,r),r&&(n.style&&re(t.style,e,n.style,r),n.classes&&re(t.classes,e,n.classes,r)),n.children&&he(t,e,n.children,r,!0)):i&&re(t,e,i),s){var o=[t];r=s.useExpr,s.events&&se(t,o,s.events,r),s.props&&(t.__props=new wt(t),re(t.__props,o,s.props,r)),r&&(s.style&&(t.__style=new wt(t),re(t.__style,o,s.style,r)),s.classes&&(t.__classes=new wt(t),re(t.__classes,o,s.classes,r))),s.children&&he(t,o,s.children,r)}},zt.transferProps=de,zt.transferProperties=de;var ve=/[\w).+\-_$\]]/,ye="abstract arguments boolean break byte case catch char class const continue debugger default delete do double else enum eval export extends false final finally float for function goto if implements import in instanceof int interface let long native new null package private protected public return short static super switch synchronized this throw throws transient true try typeof undefined var void volatile while with yield isNaN isFinite parseFloat parseInt Array Date Infinity Math NaN Number Object String Boolean RegExp JSON",_e={};function me(t,e){for(var n,i=t.length;e<i;){if(!(32===(n=t.charCodeAt(e))||9<=n&&n<=13))return 44!==n&&123!==n;--e}}function xe(t,e){for(var n,i,s,r=t.length;e<r;)if(32===(n=t.charCodeAt(e))||9<=n&&n<=13)s=!0,++e;else{if(46===n)i&&M("Unexpected token '.'.",{code:1001,expr:t}),i=!(s=!1);else{if(!(be(n)||48<=n&&n<=57)){i&&M("Unexpected token '"+t[e]+"'.",{code:1001,expr:t});break}if(s&&!i){--e;break}i=s=!1}++e}return e}function be(t){return 97<=t&&t<=122||65<=t&&t<=90||95===t||36===t}function we(t,e,n){for(var i=n.length;e<i;){if(n.charCodeAt(e)===t&&92!==n.charCodeAt(e-1))return e;++e}return i}!function(){for(var t=ye.split(/\s+/),e=0,n=t.length;e<n;++e)_e[t[e]]=!0}();var Ae={parse:function(t,e,n){var i,s,r,o=n.slice(1),a=0,c=[],l=function(t){for(var e,n,i,s,r=[],o=t.length,a=-1;a<o;)if(n=e,32===(e=t.charCodeAt(a))||9<=e&&e<=13)++a;else{switch(e){case 39:case 34:(a=we(e,a+1,t))===o&&M("Unclosed "+t[a]+".",{code:1001,expr:t});break;case 47:for(s=a-1;0<=s&&(32===(i=t.charCodeAt(s))||9<=i&&i<=13);--s);i&&ve.test(String.fromCharCode(i))||(a=we(e,a+1,t))===o&&M("Unclosed "+t[a]+".",{code:1001,expr:t});break;default:if(46===n){a=xe(t,a+1);continue}if(be(e)){s=xe(t,a+1),58!==t.charCodeAt(s)?r.push(a,s):me(t,a-1)&&r.push(a,s),a=s;continue}}++a}return r}(t),f=e.constructor.resources;for(r=0;r<l.length;r+=2)l[r+1]<0||(i=t.slice(l[r]+a,l[r+1]+a),s=y.parse(i.replace(w,"")),C.call(_e,s[0])||n.indexOf(s[0])<0&&(f&&C.call(f,s[0])?c.push("var "+s[0]+" = this.constructor.resources."+s[0]+";"):(t=t.slice(0,l[r]+a)+"this."+i+t.slice(l[r+1]+a),a+=5)));c.push("return "+t),o.push(c.join("\n"));try{return new ee(Function.apply(null,o),arguments[0])}catch(t){M(t,{code:1001,expr:arguments[0],desc:"Illegal expression `"+arguments[0]+"`."})}}},ke=qt.MODES;function $e(t,e){for(var n="$"+e.length;0<=t.indexOf(n);)n="$"+n;return n}var Ee={parse:function(t,e,n){var i,s,r,o,a,c,l,f=-1,h=t.length;if(t[0]===x.TWO_WAY?(f=ke.TWO_WAY,t=t.slice(1,h)):t[h-1]===x.ANY_WAY?(f=ke.ANY_WAY,t=t.slice(0,h-1)):t[h-1]===x.ASSIGN?(f=ke.ASSIGN,t=t.slice(0,h-1)):t[h-1]===x.ONE_TIME?(f=ke.ONE_TIME,t=t.slice(0,h-1)):f=ke.ONE_WAY,f===ke.TWO_WAY)y.test(t.trim())||M("",{code:1001,expr:arguments[0],desc:"`"+arguments[0]+"` is not a valid two-way binding expression. Must be a property name or path."}),(l=y.parse(t.trim()))[0]in e&&n.indexOf(l[0])<0&&l.unshift("this"),o=Ae.parse(t,e,n);else if(t.indexOf(x.CONVERTER)<0)o=Ae.parse(t,e,n);else if(a=t.split(x.CONVERTER),o=Ae.parse(a[0],e,n),1<a.length)for(i=1;i<a.length;++i){(c=a[i].trim())||M("Converter must not be empty!",{code:1001,expr:arguments[0],desc:"Empty converter in the expression `"+arguments[0]+"` is not allowed."});var u=$e(t,n),p=c.indexOf("(");if(0<p)c=c.slice(0,p+1)+u+","+c.slice(p+1);else{if(c.indexOf(".")<0&&n.indexOf(c)<0){var g=e.constructor.resources;if(g){var d=y.search(c,g);if("function"==typeof d){(s=s||[]).push(new ee(d,c));continue}}}c=c+"("+u+")"}r=Ae.parse(c,e,n.concat([u])),(s=s||[]).push(r)}var v={mode:f,evaluator:o};return f===ke.TWO_WAY?(v.identifiers=n,v.path=l):s&&s.length&&(v.converters=s),v}},Oe={parse:function(t,e,n){var i=t.indexOf(x.MODIFIER)<0?[t]:t.split(x.MODIFIER);i[0]=i[0].trim();var s={};if($.test(i[0])?s.handler=i[0].replace(k,""):s.evaluator=Ae.parse(i[0],e,n),1<i.length){for(var r=[],o=1;o<i.length;++o)r.push(i[o].trim());s.modifiers=r}return s}};function Ce(t){var e=typeof t;return"object"===e&&t.__extag_expr__===Kt?t.args:"string"===e||"function"===e?[t]:Array.isArray(t)?t:void 0}function Te(t,e){var n,i,s,r,o=t.props;if(t.xif&&(r=Ce(t.xif),t.xif=Pe(r,t,e)),t.xfor&&(r=Ce(t.xfor[1]),t.xfor[1]=Pe(r,t,e),t.identifiers=t.identifiers.concat([t.xfor[0]])),t.xkey&&(r=Ce(t.xkey),t.xkey=Pe(r,t,e)),o)for(i in o)"object"==typeof(n=o[i])&&n.__extag_expr__===Kt&&(o[i]=Pe(n.args,t,e));if(t.type&&"string"==typeof t.type&&("function"==typeof(s=y.search(t.type,e.constructor.resources))&&s.__extag_component_class__||M("Can not find such component type `"+Me+"`"),t.type=s),null==t.type&&A.test(t.tag)&&"function"==typeof(s=y.search(t.tag,e.constructor.resources))&&s.__extag_component_class__&&(t.type=s),null==t.type)switch(t.tag){case"x:slot":t.type=Qt;break;case"x:frag":t.type=Gt;break;case"x:output":t.type=Ft}t.events&&function(t,e){var n,i,s,r,o=t.events;for(n in o)r=o[n],s=Ce(r),(i=Ne(s,e,t.identifiers))&&(o[n]=i)}(t,e)}function De(t,e,n){var i=typeof t;return"string"===i?Oe.parse(t,e,n):"function"===i?new ee(t):void M("evaluator must be string or function")}function Pe(t,e,n){var i,s=typeof t[0];if(1===t.length)return"string"===s?new Kt(qt,Ee.parse(t[0],n,e.identifiers)):"function"===s?new Kt(qt,{mode:1,evaluator:De(t[0],n,e.identifiers)}):t[0];if("{"===t[0]&&"}"===t[t.length-1]&&(t=t.slice(1,2),i="frag"),"@"===t[0])return new Kt(qt,{mode:2,path:t[1],evaluator:De(t[2]),identifiers:e.identifiers});var r=1;switch(t[t.length-1]){case"?":t=t.slice(0,-1),r=0;break;case"!":t=t.slice(0,-1),r=-1;break;case"^":t=t.slice(0,-1),r=3}return new Kt(qt,{mode:r,target:i,evaluator:De(t[1],n,e.identifiers),converters:2===t.length?null:function(t,e,n){for(var i=0;i<t.length;++i)t[i]=De(t[n])}(t.slice(2),0,e.identifiers)})}function Ne(t,e,n){var i,s=typeof t[0];return(i="string"===s&&1===t.length?Oe.parse(t[0],n,e.identifiers):"function"===s?{evaluator:new ee(t[0]),modifiers:1<t.length?t.slice(1):null}:null)?new Kt(Ht,i):null}var Se={xns:!0,xif:!0,xfor:!0,xkey:!0,xname:!0,xslot:!0,xtype:!0,events:!0};function je(t,e,n){var i,s,r={__extag_node__:d},o=typeof t;if("string"===o){var a=t.indexOf(":");if(a<0)r.ns="",r.tag=t;else{if("x"===t.slice(0,a))switch(t){case"x:slot":r.tag=t,r.type=Qt;break;case"x:frag":r.tag=t,r.type=Gt;break;case"x:output":r.tag=t,r.type=Ft}r.type||(r.ns=t.slice(0,a),r.tag=t.slice(a+1))}}else"function"===o&&t.__extag_component_class__?r.type=t:M("The first argument must be string, component class or constructor.");if(null!=e)for(s in e.xns&&(r.ns=e.xns),e.xif&&(r.xif=e.xif),e.xfor&&(r.xfor=e.xfor),e.xkey&&(r.xkey=e.xkey),e.xname&&(r.name=e.xname),e.xslot&&(r.slot=e.xslot),e.xtype&&(r.type?r.type===Ft&&(r.props={xtype:e.xtype}):r.type=e.xtype),e.events&&(r.events=e.events),i=r.props?r.props:r.props={},e)!Se[s]&&C.call(e,s)&&(i[s]=e[s]);return n&&(n=3<arguments.length||Array.isArray(n)?function t(e,n){var i,s=e.length;if(!n)for(i=0;i<s;++i)if(Array.isArray(e[i])){n=[];break}if(n)for(i=0;i<s;++i){var r=e[i];Array.isArray(r)?t(r,n):n.push(r)}return n||e}(n=E.call(arguments,2)):[n],r.children=n),r}function Me(){return{args:E.call(arguments,0),__extag_expr__:Kt}}var Ie={node:je,expr:Me,parse:function(t,e){var n=t(je,Me);return n.identifiers=["this"],Te(n,e),function t(e,n){var i,s,r=e.children;if(r&&r.length)for(i=r.length-1;0<=i;--i)if("object"==typeof(s=r[i])){if(s.__extag_node__===d){s.useExpr=!0,s.identifiers=e.identifiers,Te(s,n),t(s,n);continue}s.__extag_expr__===Kt&&(r[i]={__extag_node__:d,useExpr:!0,type:Kt,expr:Pe(s.args,e,n)})}}(n,e),n.type?"x:frag"===n.tag?n.type=null:"x:slot"===n.tag||"x:view"===n.tag?M(n.tag+" can not be used as root tag of component template."):M("component can not be used as root tag of another component template."):(n.xif||n.xfor||n.xkey)&&M("`xif`, `xfor`, `xkey` can not be used on root tag of component template."),n}};zt.parseJSX=Ie.parse;var ze={tryParse:function(t){return"false"!==t&&("true"===t||(isNaN(t)?void 0:Number(t)))}},We=/\s*\n\s*/g,Ye=new RegExp(x.DATA+"\\"+"{}"[0]+"(\\s|.)*?\\"+"{}"[1]),Ve={like:function(t){return Ye.test(t)},parse:function(t,e,n){var i,s,r,o,a,c,l,f,h,u,p=[],g=0,d=0;for(i=0,s=t.length;i<s;++i)f=l,l=t.charCodeAt(i),c?125!==l||o||a?39===l?o?92!==f&&(o=!1):o=!0:34===l?a?92!==f&&(a=!1):a=!0:123!==l||o||a||++d:0===--d&&(g<r&&(u=(u=t.slice(g,r)).replace(We," "))&&(u=j(u),p.push(u)),123===t.charCodeAt(r+2)&&125===t.charCodeAt(i-1)?(h=Ee.parse(t.slice(r+3,i-1),e,n)).target="frag":(h=Ee.parse(t.slice(r+2,i),e,n)).target="text",p.push(h),g=r=i+1,c=!1):64===f&&123===l&&(c=!0,r=i-1,d=1);return 0<g&&g<s&&(u=(u=t.slice(g,s)).replace(We," "))&&(u=j(u),p.push(u)),p.length?p:null}},Le=/;/g,Re=/^[a-z0-9\-_]+$/i,Ue={parse:function(t,e,n,i){var s,r,o,a,c,l,f,h,u={},p=t.split(Le);for(l=0,c=p.length;l<c;++l)if((h=(r=p[l].trim()).indexOf(":"))<0){if(r=r.trim())for(a=r.split(b),f=0;f<a.length;++f)u[a[f]]=!0}else{o=r.slice(0,h).trim(),t=r.slice(h+1).trim(),o&&Re.test(o)||M("Illegal "+(i?"x:style":"x:class")+" expression.",{code:1001,expr:o||arguments[0]});try{if(!Ve.like(t)){u[o]=i?t:ze.tryParse(t);continue}s=Ve.parse(t,e,n)}catch(t){throw t}s?1===s.length?u[o]=new Kt(qt,s[0]):i?u[o]=new Kt(te,s):M("Illegal x:class expression.",{code:1001,expr:t}):u[o]=i?t:ze.tryParse(t)}return u}},Qe=/^([_$\w]+)\s+of\s+(.+)$/,Fe=/[a-zA-Z]/,Ge=/[\s/>]/,Xe=/[\s\/]+/,Ze=/^x:/,qe={html:"http://www.w3.org/1999/xhtml",math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};var He={"!":!0,br:!0,hr:!0,area:!0,base:!0,img:!0,input:!0,link:!0,meta:!0,basefont:!0,param:!0,col:!0,frame:!0,embed:!0,keygen:!0,source:!0,command:!0,track:!0,wbr:!0},Je={"inner-html":"innerHTML"},Be={"x:ns":!0,"x:if":!0,"x:for":!0,"x:key":!0,"x:name":!0,"x:slot":!0,"x:type":!0,"x:class":!0,"x:style":!0};function Ke(t,e){var n=t[e];return null==n&&(t[e]=n={}),n}function tn(t){return t in Je?Je[t]:t}function en(t,e,n,i,s){var r;if("x:class"===t)n.classes=Ue.parse(e,i,s,!1);else if("x:style"===t)n.style=Ue.parse(e,i,s,!0);else if("x:type"===t){var o=y.search(e,i.constructor.resources);"function"==typeof o&&o.__extag_component_class__?n.type=o:(r=Ee.parse(e,i,s),n.xtype=new Kt(qt,r))}else if("x:name"===t)n.name=e;else if("x:slot"===t)n.slot=e;else if("x:key"===t)n.xkey=Ae.parse(e,i,s);else if("x:for"===t){var a=e.trim().match(Qe);a&&a[2].trim()||M('Illegal x:for="'+e+'".',{code:1001,expr:e}),(r=Ee.parse(a[2],i,s))?n.xfor=[a[1],new Kt(qt,r)]:M('Illegal x:for="'+e+'".',{code:1001,expr:e}),n.identifiers=s.concat([a[1]])}else"x:if"===t?(r=Ee.parse(e,i,s))?n.xif=new Kt(qt,r):M('Illegal x:if="'+e+'".',{code:1001,expr:e}):"x:ns"===t&&(n.ns=e)}function nn(t,e,n,i,s){var r,o,a,c=t[t.length-1];if(null==e)return a=tn(t),void((o=Ke(n,"props"))[a]=!0);if(c===x.EVENT)o=Ke(n,"events"),a=t.slice(0,-1),r=Oe.parse(e,i,s),o[a]=new Kt(Ht,r);else switch(o=Ke(n,"props"),c){case x.DATA:a=tn(t.slice(0,-1)),r=ze.tryParse(e),o[a]=null!=r?r:new Kt(qt,r=Ee.parse(e,i,s));break;case x.TEXT:a=tn(t.slice(0,-1));try{r=Ve.parse(e,i,s)}catch(t){throw t}r?1===r.length?o[a]=new Kt(qt,r[0]):o[a]=new Kt(te,r):o[a]=e;break;default:o[a=tn(t)]=e}}function sn(t,e,n){for(var i=e.length,s=n;s<i;){if(t.test(e[s]))return s;s+=1}return-1}function rn(t,e,n,i){for(var s,r,o,a,c=e,l=e,f=e,h=t.length;c<h;){if(s=t[c],r){if(!w.test(s)){if(f=0<(f='"'===s||"'"===s?(l=c+1,t.indexOf(s,l)):sn(Ge,t,l=c))?f:h,n)try{120===(a=r).charCodeAt(0)&&a in Be?en(r,t.slice(l,f),n,i,n.identifiers):nn(r,t.slice(l,f),n,i,n.identifiers)}catch(t){throw t}if(">"===t[f])return f;r=null,l=f=c=f+1;continue}}else{if(">"===s){if(l<(f=c))for(o=t.slice(l,f).trim().split(Xe);0<o.length;)(r=o.shift())&&n&&nn(r,null,n,i,n.identifiers);return f}if("="===s){if(l<(f=c)){for(o=t.slice(l,f).trim().split(Xe);1<o.length;)(r=o.shift())&&n&&nn(r,null,n,i,n.identifiers);r=o.shift()}l=f=c=f+1;continue}}c+=1}}var on=/^\s*\n\s*/,an=/\s*\n\s*$/;function cn(t,e){return{__extag_node__:d,useExpr:!0,type:Kt,expr:new Kt(t,e)}}function ln(t,e,n,i,s,r){var o,a=i.children||[],c=t.slice(e,n);if(c=c.replace(on,"").replace(an,"")){if(Ve.like(c)){try{o=Ve.parse(c,s,r)}catch(t){throw t}if(o)if(1===o.length&&"object"==typeof o[0])a.push(cn(qt,o[0]));else{for(var l=-1,f=0,h=o.length;f<h;++f){var u=o[f];"object"==typeof u&&"frag"===u.target?(l<f&&(1<f-l?a.push(cn(te,o.slice(l,f))):"object"==typeof o[l]?a.push(cn(qt,o[l])):a.push(o[l])),a.push(cn(qt,u)),l=-1):l<0&&(l=f)}0<=l&&l<f&&(1<f-l?a.push(cn(te,o.slice(l,f))):"object"==typeof o[l]?a.push(cn(qt,o[l])):a.push(o[l]))}else a.push(j(c))}else a.push(j(c));i.children=a}}var fn=function(t,e){var n=e.constructor,i=function(t,e){var n,i,s,r,o,a,c=0,l=0,f=[],h=0,u=(t=t.trim()).length;for(r={tag:"[]",children:[],identifiers:["this"]},f.push(r);h<u;){if("<"===t[h]){if(n=t[h+1],Fe.test(n)){if(c<h&&ln(t,c,h,r,e,r.identifiers),l=sn(Ge,t,c=h+1),s=t.slice(c,l),(i={}).tag=s,i.useExpr=!0,i.__extag_node__=d,i.identifiers=r.identifiers,">"!==t[l]&&(l=rn(t,c=l+=1,i,e,i.identifiers)),i.ns||(i.props&&i.props.xmlns?i.ns=(a=i.props.xmlns)&&a!==qe.html?a===qe.svg?"svg":a===qe.math?"math":a===qe.xlink?"xlink":null:"":r.ns&&(i.ns=r.ns)),null==i.type&&Ze.test(s))switch(s){case"x:slot":i.type=Qt;break;case"x:frag":i.type=Gt}if(null==i.type&&null==i.xtype&&A.test(s)){var p=y.search(s,e.constructor.resources);"function"==typeof p&&p.__extag_component_class__&&(i.type=p)}r&&(r.children=r.children||[],r.children.push(i)),"/"===t[l-1]||(o=s,C.call(He,o))||(f.push(i),r=i),c=l=h=l+1;continue}if("/"===n&&Fe.test(t[h+2])){if(c<h&&ln(t,c,h,r,e,r.identifiers),l=sn(Ge,t,c=h+2),(s=t.slice(c,l))!==r.tag&&M("Unclosed tag "+r.tag),">"!==t[l]&&(l=rn(t,c=l+=1)),!(1<f.length))return f[0];f.pop(),0<f.length&&(r=f[f.length-1]),c=l=h=l+1;continue}if("!"===n&&"\x3c!--"===t.slice(h,h+4)){c<h&&ln(t,c,h,r,e,r.identifiers),c=h+4,l=0<(l=t.indexOf("--\x3e",c))?l:t.length,i={tag:"!",comment:t.slice(c,l),__extag_node__:d},r.children=r.children||[],r.children.push(i),c=l=h=l+3;continue}}h+=1}return c<u&&ln(t,c,u,r,e,r.identifiers),f}(t,e)[0].children,s=i[0];return 1!==i.length&&M("The template of component "+(n.fullname||n.name)+" must have only one root tag."),"!"!==s.tag&&"#"!==s.tag||M("Component template root tag must be a DOM element, instead of: "+t.slice(0,t.indexOf(">"))),s.type?"x:frag"===s.tag&&s.type===Gt?s.type=null:"x:slot"===s.tag||"x:view"===s.tag?M(s.tag+" can not be used as root tag of component template: "+t.slice(0,t.indexOf(">"))):M("component can not be used as root tag of another component template: "+t.slice(0,t.indexOf(">"))):(s.xif||s.xfor||s.xkey)&&M("`x:if`, `x:for`, `x:key` can not be used on root tag of component template: "+t.slice(0,t.indexOf(">"))),s};return zt.parseHTMX=fn,"undefined"!=typeof ExtagDOM&&$t("view-engine",ExtagDOM),{anew:G.anew,inst:G.inst,conf:function(t,e){if(1===arguments.length)return kt(t);$t(t,e)},help:function(t){return new e(t)},defineClass:N,setImmediate:gt.setImmediate,Validator:nt,Watcher:I,Model:xt,Text:It,Slot:Qt,Output:Ft,Element:Wt,Fragment:Gt,Component:Ut,node:Ie.node,expr:Ie.expr,version:"0.3.3"}});
