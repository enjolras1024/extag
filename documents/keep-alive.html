<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
    <link href="../stylesheets/codemirror.css" rel="stylesheet">
    <link href="../stylesheets/alicestyle.css" rel="stylesheet">
    <link href="../stylesheets/common.css" rel="stylesheet">

    <title>KeepAlive - Extag</title>
  </head>
  <body>
    <aside class="side-bar"></aside>
    <div class="main">
      
      <article class="article">
        <h2>KeepAlive</h2>
        <p>Extag内置KeepAlive组件，用以缓存失活的<strong>直属子内容</strong>，以便保留它们的状态，避免将其自动销毁掉。KeepAlive组件会根据<span class="expr">xkey</span>特性来复用这些子内容。在字符串模板中，</p>
        <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">KeepAlive</span><span class="cm-tag cm-bracket">&gt;</span>@{{<span class="cm-variable">render</span>()}}<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">KeepAlive</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div>
        <p>需要以上面的形式使用KeepAlive，即KeepAlive接收的contents必须是一个或一组带有不同<span class="expr">xkey</span>值的虚拟节点。而类似下面的形式不能缓存失活子内容，是因为<span class="expr">@{{render()}}</span>前后有其他内容（文本或子元素），则<span class="expr">@{{render()}}</span>处实际被替换为一个Fragment，于是<span class="expr">@{{render()}}</span>的结果不再是KeepAlive的<strong>直属子内容</strong>。</p>
        <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">&lt;KeepAlive&gt; @{{render()}} &lt;/KeepAlive&gt;</span></span></pre></div></div></div>

        <p>下面这些形式也是无效的，因为使用<span class="expr">x:if</span>和<span class="expr">x:for</span>以及动态<span class="expr">x:type</span>指令的地方，实际上是嵌入一个内置的Block组件，它本身并不具有动态改变的<span class="expr">x:key</span>。</p>
        
        <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">&lt;KeepAlive&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-comment">&lt;div x:if="state.show" x:key="state.key"&gt;&lt;/div&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">&lt;/KeepAlive&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">&lt;KeepAlive&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-comment">&lt;div x:for="item of items" x:key="item.key"&gt;&lt;/div&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">&lt;/KeepAlive&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">&lt;KeepAlive&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-comment">&lt;any x:type="state.type" x:key="state.type"&gt;&lt;/any&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">&lt;/KeepAlive&gt;</span></span></pre></div></div></div>
        <p>在渲染函数中使用KeepAlive也很方便，</p>
        <div id="code-tabs-1"></div>
        <p>下面的例子中，切换子组件Counter，指定<span class="expr">xkey</span>的a和b会被缓存，因而<span class="expr">state.count</span>的值不会丢失。而c没有指定<span class="expr">xkey</span>，就不会被缓存。</p>
        <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Counter</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Component</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-keyword">get</span> <span class="cm-property">template</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-string-2">`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-string-2">&lt;div&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string-2">&lt;button click+="onClick::bind"&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string-2">click @{label} (@{state.count})</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string-2">&lt;/button&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-string-2">&lt;/div&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-string-2">`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-keyword">get</span> <span class="cm-property">attributes</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">label</span>: <span class="cm-string">''</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">setup</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">this</span>.<span class="cm-property">state</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Model</span>({<span class="cm-property">count</span>: <span class="cm-number">0</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">onClick</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">this</span>.<span class="cm-property">state</span>.<span class="cm-property">count</span><span class="cm-operator">++</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Demo</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Component</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-keyword">get</span> <span class="cm-property">template</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-string-2">`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-string-2">&lt;div&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string-2">&lt;div style="margin: 10px 0;"&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-string-2">&lt;select change+="onChange::bind" value@="label"&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string-2">&lt;option value="a"&gt;a&lt;/option&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string-2">&lt;option value="b"&gt;b&lt;/option&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string-2">&lt;option value="c"&gt;c&lt;/option&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-string-2">&lt;/select&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string-2">&lt;/div&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string-2">&lt;KeepAlive&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-string-2">@{{render()}}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-string-2">&lt;/KeepAlive&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-string-2">&lt;/div&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-string-2">`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  } </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-keyword">get</span> <span class="cm-property">resources</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">KeepAlive</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">KeepAlive</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">setup</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">state</span>: <span class="cm-keyword">new</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Model</span>({<span class="cm-property">label</span>: <span class="cm-string">'a'</span>})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">render</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">const</span> <span class="cm-def">label</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">state</span>.<span class="cm-property">label</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-variable">Extag</span>.<span class="cm-property">node</span>(<span class="cm-variable">Counter</span>, {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">xkey</span>: (<span class="cm-variable-2">label</span> <span class="cm-operator">===</span> <span class="cm-string">'a'</span> <span class="cm-operator">||</span> <span class="cm-variable-2">label</span> <span class="cm-operator">===</span> <span class="cm-string">'b'</span>) <span class="cm-operator">?</span> <span class="cm-variable-2">label</span> : <span class="cm-atom">null</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">label</span>: <span class="cm-variable-2">label</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    })</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">onChange</span>(<span class="cm-def">event</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">this</span>.<span class="cm-property">state</span>.<span class="cm-property">label</span> <span class="cm-operator">=</span> <span class="cm-variable-2">event</span>.<span class="cm-property">target</span>.<span class="cm-property">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div>
        <p>
          <a class="link" href="https://codepen.io/enjolras1024/pen/rNWBKMK" target="_blank">
            在CodePen上尝试
          </a>
        </p>
      </article>
      <footer>
        <p>Copyright © 2017-2021 Enjolras Chen</p>
      </footer>
    </div>

    <script src="../javascripts/extag-dom.min.js"></script>
    <script src="../javascripts/extag.min.js"></script>
    <script src="../javascripts/common.js"></script>
    <script>
      new CodeTabs({
        attrs: {
          data: [
            {label: 'ES5', content: '<div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">render</span>(<span class="cm-def">props</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> (</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">Extag</span>.<span class="cm-property">node</span>(<span class="cm-variable">KeepAlive</span>, <span class="cm-atom">null</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable-2">props</span>.<span class="cm-property">show</span> <span class="cm-operator">?</span> <span class="cm-variable">Extag</span>.<span class="cm-property">node</span>(<span class="cm-variable">SomeThing</span>, {<span class="cm-property">xkey</span>: <span class="cm-string">"some-key"</span>}) : <span class="cm-string">""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    ) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div>'},
            {label: 'ES6+JSX', content: '<div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">render</span>(<span class="cm-def">props</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> (</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">KeepAlive</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      {<span class="cm-variable">props</span>.<span class="cm-property">show</span> <span class="cm-operator">?</span> <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">SomeThing</span> <span class="cm-attribute">xkey</span>=<span class="cm-string">"some-key"</span><span class="cm-tag cm-bracket">/&gt;</span> : <span class="cm-string">""</span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">KeepAlive</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div>'}
          ]
        }
      }).attach(ExtagDOM.query('#code-tabs-1'));
    </script>
  </body>
</html>