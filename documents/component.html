<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
  <link href="../stylesheets/codemirror.css" rel="stylesheet">
  <link href="../stylesheets/alicestyle.css" rel="stylesheet">
  <link href="../stylesheets/common.css" rel="stylesheet">

  <title>组件系统 - Extag</title>
</head>
<body>
  <div class="main">
    <aside class="side-bar"></aside>
    <article class="article">
      <h2>组件系统</h2>
      <p>组件系统是Extag的核心，其他模块和类的设计几乎都是在为组件的实现做铺垫。组件主要是对一般标签元素的扩展和加强，支持<a href="./template.html" class="link">模板</a>、<a href="./template.html#data-binding" class="link">数据绑定</a>、<a href="#component-attribute-validation" class="link">特性验证</a>等高级功能。</p>
      <h3 id="component-element-fragment-text">组件，元素，片段，文本</h3>
      <p>组件Component、元素Element、片段Fragment和文本Text，共同构成了Shell层。文本是最简单的，元素则可以设置样式、插入或移除子节点等，片段则只负责管理一组子节点。下面的代码展示了相关的API，移步<a class="link" href="../examples/component-element-text/" target="_blank">这里</a>可以看到结果。多数情况下，使用声明式组件模板足以完成大部分工作，不需要命令式地操作文本、元素、片段或子组件。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 定义组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">Panel</span> <span class="cm-operator">=</span> <span class="cm-variable">Extag</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-comment">// constuctor: function Panel() { Extag.Component.apply(this, arguments) }, // ES5中如此调用Component的构造函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">extends</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">Component</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">template</span>:<span class="cm-string">'&lt;div class="panel" x:style="border: solid 2px @{color};"&gt;'</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-string">'&lt;h3 class="head" x:style="background-color: @{color};"&gt;'</span> <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                    <span class="cm-string">'@{title}'</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-string">'&lt;/h3&gt;'</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-string">'&lt;div class="body" x:name="body"&gt;'</span> <span class="cm-operator">+</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-string">'&lt;/div&gt;'</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-string">'&lt;/div&gt;'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">attributes</span>: [<span class="cm-string">'title'</span>, <span class="cm-string">'color'</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 创建组件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">panel</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Panel</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 创建元素和文本</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">svg</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Element</span>(<span class="cm-string">'svg:svg'</span>); <span class="cm-comment">// 前缀svg:为元素的命名空间</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">rect</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Element</span>(<span class="cm-string">'svg:rect'</span>); </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">span</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Element</span>(<span class="cm-string">'span'</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">text</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Text</span>(<span class="cm-string">''</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// appendChild, insertChild, removeChild, replaceChild</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">svg</span>.<span class="cm-property">appendChild</span>(<span class="cm-variable">rect</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">span</span>.<span class="cm-property">appendChild</span>(<span class="cm-variable">text</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 设置属性，样式等</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">span</span>.<span class="cm-property">set</span>(<span class="cm-string">'title'</span>, <span class="cm-string">"It's a rect"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">span</span>.<span class="cm-property">style</span>.<span class="cm-property">set</span>(<span class="cm-string">'color'</span>, <span class="cm-string">'white'</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">span</span>.<span class="cm-property">classes</span>.<span class="cm-property">set</span>(<span class="cm-string">'dark-bg'</span>, <span class="cm-atom">true</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">text</span>.<span class="cm-property">set</span>(<span class="cm-string">'content'</span>, <span class="cm-string">"It's a rect"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rect</span>.<span class="cm-property">assign</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">width</span>: <span class="cm-number">100</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">height</span>: <span class="cm-number">100</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">transform</span>: <span class="cm-string">'translate(10, 10)'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">rect</span>.<span class="cm-property">style</span>.<span class="cm-property">assign</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">fill</span>: <span class="cm-string">'rgb(0, 120, 240)'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 设置DOM属性或自定义特性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">panel</span>.<span class="cm-property">assign</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">title</span>: <span class="cm-string">'SVG'</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">color</span>: <span class="cm-string">'#eee'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}); </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">panel</span>.<span class="cm-property">body</span>.<span class="cm-property">setChildren</span>([<span class="cm-variable">svg</span>, <span class="cm-variable">span</span>]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 附着到页面元素上</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">panel</span>.<span class="cm-property">attach</span>(<span class="cm-variable">ExtagDOM</span>.<span class="cm-property">query</span>(<span class="cm-string">'#panel'</span>));</span></pre></div></div></div>
      <p>Text、Element和Fragment作为final class都是不能被继承的，而Component则具有很好的可扩展性。 
        这里使用了Extag的工具方法<span class="expr">defineClass</span>，<span class="expr">extends</span>表示继承，<span class="expr">statics</span>表示一些静态属性，<span class="expr">constrcutor</span>表示自定义构造函数，其它属性和方法则定义在<span class="expr">prototype</span>之上。
        你依然可以用你喜欢的方式来定义一个子组件类，例如使用ES6的<span class="expr">class</span>语法糖。重要的是，在子类构造函数中要调用父类Component的构造函数。</p>
      <h3 id="props-style-and-classes">props, style, classes</h3>
      <p>无论是组件、元素还是文本，都可使用<span class="expr">set</span>方法更新它的DOM属性值，或通过<span class="expr">assign</span>方法<span class="expr">set</span>多个属性。某个DOM属性的值发生更改时，这个DOM属性就会被标记为脏，并触发失效机制，等待渲染。异步渲染过后，脏标记被自动清除。</p>
      <p>对于组件和元素，它们的成员对象<span class="expr">style</span>和<span class="expr">classes</span>，都有脏标记的功能，并与失效机制挂钩。因为我们可以在模板使用<a href="./template.html#class-and-style-binding" class="link">数据绑定</a>，所以一般不需要手动更新<span class="expr">style</span>和<span class="expr">classes</span>的属性值。</p>
      <div class="tip-box">
        <h4>property v.s. attribute</h4>
        <p>对于DOM，常用的property一般都是基本类型的，且都有对应的attribute， 例如checked、title、src等。但也有一些常用的property是没有对应的attribute的，例如innerHTML、textContent等。还有一些property，虽有对应的attribute，但它们本身是object，而非字符串，例如SVG元素circle的属性cx、cy等。</p> 
        <p>为了应对这种不一致的情况，在渲染<span class="expr">props</span>时，ExtagDOM采取的策略是，对于那些重要的property，如checked、innerHTML，我们直接对其赋值，否则一般使用<span class="expr">setAttribute</span>方法进行赋值。特别地，如果特性名以<span class="expr">xlink:</span>打头，则使用<span class="expr">setAttributeNS</span>方法进行赋值</p>
        <!-- <p>对于data-*之类的自定义attribute，建议使用组件、元素的成员<span class="expr">attrs</span>来管理。</p> -->
        
        <p>对于DOM元素原生的属性，大部分DOM属性名和特性名都统一为完全小写形式的。而有一些DOM属性名虽是<span class="expr">camelCase</span>的，但其对应特性名通常却是完全小写的，如readOnly。另有一些DOM属性，它们的特性名与属性名之间，存在特别的转换关系。例如：</p>
        <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">// kebab-case &lt;=&gt; camelCase</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">'accept-charset'</span> <span class="cm-operator">&lt;=&gt;</span> <span class="cm-string">'acceptCharset'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">// lowercase &lt;=&gt; lowercase</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">'autocomplete'</span> <span class="cm-operator">&lt;=&gt;</span> <span class="cm-string">'autocomplete'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">'autofocus'</span> <span class="cm-operator">&lt;=&gt;</span> <span class="cm-string">'autofocus'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">// lowercase &lt;=&gt; camelCase</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">'readonly'</span> <span class="cm-operator">&lt;=&gt;</span> <span class="cm-string">'readOnly'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">'tabindex'</span> <span class="cm-operator">&lt;=&gt;</span> <span class="cm-string">'tabIndex'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">// specially</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">'for'</span> <span class="cm-operator">&lt;=&gt;</span> <span class="cm-string">'htmlFor'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">'float'</span> <span class="cm-operator">&lt;=&gt;</span> <span class="cm-string">'cssFloat'</span> <span class="cm-comment">// 样式属性</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">'class'</span> <span class="cm-operator">&lt;=&gt;</span> <span class="cm-string">'className'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">'inner-html'</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">'innerHTML'</span></span></pre></div></div></div>
        <p>其中，<span class="expr">inner-html</span>不是DOM元素原生的特性，而是Extag为所有标签元素特别添加的自定义特性。在组件模板或JS中，我们一般使用DOM属性名对应的特性名。如果你使用了DOM属性名，如tabIndex，并且需要用setAttribute渲染，ExtagDOM会将之映射为对应的特性名，如tabindex。</p>

      </div>
      
      <p>Shell层通过ExtagDOM与真实DOM层结合后，文本、元素和以元素为根的组件的属性<span class="expr">$skin</span>都指向实际的DOM节点。而片段和以片段为根的组件的<span class="expr">$skin</span>则为null，因而设置它们的DOM属性等，并没有什么实质的影响。</p>
      <h3 id="component-attributes">组件自定义特性</h3>
      <p>对于组件，除了设置DOM属性外，还可以有自定义特性，可自定义特性的默认值，还可为自定义特性添加一些描述。在创建这一组件的首个实例时，Extag就会在它的<span class="expr">prototype</span>上通过<span class="expr">Objec.defineProperty</span>为每个特性创建一对响应式<span class="expr">getter/setter</span>（实际分别调用组件实例的get和set方法）。 自定义特性的值发生改变时，会派发属性更改事件<span class="expr">changed</span>，并触发失效机制。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">Demo</span> <span class="cm-operator">=</span> <span class="cm-variable">Extag</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">extends</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">Component</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">template</span>: <span class="cm-string">'&lt;div&gt;&lt;/div&gt;'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">attributes</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">label</span>: <span class="cm-string">''</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">amount</span>: <span class="cm-number">0</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">active</span>: <span class="cm-atom">true</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">date1</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">anew</span>(<span class="cm-variable">Date</span>, <span class="cm-string">'2020/01/01'</span>), <span class="cm-comment">// 用一个构造函数和参数列表来生成默认值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">date2</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">inst</span>(<span class="cm-keyword">function</span>() { <span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>(); }) <span class="cm-comment">// 用一个函数来生成默认值</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    } </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// 或者attributes: ['label', 'active', 'amount', 'date1', 'date2']，默认值都为undefined</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">demo</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Demo</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">demo</span>.<span class="cm-variable">on</span>(<span class="cm-string">'changed'</span>, <span class="cm-keyword">function</span>(<span class="cm-variable">key</span>, <span class="cm-variable">value</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">'changed'</span>, <span class="cm-variable">key</span>, <span class="cm-variable">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">demo</span>.<span class="cm-property">label</span> <span class="cm-operator">=</span> <span class="cm-string">'abcd'</span>;    <span class="cm-comment">// 等同于demo.set('label', 'abcd')，输出: changed label "abcd"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">demo</span>.<span class="cm-property">active</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;    <span class="cm-comment">// 等同于demo.set('active', false)，输出: changed active false</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">demo</span>.<span class="cm-property">amount</span> <span class="cm-operator">=</span> <span class="cm-number">20000</span>;    <span class="cm-comment">// 等同于demo.set('amount', 20000)，输出: changed amount 20000</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">demo</span>.<span class="cm-property">undeclared</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;    <span class="cm-comment">// 不同于demo.set('undeclared', 1)，对于未声明的属性，set方法是去设置DOM属性;</span></span></pre></div></div></div>
      <p>如果所有的特性都不需要默认值，<span class="expr">attributes</span>可定义为一个特性名数组。如果某个特性的默认值不是基础类型的，则可用<span class="expr">Extag.anew</span>或<span class="expr">Extag.inst</span>为其生成默认值。</p>
      <!-- <p>如果不希望自定义特性是<span class="expr">bindable</span>的，但又希望在组件模板可以通过attribute传值给组件，则可以这样定义：</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-property">attributes</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">filter</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-property">type</span>: <span class="cm-variable">Function</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">bindable</span>: <span class="cm-atom">false</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div></div></div>
      <p>声明为不可绑定的属性，通过<span class="expr">this.</span>就可访问到，但Extag不会为之创建<span class="expr">getter/setter</span>，自然也不会派发属性更改事件。而未在attributes中声明的属性，通过在模板标签上传值，实际是通过set方法是去设置DOM属性。</p> -->
      <p>未在<span class="expr">attributes</span>中声明的属性，在模板标签上传值给组件的方式，实际是通过元素的<span class="expr">set</span>方法是去设置DOM属性。</p>
      <div class="tip-box">
        <p>注意，不同于DOM特性，组件attributes中自定义的属性，是没有脏标记功能的，故而不会被渲染到真实DOM层。
          如果你在attributes中定义了某个已有的DOM属性，例如title，它是不会被渲染到组件根元素上的（模板中可以使用<span class="expr">:title</span>使之作为DOM Attribute直接通过setAttribute完成渲染）。
          所以，最好避免在组件attributes中定义已有的DOM属性。</p>
        <p>另外，组件特性的点语法赋值和set方法设置属性值的关系，可类比DOM属性赋值和setAttribute方法之间的关系。</p>
      </div>
      <h3 id="component-attribute-validation">组件特性验证</h3>
      <p>在开发环境版本的Extag中，组件特性是支持验证的。你可以指明特性的类型，还可以提供一个验证函数，以实现自定义验证的需要。为此，我们可以在子组件类的静态属性<span class="expr">attributes</span>中这样进行定义：</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-property">attributes</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 对于boolean、number、string类型</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">label</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-property">type</span>: <span class="cm-string">'string'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">amount</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-property">type</span>: <span class="cm-string">'number'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">value</span>: <span class="cm-number">0</span></span> <span class="cm-comment">// </span><span class="cm-comment">提供</span><span class="cm-comment">默认值</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">active</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-property">type</span>: <span class="cm-string">'boolean'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 对于Object类型，使用它们的构造函数</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">list</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-property">type</span>: <span class="cm-variable">Array</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }, </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">tool</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">type</span>: <span class="cm-variable">Knife</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 以上是简单的类型验证，亦可允许多类型，模式匹配或自定义一个验证函数</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">date</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">type</span>: [<span class="cm-string">'number'</span>, <span class="cm-string">'string'</span>, <span class="cm-property">Date</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">name</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">test</span>: <span class="cm-string-2">/^[a-zA-Z0-9]{1,32}$/</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">score</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">type</span>: <span class="cm-string">'number'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">test</span>: <span class="cm-keyword">function</span>(<span class="cm-def">value</span>) {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-keyword">if</span> (<span class="cm-property-2">value</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> <span class="cm-operator">||</span> <span class="cm-property-2">value</span> <span class="cm-operator">&gt;</span> <span class="cm-number">100</span>) {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> <span class="cm-string">'out of the range 0~100'</span>; <span class="cm-comment">// 验证不通过，则返回一段错误描述</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div></div></div>
      <p>验证失败后，开发环境版本的Extag会在控制台中输出一条警告。生产环境版本的Extag，默认不执行验证过程，但你仍然可以访问<span class="expr">Extag.Validator</span>，手动调用它的<span class="expr">validate</span>方法或<span class="expr">troubleShoot</span>方法，并且不会在控制台输出警告信息。<span class="expr">validate</span>方法只返回<span class="expr">true</span>（验证成功）或<span class="expr">false</span>（验证失败），而<span class="expr">troubleShoot</span>方法验证失败的时候返回一段错误描述。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">Demo</span> <span class="cm-operator">=</span> <span class="cm-variable">Extag</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">extends</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">Component</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">template</span>: <span class="cm-string">'&lt;div&gt;&lt;/div&gt;'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">attributes</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">score</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-property">test</span>: <span class="cm-keyword">function</span>(<span class="cm-def">value</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">if</span> (<span class="cm-keyword">typeof</span> <span class="cm-variable-2">value</span> <span class="cm-operator">!=</span> <span class="cm-string">'number'</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">              <span class="cm-keyword">return</span> <span class="cm-string">'not a number'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-keyword">if</span> (<span class="cm-variable-2">value</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> <span class="cm-operator">||</span> <span class="cm-variable-2">value</span> <span class="cm-operator">&gt;</span> <span class="cm-number">100</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">              <span class="cm-keyword">return</span> <span class="cm-string">'out of the range 0~100'</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">setup</span>: <span class="cm-keyword">function</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">this</span>.<span class="cm-property">on</span>(<span class="cm-string">'changed'</span>, <span class="cm-keyword">this</span>.<span class="cm-property">onChangedScore</span>.<span class="cm-property">bind</span>(<span class="cm-keyword">this</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">onChangedScore</span>: <span class="cm-keyword">function</span>(<span class="cm-def">key</span>, <span class="cm-def">value</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">if</span> (<span class="cm-variable-2">key</span> <span class="cm-operator">!==</span> <span class="cm-string">'score'</span>) { <span class="cm-keyword">return</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">var</span> <span class="cm-def">error</span> <span class="cm-operator">=</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Validator</span>.<span class="cm-property">troubleShoot</span>(<span class="cm-keyword">this</span>, <span class="cm-string">'score'</span>, <span class="cm-variable-2">value</span>); </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">if</span> (<span class="cm-variable-2">error</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-variable">console</span>.<span class="cm-property">warn</span>(<span class="cm-string">'invalid score, '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">error</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">})</span></pre></div></div></div>
      <h3 id="component-attribute-interception">组件特性拦截</h3>
      <p>组件特性默认是<span class="expr">bindable</span>的，本身就有一对<span class="expr">getter/setter</span>，而你可以进一步定义自己的<span class="expr">get</span>和<span class="expr">set</span>方法，来拦截原有默认的取值、赋值的操作。例如：</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">Demo</span> <span class="cm-operator">=</span> <span class="cm-variable">Extag</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">extends</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">Component</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">template</span>: <span class="cm-string">'&lt;div&gt;&lt;/div&gt;'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">attributes</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">score</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">get</span>: <span class="cm-keyword">function</span>(<span class="cm-def">props</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-keyword">return</span> <span class="cm-variable-2">props</span>.<span class="cm-property">score</span>; <span class="cm-comment">// 默认返回的就是props.score</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        <span class="cm-property">set</span>: <span class="cm-keyword">function</span>(<span class="cm-def">value</span>, <span class="cm-def">props</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          <span class="cm-keyword">if</span> (<span class="cm-keyword">typeof</span> <span class="cm-variable-2">value</span> <span class="cm-operator">===</span> <span class="cm-string">'number'</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">value</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">value</span> <span class="cm-operator">&lt;=</span> <span class="cm-number">100</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">            <span class="cm-variable-2">props</span>.<span class="cm-property">score</span> <span class="cm-operator">=</span> <span class="cm-variable-2">value</span>; <span class="cm-comment">// props是所有特性值真正存放的地方</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">          }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">        }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">demo</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Demo</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">demo</span>.<span class="cm-property">on</span>(<span class="cm-string">'changed'</span>, <span class="cm-keyword">function</span>(<span class="cm-def">key</span>, <span class="cm-def">value</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable-2">key</span>, <span class="cm-variable-2">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">demo</span>.<span class="cm-property">score</span> <span class="cm-operator">=</span> <span class="cm-number">50</span>;        <span class="cm-comment">// 输出：score 50</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">demo</span>.<span class="cm-property">score</span> <span class="cm-operator">=</span> <span class="cm-string">'0'</span>;       <span class="cm-comment">// 没有输出</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">demo</span>.<span class="cm-property">score</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">50</span>;       <span class="cm-comment">// 没有输出</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">demo</span>.<span class="cm-property">score</span>) <span class="cm-comment">// 输出：50</span></span></pre></div></div></div>
      <h3 id="component-attribute-dependency">组件特性依赖</h3>
      <p>你可以定义一个依赖于其他特性的属性<span class="expr">getter</span>，它的值是由其他特性值计算得到的。这样有助于消除模板中复杂而冗长的绑定表达式。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">Demo</span> <span class="cm-operator">=</span> <span class="cm-variable">Extag</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">extends</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">Component</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">template</span>: <span class="cm-string">'&lt;h2&gt;@{fullName}&lt;/h2&gt;'</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">attributes</span>: [<span class="cm-string">'firstName'</span>, <span class="cm-string">'lastName'</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">get</span> <span class="cm-property">fullName</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-keyword">this</span>.<span class="cm-property">firstName</span> <span class="cm-operator">+</span> <span class="cm-string">' '</span> <span class="cm-operator">+</span> <span class="cm-keyword">this</span>.<span class="cm-property">lastName</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre></div></div></div>
      <p>就比如上面代码展示的，`fullName`依赖于`fistName`和`lastName`。只要`firstName`或`lastName`的值发生改变，就会重新将`fullName`渲染到页面。</p>
      <h3 id="component-inner-state">组件内部状态</h3>
      <p>组件可能含有自己的内部状态，你可以在组件<span class="expr">setup</span>的时候，创建<a href="./model.html" class="link">Model</a>类型的<span class="expr">state</span>对象，当它的属性值发生更改时会派发<span class="expr">changed</span>事件。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">Demo</span> <span class="cm-operator">=</span> <span class="cm-variable">Extag</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">extends</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">Component</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">template</span>: <span class="cm-string">'&lt;div&gt;@{state.seconds}&lt;/div&gt;'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">setup</span>: <span class="cm-keyword">function</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// setup发生在模板引擎工作之前。在这里定义state，以便模板引擎能找到state。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">var</span> <span class="cm-def">state</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Model</span>({<span class="cm-property">seconds</span>: <span class="cm-number">0</span>});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-variable">setInterval</span>(<span class="cm-keyword">function</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-variable-2">state</span>.<span class="cm-property">seconds</span> <span class="cm-operator">+=</span> <span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }, <span class="cm-number">1000</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">state</span>: <span class="cm-variable-2">state</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre></div></div></div>
      <p>
        <a class="link" href="https://codepen.io/enjolras1024/pen/WNGRjLv" target="_blank">
          在CodePen上尝试
        </a>
      </p>
<!--       
      <h3 id="component-contents">组件contents</h3>
      <p>组件在内部管理自己的children，在外部接受contents。在模板中，你可以使用<span class="expr">x:slot</span>标签来自动收集匹配的contents。本章第一节的代码中，Panel模板就使用了一个<span class="expr">x:slot</span>，具体用法参见模板语法的<a class="link" href="./template.html#component-slots">组件slots</a>。或者不使用<span class="expr">x:slot</span>，你也可以选择在何处手动插入来自外部的contents。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation" style=""><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">Panel</span> <span class="cm-operator">=</span> <span class="cm-variable">Extag</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">extends</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">Component</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">attributes</span>: [<span class="cm-string">'title'</span>, <span class="cm-string">'color'</span>],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">template</span>:<span class="cm-string">'&lt;div class="panel" x:style="border: solid 2px @{color};"&gt;'</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-string">'&lt;h3 class="head" x:style="background-color: @{color};"&gt;@{ title }&lt;/h3&gt;'</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">                <span class="cm-string">'&lt;div class="body" x:name="slot"&gt;&lt;/div&gt;'</span> <span class="cm-operator">+</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">             <span class="cm-string">'&lt;/div&gt;'</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">setup</span>: <span class="cm-keyword">function</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">this</span>.<span class="cm-property">on</span>(<span class="cm-string">'created'</span>, <span class="cm-keyword">this</span>.<span class="cm-property">onCreated</span>.<span class="cm-property">bind</span>(<span class="cm-keyword">this</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">onCreated</span>: <span class="cm-keyword">function</span>() {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">// created之后，才能访问到具名部件slot</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-keyword">this</span>.<span class="cm-property">on</span>(<span class="cm-string">'changed'</span>, (<span class="cm-keyword">function</span>(<span class="cm-def">key</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">if</span> (<span class="cm-variable-2">key</span> <span class="cm-operator">!==</span> <span class="cm-string">'contents'</span>) { <span class="cm-keyword">return</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-keyword">this</span>.<span class="cm-property">slot</span>.<span class="cm-property">setChildren</span>(<span class="cm-keyword">this</span>.<span class="cm-property">getContents</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }).<span class="cm-property">bind</span>(<span class="cm-keyword">this</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">panel</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Panel</span>({<span class="cm-property">title</span>: <span class="cm-string">'SVG'</span>, <span class="cm-property">color</span>: <span class="cm-string">'#eee'</span>});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">panel</span>.<span class="cm-property">setContents</span>([<span class="cm-variable">svg</span>, <span class="cm-variable">span</span>]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// ...</span></span></pre></div></div></div>
       -->
      <h3 id="component-boundary">组件边界处理</h3>
      <p>在将一个组件用作其他组件的子组件时，这个子组件的根元素就是内外边界结合的地方。为了避免边界冲突，组件内部只应在模板根元素上声明class和一些DOM事件，style等其他DOM属性应一律留在外部操作（用作子组件时）。否则一不注意，就可能引发冲突，造成混乱。</p>
      <p>如果不想接受外部的DOM属性、样式的直接修改，那么你可以在子组件模板中使用<span class="expr">&lt;x:frag&gt;</span>作为根元素。即组件以Fragment的形式出现，把真正的根元素作为<span class="expr">&lt;x:frag&gt;</span>的子节点。这样在外部，则必须通过组件声明的<span class="expr">attributes</span>，才能够间接地修改到实际根元素的样式等DOM属性。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">x:frag</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">x:style</span>=<span class="cm-string">"color: @{color};"</span><span class="cm-tag cm-bracket">&gt;</span>...<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">x:frag</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div>
      <div class="tip-box">
        <p><span class="expr">&lt;x:frag&gt;</span>中可以添加多个子节点。渲染时，<span class="expr">&lt;x:frag&gt;</span>是不存在的，它所在的位置将被所有子节点所占据。Extag内置的<span class="expr">&lt;x:slot&gt;</span>正是以<span class="expr">&lt;x:frag&gt;</span>为根的特殊组件。</p>
      </div>
      <p>Fragment和以<span class="expr">&lt;x:frag&gt;</span>为根的组件，不能通过它们的attach方法直接地添加到页面上。</p>
      <p>
        <a class="link" href="https://codepen.io/enjolras1024/pen/NWRdjZG" target="_blank">
          在CodePen上尝试
        </a>
      </p>
      
      <h3 id="component-lifecycle">组件生命周期</h3>
      <p>prepare->steup(context)->initialize->emit('created')->attach->invalidate->update->emit('updating')->digest->emit('updated')->detach->destroy->emit('destorying')</p>
      <p>prepare: 创建某种类型组件的首个实例时，首先要在prototype上定义声明的attributes，编译声明的模板。同时，对于该类型组件的所有实例，还需要设置attributes的默认值，定义好props, style 和 classes等成员。</p>
      <p>initialize: 这一阶段，有了编译好的模板，就会启动模板引擎，为组件添加子内容、事件处理器和数据绑定等等。在模板引擎开始工作之前，你可以在<span class="expr">setup</span>方法中预先完成些事，比如初始化state，访问<a class="link" href="#component-context">组件context</a>，以及将事件处理函数绑定到<span class="expr">this</span>，最后返回一些在模板中可以直接访问的属性和方法。初始化完成后，组件才算真正创建完毕，会派发<span class="expr">created</span>事件。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">click+</span>=<span class="cm-string">"onClick"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>Count: @{state.count}<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div>
      <br>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">setup</span>(<span class="cm-variable">context</span>) {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">state</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Model</span>({<span class="cm-property">count</span>: <span class="cm-number">0</span>});</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">this</span>.<span class="cm-property">on</span>(<span class="cm-string">'created'</span>, <span class="cm-keyword">function</span>(){</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">'created'</span>);</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  });</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">get</span> <span class="cm-property">state</span>() { <span class="cm-keyword">return</span> <span class="cm-variable">state</span>; },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">onClick</span>: <span class="cm-keyword">this</span>.<span class="cm-property">onClick</span>.<span class="cm-property">bind</span>(<span class="cm-keyword">this</span>) </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">onClick</span>() {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">this</span>.<span class="cm-property">state</span>.<span class="cm-property">count</span><span class="cm-operator">++</span>;</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div></div></div>
      <p>attach: 对于以元素为根的组件，你可以调用attach方法，将之附着到页面上已有的DOM元素上（要求该DOM元素与组件根元素的tagName和namespace一致）。进入digest阶段，根组件的后代元素会由上而下，跟着调用各自的attach方法，附着到通过ExtagDOM创建的DOM元素上。以片段为根的组件调用attach方法无效。</p>
      <p>invalidate: 当组件、元素的属性、样式发生变化后，或完成了attach，组件、元素就会触发失效机制，进入失效状态，需要等待下一刻digest完成，才会恢复到正常状态。</p>
      <p>update: 这一阶段，组件将派发<span class="expr">updating</span>事件，导致一系列数据绑定执行生效，更多的组件和元素触发失效机制。如果想在digest之前完成一些操作，那么可以在setup的时候监听<span class="expr">updating</span>事件并处理。</p>
      <p>digest: 这一阶段，就是通过ExtagDOM把Shell层变动的部分，按照模板自上而下依次渲染到DOM层，而后清除脏标记。对于已完成attach的组件，首次成功渲染后会派发<span class="expr">mounted</span>事件。如果尚未attach，所有脏标记将会保留，直到能够完成渲染。最后，对于更新过的组件，每次都自下而上派发<span class="expr">updated</span>事件。</p>
      <p>detach: DOM元素从文档中移除后，Shell层的元素、组件的detach方法就会被调用，从而脱离已附着的DOM元素。后代元素、组件也会跟着调用各自的detach方法，脱离已附着的DOM元素。</p>
      <p>destroy: detach之后, destroy就被自动调用，将要清理children，移除所有的数据绑定和事件监听。进入destroy阶段，首先会派发<span class="expr">destroying</span>事件，你可以在这时清理遗留的东西，如对window事件的监听。</p>
      <p>Shell层的文本、元素、片段的生命周期与之类似，但相较简单，不会派发<span class="expr">created</span>等事件。</p>
      <div class="tip-box">
        <p>其中，<span class="expr">attach, detach, update, digest, invalidate</span>都是Component对象的实例方法，大部分情况下由Extag内部自主调用，应避免在继承时重写这些方法。</p>
        
      </div>
      <div class="tip-box">
        <p>对于移除的元素、组件，如果不希望立即销毁它们，而希望留有后用，则应该及时地将它们转移到离线的Shell层元素中，保证它们有逻辑意义上的父节点，Extag就不会调用它们的detach方法。</p>
      </div>
      <p>
        <a class="link" href="https://codepen.io/enjolras1024/pen/vYXgZEP" target="_blank">
          在CodePen上尝试
        </a>
      </p>
      <!-- <h3 id="component-error-capture">组件错误捕获</h3> -->
      <h3 id="component-context">组件context</h3>
      <p>组件context这个属性的值默认为<span class="expr">undefined</span>。你可以在<span class="expr">setup</span>的时候，给组件定义一个context，而后模板引擎会自动将这个context层层传递下去。后代组件的<span class="expr">setup</span>方法就会接收到这个context，然后选择如何使用context，比如合成一个新的context继续传递下去。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">setup</span>(<span class="cm-variable">context</span>) {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 新增属性x，供后代组件使用</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">ctx</span> <span class="cm-operator">=</span> <span class="cm-variable">Object</span>.<span class="cm-property">assign</span>({}, <span class="cm-variable">context</span>, {<span class="cm-property">x</span>: <span class="cm-number">0</span>});</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">get</span> <span class="cm-variable">context</span>() { <span class="cm-keyword">return</span> <span class="cm-variable">ctx</span>; }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre></div></div></div>
      <div class="tip-box"><p>context的使用无疑增强了父子组件的耦合性，一般是不建议用的。</p></div>

      <h3 id="component-element-command">组件元素命令</h3>
      <p>使用组件或元素的<span class="expr">cmd</span>方法，可以命令DOM元素在digest阶段完成某个动作，如focus</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">element</span>.<span class="cm-property">cmd</span>(<span class="cm-string">'focus'</span>)</span></pre></div></div></div>
      <p>cmd方法接收额外参数，到时候传递给要调用的DOM元素方法。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">element</span>.<span class="cm-property">cmd</span>(<span class="cm-string">'scrollTo'</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>);</span></pre></div></div></div>
      <p></p>
    </article>
  </div>

  <script src="../javascripts/extag-dom.js"></script>
  <script src="../javascripts/extag.js"></script>
  <script src="../javascripts/common.js"></script>
</body>