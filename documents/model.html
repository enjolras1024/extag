<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link href="../stylesheets/codemirror.css" rel="stylesheet">
  <link href="../stylesheets/alicestyle.css" rel="stylesheet">
  <link href="../stylesheets/common.css" rel="stylesheet">
  <title>数据模型 - Extag</title>
</head>
<body>
  <div class="main">
    <aside class="side-bar"></aside>
    <article class="article">
      <h2>数据模型</h2>
      <h3 id="model-for-object">Model for Object</h3>
      <p>
        如果组件含有可变的内部状态，需要监听内部状态值的变化，在组件模板中形成绑定关系，则可以使用Extag提供的Model。
        在构造Model实例时，提供一些初始属性值给Model的构造函数，即可通过<span class="expr">Objec.defineProperty</span>为这个实例对象的各个属性创建响应式<span class="expr">getter/setter</span>。
      </p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation" ><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">point</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Extag</span>.<span class="cm-property">Model</span>({<span class="cm-property">x</span>: <span class="cm-number">0</span>, <span class="cm-property">y</span>: <span class="cm-number">0</span>});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">point</span>.<span class="cm-property">on</span>(<span class="cm-string">'changed'</span>, <span class="cm-keyword">function</span>(<span class="cm-def">key</span>, <span class="cm-def">value</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable-2">key</span>, <span class="cm-variable-2">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">point</span>.<span class="cm-property">x</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;    <span class="cm-comment">// 输出：x 1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">point</span>.<span class="cm-property">y</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;    <span class="cm-comment">// 输出：y 2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">point</span>.<span class="cm-property">z</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>;    <span class="cm-comment">// 没有输出</span></span></pre></div></div></div>
      <p>同Component一样，Model具有良好的可扩展性，继承时支持<span class="expr">attributes</span>声明和验证。Model子类只在第一次实例化时，才会在子类<span class="expr">prototype</span>上为声明的<span class="expr">attributes</span>创建响应式<span class="expr">getter/setter</span>。构造时，对于新增的属性，则直接在实例对象上创建响应式<span class="expr">getter/setter</span>。</p>
      <div class="code-box scroll"><div class="CodeMirror cm-s-alice"><div class="CodeMirror-code" role="presentation" ><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">Point</span> <span class="cm-operator">=</span> <span class="cm-variable">Extag</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">extends</span>: <span class="cm-variable">Extag</span>.<span class="cm-property">Model</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-property">attributes</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">x</span>: {<span class="cm-property">type</span>: <span class="cm-string">'number'</span>, <span class="cm-property">value</span>: <span class="cm-number">0</span>},</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">      <span class="cm-property">y</span>: {<span class="cm-property">type</span>: <span class="cm-string">'number'</span>, <span class="cm-property">value</span>: <span class="cm-number">0</span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">point</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Point</span>({<span class="cm-property">z</span>: <span class="cm-number">0</span>});<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 在Point.prototype上为声明的attributes创建getter/setter，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 且在point实例对象上新增z的getter/setter。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">point</span>.<span class="cm-property">on</span>(<span class="cm-string">'changed'</span>, <span class="cm-keyword">function</span>(<span class="cm-def">key</span>, <span class="cm-def">value</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable-2">key</span>, <span class="cm-variable-2">value</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">point</span>.<span class="cm-property">x</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;  <span class="cm-comment">// 输出：x 1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">point</span>.<span class="cm-property">y</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;  <span class="cm-comment">// 输出：y 2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">point</span>.<span class="cm-property">z</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>;  <span class="cm-comment">// 输出：z 3</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">point2</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Point</span>({<span class="cm-property">x</span>:<span class="cm-number">1</span>, <span class="cm-property">y</span>: <span class="cm-number">2</span>, <span class="cm-property">z</span>: <span class="cm-number">3</span>}); <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-comment">// 不用为声明的attributes二次创建getter/setter，</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 但在point2实例对象上新增z的getter/setter。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div>
      <div class="tip-box">
        <p>同Component的设计类似，响应式<span class="expr">getter/setter</span>实际分别调用Model实例的<span class="expr">get</span>和<span class="expr">set</span>方法，也可通过<span class="expr">assign</span>方法去<span class="expr">set</span>多个属性。</p>
        <p>对于Array，Extag没有提供类似的包装。当数组长度变化或某些索引处的元素发生了替换时，可返回新的数组，以替换旧的数组，相关的绑定才会生效。</p></div>
    </article>
  </div>
  <script src="../javascripts/extag-dom.js"></script>
  <script src="../javascripts/extag.js"></script>
  <script src="../javascripts/common.js"></script>
</body>