!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Extag=e()}(this,function(){"use strict";var e=/^\s*[$_A-Z][$_A-Z0-9]*(\s*\.\s*[$_A-Z0-9]+)*\s*$/i,n=/\s*\.\s*/;function s(t,e){for(var n=-1,i=t.length,s=e;++n<i;)if(null==(s=s[t[n]]))return s;return s}var g={test:function(t){return e.test(t)},parse:function(t){if(g.test(t))return t.trim().split(n)},search:function(t,e,n){var i;if("string"==typeof t&&(t=g.parse(t)),t)return e&&(i=s(t,e)),null!=i||n||("undefined"!=typeof window?i=s(t,window):"undefined"!=typeof global&&(i=s(t,global))),i}},u=0,o=3,i=0,l=4,c=2,f=1,h=16,p=32,r=11,a=256,d=Object.freeze({}),v="view-engine",_="hook-engine",x=Object.freeze({}),y=Object.freeze([]),m={DATA:"@",TEXT:"#",EVENT:"+",FRAGMENT:"<>",MODIFIER:"::",CONVERTER:"|=",ASSIGN:"!",TWO_WAY:"@",ANY_WAY:"^",ONE_TIME:"?"},b=/\s+/,w=/\s/g,A=/^[A-Z]/,k=/^this\./,$=/^(this\.)?[\w$_]+$/,E=Array.prototype.slice,C=Object.defineProperty,O=Object.prototype.hasOwnProperty,T=Object.getOwnPropertyDescriptor,D=function(t){var e,n,i,s=arguments.length;for(i=1;i<s;++i)if((e=arguments[i])instanceof Object)for(n in e)O.call(e,n)&&(t[n]=e[n]);return t};function N(t,e){var n,i=t.length;if(!e)for(n=0;n<i;++n)if(Array.isArray(t[n])){e=[];break}if(e)for(n=0;n<i;++n){var s=t[n];Array.isArray(s)?N(s,e):e.push(s)}return e||t}function S(t,e){return null!=e&&(t=t.slice(0)).push(e),t}function t(t){return"function"==typeof t&&/native code/.test(t.toString())}function I(t,e){var n,i,s;for(n=0,i=e.length;n<i;++n)for(var r in s=e[n])O.call(s,r)&&C(t,r,T(s,r))}function M(t){var e,n,i,s,r;return O.call(t,"extends")?"function"!=typeof(n=t.extends)&&W("superClass must be a function"):n=Object,O.call(t,"constructor")?"function"!=typeof(e=t.constructor)&&W("subClass must be a function"):e=function(){n.apply(this,arguments)},e.prototype=Object.create(n.prototype),r=[e.prototype],i=t.mixins,Array.isArray(i)&&r.push.apply(r,i),r.push(t),I(e.prototype,r),C(e.prototype,"constructor",{value:e,enumerable:!1,writable:!0,configurable:!0}),r=[e,n],(s=t.statics)&&(i=s.mixins,Array.isArray(i)&&r.push.apply(r,i),r.push(s)),I(e,r),delete e.prototype.statics,delete e.prototype.entend,delete e.prototype.mixins,delete e.mixins,e}var P=/&[\w#]{2,6};/;function j(t){return P.test(t)?t.replace(/&nbsp;/g,String.fromCharCode(160)).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t}function W(t,e){var n=t instanceof Error?t:new Error(t);throw e&&D(n,e),n}function Y(t){return t&&"object"==typeof t&&t.__extag_node__===d}function z(){}var V=[function(t){this.emit(t.type,t,i)},function(t){this.emit(t.type,t,f)},function(t){this.emit(t.type,t,c)},function(t){this.emit(t.type,t,f|c)}];function G(t,e,n){var i=t.constructor;"function"==typeof i.removeEventListener&&(2===arguments.length?i.removeEventListener(t,e):i.removeEventListener(t,e,n))}function R(t){var e=i;return t&&(t.capture&&(e|=f),t.passive&&(e|=c),t.once&&(e|=l)),e}function U(t){var e={};return t&f&&(e.capture=!0),t&c&&(e.passive=!0),t&l&&(e.once=!0),e}function F(t,e){return(t&f)==(e&f)}function L(t,e,n,i){var s=t._actions;if("function"==typeof n){s||C(t,"_actions",{value:s={},writable:!1,enumerable:!1,configurable:!0});var r=s[e];r||(r=s[e]={type:e,head:null,tail:null});var a=R(i);if(n.__extag_handler__)for(var o=r.head;o;){if(o.func===n&&F(a,o.flag))return;o=o.next}var l,c,f,h,u={func:n,flag:a};n.__extag_handler__=!0,r.head?r.tail.next=u:r.head=u,r.tail=u,"listeners"in r&&!r.listeners||(c=r,f=u,"function"==typeof(h=(l=t).constructor).addEventListener?h.addEventListener(l,c,f):c.listeners=null)}}function X(t,e,n,i){var s=t._actions;if(s){var r=s[e];if(r){if(2===arguments.length)return r.listeners&&G(t,r),void(s[e]=null);for(var a=R(i),o=r.head,l=null;o;){if(n===o.func&&F(a,o.flag)){if(r.listeners)r.listeners[o.flag&(f|c)]&&G(t,r,o);o.next||(r.tail=l),l?l.next=o.next:r.head=o.next;break}o=(l=o).next}}}}function Q(t,e,n){(e=E.call(e,0)).unshift(n),t.apply(console,e)}M({constructor:z,statics:{opts2flag:R,flag2opts:U,getEventListener:function(t,e){return V[e].bind(t)}},on:function(t,e,n){if("object"==typeof t){for(t in n=t)if(O.call(n,t)){var i=n[t];Array.isArray(i)?L(this,t,i[0],i[1]):L(this,t,i)}}else L(this,t,e,n)},off:function(t,e,n){var i=this._actions;if(i){var s=arguments.length,r=typeof t;if(0===s)for(t in i)X(this,t);else if("string"===r)1===s?X(this,t):X(this,t,e,n);else if("object"===r)for(t in n=t)if(O.call(n,t)){var a=n[t];Array.isArray(a)?X(this,t,a[0],a[1]):null==a?X(this,t):X(this,t,a)}}},emit:function(t){var e=this._actions;if(e){var n=e[t];if(n&&n.head){var i,s,r=n.listeners?arguments[2]:0;for(i=n.head;i;)F(r,i.flag)&&(i.func.apply(null,E.call(arguments,1)),i.flag&l&&(s=s||[]).push(i)),i=i.next;if(s)for(var a=0;a<s.length;++a)i=s[a],this.off(t,i.func,i.flag?U(i.flag):null)}}}});var q={info:function(){Q(console.log,arguments,"[EXTAG INFO]")},warn:function(){Q(console.warn,arguments,"[EXTAG WARN]")},error:function(){Q(console.error,arguments,"[EXTAG ERROR]")},debug:function(){Q(console.log,arguments,"[EXTAG DEBUG]")}};function H(){1<arguments.length?(this.ctor=arguments[0],this.args=arguments[1]):this.gen=arguments[0]}M({constructor:H,statics:{anew:function(t){return new H(t,E.call(arguments,1))},inst:function(t){return new H(t)}},gen:function(){var t=this.ctor,e=this.args;if(!e)return new t;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);default:W("`anew` arguments length must not exceed 6.")}}});var Z={},B={configurable:!0,enumerable:!0},J={},K={};function tt(e){return function(t){return t[e]}}function et(t,e){var n,i;B.get=(n=e,O.call(J,n)||(J[n]=function(){return this.get(n)}),J[n]),B.set=(i=e,O.call(K,i)||(K[i]=function(t){this.set(i,t)}),K[i]),C(t,e,B)}function nt(){W("Accessor is a partial class for mixins and can not be instantiated")}function it(t){if(t instanceof Object){var e=t.constructor;return e.fullname||e.name}return typeof t}function st(t,e,n,i){var s,r,a,o=nt.getAttrDesc(t,e);if(o&&(o.type||o.test))return(a=o.type)&&(s=function(t,e,n,i){var s,r,a,o,l,c,f=typeof i;if("string"===f&&typeof n!==i?(f=i,s=!0):"function"!==f||n instanceof i||(f=i.fullname||i.name,s=!0),s)return r=t.constructor,a=r.fullname||r.name,o=e,l=f,c=it(n),"`"+o+"` of type `"+(a||"<<anonymous>>")+"` should be `"+l+(c?"`, not `"+c:"")+"`";if(Array.isArray(i)){for(var h=0,u=i.length;h<u&&!("string"==(f=typeof i[h])&&typeof n===i[h]||"function"===f&&n instanceof i[h]);++h);if(h===u)return function(t,e,n,i){for(var s=[],r=0,a=n.length;r<a;++r)s.push("`"+(n[r].name||n[r])+"`");return"`"+e+"` of type `"+(t||"<<anonymous>>")+"` should be "+s.join(" or ")+(i?", not `"+i:"")+"`"}((r=t.constructor).fullname||r.name,e,i,it(n))}}(t,e,n,a)),s||((r=o.test)&&(s="function"==typeof r?r.call(t,n,e):function(t,e,n,i){if(!i.test(n))return n+" does not match the pattern "+i.toString()+" of the property `"+e+"` in "+t.toString()}(t,e,n,r)),s||void 0)}M({constructor:nt,statics:{getAttrDesc:function(t,e){return t.__extag_descriptors__?t.__extag_descriptors__[e]:null},defineGetterSetter:et,getAttributeDefaultValue:function(t){return"object"!=typeof t.value?t.value:null!=t.value?t.value instanceof H?t.value.gen&&t.value.gen():t.value:void 0},getAttributeDefaultValues:function(t){var e={},n=t.__extag_descriptors__;if(n)for(var i in n)if(O.call(n,i)){var s=n[i],r=typeof s.value;if("undefined"===r)continue;"object"!==r?e[i]=s.value:null!=s.value&&(s.value instanceof H?e[i]=s.value.gen&&s.value.gen():e[i]=s.value)}return e},applyAttributeDescriptors:function(t,e){if(!O.call(t,"__extag_descriptors__")){if(Array.isArray(e)){var n,i,s=e;for(e={},n=0,i=s.length;n<i;++n)e[s[n]]=Z}var r,a,o=D({},t.__extag_descriptors__);for(r in e)if(O.call(e,r)){if(r in t)continue;a=e[r],o[r]="object"!=typeof a?{value:a}:a instanceof H?{value:a}:a?(a.get&&!a.set||a.set&&!a.get&&(a.get=tt(r)),a):Z,et(t,r)}C(t,"__extag_descriptors__",{value:o,configurable:!0,enumerable:!1,writable:!1})}}},get:function(t){W("Method `get` must be implemented by sub-class")},set:function(t,e){W("Method `set` must be implemented by sub-class")},assign:function(t){for(var e in t)O.call(t,e)&&this.set(e,t[e])}});var rt={validate0:function(t,e){var n,i=t.__extag_descriptors__;for(n in i)!i[n].required||e&&O.call(e,n)||q.warn("Attribute Validation:","required `"+n+"` for component "+(t.constructor.fullname||t.constructor.name))},validate:function(t,e,n,i){return!st(t,e,n)},troubleShoot:st};function at(){W("DirtyMarker is a partial class for mixins and can not be instantiated")}function ot(t,e,n){var i,s;function r(){i=!0}e.$flag&=~(h|p);for(var a=e,o=[e];e&&(!e.constructor.__extag_component_class__||(e.emit("throwed",{targets:o.slice(0),target:a,phase:n,error:t,stop:r}),!i));){if(!(s=e.__extag_scopes__)||!s[0]){q.error("Unsolved error in phase `"+n+"` from ",a),q.error(t);break}e=s[0],o.push(e)}}M({constructor:at,statics:{check:function(t,e,n,i){var s=t._dirty;s||(s={},t._dirty=s),e in s?s[e]===n&&delete s[e]:s[e]=i},clean:function(t,e){t._dirty&&(e?delete t._dirty[e]:t._dirty=null)}},hasDirty:function(t){var e=this._dirty;return!!e&&(null==t||O.call(e,t))}});var lt=function(t,e,i){if(t){var n=t.resolve();return function(t){"function"==typeof t&&n.then(t)}}if(e){var s=[],r=0,a=document.createTextNode("");return new e(function(){for(var t;t=s.pop();)t();r=r?0:1}).observe(a,{characterData:!0}),function(t){"function"==typeof t&&(s.unshift(t),a.data=r)}}return i?function(t){if("function"==typeof t){var e=!1,n=function(){e||(e=!0,t())};i(n),setTimeout(n)}}:setTimeout}("undefined"!=typeof Promise&&t(Promise)?Promise:null,"undefined"!=typeof MutationObserver&&t(MutationObserver)?MutationObserver:null,"undefined"!=typeof requestAnimationFrame&&t(requestAnimationFrame)?requestAnimationFrame:null),ct=[],ft=[],ht=[],ut=0,pt=0,gt=!1;function dt(){try{var e,t;for(0,ut=0;ut<ct.length;){e=ct[ut++];try{e.update()}catch(t){_t(function(){ot(t,e,"updating")})}}for(ct.length=0,ut=-1,pt=0;pt<ft.length;){e=ft[pt++];try{e.digest()}catch(t){_t(function(){ot(t,e,"digesting")})}}for(ft.length=0,gt=!(pt=-1),t=ht.length-1;0<=t;--t)try{(0,ht[t])()}catch(t){q.error("callback failed",t)}ht.length=0}catch(t){throw pt=ut=-1,ct.length=0,ft.length=0,ht.length=0,gt=!1,t}}function vt(t,e,n,i){for(var s,r;e<=n;)if((r=i[s=e+n>>1].$meta.guid)<t)e=s+1;else{if(!(t<r))return e;n=s-1}return-e-1}function _t(t){ht.push(t)}var xt,yt={setImmediate:lt,insertUpdateQueue:function(t){var e,n=ct.length,i=t.$meta.guid;if(0<n&&i>ct[n-1].$meta.guid)e=n;else{var s=vt(i,ut+1,ct.length-1,ct);if(!(s<0))return;e=-s-1}e===n?ct.push(t):ct.splice(e,0,t),gt||(gt=!0,lt(dt))},insertDigestQueue:function(t){var e,n=ft.length,i=t.$meta.guid;if(0<n&&i>ft[n-1].$meta.guid)e=n;else{var s=vt(i,pt+1,ft.length-1,ft);if(!(s<0))return;e=-s-1}e===n?ft.push(t):ft.splice(e,0,t),gt||(gt=!0,lt(dt))},pushCallbackStack:_t},mt=[],bt=function(t){(xt=t).depsCountNew=0,xt.depsCountOld=0,xt.executeTimes=xt.executeTimes?xt.executeTimes+1:1,mt.push(t)},wt=function(){if(null!=xt){if(xt.depsCountOld<xt.depsCount){var t,e,n=xt.deps;for(t=n.length-1;0<=t;--t)(e=n[t]).times!==xt.executeTimes&&(e.src.off("changed",xt.invalidate),n.splice(t,1))}xt.depsCount=xt.depsCountOld+xt.depsCountNew,mt.pop(),mt.length&&(xt=mt[mt.length-1])}},At=function(t,e){if(null!=xt){var n=xt.keys;n?n.indexOf(e)<0&&n.push(e):xt.keys=[e];var i,s,r=xt.deps;if(r){for(i=0;i<r.length;++i)if((s=r[i]).src===t)return void(s.times<xt.executeTimes&&(s.times=xt.executeTimes,xt.depsCountOld++))}else r=xt.deps=[];xt.depsCountNew++,t.on("changed",xt.invalidate),r.push({src:t,times:xt.executeTimes})}},kt=function(t){var e=t.deps;if(e){for(var n=0;n<e.length;++n)e[n].src.off("changed",t.invalidate);t.deps=null,t.keys=null}};function $t(t){$t.initialize(this,t)}M({constructor:$t,mixins:[nt.prototype,z.prototype],statics:{create:function(t){return new $t(t)},initialize:function(t,e){var n,i=t.constructor;i!==$t&&i.attributes?(nt.applyAttributeDescriptors(i.prototype,i.attributes),n=nt.getAttributeDefaultValues(t),C(t,"_props",{value:n,writable:!1,enumerable:!1,configurable:!0})):C(t,"_props",{value:{},writable:!1,enumerable:!1,configurable:!0}),e&&function(t,e){var n,i;for(n in e)O.call(e,n)&&(nt.getAttrDesc(t,n)?t.set(n,e[n]):(i=T(e,n)).get||i.set?C(t,n,i):(nt.defineGetterSetter(t,n),t.set(n,i.value)))}(t,e)}},keys:function(){return Object.keys(this._props||x)},get:function(t){At(this,t);var e=nt.getAttrDesc(this,t);return e&&e.get?e.get.call(this,this._props):this._props[t]},set:function(t,e){var n,i=nt.getAttrDesc(this,t),s=this._props;i&&i.get?i.set&&(n=i.get.call(this,s),i.set.call(this,e,s),n!==(e=i.get.call(this,s))&&this.emit("changed",t,e)):(n=s[t])!==e&&(s[t]=e,this.emit("changed",t,e))}});var Et={invalidate:function(){}};function Ct(t){this._owner=t||Et,this._props={}}M({constructor:Ct,mixins:[nt.prototype,at.prototype],get:function(t){return this._props[t]},set:function(t,e){var n=this._props,i=n[t];e!==i&&(n[t]=e,this._owner.invalidate(1),at.check(this,t,e,i))},reset:function(t){var e,n,i=this._props;if(i)for(n in i)O.call(i,n)&&(t&&O.call(t,n)||at.check(this,n,null,i[n]));if(t){for(n in t)O.call(t,n)&&(e=t[n])!==i[n]&&at.check(this,n,e,i[n]);this._props=t}else this._props={}}});var Ot={},Tt={get:function(t){return Ot[t]},set:function(t,e){Ot[t]=e}},Dt=0,Nt=null;function St(){W("Shell is a base class and can not be instantiated")}function It(){W("Parent is a base class and can not be instantiated!")}function Mt(t){for(var e=t._parent;e&&e.$meta.type===u;)e=e._parent;return e}function Pt(t,e){var n,i,s=t._children,r=s.length;for(e=e||[],n=0;n<r;++n)(i=s[n]).$meta.type===u?Pt(i,e):e.push(i);return e}M({constructor:St,mixins:[z.prototype,nt.prototype,at.prototype],invalidate:function(t){0==(this.$flag&h)&&(this.$flag|=h,yt.insertUpdateQueue(this)),t&&0==(this.$flag&t)&&(this.$flag|=t)},update:function(){W("The method `update` must be implemented by sub-class")},digest:function(){W("The method `digest` must be implemented by sub-class")},attach:function(t){0===this.$meta.type&&W("Fragment and component using <x:frag> as root tag, can not attach a skin.");var e=St.getViewEngine(this);if(e.attachShell(t,this),this.$skin=t,this._actions){var n,i,s=this._actions;for(n in s)if(O.call(s,n)&&e.mayDispatchEvent(t,n)&&(i=s[n]))for(var r=i.head;r;)St.addEventListener(this,i,r),r=r.next}0==(this.$flag&p)&&(this.$flag|=p,yt.insertDigestQueue(this))},detach:function(){this.constructor.destroy(this);var t=this.$skin;t&&(St.getViewEngine(this).detachShell(t,this),this.$skin=null)},toString:function(){var t=this.$meta,e=this.constructor;return(e.fullname||e.name)+"<"+t.tag+">("+t.guid+")"},get:function(t){return this._props[t]},set:function(t,e){var n=this._props,i=n[t];i!==e&&(n[t]=e,this.invalidate(1),at.check(this,t,e,i))},cmd:function(t){this._commands||(this._commands=[]),this._commands.push({name:t,args:E.call(arguments,1)}),this.invalidate(8)},statics:{initialize:function(t,e,n,i){e===o||O.call(t,"_props")||(t._props={}),t.$flag=0,t.$meta={guid:Dt++,type:e,tag:n,ns:i||""}},destroy:function(t){if(!(512&t.$flag)){var e;t.off(),at.clean(t);var n=t._bindings;if(n){for(e=n.length-1;0<=e;--e)n[e].destroy();n.length=0}var i,s=t._children;if(s){for(e=s.length-1;0<=e;--e)(i=s[e]).constructor.destroy(i),i._parent=null;t._children.length=0}t.$flag|=512}},getViewEngine:function(t){var e=t.$meta.ns;return null==Nt&&(Nt=Tt.get(v)),e&&!Nt.hasNameSpace(e)?Tt.get(e+":"+v):Nt},addEventListener:function(t,e,n){var i=t.$skin,s=St.getViewEngine(t);if(i&&s)if(s.mayDispatchEvent(i,e.type)){var r=n.flag&(f|c);e.listeners=e.listeners||[];var a=e.listeners[r];if(a)return void a.count++;a=z.getEventListener(t,n.flag),s.addEventListener(i,e.type,a,r&&z.flag2opts(r)),(e.listeners[r]=a).count=1}else e.listeners=null},removeEventListener:function(t,e,n){var i,s,r,a=t.$skin,o=e.listeners,l=St.getViewEngine(t);if(a&&o&&l&&l.mayDispatchEvent(a,e.type))if(2===arguments.length)for(i=0;i<o.length;++i)(r=o[i])&&(r.count=0,o[i]=null,l.removeEventListener(a,e.type,r,z.flag2opts(i)));else{if(!(r=o[s=n.flag&(f|c)]))return;r.count--,r.count<1&&(l.removeEventListener(a,e.type,r,z.flag2opts(s)),o[s]=null)}}}}),C(St.prototype,"style",{get:function(){return this._style||(this._style=new Ct(this)),this._style}});var jt=[],Wt=!1;function Yt(t){jt.push(t),Wt||(Wt=!0,yt.pushCallbackStack(zt))}function zt(){for(var t=0;t<jt.length;++t){var e=jt[t];e._parent||e.detach()}jt.length=0,Wt=!1}function Vt(t){Vt.initialize(this,t)}function Gt(t,e,n){this.scope=t,this.produce=e,this.consume=n,this.execute=this.execute.bind(this),this.invalidate=this.invalidate.bind(this),this.flag=1,this.execute(),this.scope.on("updating",this.execute)}M({constructor:It,statics:{findParent:Mt,flattenChildren:Pt},getParent:function(t){return t?Mt(this):this._parent},getChildren:function(t){return t?Pt(this):this._children?this._children.slice(0):[]},setChildren:function(t){var e,n=this._children,i=t?t.length:0,s=n?n.length:0;if(s===i){for(e=0;e<i&&n[e]===t[e];++e);if(e===i)return}if(s){for(e=0;e<s;++e)n[e]._parent=null,Yt(n[e]);n.length=0}if(i)for(e=0;e<i;++e)this.insertChild(t[e],null);else s&&this.invalidate(2)},insertChild:function(t,e){null==t&&W("The new child to be inserted into this parent must not be null!");var n,i,s,r=this._children;if(r||(r=[],this._children=r),s=r.length,null!=e){for(n=0;n<s&&(r[n]!==e||this!==e._parent);++n);if(n===s&&W("The child before which the new child is to be inserted is not a child of this parent!"),e===t)return}else n=s;if(t._parent)if(t._parent===this){for(i=0;i<s;++i)if(r[i]===t){if(i===n)return;r.splice(i,1),n=i<n?n-1:n,s=r.length;break}}else t._parent.removeChild(t);n<s?r.splice(n,0,t):r.push(t),(t._parent=this).invalidate(2)},appendChild:function(t){this.insertChild(t,null)},removeChild:function(t){null==t&&W("The new child to be removed from this parent must not be null!");var e=0,n=0,i=this._children;if(i)for(e=0,n=i.length;e<n&&(i[e]!==t||this!==t._parent);++e);e===n&&W("The child to be removed is not a child of this parent!"),e<n-1?i.splice(e,1):i.pop(),t._parent=null,Yt(t),this.invalidate(2)},replaceChild:function(t,e){null==t&&W("The new child to be inserted into this parent must not be null!");var n=0,i=0,s=0,r=this._children;if(r)for(n=0,s=r.length;n<s&&(r[n]!==e||this!==e._parent);++n);if(n===s&&W("The child to be replaced is not a child of this parent!"),t!==e){if(t._parent)if(t._parent===this){for(i=0;i<s;++i)if(r[i]===t){r.splice(i,1),n=i<n?n-1:n,s=r.length;break}}else t._parent.removeChild(t);Yt(e),e._parent=null,t._parent=this,r[n]=t,this.invalidate(2)}}}),M({constructor:Vt,extends:St,statics:{initialize:function(t,e){St.initialize(t,o,"",""),t.set("content",null!=e?e:"")}},get:function(t){if("content"===t)return this._content},set:function(t,e){"content"===t&&e!==this._content&&(this._dirty=!0,this._content=e,this.invalidate(1))},update:function(){if(0==(this.$flag&h))return!1;0==(this.$flag&p)&&(this.$flag|=p,yt.insertDigestQueue(this))},digest:function(){if(0==(this.$flag&p))return!1;this.$skin&&this.$flag&r&&(St.getViewEngine(this).renderShell(this.$skin,this),this.$flag&=~r,this._dirty=!1);this.$skin&&!1&this.$flag&&(this.$flag|=a),this.$flag&=~(h|p)},getParent:It.prototype.getParent,toString:function(){var t=this._content;return'"'+((t=null==t?"":t.toString()).length<24?t:t.slice(0,21)+"...")+'"('+this.$meta.guid+")"}}),M({constructor:Gt,statics:{record:function(t,e){var n=t._bindings;n?n.push(e):t._bindings=[e]},remove:function(t,e){var n=t._bindings;n&&n.length&&n.splice(n.lastIndexOf(e),1)},create:function(t,e,n){return new Gt(t,e,n)}},destroy:function(){this.scope.off("updating",this.execute),kt(this)},execute:function(){if(0!==this.flag){bt(this);var t=this.produce.call(this.scope);wt(),this.consume.call(this.scope,t),this.flag=0}},invalidate:function(t){0<=this.keys.indexOf(t)&&(this.scope.invalidate(),this.flag=1)}});var Rt={driveComponent:null,driveChildren:null,driveContent:null,transferProps:null,createContent:null,parseHTMX:null,parseJSX:null};function Ut(t,e){Ut.initialize(this,t,e)}function Ft(t,e,n){Ft.initialize(this,t,e,n)}function Lt(t,e){Lt.initialize(this,t,e||y)}function Xt(){Ut.apply(this,arguments)}M({constructor:Ut,extends:St,mixins:[It.prototype],statics:{__extag_component_class__:!0,destroy:function(t){512&t.$flag||(t.emit("destroying"),St.destroy(t))},initialize:function(e,t,n){var i=e.constructor,s=i.prototype,r=i.attributes,a=i.__extag_template__;if(e.__extag_scopes__=n,nt.applyAttributeDescriptors(s,r),e._props=nt.getAttributeDefaultValues(e),!a)try{i.template||("function"==typeof s.render?i.template="<x:frag>@{{this.render(this._props) ^}}</x:frag>":i.template="<x:frag></x:frag>"),"string"==typeof i.template?a=Rt.parseHTMX(i.template,s):"function"==typeof i.template?a=Rt.parseJSX(i.template,s):W("The static template must be string or function"),a&&(i.__extag_template__=a)}catch(t){ot(t,e,"parsing")}St.initialize(e,"x:frag"!==a.tag?1:u,a.tag,a.ns||"");var o=n&&n[0]&&n[0].context,l=e.setup(o),c=e._actions;if(null!=l)for(var f in"object"!=typeof l&&W("setup() should return object, instead of "+typeof l),l){var h=T(l,f);h.get||h.set?C(e,f,h):e[f]=h.value}o&&null==e.context&&(e.context=o),t&&Rt.driveContent(e,n,t,!0),c&&c.created&&e.emit("created"),e.invalidate()}},get:function(t){var e=nt.getAttrDesc(this,t);return e?(At(this,t),e.get?e.get.call(this,this._props):this._props[t]):this._props[t]},set:function(t,e){var n,i=nt.getAttrDesc(this,t),s=this._props;i?i.get?i.set&&(n=i.get.call(this,s),i.set.call(this,e,s),n!==(e=i.get.call(this,s))&&(this.invalidate(),this.emit("changed",t,e))):(n=s[t])!==e&&(s[t]=e,this.invalidate(),this.emit("changed",t,e)):(n=s[t])!==e&&(s[t]=e,this.invalidate(1),at.check(this,t,e,n))},bind:function(t,e){return Gt.create(this,t,e)},setup:function(t){t&&(this.context=t)},update:function(){if(0!=(this.$flag&h)){if(this.emit("updating"),0==(128&this.$flag)){var t=this.constructor.__extag_template__;Rt.driveComponent(this,t,!0),this.$flag|=128,this._actions&&this._actions.started&&this.emit("started")}var e=this.$meta.type;if(0!==e&&0!=(1&this.$flag)&&Rt.transferProps(this),this._contents&&(this._contents.length?this._contents.length=0:this._contents=null),0==(this.$flag&p)){if(0===e&&this._parent&&2&this.$flag){var n=this.getParent(!0);n.$flag|=2,0==(n.$flag&p)&&(n.$flag|=p,yt.insertDigestQueue(n))}this.$flag|=p,yt.insertDigestQueue(this)}}},digest:function(){if(0!=(this.$flag&p)){if(this.$skin&&0!==this.$meta.type&&this.$flag&r)St.getViewEngine(this).renderShell(this.$skin,this),at.clean(this),this._style&&at.clean(this._style),this.$style&&at.clean(this.$style),this.$props&&at.clean(this.$props),this._commands&&(this._commands=null),this.$flag&=~r;this.$flag&=~(h|p);var t=this._actions;if(0==(this.$flag&a)){if(0===this.$meta.type){var e=It.findParent(!0);e&&e.$skin&&(this.$flag|=a)}else this.$skin&&(this.$flag|=a);t&&t.mounted&&this.$flag&a&&yt.pushCallbackStack(function(){this.emit("mounted")}.bind(this))}t&&t.updated&&yt.pushCallbackStack(function(){this.emit("updated")}.bind(this))}},accept:function(t,e){t=null==t?y:Array.isArray(t)?N(t):[t],(this._contents||t.length)&&(this._contents=t.slice(0),this._contents.scopes=e||y,this.emit("contents",this._contents),this.invalidate(4))},addNamedPart:function(t,e){this[t]=e}}),M({constructor:Ft,extends:Ut,statics:{initialize:function(t,e,n,i){Ut.initialize(t,e,n,i),n[0].on("contents",t.onScopeContents.bind(t)),t.on("updating",t.onUpdating.bind(t)),t.scopes=n,t.collect()},template:"<x:frag></x:frag>"},collect:function(){var t,e,n,i,s,r,a=this.scopes;if(a[0]._contents){if(r=[],s=a[0]._contents,r.scopes=s.scopes,s&&0<s.length)for(e=this.get("name")||"",i=0,n=s.length;i<n;++i)null!=(t=s[i])&&e===(t.slot||"")&&r.push(t);this._collection=r,this.invalidate()}},onUpdating:function(){if(this._collection||this._contents){var t=this.scopes,e=this._contents,n=this._collection;n&&n.length?(t=n.scopes,Rt.driveChildren(this,t,n,!!t)):e&&e.length?(t=e.scopes,n=e.slice(0),Rt.driveChildren(this,t,n,!!t)):this.setChildren([]),this._collection=null,this._contents&&(this._contents.length?this._contents.length=0:this._contents=null)}else this.setChildren([])},onScopeContents:function(){this.collect()}}),M({constructor:Lt,extends:St,mixins:[It.prototype],statics:{__extag_fragment_class__:!0,initialize:function(t,e,n){St.initialize(t,0,"x:frag",""),t.__extag_scopes_=n,e&&Rt.driveContent(t,n,e,!0)}},accept:function(t,e){null==t?t=y:Array.isArray(t)||(t=[t]),Rt.driveChildren(this,e||y,t,!1)},update:function(){if(0!=(this.$flag&h)&&0==(this.$flag&p)){if(this._parent&&2&this.$flag){var t=this.getParent(!0);t&&(t.$flag|=2,0==(t.$flag&p)&&(t.$flag|=p,yt.insertDigestQueue(t)))}this.$flag|=p,yt.insertDigestQueue(this)}},digest:function(){if(0==(this.$flag&p))return!1;this.$flag&=~(h|p),at.clean(this)}});var Qt={};function qt(t,e){qt.initialize(this,t,e||y)}function Ht(t,e){for(var n=0;n<e.length;++n)if(e[n]&&e[n].xkey===t)return e[n]}function Zt(t,e){for(var n=0;n<e.length;++n)if(e[n]&&e[n].xkey===t)return e[n]}function Bt(){Ut.apply(this,arguments)}M({constructor:Xt,extends:Ut,setup:function(){var e=this;e.on("contents",function(t){e.fragment||(e.fragment=new Lt),e.fragment.accept(t,t.scopes)}),e.on("updating",function(){var t=e.getPool();t.target?t.target.append(e):t.portals.push(e)},{once:!0}),e.on("destroying",function(){var t=e.getPool();t.target&&t.target.remove(e),e.fragment&&e.fragment.setChildren([])})},getPool:function(){var t=this.get("target"),e=Qt[t];return e||(e=Qt[t]={portals:[]}),e}}),Xt.Target=M({extends:Ut,statics:{fullname:"Portal.Target"},setup:function(){var i=this;i.on("updating",function(){var t=i.get("name"),e=Qt[t];if(e)if(!e.target&&e.portals.length){for(var n=0;n<e.portals.length;++n)e.portals[n].fragment&&i.append(e.portals[n]);e.portals.length=0}else W('A portal target with the same name="'+t+'" already exists');else Qt[t]={target:i,portals:[]}},{once:!0}),i.on("destroying",function(){var t=i.get("name");delete Qt[t]})},append:function(t){t.fragment||(t.fragment=new Lt),this.appendChild(t.fragment)},remove:function(t){t.fragment&&this.removeChild(t.fragment)}}),M({constructor:qt,extends:St,mixins:[It.prototype],statics:{__extag_element_class__:!0,initialize:function(t,e,n){St.initialize(t,1,e.tag,e.ns),t.__extag_scopes__=n,e&&Rt.driveContent(t,n,e,!0)}},accept:function(t,e){null==t?t=y:Array.isArray(t)||(t=[t]),Rt.driveChildren(this,e||y,t,!1)},update:function(){if(0==(this.$flag&h))return!1;0!=(1&this.$flag)&&Rt.transferProps(this),0==(this.$flag&p)&&(this.$flag|=p,yt.insertDigestQueue(this))},digest:function(){if(0==(this.$flag&p))return!1;this.$skin&&this.$flag&r&&(St.getViewEngine(this).renderShell(this.$skin,this),at.clean(this),this._style&&at.clean(this._style),this._commands&&(this._commands=null),this.$flag&=~r);this.$skin&&!1&this.$flag&&(this.$flag|=a),this.$flag&=~(h|p)}}),M({constructor:Bt,extends:Ut,setup:function(){this.fragments=[],this.recyclebin=new Lt,this.on("contents",this.onContents.bind(this)),this.on("destroying",this.onDestroying.bind(this))},onContents:function(t){var e,n,i,s;for(function(t,e){for(var n=[],i=0;i<t.length;++i){var s=t[i];null!=s&&null!=s.xkey&&(0<=n.indexOf(s.xkey)&&W("duplicated xkey `"+s.xkey+"` for all contents of ",e),n.push(s.xkey))}}(t,this),s=(e=this.getChildren()).length-1;0<=s;--s)null!=(i=e[s]).xkey&&((n=Zt(i.xkey,t))||(this.removeChild(i),this.recyclebin.appendChild(i)));for(e=[],s=0;s<t.length;++s)null!=(n=t[s])&&(null!=n.xkey?(i=Ht(n.xkey,this.fragments))||((i=new Lt).xkey=n.xkey,this.fragments.push(i)):i=new Lt,i.accept([n],t.scopes),e.push(i));this.setChildren(e)},onDestroying:function(){this.recyclebin.detach()}});var Jt,Kt={ASSIGN:-1,ONE_TIME:0,ONE_WAY:1,TWO_WAY:2,ANY_WAY:3};function te(t,e){return t.converters&&t.converters.length?function(t,e,n){for(var i=0;i<t.length;++i)n=Jt(t[i],S(e,n));return n}(t.converters,e,Jt(t.evaluator,e)):Jt(t.evaluator,e)}function ee(t){this.pattern=t}function ne(t){this.pattern=t}function ie(t){return{once:0<=t.indexOf("once"),capture:0<=t.indexOf("capture"),passive:0<=t.indexOf("passive")}}function se(t,e){"object"==typeof e&&e&&t&&t.length&&(0<=t.indexOf("stop")&&e.stopPropagation&&e.stopPropagation(),0<=t.indexOf("prev")&&e.preventDefault&&e.preventDefault())}function re(t,e){this.binding=t,this.pattern=e}Jt=function(t,e){return t.apply(e[0],e)},M({constructor:ee,statics:{MODES:Kt,create:function(t){return new ee(t)}},connect:function(t,e,n){this.flag=0,this.scopes=n,this.target=e,this.targetProp=t;var i=this.pattern;i.mode!==Kt.ASSIGN?(this.execute=this.execute.bind(this),this.invalidate=this.invalidate.bind(this),i.mode===Kt.TWO_WAY&&(this.backward=this.backward.bind(this),nt.getAttrDesc(this.target,this.targetProp)&&this.target.on("changed",this.backward)),this.flag=1,this.execute(),(this.deps&&this.deps.length||i.mode===Kt.ANY_WAY)&&(n[0].on("updating",this.execute),Gt.record(e,this))):this.target.set(this.targetProp,te(i,n))},replace:function(t){if(1<t.length&&t.length===this.scopes.length){for(var e,n=t.length-1;0<=n;--n)if(t[n]!==this.scopes[n]){e=!0;break}e&&(this.scopes=t,this.flag=1,this.execute())}},destroy:function(){var t=this.scopes;this.pattern.mode===Kt.TWO_WAY&&nt.getAttrDesc(this.target,this.targetProp)&&this.target.off("changed",this.backward),t[0].off("updating",this.execute),kt(this)},execute:function(){var t=this.pattern;if(0!==this.flag||t.mode===Kt.ANY_WAY){bt(this);var e=te(t,this.scopes);wt(),this.target.set(this.targetProp,e),this.flag=0,t.mode===Kt.ONE_TIME&&this.destroy()}},backward:function(t){if(t===this.targetProp){var e=this.target[this.targetProp],n=this.pattern.evaluator.path,i=n.from,s=n.length,r=this.scopes;2===s?(0<=i?r[i]:r[0].constructor.resources).set(n[1],e):2<s&&(0<=i?g.search(n.slice(1,s-1),r[i],!0):g.search(n.slice(1,s-1),r[0].constructor.resources,!0)).set(n[s-1],e)}},invalidate:function(t){this.keys&&0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}}),M({constructor:ne,statics:{create:function(t){return new ne(t)}},connect:function(t,e,n){this.type=t,this.target=e;var i=this.pattern,s=i.handler,r=i.evaluator,a=i.modifiers;if(s){var o=n[0][s];if(!o)return;a&&a.length?"bind"===a[0]&&1===a.length?this.handler=o.bind(n[0]):(this.handler=function(t){se(a,t),0<=a.indexOf("bind")?o.apply(n[0],arguments):o.apply(null,arguments)},this.options=ie(a)):this.handler=o}else n.length<=1?a&&a.length?(this.handler=function(t){se(a,t),r.apply(n[0],S(n,t))},this.options=ie(a)):this.handler=function(t){r.apply(n[0],S(n,t))}:(this.scopes=n,a&&a.length?(this.handler=function(t){se(a,t),r.apply(n[0],S(n,t))}.bind(this),this.options=ie(a)):this.handler=function(t){r.apply(n[0],S(n,t))}.bind(this));this.handler&&(this.options?e.on(t,this.handler,this.options):e.on(t,this.handler),Gt.record(e,this))},replace:function(t){if(this.scopes&&1<t.length&&this.scopes.length===t.length)for(var e=1;e<t.length;++e)this.scopes[e]=t[e]},destroy:function(){var t=this.handler;t&&(this.options?this.target.off(this.type,t,this.options):this.target.off(this.type,t))}}),M({constructor:re,connect:function(t,e,n){this.binding.create(this.pattern).connect(t,e,n)}});var ae=ee.MODES;function oe(t){this.pattern=t}function le(t,e){le.initialize(this,t,e)}function ce(t,e){if(!Y(t))return new Vt(t);var n,i,s,r=t.useExpr;return t.xif||t.xfor||t.xtype?s=new le(t,e):r&&t.type===re?"frag"===(i=t.expr).pattern.target?(s=new Lt(null,e),i.connect("accept",s,e)):(s=new Vt(""),i.connect("content",s,e)):(s=(n=t.type)?new n(t,e):new qt(t,e),t.name&&e[0].addNamedPart(t.name,s)),s}function fe(t,e,n,i){var s,r,a=t._events;if(a)for(s in a)"function"==typeof(r=a[s])?t.off(s,r):Array.isArray(r)&&t.off(s,r[0],r[1]);if(n)for(s in n)r=n[s],i&&r instanceof re?r.connect(s,t,e):"function"==typeof r?t.on(s,r):Array.isArray(r)&&t.on(s,r[0],r[1]);i||(t._events=n)}function he(t,e,n,i,s){var r,a,o,l=t._props;if(l&&!s)if(t instanceof Ut)for(r in l)n&&r in n||((a=nt.getAttrDesc(t,r))?t.set(r,nt.getAttributeDefaultValue(a)):t.set(r,null));else for(r in l)n&&r in n||t.set(r,null);if(n)for(r in n)o=n[r],i&&o instanceof re?o.connect(r,t,e):t.set(r,o)}function ue(t,e){var n=t.$meta;return n.type===o&&e.__extag_node__!==d||t.__extag_key__===e.xkey&&(e.type?t.constructor===e.type:n.tag===e.tag&&n.ns===e.ns)}function pe(t,e,n){Y(e)?(he(t,n,e.attrs),fe(t,n,e.events),ge(t,n,e.contents,e.useExpr,t instanceof Ut)):t.set("content",e)}function ge(t,e,n,i,s){var r;if(n?n.length&&(n=function t(e,n,i){var s,r,a=e.length;if(!n)for(s=0;s<a;++s)if(null==(r=e[s])||Array.isArray(r)){n=[];break}if(n)for(s=0;s<a;++s)r=e[s],Array.isArray(r)?t(r,n,i):null!=r&&(n.push(r),i&&Y(r)&&!r.ns&&(r.ns=i));else for(s=0;s<a;++s)r=e[s],i&&Y(r)&&!r.ns&&(r.ns=i);return n||e}(n,null,t.$meta.ns)):n=y,i&&1===n.length&&Y(n[0])&&n[0].type===re){var a=n[0].expr;if(a instanceof re&&"frag"===a.pattern.target)return void(!s&&t instanceof Ut?a.connect(function(t,e){Lt.prototype.accept.call(this,t,e)},t,e):a.connect("accept",t,e))}s?t.accept(n,e):(r=i?function(t,e){var n,i,s,r=[];if(t&&t.length)for(n=0,i=t.length;n<i;++n)(s=ce(t[n],e))&&r.push(s);return r}(n,e):function(t,e,n){for(var i,s,r,a,o=n._children||y,l=t||y,c=new Array(l.length),f=0,h=o.length-1,u=0,p=l.length-1,g=o[f],d=o[h],v=l[u],_=l[p];f<=h&&u<=p;)if(null==g)g=o[++f];else if(null==d)d=o[--h];else if(ue(g,v))pe(c[u]=g,v,e),g=o[++f],v=l[++u];else if(ue(d,_))pe(c[p]=d,_,e),d=o[--h],_=l[--p];else if(ue(g,_))pe(c[p]=g,_,e),g=o[++f],_=l[--p];else if(ue(d,v))pe(c[u]=d,v,e),d=o[--h],v=l[++u];else{if(!s)for(s={},a=f;a<=h;++a)(r=o[a].__extag_key__)&&(s[r]=a);null!=(a=(r=v.xkey)&&s[r])&&ue(o[a]||x,v)?c[u]=o[a]:((i=ce(v,e)).__extag_key__=r,c[u]=i),v=l[++u]}if(h<f)for(;u<=p;)(i=ce(v,e)).__extag_key__=v.xkey,c[u]=i,v=l[++u];return c}(n,e,t),t.setChildren(r))}M({constructor:oe,statics:{create:function(t){return new oe(t)}},connect:function(t,e,n){this.scopes=n,this.target=e,this.property=t,this.flag=1;var i,s,r,a=this.pattern;for(i=0,s=a.length;i<s;++i)(r=a[i])instanceof re&&(null!=this.mode&&this.mode!==r.pattern.mode&&W("all embedded expressions must have same data-binding mode for TextBinding"),this.mode=r.pattern.mode);if(null!=this.mode&&this.mode!==ae.ASSIGN)this.invalidate=this.invalidate.bind(this),this.execute=this.execute.bind(this),this.execute(),n[0].on("updating",this.execute),Gt.record(e,this);else{var o=this.evaluate();e.set(t,o.join(""))}},replace:function(t){1<t.length&&t.length===this.scopes.length&&(this.scopes=t,this.flag=1,this.execute())},destroy:function(){this.scopes[0].off("updating",this.execute),kt(this)},evaluate:function(){var t,e,n,i=[],s=this.pattern;for(t=0,e=s.length;t<e;++t)(n=s[t])instanceof re&&(n=te(n.pattern,this.scopes)),i.push(n);return i},execute:function(){if(0!==this.flag||this.mode===ae.ANY_WAY){bt(this);var t=this.evaluate();wt(),this.target.set(this.property,t.join("")),this.flag=0,this.mode===ae.ONE_TIME&&this.destroy()}},invalidate:function(t){this.keys&&0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}}),M({constructor:le,extends:Ut,statics:{initialize:function(t,e,n){if(Ut.initialize(t),t.mode=0,e){t.scopes=n;var i=D({},e);delete(t.template=i).xtype,delete i.xkey,delete i.xfor,delete i.xif,t.set("condition",!0),e.xif&&(t.mode=1,i.xif.connect("condition",t,n)),e.xfor&&(t.mode=2,t.varaibles=e.xfor[0],e.xfor[1].connect("iterable",t,n),e.xkey&&(t.keyExpr=e.xkey)),e.xtype&&(t.mode=t.mode||1,t.xtype=!0,e.xtype.connect("component",t,n)),t.refresh(),n[0].on("updating",function(){t.refresh()})}},template:"<x:frag></x:frag>"},refresh:function(){if(this.mode&&(this.hasDirty("condintion")||this.hasDirty("component")||this.hasDirty("iterable")||this.hasDirty("xtype"))){var t=this.get("condition"),e=this.get("component"),n=this.template,i=this.scopes,s=[];if(t){if(this.xtype){if(!e||!e.__extag_component_class__)return void this.setChildren(s);n=D({},n,{type:e})}if(1===this.mode)return(a=Rt.createContent(n,i,!0))&&s.push(a),void this.setChildren(s);var r,a,o,l,c,f,h,u={},p=this.get("iterable")||[],g=this._children||[],d=this.varaibles,v=this.keyExpr;for(f=0,c=g.length;f<c;++f)"__extag_key__"in g[f]&&(u[l=g[f].__extag_key__]=f);for(f=0,c=p.length;f<c;++f){a=l=null,o=p[f];var _,x={};x[d[0]]=o,d[1]&&(x[d[1]]=f),h=i.concat([x]),v&&null!=(r=u[l=te(v.pattern,h)])&&(a=g[r]),a?(_=(h=a.__extag_scopes__)[h.length-1]).assign(x):(_=new $t(x),h[h.length-1]=_,(a=Rt.createContent(n,h)).__extag_key__=l,a.__extag_scopes__=h),s.push(a)}this.setChildren(s)}else this.setChildren(s)}}});var de=ee.MODES;function ve(t){this.pattern=t}function _e(t,e,n){ve.create(n).connect("class",t,e)}function xe(t){var e=typeof t;if("object"===e)return t;if("string"===e){var n,i,s,r,a,o={},l=t.split(";");for(s=0;s<l.length;++s)0<(i=(n=l[s]).indexOf(":"))&&(r=n.slice(0,i).trim(),a=n.slice(i+1).trim(),r&&(o[r]=a));return o}}M({constructor:ve,statics:{create:function(t){return new ve(t)}},connect:function(t,e,n){this.scopes=n,this.target=e,this.property=t,this.flag=1;var i,s,r=this.pattern;for(i in r)(s=r[i])instanceof re&&(null!=this.mode&&this.mode!==s.pattern.mode&&W("all embedded expressions must have same data-binding mode for ClassBinding"),this.mode=s.pattern.mode);if(null!=this.mode&&this.mode!==de.ASSIGN)this.invalidate=this.invalidate.bind(this),this.execute=this.execute.bind(this),this.execute(),n[0].on("updating",this.execute),Gt.record(e,this);else{var a=this.evaluate();e.set(t,a)}},replace:function(t){1<t.length&&t.length===this.scopes.length&&(this.scopes=t,this.flag=1,this.execute())},destroy:function(){this.scopes[0].off("updating",this.execute),kt(this)},evaluate:function(){var t,e,n={},i=this.pattern;for(t in i)(e=i[t])instanceof re&&(e=te(e.pattern,this.scopes)),n[t]=e;return n},execute:function(){if(0!==this.flag||this.mode===de.ANY_WAY){bt(this);var t=this.evaluate();wt(),this.target.set(this.property,t),this.flag=0,this.mode===de.ONE_TIME&&this.destroy()}},invalidate:function(t){this.keys&&0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}}),Rt.createContent=ce,Rt.driveChildren=ge,Rt.driveContent=function(t,e,n,i){var s=n.useExpr;n.events&&fe(t,e,n.events,s),n.attrs&&he(t,e,n.attrs,s,i),s&&(n.style&&he(t.style,e,n.style,s,i),n.classes&&_e(t,e,n.classes)),n.contents&&ge(t,e,n.contents,s,t instanceof Ut)},Rt.driveComponent=function(t,e,n){var i=[t],s=e.useExpr;e.events&&fe(t,i,e.events,s),e.attrs&&(t.$props=new Ct(t),he(t.$props,i,e.attrs,s,n)),s&&(e.style&&(t.$style=new Ct(t),he(t.$style,i,e.style,s,n)),e.classes&&(t.$props=t.$props||new Ct(t),_e(t.$props,i,e.classes))),e.contents&&ge(t,i,e.contents,s)},Rt.transferProps=function(t){var e;if(t.$meta.type!==o&&(t.hasDirty("style")&&(at.clean(t,"style"),e=xe(t.get("style")),t.style.reset(e)),t.$props&&t.constructor.__extag_component_class__)){var n,i,s,r=t.$props;if(r.hasDirty("style")){var a=((s=(n=t)[i="$style"])||(s=new Ct(n),n[i]=s),s);at.clean(r,"style"),e=xe(e=r.get("style")),a.reset(e)}}};var ye=/[\w).+\-_$\]]/,me="abstract arguments boolean break byte case catch char class const continue debugger default delete do double else enum eval export extends false final finally float for function goto if implements import in instanceof int interface let long native new null package private protected public return short static super switch synchronized this throw throws transient true try typeof undefined var void volatile while with yield isNaN isFinite parseFloat parseInt Array Date Infinity Math NaN Number Object String Boolean RegExp JSON",be={};function we(t,e){for(var n,i=t.length;e<i;){if(!(32===(n=t.charCodeAt(e))||9<=n&&n<=13))return 44!==n&&123!==n;--e}}function Ae(t,e){for(var n="$"+e;0<=t.indexOf(n);)n="$"+n;return n}function ke(t,e){for(var n=e.length-1;0<=n;--n)if("string"==typeof e[n]){if(t===e[n])return n}else if(0<=e[n].indexOf(t))return n;return-1}function $e(t,e){for(var n,i,s,r=t.length;e<r;)if(32===(n=t.charCodeAt(e))||9<=n&&n<=13)s=!0,++e;else{if(46===n)i&&W("Unexpected token '.'.",{code:1001,expr:t}),i=!(s=!1);else{if(!(Ee(n)||48<=n&&n<=57)){i&&W("Unexpected token '"+t[e]+"'.",{code:1001,expr:t});break}if(s&&!i){--e;break}i=s=!1}++e}return e}function Ee(t){return 97<=t&&t<=122||65<=t&&t<=90||95===t||36===t}function Ce(t,e,n){for(var i=e.length;n<i;){if(e.charCodeAt(n)===t&&92!==e.charCodeAt(n-1))return n;++n}return i}function Oe(t,e){for(var n;0<=--e&&(32===(n=t.charCodeAt(e))||9<=n&&n<=13););return!n||!ye.test(String.fromCharCode(n))}function Te(t,e,n,i){try{t.push(e.join("\n"));var s=Function.apply(null,t);return n&&(s.path=n),s}catch(t){W(t,{code:1001,expr:i,desc:"Illegal expression `"+i+"`."})}}!function(){for(var t=me.split(/\s+/),e=0,n=t.length;e<n;++e)be[t[e]]=!0}();var De={regexStarts:Oe,gotoEnding:Ce,parse:function(t,e,n,i){var s,r,a=[],o=[];for(s=0;s<n.length;++s)"$"===n[s][0]?o.push(n[s]):o.push(Ae(t,s));var l=o.slice(0),c=e.constructor.resources,f=g.parse(t);if(f&&f.length&&(!O.call(be,f[0])||"this"===f[0]))return f.from=ke(f[0],n),f.from<0?c&&O.call(c,f[0])?a.push("var "+f[0]+" = this.constructor.resources."+f[0]+";"):(f.unshift("this"),f.from=0):"string"!=typeof n[f.from]&&f.unshift(o[f.from]),a.push("return "+f.join(".")),Te(o,a,f,i);var h,u=0,p=function(t){for(var e,n,i,s=[],r=t.length,a=0;a<r;)if(n=e,32===(e=t.charCodeAt(a))||9<=e&&e<=13)++a;else{switch(e){case 39:case 34:(a=Ce(e,t,a+1))===r&&W("Unclosed "+String.fromCharCode(e)+" .",{code:1001,expr:t});break;case 47:Oe(t,a)&&(a=Ce(e,t,a+1))===r&&W("Unclosed "+String.fromCharCode(e)+" .",{code:1001,expr:t});break;default:if(46===n){a=$e(t,a+1);continue}if(Ee(e)){i=$e(t,a+1),58!==t.charCodeAt(i)?s.push(a,i):we(t,a-1)&&s.push(a,i),a=i;continue}}++a}return s}(t);for(r=0;r<p.length;r+=2)p[r+1]<0||(h=t.slice(p[r]+u,p[r+1]+u),f=g.parse(h.replace(b,"")),O.call(be,f[0])||((s=ke(f[0],n))<0?c&&O.call(c,f[0])?(a.push("var "+f[0]+" = this.constructor.resources."+f[0]+";"),l.push(f[0])):(t=t.slice(0,p[r]+u)+"this."+h+t.slice(p[r+1]+u),u+=5):"string"!=typeof n[s]&&(t=t.slice(0,p[r]+u)+o[s]+"."+h+t.slice(p[r+1]+u),u+=o[s].length+1)));return a.push("return "+t),Te(o,a,null,i)}},Ne=ee.MODES,Se={parse:function(t,e,n){var i,s,r,a,o,l,c=-1,f=t.length;if(t[0]===m.TWO_WAY?(c=Ne.TWO_WAY,t=t.slice(1,f)):t[f-1]===m.ANY_WAY?(c=Ne.ANY_WAY,t=t.slice(0,f-1)):t[f-1]===m.ASSIGN?(c=Ne.ASSIGN,t=t.slice(0,f-1)):t[f-1]===m.ONE_TIME?(c=Ne.ONE_TIME,t=t.slice(0,f-1)):c=Ne.ONE_WAY,c===Ne.TWO_WAY)g.test(t.trim())||W("Invalid two-way binding expression!",{code:1001,expr:arguments[0],desc:"`"+arguments[0]+"` is not a valid two-way binding expression. Must be a property name or path."}),a=De.parse(t,e,n,arguments[0]);else if(t.indexOf(m.CONVERTER)<0)a=De.parse(t,e,n,arguments[0]);else if(o=t.split(m.CONVERTER),a=De.parse(o[0],e,n,arguments[0]),1<o.length)for(i=1;i<o.length;++i){(l=o[i].trim())||W("Converter must not be empty!",{code:1001,expr:arguments[0],desc:"Empty converter in the expression `"+arguments[0]+"` is not allowed."});for(var h="$value";0<=t.indexOf(h);)h="$"+h;var u=l.indexOf("(");l=0<u?l.slice(0,u+1)+h+","+l.slice(u+1):l+"("+h+")",r=De.parse(l,e,n.concat([h]),arguments[0]),(s=s||[]).push(r)}var p={mode:c,evaluator:a};return s&&s.length&&(p.converters=s),p}},Ie={parse:function(t,e,n){var i=t.indexOf(m.MODIFIER)<0?[t]:t.split(m.MODIFIER);i[0]=i[0].trim();var s={};if($.test(i[0])?s.handler=i[0].replace(k,""):((n=n.slice(0)).push("$event"),s.evaluator=De.parse(i[0],e,n)),1<i.length){for(var r=[],a=1;a<i.length;++a)r.push(i[a].trim());s.modifiers=r}return s}},Me={tryParse:function(t){return"false"!==t&&("true"===t||(isNaN(t)?void 0:Number(t)))}},Pe=ee.MODES;function je(t){this.pattern=t}M({constructor:je,statics:{create:function(t){return new je(t)}},connect:function(t,e,n){this.flag=0,this.scopes=n,this.target=e,this.method="function"==typeof t?t:e[t];var i=this.pattern;i.mode!==Pe.ASSIGN?(this.execute=this.execute.bind(this),this.invalidate=this.invalidate.bind(this),this.flag=1,this.execute(),n[0].on("updating",this.execute),Gt.record(e,this)):this.target.set(this.targetProp,te(i,n))},destroy:function(){this.scopes[0].off("updating",this.execute),kt(this)},execute:function(){var t=this.pattern;if(0!==this.flag||t.mode===Pe.ANY_WAY){bt(this);var e=te(t,this.scopes);wt(),this.method.call(this.target,e,this.scopes),this.flag=0,t.mode===Pe.ONE_TIME&&this.destroy()}},invalidate:function(t){this.keys&&0<=this.keys.indexOf(t)&&(this.scopes[0].invalidate(),this.flag=1)}});var We=ee.MODES;function Ye(t){t!==m.DATA&&t!==m.TEXT&&W(t+" is not allowed in expr() for data binding")}function ze(t,e){var n,i,s,r=t.attrs;if(t.xif&&(Ye((s=t.xif.args)[0]),t.xif=Re(s,t,e)),t.xfor&&(Array.isArray(t.xfor[0])||(t.xfor[0]=t.xfor[0].replace(b,"").split(",")),Ye((s=t.xfor[1].args)[0]),t.xfor[1]=Re(s,t,e),t.identifiers=t.identifiers.concat([t.xfor[0]])),t.xkey&&(Ye((s=t.xkey.args)[0]),t.xkey=Re(s,t,e)),r)for(i in r)(n=r[i])&&"object"==typeof n&&(n.__extag_expr__===re?(Ye((s=n.args)[0]),r[i]=Re(s,t,e)):"style"===i&&(t[i]=Ge(n,t,e),delete r[i]));if(null==t.type&&null==t.xtype)switch(t.tag){case"x:slot":t.type=Ft;break;case"x:frag":t.type=Lt}t.events&&function(t,e){var n,i,s,r,a=t.events;for(n in a)(r=a[n])&&"object"==typeof r&&r.__extag_expr__===re&&((s=r.args)[0]!==m.EVENT&&W(s[0]+" is not allowed in expr() for event binding"),(i=Re(s,t,e))&&(a[n]=i))}(t,e)}function Ve(t,e,n){var i=typeof t;return"string"===i?De.parse(t,e,n):"function"===i?t:void W("evaluator must be string or function")}function Ge(t,e,n){var i,s;for(i in t)(s=t[i])&&"object"==typeof s&&s.__extag_expr__===re&&(t[i]=Re(s.args,e,n));return t}function Re(t,e,n){t.length<2&&W("Unexpected arguments for expr()");var i,s,r,a=t[0],o=t[1],l=typeof o;if(a===m.DATA||a===m.FRAGMENT){if(a===m.FRAGMENT&&(i="frag"),2===t.length&&"string"===l)return i||o[0]!==m.TWO_WAY?null!=(r=Me.tryParse(o.trim()))?r:new re("frag"===((s=Se.parse(o,n,e.identifiers)).target=i)?je:ee,s):(g.test(o.slice(1))||W("Invalid two-way binding expression!",{code:1001,expr:arguments[0],desc:"`"+arguments[0]+"` is not a valid two-way binding expression. Must be a property name or path."}),new re(ee,s={mode:We.TWO_WAY,evaluator:Ve(o.slice(1),n,e.identifiers)}));switch(t[t.length-1]){case m.ASSIGN:a=We.ASSIGN,t=t.slice(0,-1);break;case m.ANY_WAY:a=We.ANY_WAY,t=t.slice(0,-1);break;case m.ONE_TIME:a=We.ONE_TIME,t=t.slice(0,-1);break;default:a=We.ONE_WAY}return new re("frag"===i?je:ee,s={mode:a,target:i,evaluator:Ve(o,n,e.identifiers),converters:t.length<=2?null:function(t,e,n){for(var i,s=[],r=0;r<t.length;++r)i=Ve(t[r],e,n),s.push(i);return s}(t.slice(2),n,e.identifiers)})}if(a===m.EVENT)return"string"===l&&2===t.length?s=Ie.parse(o,n,e.identifiers):"function"===l?s={evaluator:Ve(o,n,e.identifiers),modifiers:2<t.length?t.slice(2):null}:W("Unexpected arguments for expr()"),new re(ne,s);if(a===m.TEXT){s=[];for(var c=1;c<t.length;++c)(o=t[c])&&"object"==typeof o&&o.__extag_expr__&&(o=Re(o.args,e,n)),s.push(o);return new re(oe,s)}W('The first argument of expr() should be one of "@", "+", "#", "{}"')}var Ue={xns:!0,xif:!0,xfor:!0,xkey:!0,xname:!0,xslot:!0,xtype:!0,events:!0};function Fe(t,e,n){var i={__extag_node__:d},s=typeof t;if("string"===s){var r=t.indexOf(":");if(r<0)i.ns="",i.tag=t;else{if("x"===t.slice(0,r))switch(t){case"x:slot":i.tag=t,i.type=Ft;break;case"x:frag":i.tag=t,i.type=Lt}i.type||(i.ns=t.slice(0,r),i.tag=t.slice(r+1))}}else if("function"===s)if(t.__extag_component_class__||t===Lt)i.type=t;else{var a=Tt.get(_);a&&(i.type=a.getHookableComponentClass(t)),"function"==typeof i.type&&i.type.__extag_component_class__||W("component class is not found.")}else W("The first argument must be string, function, component class or constructor.");if(e&&"object"==typeof e){e.xns&&(i.ns=e.xns),e.xif&&(i.xif=e.xif),e.xfor&&(i.xfor=e.xfor),e.xkey&&(i.xkey=e.xkey),e.xname&&(i.name=e.xname),e.xslot&&(i.slot=e.xslot),e.xtype&&(e.xtype instanceof re?i.xtype=e.xtype:i.type=e.xtype),e.events&&(i.events=e.events);var o,l={};for(o in e)!Ue[o]&&O.call(e,o)&&(l[o]=e[o]);i.attrs=l}return null!=n&&(3<arguments.length?n=E.call(arguments,2):Array.isArray(n)||(n=[n]),i.contents=n),i}function Le(){return{args:E.call(arguments,0),__extag_expr__:re}}var Xe={node:Fe,expr:Le,parse:function(t,e){var n=t(Fe,Le);return n.__extag_node__!==d&&W("template root must be a tag node"),n.useExpr=!0,n.identifiers=["this"],ze(n,e),function t(e,n){var i,s,r=e.contents;if(r&&r.length)for(i=(r=e.contents=N(r)).length-1;0<=i;--i)if("object"==typeof(s=r[i])){if(s.__extag_node__===d){e.ns&&!s.ns&&(s.ns=e.ns),s.useExpr=!0,s.identifiers=e.identifiers,ze(s,n),t(s,n);continue}if(s.__extag_expr__===re){var a=s.args[0];a!==m.DATA&&a!==m.FRAGMENT&&W(a+" is not allowed in expr() for text or fragment binding"),r[i]={__extag_node__:d,useExpr:!0,type:re,expr:Re(s.args,e,n)}}}}(n,e),n.type&&(n.type===Lt?(n.tag="x:frag",n.type=null):W("component can not be used as root tag of another component template.")),(n.xif||n.xfor||n.xkey)&&W("`xif`, `xfor`, `xkey` can not be used on root tag of component template."),n}};Rt.parseJSX=Xe.parse;var Qe=/\s*\n\s*/g,qe=new RegExp(m.DATA+"\\"+"{}"[0]+"(\\s|.)*?\\"+"{}"[1]),He={like:function(t){return qe.test(t)},parse:function(e,t,n){for(var i,s,r,a,o,l,c=[],f=0,h=e.length,u=0,p=0;u<h;){switch(r=s,s=e.charCodeAt(u)){case 125:if(a&&0===--p){f<i&&(l=(l=e.slice(f,i)).replace(Qe," "))&&(l=j(l),c.push(l));try{123===e.charCodeAt(i+2)&&125===e.charCodeAt(u-1)?(o=Se.parse(e.slice(i+3,u-1),t,n)).target="frag":(o=Se.parse(e.slice(i+2,u),t,n)).target="text"}catch(t){e=e.slice(i,u+1),W(t,{code:1001,expr:e})}c.push(new re("frag"===o.target?je:ee,o)),f=i=u+1,a=!1}break;case 123:a?(64===r&&W("Unclosed @{ .",{code:1001,expr:e}),++p):64===r&&(i=u-1,a=!0,p=1);break;case 39:case 34:a&&(u=De.gotoEnding(s,e,u+1))===h&&W("Unclosed "+String.fromCharCode(s)+" .",{code:1001,expr:e});break;case 47:a&&De.regexStarts(e,u)&&(u=De.gotoEnding(s,e,u+1))===h&&W("Unclosed "+String.fromCharCode(s)+" .",{code:1001,expr:e})}++u}return a&&W("Unclosed @{ .",{code:1001,expr:e}),0<f&&f<h&&(l=(l=e.slice(f,h)).replace(Qe," "))&&(l=j(l),c.push(l)),c.length?c:null}},Ze=/;/g,Be=/^[a-z0-9\-_]+$/i,Je={parse:function(t,e,n,i){var s,r,a,o,l,c,f,h,u={},p=t.split(Ze);for(c=0,l=p.length;c<l;++c)if((h=(r=p[c].trim()).indexOf(":"))<0){if(r=r.trim())for(o=r.split(b),f=0;f<o.length;++f)u[o[f]]=!0}else{a=r.slice(0,h).trim(),t=r.slice(h+1).trim(),a&&Be.test(a)||W("Illegal "+(i?"x:style":"x:class")+" expression.",{code:1001,expr:a||arguments[0]});try{if(!He.like(t)){u[a]=i?t:Me.tryParse(t);continue}s=He.parse(t,e,n)}catch(t){throw 1001===t.code&&(t.expr="@{0}".replace("0",t.expr)),t}s?1===s.length?u[a]=s[0]:i?u[a]=new re(oe,s):W("Illegal x:class expression.",{code:1001,expr:t}):u[a]=i?t:Me.tryParse(t)}return u}},Ke=/^\(.+\)$/,tn=/\s+of\s+/,en=/,/,nn=/^[\w\$\_]+$/,sn=/[a-zA-Z]/,rn=/[\s/>]/,an=/[\s\/]+/,on=/^x:/,ln={html:"http://www.w3.org/1999/xhtml",math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};var cn={"!":!0,br:!0,hr:!0,area:!0,base:!0,img:!0,input:!0,link:!0,meta:!0,basefont:!0,param:!0,col:!0,frame:!0,embed:!0,keygen:!0,source:!0,command:!0,track:!0,wbr:!0},fn={"x:ns":!0,"x:if":!0,"x:for":!0,"x:key":!0,"x:name":!0,"x:slot":!0,"x:type":!0,"x:class":!0,"x:style":!0};function hn(t,e){var n=t[e];return null==n&&(t[e]=n={}),n}function un(t,e){var n=g.search(t,e.constructor.resources);if("function"==typeof n){if(n.__extag_component_class__)return n;var i=Tt.get(_);if(i&&"function"==typeof(n=i.getHookableComponentClass(n))&&n.__extag_component_class__)return n}}function pn(t,e,n,i,s){var r;if("x:class"===t)n.classes=Je.parse(e,i,s,!1);else if("x:style"===t)n.style=Je.parse(e,i,s,!0);else if("x:type"===t){var a=un(e,i);a?n.type=a:(r=Se.parse(e,i,s),n.xtype=new re(ee,r))}else if("x:name"===t)n.name=e;else if("x:slot"===t)n.slot=e;else if("x:key"===t)r=Se.parse(e,i,s),n.xkey=new re(ee,r);else if("x:for"===t){var o=e.trim().split(tn);2!==o.length&&W('Illegal x:for="'+e+'".',{code:1001,expr:e}),r=o[1].trim(),o[0]=o[0].trim(),o=Ke.test(o[0])?o[0].slice(1,-1).split(en):[o[0]];for(var l=0;l<o.length;++l)o[l]=o[l].trim(),nn.test(o[l])||W('Illegal x:for="'+e+'".',{code:1001,expr:e});(r=r&&Se.parse(r,i,s))?n.xfor=[o,new re(ee,r)]:W('Illegal x:for="'+e+'".',{code:1001,expr:e}),n.identifiers=s.slice(0),n.identifiers.push(o)}else"x:if"===t?(r=Se.parse(e,i,s))?n.xif=new re(ee,r):W('Illegal x:if="'+e+'".',{code:1001,expr:e}):"x:ns"===t&&(n.ns=e)}function gn(t,e,n,i,s){var r,a,o,l=t[t.length-1];if(null!=e)if(l===m.EVENT)a=hn(n,"events"),o=t.slice(0,-1),r=Ie.parse(e,i,s),a[o]=new re(ne,r);else switch(a=hn(n,"attrs"),l){case m.DATA:o=t.slice(0,-1),r=Me.tryParse(e.trim()),a[o]=null!=r?r:new re(ee,r=Se.parse(e,i,s));break;case m.TEXT:o=t.slice(0,-1);try{r=He.parse(e,i,s)}catch(t){throw t}r?1===r.length?a[o]=r[0]:a[o]=new re(oe,r):a[o]=e;break;default:a[t]=e}else(a=hn(n,"attrs"))[t]=!0}function dn(t,e,n){for(var i=e.length,s=n;s<i;){if(t.test(e[s]))return s;s+=1}return-1}function vn(t,e,n,i){for(var s,r,a,o,l=e,c=e,f=e,h=t.length;l<h;){if(s=t[l],r){if(!w.test(s)){if(f=0<(f='"'===s||"'"===s?(c=l+1,t.indexOf(s,c)):dn(rn,t,c=l))?f:h,n)try{120===(o=r).charCodeAt(0)&&o in fn?pn(r,t.slice(c,f),n,i,n.identifiers):gn(r,t.slice(c,f),n,i,n.identifiers)}catch(t){throw t}if(">"===t[f])return f;r=null,c=f=l=f+1;continue}}else{if(">"===s){if(c<(f=l))for(a=t.slice(c,f).trim().split(an);0<a.length;)(r=a.shift())&&n&&gn(r,null,n,i,n.identifiers);return f}if("="===s){if(c<(f=l)){for(a=t.slice(c,f).trim().split(an);1<a.length;)(r=a.shift())&&n&&gn(r,null,n,i,n.identifiers);r=a.shift()}c=f=l=f+1;continue}}l+=1}}var _n=/^\s*\n\s*/,xn=/\s*\n\s*$/;function yn(t,e){return{__extag_node__:d,useExpr:!0,type:re,expr:e instanceof re?e:new re(t,e)}}function mn(t,e,n,i,s,r){var a,o=i.contents||[],l=t.slice(e,n);if(l=l.replace(_n,"").replace(xn,"")){if(He.like(l)){try{a=He.parse(l,s,r)}catch(t){throw t}if(a)if(1===a.length&&a[0]instanceof re)u=a[0],o.push(yn(a[0].binding,a[0]));else{for(var c=-1,f=0,h=a.length;f<h;++f){var u=a[f];u instanceof re&&"frag"===u.pattern.target?(c<f&&(1<f-c?o.push(yn(oe,a.slice(c,f))):a[c]instanceof re?o.push(yn(a[c].binding,a[c])):o.push(a[c])),o.push(yn(u.binding,u)),c=-1):c<0&&(c=f)}0<=c&&c<f&&(1<f-c?o.push(yn(oe,a.slice(c,f))):a[c]instanceof re?o.push(yn(a[c].binding,a[c])):o.push(a[c]))}else o.push(j(l))}else o.push(j(l));i.contents=o}}var bn=function(t,e){var n=e.constructor,i=function(t,e){var n,i,s,r,a,o,l=0,c=0,f=[],h=0,u=(t=t.trim()).length;for(r={tag:"<>",contents:[],identifiers:["this"]},f.push(r);h<u;){if("<"===t[h]){if(n=t[h+1],sn.test(n)){if(l<h&&mn(t,l,h,r,e,r.identifiers),c=dn(rn,t,l=h+1),s=t.slice(l,c),(i={}).tag=s,i.useExpr=!0,i.__extag_node__=d,i.identifiers=r.identifiers,">"!==t[c]&&(c=vn(t,l=c+=1,i,e,i.identifiers)),i.ns||(i.attrs&&i.attrs.xmlns?i.ns=(o=i.attrs.xmlns)&&o!==ln.html?o===ln.svg?"svg":o===ln.math?"math":o===ln.xlink?"xlink":null:"":r.ns&&(i.ns=r.ns)),null==i.type&&null==i.xtype)if(on.test(s))switch(s){case"x:slot":i.type=Ft;break;case"x:frag":i.type=Lt}else if(A.test(s)){var p=un(s,e);p&&(i.type=p)}r&&(r.contents=r.contents||[],r.contents.push(i)),"/"===t[c-1]||(a=s,O.call(cn,a))||(f.push(i),r=i),l=c=h=c+1;continue}if("/"===n&&sn.test(t[h+2])){if(l<h&&mn(t,l,h,r,e,r.identifiers),c=dn(rn,t,l=h+2),(s=t.slice(l,c))!==r.tag&&W("Unclosed tag "+r.tag),">"!==t[c]&&(c=vn(t,l=c+=1)),!(1<f.length))return f[0];f.pop(),0<f.length&&(r=f[f.length-1]),l=c=h=c+1;continue}if("!"===n&&"\x3c!--"===t.slice(h,h+4)){l<h&&mn(t,l,h,r,e,r.identifiers),l=h+4,l=c=h=(c=0<(c=t.indexOf("--\x3e",l))?c:t.length)+3;continue}}h+=1}return l<u&&mn(t,l,u,r,e,r.identifiers),f}(t,e)[0].contents,s=i[0];return 1!==i.length&&W("The template of component "+(n.fullname||n.name)+" must have only one root tag."),"!"!==s.tag&&"#"!==s.tag||W("Component template root tag must be a DOM element, instead of: "+t.slice(0,t.indexOf(">"))),"x:slot"!==s.tag&&"x:view"!==s.tag||W(s.tag+" can not be used as root tag of component template: "+t.slice(0,t.indexOf(">"))),s.type&&s.type.__extag_component_class__&&W("component can not be used as root tag of another component template: "+t.slice(0,t.indexOf(">"))),(s.xif||s.xfor||s.xkey)&&W("`x:if`, `x:for`, `x:key` can not be used on root tag of component template: "+t.slice(0,t.indexOf(">"))),s};return Rt.parseHTMX=bn,"undefined"!=typeof ExtagDOM&&Tt.set("view-engine",ExtagDOM),{anew:H.anew,inst:H.inst,node:Xe.node,expr:Xe.expr,conf:function(t,e){if(1===arguments.length)return Tt.get(t);Tt.set(t,e)},defineClass:M,setImmediate:yt.setImmediate,Validator:rt,Watcher:z,Model:$t,Cache:Ct,Text:Vt,Slot:Ft,Portal:Xt,Element:qt,Fragment:Lt,Component:Ut,KeepAlive:Bt,version:"0.5.7"}});
